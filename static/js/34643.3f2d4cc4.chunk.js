"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[34643],{657:(e,t,i)=>{i.d(t,{Y:()=>r});var s=i(30726),n=i(50346);class r{constructor(e,t){this._textures=e,this.loadPromise=null,this._disposed=!1;const i=this._textures.acquire(t);(0,n.$X)(i)?(i.then(e=>{this._disposed?(0,s.Gz)(e):this._textureRef=e}),this.loadPromise=i):this._textureRef=i}dispose(){this._textureRef=(0,s.Gz)(this._textureRef),this._disposed=!0}get glTexture(){var e;return null===(e=this._textureRef)||void 0===e?void 0:e.glTexture}}},79115:(e,t,i)=>{i.d(t,{z:()=>l});var s=i(15941),n=i(9392),r=i(482),o=i(14556),a=i(78315);function l(e,t,i,s){if(null==t||null==s)return!1;const n=(0,r.Tp)(t,s);if(null==(null===n||void 0===n?void 0:n.projector))return!1;if(n.projector===r.pO)return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),!0;const{source:l,dest:h,projector:p}=n;if(3===h.spatialReferenceId){const t=r.w5[l.spatialReferenceId][2];if(null==t)return!1;t((0,a.a)(e),0,d,0),(0,r.s7)(d,0,u,0);const s=c(d[1],e[2],e[3],o.$O.radius);return(0,a.e)(i,u,s),!0}if(2!==l.spatialReferenceId&&5!==l.spatialReferenceId||11!==h.spatialReferenceId){var m,f;p((0,a.a)(e),0,u,0);const t=null!==(m=l.metersPerUnit)&&void 0!==m?m:1,s=null!==(f=h.metersPerUnit)&&void 0!==f?f:1,n=e[3]*t/s;(0,a.e)(i,u,n)}else{const t=r.w5[l.spatialReferenceId][1],s=r.w5[1][11];let n=e[3];null!=t&&null!=s&&(n=c(e[1],e[2],e[3],o.$O.radius)),p((0,a.a)(e),0,u,0),(0,a.e)(i,u,n)}return!0}function c(e,t,i,s){const n=s+t;if(n<s/2||i>n)return Number.MAX_VALUE;const r=Math.abs(h*e)+Math.asin(i/n);return r>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(r)}const d=(0,n.vt)(),u=(0,n.vt)(),h=(0,s.kU)(1)},81148:(e,t,i)=>{i.d(t,{V:()=>n});var s=i(80963);function n(e){return e&&(0,s.q8)(e)?2:e&&(0,s.KQ)(e)?3:1}},87081:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ce});var s=i(6326),n=i(81806),r=i(76460),o=i(30726),a=i(68134),l=i(52394),c=i(46053),d=(i(47249),i(87990)),u=i(86300),h=i(44680),p=i(13191),m=i(4336),f=i(20664),g=i(9392),y=i(55855),b=i(34111),v=i(5809),_=i(21479),w=i(14487),M=i(2413),x=i(88105),C=i(14303),O=i(12482),T=i(97048),P=i(83491),U=i(65768);class j extends U.P{constructor(e,t,i,s,n,r,o){super(e,0,0,0,t),this.nodesCached=i,this.vboMB=s,this.textureMB=n,this.vboMBCached=r,this.textureMBCached=o}}var R=i(75228),H=i(35493),A=i(93345);const V={Points:null,Lines:null,LineStrip:null,Triangles:A.WR.TRIANGLES,TriangleStrip:A.WR.TRIANGLE_STRIP,NotSet:null},S={Opaque:1,Mask:2,Blend:0},E={Back:2,Front:1,None:0,NotSet:2},F={WrapYBit:{s:33071,t:10497},WrapXBit:{s:10497,t:33071},WrapXy:{s:10497,t:10497},None:{s:33071,t:33071},NotSet:{s:33071,t:33071}},I={U8:1,I8:1,U16:2,I16:2,U32:4,I32:4,F32:4,F64:8,Utf8String:1,NotSet:1};var k=i(45270),B=i(82805),L=i(48168);class D{constructor(e){this.layerView=e,this.type=8,this.slicePlaneEnabled=!1,this.isGround=!0,this.layerViewUid=e.uid}intersect(e,t,i,s,n,r){if(e.options.filteredLayerViewUids.includes(this.layerView.uid))return;const{results:o,tolerance:a}=e,l=2===e.options.store,{componentObjectCollection:c}=this.layerView.view.stage.renderView,d=new L.JG(a,r,e.options.normalRequired),u=(0,L.OO)(i,s,G),h=(0,f.a)((0,g.vt)(),s,i),p=(0,f.n)((0,g.vt)(),h),m=(n,r,a)=>{if(r>=0){if(null!=t&&!t(i,s,r))return;const n=e=>{const t=new k.kV(this.layerView.layer.uid);e.set(this.type,t,r,a)};if(this.isGround&&(null==o.ground.distance||r<o.ground.distance)&&n(o.ground),e.options.isFiltered)return;if((null==o.min.distance||r<o.min.distance)&&n(o.min),(null==o.max.distance||r>o.max.distance)&&n(o.max),l){const t=new B.i(e.ray);n(t),e.results.all.push(t)}}};this.layerView.forEachVisibleTile(e=>{if(!e.boundingVolumeIntersectsRay(i,p))return;const{componentObjects:t}=e;for(const n of t)(0,L.Wb)(n.aabbInWorldCoordinates,i,u,0)&&c.intersect(n,i,s,null,d,m)})}}const G=(0,g.vt)();var z=i(95225),N=i(42136),W=i(59231),q=i(10231),X=i(16449),Z=i(55002),$=i(657),J=i(81148),K=i(50468),Q=i(25672),Y=i(96897),ee=i(52757),te=i(91196),ie=i(90992),se=i(79196),ne=i(75569);class re{constructor(e,t,i,s,n,r,o){this.handle=e,this.componentObjects=t,this.textures=i,this.cpuMemoryUsage=s,this.vboMemoryUsage=n,this.textureMemoryUsage=r,this.obb=o,this.isVisible=!1,this.usedMemory=this.textureMemoryUsage+this.vboMemoryUsage+this.cpuMemoryUsage;const a=(0,g.vt)();null!==o&&void 0!==o&&o.getCenter(a),this._obbCenter=a,this._obbRadiusSquared=o?(null===o||void 0===o?void 0:o.radius)**2:0}boundingVolumeIntersectsRay(e,t){if(!this.obb)return!0;const i=(0,f.a)(oe,this._obbCenter,e),s=(0,f.f)(i,t);return(0,f.f)(i,i)-s*s<=this._obbRadiusSquared&&this.obb.intersectRay(e,t)}}const oe=(0,g.vt)();function ae(e){return Math.round(e/1048.576)/1e3}let le=class extends((0,P.w)(te.A)){get hasModifications(){return this._modifications&&this._modifications.length>0}constructor(e){super(e),this.type="integrated-mesh-3dtiles",this._compressionTracker=new se.c,this._modifications=new Array,this._visibleGeometryChangedSchedulerHandle=null,this._wasmLayerId=-1,this.ignoresMemoryFactor=!1,this._usedMemory=0,this._cacheMemory=0,this.drapeTargetType=1,this._applySSAO=!(0,n.A)("disable-feature:im-ssao"),this._shadeNormals=!!(0,n.A)("enable-feature:im-shading"),this._lyrHandleToObjects=new Map,this._visibleObjects=new Set,this._initialCullFace=new Map,this._suspendedHandle=null,this._dbgFlags=new Set,this._memCache=e.view.resourceController.memoryController.newCache("IM3DTiles-".concat(this.uid),e=>this._deletePerObjectData(e))}initialize(){var e;this._dbgFlags.add(3),this._dbg(2,"Tiles3DLayerView3D initialize() called");const{view:t}=this;if(this._updatingHandles.add(()=>this.layer.modifications,()=>this._loadModifications(),a.Vh),!this._canProjectWithoutEngine())throw(0,ie.lQ)("layer",this.layer.spatialReference.wkid,null===(e=t.renderSpatialReference)||void 0===e?void 0:e.wkid);const i=(0,R.Bk)(this).then(e=>{this._wasmLayerId=e,this._intersectionHandler=new D(this),t.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler),this._updatingHandles.add(()=>this.slicePlaneEnabled,e=>this._slicePlaneEnabledChange(e)),this._updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),a.Vh),this._updatingHandles.add(()=>this.fullOpacity,()=>this._opacityChange()),this._updatingHandles.add(()=>t.clippingArea,()=>this._clippingAreaChanged(),a.Vh),this._elevationProvider=new H.e({view:t,layerElevationSource:this,intersectionHandler:this._intersectionHandler}),t.elevationProvider.register(1,this._elevationProvider),t.overlayManager.registerDrapeTarget(this),this.addHandles([(0,a.wB)(()=>this.layer.elevationInfo,e=>this._elevationInfoChanged(e))]),this._suspendedHandle=(0,a.wB)(()=>this.suspended,e=>{var t;return null===(t=this._wasm)||void 0===t?void 0:t.setEnabled(this,!e)},a.Vh)});this.addResolvingPromise(i),this._replacesTerrain&&this.addHandles((0,a.z7)(()=>this.view.map.ground.opacity,()=>{this._opacityChange()}))}get _replacesTerrain(){var e;return this.layer.replacesTerrain&&!(null===(e=this.view.map.basemap)||void 0===e||!e.groundLayers.includes(this.layer))}get fullOpacity(){return this._replacesTerrain?this.view.map.ground.opacity:1}get opacity(){return 1}_opacityChange(){const{fullOpacity:e}=this;this.forEachComponentObject(t=>{this._collection.getMaterial(t).objectOpacity=e})}intersect(e,t,i,s){this._intersectionHandler.intersect(e,t,i,s,null,!1)}get ready(){return!0}destroy(){this._dbg(2,"Tiles3DLayerView3D destroy() called"),(0,R.r8)(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._intersectionHandler&&(this.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null),this._elevationProvider&&(this._elevationProvider.notifyObjectsChangedFunctional(e=>this.forEachComponentObject(t=>e(t.obb))),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null),this.view.overlayManager.unregisterDrapeTarget(this),this._lyrHandleToObjects.forEach(e=>this.freeObject(e)),this._lyrHandleToObjects.clear(),this._initialCullFace.clear(),this._visibleObjects.clear(),this._usedMemory=0,this._cacheMemory=0,this._memCache.destroy(),this._updatingHandles=(0,o.pR)(this._updatingHandles),this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)}_modificationsChanged(){var e;const t=this.layer.spatialReference,i=(0,T.Ir)(this._layerClippingArea,this._modifications,t);null===(e=this._wasm)||void 0===e||e.setMeshModifications(this,i,t.wkid)}_clippingAreaChanged(){const e=this.layer.spatialReference,t=(0,M.vt)();this._layerClippingArea=(0,N.k)(this.view.clippingArea,t,e)?t:null,this._modificationsChanged()}_visibleGeometryChanged(){var e;null!==(e=this._visibleGeometryChangedSchedulerHandle)&&void 0!==e||(this._visibleGeometryChangedSchedulerHandle=(0,l._)(()=>{this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle=null}))}_slicePlaneEnabledChange(e){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=e),this.forEachComponentObject(t=>{const i=this._collection.getMaterial(t);i.commonMaterialParameters.hasSlicePlane=e,i.commonMaterialParameters.cullFace=e?0:this._initialCullFace.get(t)})}_elevationInfoChanged(e){var t;null===(t=this._wasm)||void 0===t||t.setLayerOffset(this,(0,O.M7)(e))}get _wasm(){return(0,R.pw)(this.view)}get wasmLayerId(){return this._wasmLayerId}get usedMemory(){return this._usedMemory}get unloadedMemory(){return 0}get cachedMemory(){return this._cacheMemory}get visibleAtCurrentScale(){return(0,ie.E5)(this.layer.effectiveScaleRange,this.view.scale)}get performanceInfo(){let e=0,t=0,i=0,s=0,n=0,r=0;return this._lyrHandleToObjects.forEach(o=>{o.isVisible?(e+=o.textureMemoryUsage,t+=o.vboMemoryUsage,n++):(i+=o.textureMemoryUsage,s+=o.vboMemoryUsage,r++)}),new j(this.usedMemory,n,r,ae(t),ae(e),ae(s),ae(i))}_canProjectWithoutEngine(){if(2===this.view.state.viewingMode){var e,t,i;const s=null!==(e=this.view.renderSpatialReference)&&void 0!==e&&e.isWebMercator?3857:null!==(t=null===(i=this.view.renderSpatialReference)||void 0===i?void 0:i.wkid)&&void 0!==t?t:-1;if(3857!==s&&32662!==s)return!1}return!0}get _stage(){return this.view.stage}get _collection(){return this._stage.renderView.componentObjectCollection}get elevationProvider(){return this._elevationProvider}get elevationOffset(){return(0,O.M7)(this.layer.elevationInfo)}get elevationRange(){const e=this.fullExtent;return null!==e&&void 0!==e&&e.zmin&&null!==e&&void 0!==e&&e.zmax?new z.H(e.zmin,e.zmax):null}getElevationRange(e){return null}get fullExtent(){return this.layer.fullExtent}forEachComponentObject(e){this._forEachObject(this._lyrHandleToObjects.values(),e)}forEachVisibleTile(e){for(const t of this._visibleObjects)e(t)}forEachVisibleComponentObject(e){this._forEachObject(this._visibleObjects,e)}_forEachObject(e,t){for(const i of e)for(const e of i.componentObjects)t(e)}isUpdating(){const e=this._wasm;return!(this._wasmLayerId<0||null==e)&&(e.isUpdating(this._wasmLayerId)||this._compressionTracker.compressing)}updatingFlagChanged(){this.notifyChange("updating")}async createRenderable(e){const t=e.meshData;if(null==t.data)throw new Error("meshData.data undefined");if(t.desc=JSON.parse(t.desc),null==t.desc)throw new Error("meshData.desc undefined");const i=(0,g.ci)(t.desc.origin),s=new Array,n=this.view.basemapTerrain.spatialReference;let r,o;if("global"===this.view.viewingMode){const e=(0,p.vt)();(0,v.l)(b.fv,i,e,n),r=(0,u.z0)((0,h.vt)(),e),o=(0,u.B8)((0,h.vt)(),r)}else r=h.zK,o=h.zK;const a=(0,g.o8)(i),l=(0,g.vt)(),c=function(e){return e?new W.ab(e.center,e.halfSize,(0,m.fA)(...e.quaternion)):null}(t.desc.obb);let d=0,M=0;const C={textureMemoryUsage:0},O=new Array,T=new Map,P=t.desc.prims.length;for(let u=0;u<P;u++){var U,j;const e=t.desc.prims[u];if(this._dbg(2,JSON.stringify(e)),null==V[e.ptype]||null==t.data){this._dbg(2,"[Unsupported Feature] Unsupported primitive mode ("+e.ptype+"). Skipping primitive.");continue}const p=null!==(U=t.desc)&&void 0!==U&&U.materials&&null!=e.materialId?t.desc.materials[e.materialId]:null,m=null!=p?p.lightingModel:"Unlit",{positionView:b,positionAttr:v,normalsView:P,normalsAttr:R,colorAttr:H,texCoord0Attr:A,indicesView:F}=this.getBufferViews(e,t.data.buffer,r);if(null==v||null==b||null==F)continue;const I=new X.$3(null!=H,A?1:0,null!=P,this._shadeNormals||this._replacesTerrain,this._applySSAO),k=v.data.length/v.size,B=(e,t)=>!e||e.data.length/e.size===k||(this._dbg(3,"".concat(t," !== numPos. Skipping primitive.")),!1);if(!B(A,"numTexcoord")||!B(H,"numColors")||!B(R,"normals"))continue;const L=(0,X.hH)(I),D=null!==(j=null===c||void 0===c?void 0:c.clone())&&void 0!==j?j:ue(v,i);if(r!==h.zK)for(let t=0;t<b.count;t++)b.getVec(t,l),(0,f.o)(l,l,r),b.setVec(t,l);const G=L.createBuffer(v.data.length);if((0,ee.Ap)("position",v,null,null,G,0),null!=A){const e=G.getField("uv0",x.gH);(0,ee.Ue)(A,e,0)}null!=H&&(0,ee.Ap)("color",H,null,null,G,0),null!=R&&(0,ee.Ap)("normalCompressed",R,null,null,G,0);const z=new Uint32Array([0,F.typedBuffer.length]),N=new X.s5({data:G.buffer,count:G.byteLength/L.stride,layoutParameters:I},{positions:b.typedBuffer,indices:F.typedBuffer},F.typedBuffer,z);d+=b.count+F.count;const W=this.view.renderSpatialReference,$=(0,g.vt)(),K=[1,1,1];(0,_.f)(a,W,K,n)||this._dbg(3,"Unsupported coordinate system for IM overlay"),(0,w.F)(a,W,$,n);const Q=this._collection.createObject(new q.i((0,y.fA)($[0],$[1],K[0],K[1]),new Z.d(a,o),D,N,!1));if(p){const e=e=>{var i,n;e.baseColor=p.baseColorFactor,e.usePBR="Pbr"===m,e.hasParametersFromSource=!1,e.baseColorTexture=this._getTexture(p.baseColorTex,t,T,C),e.usePBR&&(e.mrrFactors=[p.metallicFactor,p.roughnessFactor,0],e.emissiveBaseColor=null!==(i=p.emissiveFactor)&&void 0!==i?i:[0,0,0],e.metallicRoughnessTexture=this._getTexture(p.metalTex,t,T,C),e.emissionTexture=this._getTexture(p.emissiveTex,t,T,C),e.occlusionTexture=this._getTexture(p.occlusionTex,t,T,C),e.normalTexture=this._getTexture(p.normalTex,t,T,C)),e.objectOpacity=0,e.alphaDiscardMode=2;const r=[];e.baseColorTexture&&r.push(e.baseColorTexture.loadPromise),e.usePBR&&(e.metallicRoughnessTexture&&r.push(e.metallicRoughnessTexture.loadPromise),e.emissionTexture&&r.push(e.emissionTexture.loadPromise),e.occlusionTexture&&r.push(e.occlusionTexture.loadPromise),e.normalTexture&&r.push(e.normalTexture.loadPromise));const o=Promise.all(r);s.push(o),o.then(()=>{var t,i,s,n,r,o,a,l,c,d;e.alphaDiscardMode=S[p.alphaMode],e.objectOpacity=this.fullOpacity,C.textureMemoryUsage+=null!==(t=null===(i=e.baseColorTexture)||void 0===i||null===(i=i.glTexture)||void 0===i?void 0:i.usedMemory)&&void 0!==t?t:0,e.usePBR&&(C.textureMemoryUsage+=(null!==(s=null===(n=e.metallicRoughnessTexture)||void 0===n||null===(n=n.glTexture)||void 0===n?void 0:n.usedMemory)&&void 0!==s?s:0)+(null!==(r=null===(o=e.emissionTexture)||void 0===o||null===(o=o.glTexture)||void 0===o?void 0:o.usedMemory)&&void 0!==r?r:0)+(null!==(a=null===(l=e.occlusionTexture)||void 0===l||null===(l=l.glTexture)||void 0===l?void 0:l.usedMemory)&&void 0!==a?a:0)+(null!==(c=null===(d=e.normalTexture)||void 0===d||null===(d=d.glTexture)||void 0===d?void 0:d.usedMemory)&&void 0!==c?c:0))}),e.commonMaterialParameters.doubleSided=p.isDoubleSided,e.commonMaterialParameters.cullFace=p.faceCulling?E[p.faceCulling]:0,this._initialCullFace.set(Q,e.commonMaterialParameters.cullFace),e.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled,e.componentParameters.castShadows=0,e.textureAlphaCutoff=null!==(n=p.alphaCutoff)&&void 0!==n?n:ne.Q,e.alphaDiscardMode=S[p.alphaMode],e.isIntegratedMesh=!0,e.sphereDepthInterpolate=this.layer.hasGoogleUrl,e.polygonOffsetEnabled=!1,e.hasOccludees=!1,e.ellipsoidMode=(0,J.V)(this.view.spatialReference)};this._collection.updateMaterial(Q,e)}O.push(Q),M+=this._collection.getObjectGPUMemoryUsage(Q)}await Promise.all(s);const R=new Array;T.forEach(e=>{R.push(e)});const H=new re(e.handle,O,R,d,M,C.textureMemoryUsage,c);return this._memCache.put("".concat(H.handle),H),this._lyrHandleToObjects.set(e.handle,H),this._cacheMemory+=H.usedMemory,{memUsageBytes:H.usedMemory}}freeRenderable(e){const t=this._lyrHandleToObjects.get(e);t&&(t.isVisible?(this._visibleObjects.delete(t),this._usedMemory-=t.usedMemory):this._cacheMemory-=t.usedMemory,this.freeObject(t),this._lyrHandleToObjects.delete(e))}freeObject(e){this._memCache.pop("".concat(e.handle)),e.textures.forEach(e=>this._stage.removeTexture(e)),e.componentObjects.forEach(e=>{this._collection.destroyObject(e),this._initialCullFace.delete(e)})}setRenderableVisibility(e,t,i){for(let s=0;s<i;++s){const i=t[s];if(!i)continue;const n=e[s],r=this._lyrHandleToObjects.get(n);if(r){if(r.isVisible)continue;this._visibleGeometryChanged(),r.isVisible=!0,this._visibleObjects.add(r),this._usedMemory+=r.usedMemory,this._cacheMemory-=r.usedMemory,r.componentObjects.forEach(e=>{this._collection.setObjectVisibility(e,i),this._elevationProvider.notifyObjectChanged(this._collection.getComponentObb(e))}),this._memCache.pop("".concat(n))}}for(let s=0;s<i;++s){const i=e[s],n=t[s];if(n)continue;const r=this._lyrHandleToObjects.get(i);if(r){if(!r.isVisible)continue;this._visibleGeometryChanged(),r.isVisible=!1,this._visibleObjects.delete(r),this._usedMemory-=r.usedMemory,this._cacheMemory+=r.usedMemory,r.componentObjects.forEach(e=>{this._collection.setObjectVisibility(e,n),this._elevationProvider.notifyObjectChanged(this._collection.getComponentObb(e))}),this._memCache.put("".concat(i),r)}}}_getTexture(e,t,i,s){var r,o;let a=null;if(e&&null!==(r=t.desc)&&void 0!==r&&r.images&&null!==(o=t.data)&&void 0!==o&&o.buffer){const r=t.desc.images[null===e||void 0===e?void 0:e.imageId];if(a=i.get(r),!a&&r){var l;const o=this._stage.renderView.renderingContext.parameters.maxMaxAnisotropy,c=!!r.mipCount||o>1,d=F[null!==(l=e.wrapMode)&&void 0!==l?l:"None"];let u=r.alpha?6408:6407;const h=new Uint8Array(t.data.buffer,r.data.byteOffset,r.data.byteCount);let p=null,m=null,f=null;switch(r.format){case"Raw":"R8"===r.pixelFormat?(p=h,u=6403,m=""):"Rgb8"===r.pixelFormat?(p=h,u=6407,m=""):"Rgba8"===r.pixelFormat&&(p=h,u=6408,m="");break;case"Dxt1":p=h,u=6407,m="image/vnd-ms.dds";break;case"Dxt5":p=h,u=6408,m="image/vnd-ms.dds";break;case"Basis":p=h,u=6407,m="image/ktx2";break;case"Png":m="image/png",f=document.createElement("img");break;case"Jpeg":m="image/jpeg",f=document.createElement("img");break;case"Etc2":m="image/ktx",f=document.createElement("img");break;case"Astc":this._dbg(3,"Astc texture not supported");break;case"Pvrtc":this._dbg(3,"Pvrtc texture not supported")}if(f&&m){const e=new Blob([h],{type:m});f.src=URL.createObjectURL(e),p=f}if(p&&null!=m){const e=(0,n.A)("enable-feature:esri-compress-IM-textures")?{compressionTracker:this._compressionTracker,compressionCallback:e=>{e&&e>0&&(s.textureMemoryUsage-=e)}}:void 0;a=new Y.g(p,{mipmap:c,maxAnisotropy:o,encoding:m,wrap:d,pixelFormat:u,compressionOptions:e,noUnpackFlip:!0,width:r.mip0Width,height:r.mip0Height}),this._stage.addTexture(a),i.set(r,a)}}}return a?new $.Y(this.view.stage.renderView.textures,a.id):null}getBufferViews(e,t,i){let s,n,r,o,a,l,c,d=null;for(let h=0;h<e.atrbs.length;h++){const c=e.atrbs[h],p=c.view,m=void 0,f=p.byteOffset+p.byteCount,g=p.byteCount/I[p.type],y=[...Array(g).keys()].map(e=>e);try{switch(c.sem){case"Position":3!==p.ncomp||"F32"!==p.type?this._dbg(3,"[Unsupported Feature] Unsupported view for Position ("+p+")"):(s=new x.xs(t,p.byteOffset,m,f),n=new K.n(s.typedBuffer,y,3));break;case"Normal":if(3!==p.ncomp||"F32"!==p.type)this._dbg(3,"[Unsupported Feature] Unsupported view for Normal ("+p+")");else{const e=new x.xs(t,p.byteOffset,m,f),s=(0,Q._l)(e.typedBuffer,i);a=new x.Qt(s.buffer),l=new K.n(a.typedBuffer,y,2)}break;case"TexCoord":2!==p.ncomp||"F32"!==p.type?this._dbg(3,"[Unsupported Feature] Unsupported view for Texcoord ("+p+")"):void 0===o&&(o=new K.n(new x.gH(t,p.byteOffset,m,f).typedBuffer,y,2));break;case"Color":4===p.ncomp?("F32"===p.type&&(d=new x.Eq(t,p.byteOffset,m,f)),"U8"===p.type&&(d=new x.XP(t,p.byteOffset,m,f)),"U16"===p.type&&(d=new x.Uz(t,p.byteOffset,m,f))):3===p.ncomp&&("F32"===p.type&&(d=new x.xs(t,p.byteOffset,m,f)),"U8"===p.type&&(d=new x.eI(t,p.byteOffset,m,f)),"U16"===p.type&&(d=new x.nS(t,p.byteOffset,m,f))),null==d?this._dbg(2,"[Unsupported Feature] Unsupported view for Color ("+p+")"):r=new K.n(d.typedBuffer,y,p.ncomp);break;case"FeatureIndex":break;default:this._dbg(2,"[Unsupported Feature] Unsupported semantic ("+c.sem+"). Skipping vertex attribute.")}}catch(u){this._dbg(2,"Error Creating buffer ("+u+"). Skipping vertex attribute.")}}if(e.index){const i=e.index.view,s=void 0,n=i.byteOffset+i.byteCount;switch(e.index.view.type){case"U16":c=new x.h(t,i.byteOffset,s,n);break;case"U32":c=new x.P(t,i.byteOffset,s,n);break;default:this._dbg(3,"[Unsupported Feature] index type not supported ("+i.type+").")}}if(null==c&&null!=s){const e=s.count;if(e<65535){const t=new Uint16Array(e);c=new x.h(t.buffer)}else{const t=new Uint32Array(e);c=new x.P(t.buffer)}for(let t=0;t<e;t++)c.set(t,t)}return{positionView:s,positionAttr:n,colorAttr:r,texCoord0Attr:o,indicesView:c,normalsView:a,normalsAttr:l}}_loadModifications(){if(this.removeHandles("modifications"),null==this.layer.modifications)return void(this._modifications=[]);const e=this.layer.modifications;this.addHandles(this._updatingHandles.addOnCollectionChange(()=>e,()=>this._modifications=e.toArray(),a.Vh),"modifications")}_deletePerObjectData(e){var t;null!==(t=this._wasm)&&void 0!==t&&t.onRenderableEvicted(this,e.handle,e.usedMemory),this.freeRenderable(e.handle)}_dbg(e,t){this._dbgFlags.has(e)&&(3===e?r.A.getLogger(this).error(t):r.A.getLogger(this).warn(t))}};(0,s.Cg)([(0,c.MZ)()],le.prototype,"fullOpacity",null),(0,s.Cg)([(0,c.MZ)({type:[C.A]})],le.prototype,"_modifications",void 0),(0,s.Cg)([(0,c.MZ)()],le.prototype,"_visibleGeometryChangedSchedulerHandle",void 0),(0,s.Cg)([(0,c.MZ)()],le.prototype,"layer",void 0),(0,s.Cg)([(0,c.MZ)({readOnly:!0})],le.prototype,"visibleAtCurrentScale",null),(0,s.Cg)([(0,c.MZ)()],le.prototype,"elevationOffset",null),le=(0,s.Cg)([(0,d.$)("esri.views.3d.layers.IntegratedMesh3DTilesLayerView3D")],le);const ce=le,de=(0,g.vt)();function ue(e,t){const i=(0,W.OX)(e);return(0,f.g)(de,i.center,t),i.center=de,i}}}]);
//# sourceMappingURL=34643.3f2d4cc4.chunk.js.map