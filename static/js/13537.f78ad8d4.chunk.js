"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[2259,13537,96141],{2259:(e,t,n)=>{n.d(t,{o6:()=>C,extractComponentsEdgeLocationsLayout:()=>I,hx:()=>b,Jb:()=>x});var r=n(77176);function i(e,t,n){const r=t/3,i=new Uint32Array(n+1),o=new Uint32Array(n+1),s=(e,t)=>{e<t?i[e+1]++:o[t+1]++};for(let v=0;v<r;v++){const t=e[3*v],n=e[3*v+1],r=e[3*v+2];s(t,n),s(n,r),s(r,t)}let a=0,c=0;for(let v=0;v<n;v++){const e=i[v+1],t=o[v+1];i[v+1]=a,o[v+1]=c,a+=e,c+=t}const d=new Uint32Array(6*r),l=i[n],u=(e,t,n)=>{if(e<t){const r=i[e+1]++;d[2*r]=t,d[2*r+1]=n}else{const r=o[t+1]++;d[2*l+2*r]=e,d[2*l+2*r+1]=n}};for(let v=0;v<r;v++){const t=e[3*v],n=e[3*v+1],r=e[3*v+2];u(t,n,v),u(n,r,v),u(r,t,v)}const f=(e,t)=>{const n=2*e,r=t-e;for(let i=1;i<r;i++){const e=d[n+2*i],t=d[n+2*i+1];let r=i-1;for(;r>=0&&d[n+2*r]>e;r--)d[n+2*r+2]=d[n+2*r],d[n+2*r+3]=d[n+2*r+1];d[n+2*r+2]=e,d[n+2*r+3]=t}};for(let v=0;v<n;v++)f(i[v],i[v+1]),f(l+o[v],l+o[v+1]);const h=new Int32Array(3*r),p=(t,n)=>t===e[3*n]?0:t===e[3*n+1]?1:t===e[3*n+2]?2:-1,g=(e,t)=>{const n=p(e,t);h[3*t+n]=-1},y=(e,t,n,r)=>{const i=p(e,t);h[3*t+i]=r;const o=p(n,r);h[3*r+o]=t};for(let v=0;v<n;v++){let e=i[v];const t=i[v+1];let n=o[v];const r=o[v+1];for(;e<t&&n<r;){const t=d[2*e],r=d[2*l+2*n];t===r?(y(v,d[2*e+1],r,d[2*l+2*n+1]),e++,n++):t<r?(g(v,d[2*e+1]),e++):(g(r,d[2*l+2*n+1]),n++)}for(;e<t;)g(v,d[2*e+1]),e++;for(;n<r;)g(d[2*l+2*n],d[2*l+2*n+1]),n++}return h}var o=n(48549),s=n(96141),a=n(47249),c=n(20664),d=n(9392),l=n(25672);class u{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?y:g}write(e,t,n){_.seed=this._edgeHashFunction(n);const r=_.getIntRange(0,255),i=_.getIntRange(0,this.settings.variants-1),o=_.getFloat(),s=255*(.5*function(e,t){return Math.abs(e)**t*Math.sign(e)}(-(1-Math.min(o/.7,1))+Math.max(0,o-.7)/(1-.7),1.2)+.5);e.position0.setVec(t,n.position0),e.position1.setVec(t,n.position1),e.componentIndex.set(t,n.componentIndex),e.variantOffset.set(t,r),e.variantStroke.set(t,i),e.variantExtension.set(t,s)}}const f=new Float32Array(6),h=new Uint32Array(f.buffer),p=new Uint32Array(1);function g(e){return f[0]=e.position0[0],f[1]=e.position0[1],f[2]=e.position0[2],f[3]=e.position1[0],f[4]=e.position1[1],f[5]=e.position1[2],p[0]=31*(31*(31*(31*(31*(166811+h[0])+h[1])+h[2])+h[3])+h[4])+h[5],p[0]}function y(e){const t=f;t[0]=w(e.position0[0]),t[1]=w(e.position0[1]),t[2]=w(e.position0[2]),t[3]=w(e.position1[0]),t[4]=w(e.position1[1]),t[5]=w(e.position1[2]),p[0]=5381;for(let n=0;n<h.length;n++)p[0]=31*p[0]+h[n];return p[0]}const v=1e4;function w(e){return Math.round(e*v)/v}const m=(0,d.vt)(),_=new a.A;var S=n(7150);function C(e){const t=b(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return L.updateSettings(e.writerSettings),A.updateSettings(e.writerSettings),(0,S.K)(t,L,A)}function b(e,t,n,o){if(t){const t=i(n,o,e.count);return new k(n,o,t,e)}const a=(0,r.b)(e.buffer,e.stride/4,{originalIndices:n}),c=i(a.indices,o,a.uniqueCount);return{faces:a.indices,facesLength:a.indices.length,neighbors:c,vertices:s.EdgeInputBufferLayout.createView(a.buffer)}}class k{constructor(e,t,n,r){this.faces=e,this.facesLength=t,this.neighbors=n,this.vertices=r}}const L=new class{constructor(){this._commonWriter=new u}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return s.gr.createBuffer(e)}write(e,t,n){this._commonWriter.write(e,t,n),(0,c.g)(m,n.faceNormal0,n.faceNormal1),(0,c.n)(m,m);const{typedBuffer:r,typedBufferStride:i}=e.normalCompressed;(0,l.aT)(r,t,m[0],m[1],m[2],i)}},A=new class{constructor(){this._commonWriter=new u}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return s.In.createBuffer(e)}write(e,t,n){this._commonWriter.write(e,t,n);{const{typedBuffer:r,typedBufferStride:i}=e.normalCompressed;(0,l.aT)(r,t,n.faceNormal0[0],n.faceNormal0[1],n.faceNormal0[2],i)}{const{typedBuffer:r,typedBufferStride:i}=e.normal2Compressed;(0,l.aT)(r,t,n.faceNormal1[0],n.faceNormal1[1],n.faceNormal1[2],i)}}},x=(0,o.BP)().vec3f("position0").vec3f("position1"),I=(0,o.BP)().vec3f("position0").vec3f("position1").u16("componentIndex")},12580:(e,t,n)=>{n.d(t,{L:()=>i,s:()=>o});var r=n(48549);function i(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:new r.l5(e.layout)}}function o(e){return new r.q3(e.layout).createView(e.buffer)}},13537:(e,t,n)=>{n.r(t),n.d(t,{SceneLayerSnappingSource:()=>k});var r=n(6326),i=n(91967),o=n(18690),s=n(50346),a=n(46053),c=(n(81806),n(76460),n(87990)),d=n(54901),l=n(30726),u=(n(47249),n(19451)),f=n(74527),h=n(9392),p=n(12016),g=n(78315),y=n(23862),v=n(9876),w=n(72317);let m=class extends i.A{constructor(e){super(e),this.availability=0,this._ids=new Set}destroy(){this._workerHandle.destroy(),this._workerHandle=null}initialize(){this._workerHandle=new _(this.schedule,{fetchAllEdgeLocations:(e,t)=>this._fetchAllEdgeLocations(e,t)})}async fetchCandidates(e,t){const n=e.coordinateHelper,{point:r}=e,i=S;this.renderCoordsHelper.toRenderCoords(r,n.spatialReference,i);const o=e.distance,s="number"==typeof o?o:o.distance,a=await this._workerHandle.invoke({bounds:(0,g.f)(i[0],i[1],i[2],s),returnEdge:e.returnEdge,returnVertex:"none"!==e.vertexMode},t);return a.candidates.sort((e,t)=>e.distance-t.distance),a.candidates.map(e=>this._convertCandidate(n,e))}async add(e,t){this._ids.add(e.id),await this._workerHandle.invokeMethod("add",e,t)}async remove(e,t){this._ids.delete(e.id),await this._workerHandle.invokeMethod("remove",e,t)}_convertCandidate(e,t){switch(t.type){case"edge":return new v.z({objectId:t.objectId,targetPoint:(0,y.de)(this._convertRenderCoordinate(e,t.target)),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),isDraped:!1});case"vertex":return new w.C({objectId:t.objectId,targetPoint:(0,y.de)(this._convertRenderCoordinate(e,t.target)),isDraped:!1})}}_convertRenderCoordinate(e,t){let{spatialReference:n}=e;const r=(0,h.vt)();return this.renderCoordsHelper.fromRenderCoords(t,r,n),(0,y._7)(r)}async _fetchAllEdgeLocations(e,t){const n=[],r=[];for(const{id:i,uid:o}of e.components)this._ids.has(i)&&n.push((async()=>{const e=await this.fetchEdgeLocations(i,t.signal),n=e.locations.buffer;return r.push(n),{id:i,uid:o,objectIds:e.objectIds,locations:n,origin:e.origin,type:e.type}})());return{result:{components:(await Promise.all(n)).filter(e=>{let{id:t}=e;return this._ids.has(t)})},transferList:r}}};(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],m.prototype,"renderCoordsHelper",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],m.prototype,"fetchEdgeLocations",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],m.prototype,"schedule",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],m.prototype,"availability",void 0),m=(0,r.Cg)([(0,c.$)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorkerHandle")],m);class _ extends p.B{constructor(e,t){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:t})}}const S=(0,h.vt)();let C=class extends i.A{get updating(){return this._updatingHandles.updating}constructor(e){super(e),this.availability=1,this._updatingHandles=new u.U,this._abortController=new AbortController}destroy(){this._tracker=(0,l.xt)(this._tracker),this._abortController=(0,l.DC)(this._abortController),this._updatingHandles.destroy()}initialize(){const{view:e}=this,t=e.resourceController;this._edgeWorker=new f.U(b(t)),this._workerHandle=new m({renderCoordsHelper:this.view.renderCoordsHelper,schedule:b(t),fetchEdgeLocations:async(e,t)=>{if(null==this._tracker)throw new Error("tracker-not-initialized");return this._tracker.fetchEdgeLocations(e,this._edgeWorker,t)}}),this._updatingHandles.addPromise(this._setupLayerView()),this.addHandles([(0,d.DQ)(this._workerHandle),(0,d.DQ)(this._edgeWorker)])}async fetchCandidates(e,t){return this._workerHandle.fetchCandidates(e,t)}refresh(){}async _setupLayerView(){var e;if(this.destroyed)return;const t=null===(e=this._abortController)||void 0===e?void 0:e.signal,n=await this.getLayerView();null==n||(0,s.G4)(t)||(this._tracker=n.trackSnappingSources({add:(e,n)=>{this._updatingHandles.addPromise(this._workerHandle.add({id:e,bounds:n},t))},remove:e=>{this._updatingHandles.addPromise(this._workerHandle.remove({id:e},t))}}))}};function b(e){return t=>e.immediate.schedule(t)}(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],C.prototype,"getLayerView",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],C.prototype,"view",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],C.prototype,"updating",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],C.prototype,"availability",void 0),C=(0,r.Cg)([(0,c.$)("esri.views.interactive.snapping.featureSources.I3SSnappingSource")],C);let k=class extends i.A{get updating(){return this._i3sSources.some(e=>e.updating)}constructor(e){super(e),this.availability=1,this._i3sSources=[]}destroy(){this._i3sSources.forEach(e=>e.destroy()),this._i3sSources.length=0}initialize(){const{view:e}=this,t=this.layerSource.layer;this._i3sSources="building-scene"===t.type?this._getBuildingSceneI3SSources(e,t):[this._getSceneLayerI3SSource(e,t)]}async fetchCandidates(e,t){const n=await Promise.all(this._i3sSources.map(n=>n.fetchCandidates(e,t)));return(0,s.Te)(t),n.flat()}refresh(){this._i3sSources.forEach(e=>e.refresh())}_getBuildingSceneI3SSources(e,t){return t.allSublayers.toArray().map(n=>"building-component"===n.type?new C({getLayerView:async()=>(await e.whenLayerView(t)).whenSublayerView(n),view:e}):null).filter(o.Ru)}_getSceneLayerI3SSource(e,t){return new C({getLayerView:async()=>{const n=await e.whenLayerView(t);return"scene-layer-graphics-3d"===n.type?void 0:n},view:e})}};(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],k.prototype,"layerSource",void 0),(0,r.Cg)([(0,a.MZ)({constructOnly:!0})],k.prototype,"view",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],k.prototype,"updating",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],k.prototype,"availability",void 0),k=(0,r.Cg)([(0,c.$)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],k)},23241:(e,t,n)=>{n.d(t,{_:()=>o});var r=n(20664),i=n(64753);class o extends i.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof o&&(0,r.q)(this.point,e.point)}}},72317:(e,t,n)=>{n.d(t,{C:()=>a});var r=n(89379),i=n(75543),o=n(61751),s=n(23241);class a extends o.w{constructor(e){super((0,r.A)((0,r.A)({},e),{},{constraint:new i.i7(e.targetPoint)}))}get hints(){return[new s._(this.targetPoint,this.isDraped,this.domain)]}}},74527:(e,t,n)=>{n.d(t,{U:()=>a});var r=n(78393),i=n(12016),o=n(12580),s=n(2259);class a extends i.B{constructor(e){super("EdgeProcessingWorker","extract",{extract:e=>[e.dataBuffer],extractComponentsEdgeLocations:e=>[e.dataBuffer],extractEdgeLocations:e=>[e.dataBuffer]},e)}async process(e,t,n){return n?(0,s.o6)(e):function(e){return{regular:{instancesData:(0,o.s)(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:(0,o.s)(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}(await this.invoke(new c(e),t))}async extractEdgeLocations(e,t){const n=await this.invokeMethod("extractEdgeLocations",new c(e),t);return(0,o.s)(n)}async extractComponentsEdgeLocations(e,t){const n=await this.invokeMethod("extractComponentsEdgeLocations",new c(e),t);return(0,o.s)(n)}}class c{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=(0,r.iu)(e.indices)?e.indices.buffer:e.indices,this.indicesType=(0,r.iu)(e.indices)?(0,r.XJ)(e.indices)?"Uint32Array":"Uint16Array":"Array",this.indicesLength=e.indicesLength}}},77176:(e,t,n)=>{n.d(t,{b:()=>o});var r=n(15941),i=n(38496);function o(e,t,n){var o;const l=Array.isArray(e),u=l?e.length/t:e.byteLength/(4*t),f=l?e:new Uint32Array(e,0,u*t),h=null!==(o=null===n||void 0===n?void 0:n.minReduction)&&void 0!==o?o:0,p=(null===n||void 0===n?void 0:n.originalIndices)||null,g=p?p.length:0,y=(null===n||void 0===n?void 0:n.componentOffsets)||null;let v=0;if(y)for(let r=0;r<y.length-1;r++){const e=y[r+1]-y[r];e>v&&(v=e)}else v=u;const w=Math.floor(1.1*v)+1;(null==d||d.length<2*w)&&(d=new Uint32Array((0,r.cU)(2*w)));for(let r=0;r<2*w;r++)d[r]=0;let m=0;const _=!!y&&!!p,S=_?g:u;let C=(0,i.my)(u);const b=new Uint32Array(g),k=1.96;let L=0!==h?Math.ceil(4*k*k/(h*h)*h*(1-h)):S,A=1,x=y?y[1]:S;for(let r=0;r<S;r++){if(r===L){const e=1-m/r;if(e+k*Math.sqrt(e*(1-e)/r)<h)return null;L*=2}if(r===x){for(let e=0;e<2*w;e++)d[e]=0;if(p)for(let e=y[A-1];e<y[A];e++)b[e]=C[p[e]];x=y[++A]}const e=_?p[r]:r,n=e*t,i=c(f,n,t);let o=i%w,a=m;for(;0!==d[2*o+1];){if(d[2*o]===i){const e=d[2*o+1]-1;if(s(f,n,e*t,t)){a=C[e];break}}o++,o>=w&&(o-=w)}a===m&&(d[2*o]=i,d[2*o+1]=e+1,m++),C[e]=a}if(0!==h&&1-m/u<h)return null;if(_){for(let e=y[A-1];e<b.length;e++)b[e]=C[p[e]];C=(0,i.uW)(b)}const I=l?new Array(m):new Uint32Array(m*t);m=0;for(let r=0;r<S;r++)C[r]===m&&(a(f,(_?p[r]:r)*t,I,m*t,t),m++);if(p&&!_){const e=new Uint32Array(g);for(let t=0;t<e.length;t++)e[t]=C[p[t]];C=(0,i.uW)(e)}return{buffer:Array.isArray(I)?I:I.buffer,indices:C,uniqueCount:m}}function s(e,t,n,r){for(let i=0;i<r;i++)if(e[t+i]!==e[n+i])return!1;return!0}function a(e,t,n,r,i){for(let o=0;o<i;o++)n[r+o]=e[t+o]}function c(e,t,n){let r=0;for(let i=0;i<n;i++)r=e[t+i]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let d=null},96141:(e,t,n)=>{n.d(t,{EdgeInputBufferLayout:()=>s,In:()=>l,g6:()=>h,gr:()=>d,kU:()=>p,lX:()=>u,pz:()=>f,vJ:()=>a,wO:()=>c});var r=n(57481),i=n(48549),o=n(75757);const s=(0,i.BP)().vec3f("position").u16("componentIndex").freeze(),a=(0,i.BP)().vec2u8("sideness").freeze(),c=(0,r.U)(a),d=(0,i.BP)().vec3f("position0").vec3f("position1").vec2i16("normalCompressed").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).freeze(),l=(0,i.BP)().vec3f("position0").vec3f("position1").vec2i16("normalCompressed").vec2i16("normal2Compressed").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).freeze(),u=(0,r.U)(d,1),f=(0,r.U)(l,1),h=(0,o._u)([c,u]),p=(0,o._u)([c,f])}}]);
//# sourceMappingURL=13537.f78ad8d4.chunk.js.map