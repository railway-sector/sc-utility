"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[1509,53154,58067,68707],{10294:(e,t,r)=>{r.d(t,{S:()=>l});var s=r(15941),i=r(31633),n=r(20664),o=r(5568),a=r(13927);function l(e,t,r){const l=function(e,t,r,s){const o=(e=>!Array.isArray(e[0]))(t)?(e,r)=>t[3*e+r]:(e,r)=>t[e][r],l=s?(0,i.GA)(s)/(0,i.G9)(s):1;return(0,a.lU)(e,(e,t)=>(0,n.i)(e,o(t,0)*l,o(t,1)*l,o(t,2)),r)}(c,e,t,r)?(0,a.Qj)(c):[0,0,1];return Math.abs(l[2])>Math.cos((0,s.kU)(80))?o._.Z:Math.abs(l[1])>Math.abs(l[0])?o._.Y:o._.X}const c=(0,a.vt)()},38983:(e,t,r)=>{function s(e,t,r){r=r||2;var s,n,a,l,c,u,d,p=t&&t.length,f=p?t[0]*r:e.length,_=i(e,0,f,r,!0),v=[];if(!_||_.next===_.prev)return v;if(p&&(_=h(e,t,_,r)),e.length>80*r){s=a=e[0],n=l=e[1];for(var m=r;m<f;m+=r)(c=e[m])<s&&(s=c),(u=e[m+1])<n&&(n=u),c>a&&(a=c),u>l&&(l=u);d=0!==(d=Math.max(a-s,l-n))?1/d:0}return o(_,v,r,s,n,d),v}function i(e,t,r,s,i){var n,o;if(i===D(e,t,r,s)>0)for(n=t;n<r;n+=s)o=G(n,e[n],e[n+1],o);else for(n=r-s;n>=t;n-=s)o=G(n,e[n],e[n+1],o);if(o&&R(o,o.next)){var a=o.next;E(o),o=a}return o}function n(e,t){if(!e)return e;t||(t=e);var r,s=e;do{if(r=!1,s.steiner||!R(s,s.next)&&0!==w(s.prev,s,s.next))s=s.next;else{var i=s.prev;if(E(s),(s=t=i)===s.next)break;r=!0}}while(r||s!==t);return t}function o(e,t,r,s,i,h,d){if(e){!d&&h&&v(e,s,i,h);for(var p,f,_=e;e.prev!==e.next;)if(p=e.prev,f=e.next,h?l(e,s,i,h):a(e))t.push(p.i/r),t.push(e.i/r),t.push(f.i/r),E(e),e=f.next,_=f.next;else if((e=f)===_){d?1===d?o(e=c(n(e),t,r),t,r,s,i,h,2):2===d&&u(e,t,r,s,i,h):o(n(e),t,r,s,i,h,1);break}}}function a(e){var t=e.prev,r=e,s=e.next;if(w(t,r,s)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(g(t.x,t.y,r.x,r.y,s.x,s.y,i.x,i.y)&&w(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function l(e,t,r,s){var i=e.prev,n=e,o=e.next;if(w(i,n,o)>=0)return!1;for(var a=i.x<n.x?i.x<o.x?i.x:o.x:n.x<o.x?n.x:o.x,l=i.y<n.y?i.y<o.y?i.y:o.y:n.y<o.y?n.y:o.y,c=i.x>n.x?i.x>o.x?i.x:o.x:n.x>o.x?n.x:o.x,u=i.y>n.y?i.y>o.y?i.y:o.y:n.y>o.y?n.y:o.y,h=m(a,l,t,r,s),d=m(c,u,t,r,s),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&g(i.x,i.y,n.x,n.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&g(i.x,i.y,n.x,n.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&g(i.x,i.y,n.x,n.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&g(i.x,i.y,n.x,n.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function c(e,t,r){var s=e;do{var i=s.prev,o=s.next.next;!R(i,o)&&A(i,s,s.next,o)&&M(i,o)&&M(o,i)&&(t.push(i.i/r),t.push(s.i/r),t.push(o.i/r),E(s),E(s.next),s=e=o),s=s.next}while(s!==e);return n(s)}function u(e,t,r,s,i,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&x(l,c)){var u=O(l,c);return l=n(l,l.next),u=n(u,u.next),o(l,t,r,s,i,a),void o(u,t,r,s,i,a)}c=c.next}l=l.next}while(l!==e)}function h(e,t,r,s){var o,a,l,c=[];for(o=0,a=t.length;o<a;o++)(l=i(e,t[o]*s,o<a-1?t[o+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),c.push(y(l));for(c.sort(d),o=0;o<c.length;o++)r=n(r=f(c[o],r),r.next);return r}function d(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function f(e,t){var r=function(e,t){var r,s=t,i=e.x,n=e.y,o=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var a=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=i&&a>o){if(o=a,a===i){if(n===s.y)return s;if(n===s.next.y)return s.next}r=s.x<s.next.x?s:s.next}}s=s.next}while(s!==t);if(!r)return null;if(i===o)return r;var l,c=r,u=r.x,h=r.y,d=1/0;s=r;do{i>=s.x&&s.x>=u&&i!==s.x&&g(n<h?i:o,n,u,h,n<h?o:i,n,s.x,s.y)&&(l=Math.abs(n-s.y)/(i-s.x),M(s,e)&&(l<d||l===d&&(s.x>r.x||s.x===r.x&&_(r,s)))&&(r=s,d=l)),s=s.next}while(s!==c);return r}(e,t);if(!r)return t;var s=O(r,e),i=n(r,r.next);let o=p(s);return n(o,o.next),i=p(i),p(t===r?i:t)}function _(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function v(e,t,r,s){var i=e;do{null===i.z&&(i.z=m(i.x,i.y,t,r,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,s,i,n,o,a,l,c=1;do{for(r=e,e=null,n=null,o=0;r;){for(o++,s=r,a=0,t=0;t<c&&(a++,s=s.nextZ);t++);for(l=c;a>0||l>0&&s;)0!==a&&(0===l||!s||r.z<=s.z)?(i=r,r=r.nextZ,a--):(i=s,s=s.nextZ,l--),n?n.nextZ=i:e=i,i.prevZ=n,n=i;r=s}n.nextZ=null,c*=2}while(o>1)}(i)}function m(e,t,r,s,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function g(e,t,r,s,i,n,o,a){return(i-o)*(t-a)-(e-o)*(n-a)>=0&&(e-o)*(s-a)-(r-o)*(t-a)>=0&&(r-o)*(n-a)-(i-o)*(s-a)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&A(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(M(e,t)&&M(t,e)&&function(e,t){var r=e,s=!1,i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next}while(r!==e);return s}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||R(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function R(e,t){return e.x===t.x&&e.y===t.y}function A(e,t,r,s){var i=C(w(e,t,r)),n=C(w(e,t,s)),o=C(w(r,s,e)),a=C(w(r,s,t));return i!==n&&o!==a||!(0!==i||!b(e,r,t))||!(0!==n||!b(e,s,t))||!(0!==o||!b(r,e,s))||!(0!==a||!b(r,t,s))}function b(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function C(e){return e>0?1:e<0?-1:0}function M(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function O(e,t){var r=new P(e.i,e.x,e.y),s=new P(t.i,t.x,t.y),i=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,s.next=r,r.prev=s,n.next=s,s.prev=n,s}function G(e,t,r,s){var i=new P(e,t,r);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(e,t,r,s){for(var i=0,n=t,o=r-s;n<r;n+=s)i+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return i}r.d(t,{e:()=>s}),s.deviation=function(e,t,r,s){var i=t&&t.length,n=i?t[0]*r:e.length,o=Math.abs(D(e,0,n,r));if(i)for(var a=0,l=t.length;a<l;a++){var c=t[a]*r,u=a<l-1?t[a+1]*r:e.length;o-=Math.abs(D(e,c,u,r))}var h=0;for(a=0;a<s.length;a+=3){var d=s[a]*r,p=s[a+1]*r,f=s[a+2]*r;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},s.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},s=0,i=0;i<e.length;i++){for(var n=0;n<e[i].length;n++)for(var o=0;o<t;o++)r.vertices.push(e[i][n][o]);i>0&&(s+=e[i-1].length,r.holes.push(s))}return r}},40366:(e,t,r)=>{r.d(t,{F:()=>_,a:()=>y,b:()=>v});var s,i,n=r(57528),o=r(34761),a=r(13191),l=r(9392),c=r(86955),u=r(23687),h=r(12216),d=r(66470),p=r(31432),f=r(2687);class _ extends p.Y{constructor(){super(...arguments),this.origin=l.uY}}function v(){const e=new f.N5;return e.attributes.add(d.r.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new u.F("proj",e=>e.camera.projectionMatrix),new h.S("view",(e,t)=>(0,o.Tl)(m,t.camera.viewMatrix,e.origin))).main.add((0,c.H)(s||(s=(0,n.A)(["gl_Position = proj * view * vec4(position, 1.0);\ngl_Position.z = min(gl_Position.z, gl_Position.w);"])))),e.fragment.main.add((0,c.H)(i||(i=(0,n.A)(["fragColor = vec4(1., 0., 0., 0.);"])))),e}const m=(0,a.vt)(),y=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:_,build:v},Symbol.toStringTag,{value:"Module"}))},50360:(e,t,r)=>{r.d(t,{Pg:()=>l,fz:()=>c,g7:()=>o,zo:()=>a});var s=r(68707),i=(r(97799),r(63331),r(82103));r(91523);const n=new i.O;function o(e,t,r){return n.execute(e,t,r,null)}function a(e,t,r){const i=n.executeMany(new s.S(e),t,r,null);return Array.from(i)}function l(e,t,r){return n.isSimpleAsFeature(e,t,r,null,null)}function c(){return n.supportsCurves()}},58067:(e,t,r)=>{r.r(t),r.d(t,{fromExtent:()=>x,fromGeometry:()=>g,fromMultipoint:()=>w,fromPoint:()=>R,fromPolygon:()=>A,fromPolyline:()=>b,fromSpatialReference:()=>C,getSpatialReference:()=>y,toExtent:()=>O,toGeometry:()=>M,toMultipoint:()=>G,toPoint:()=>E,toPolygon:()=>P,toPolyline:()=>D});var s=r(89379),i=r(26871),n=(r(21557),r(97799)),o=r(91523),a=r(63331),l=r(82103),c=r(76797),u=r(66388),h=r(19247),d=r(65215),p=r(23701),f=(r(59739),r(48045));const _="_gxVersion",v=2,m=1;function y(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference}function g(e){switch(e.type){case"point":return R(e);case"multipoint":return w(e);case"polyline":return b(e);case"polygon":return A(e);case"extent":return x(e);default:throw new Error("Unsupported geometry type: ".concat(e.type))}}function x(e){if(!e.getCacheValue(_)){const t=new o.E;t.setCoords(e.xmin,e.ymin,e.xmax,e.ymax),e.hasM&&t.setInterval(v,0,e.mmin,e.mmax),e.hasZ&&t.setInterval(m,0,e.zmin,e.zmax),e.setCacheValue(_,t)}return e.getCacheValue(_)}function w(e){if(!e.getCacheValue(_)){const s=new a.M,i=new o.P,n=e.points,l=e.hasM,c=e.hasZ,u=c?3:2;for(let e=0,o=n.length;e<o;e++){var t,r;const o=n[e];i.setXYCoords(o[0],o[1]),c&&i.setZ(null!==(t=o[2])&&void 0!==t?t:0),l&&i.setM(null!==(r=o[u])&&void 0!==r?r:NaN),s.add(i)}e.setCacheValue(_,s)}return e.getCacheValue(_)}function R(e){if(!e.getCacheValue(_)){const t=new o.P;t.setXYCoords(e.x,e.y),e.hasM&&t.setM(e.m),e.hasZ&&t.setZ(e.z),e.setCacheValue(_,t)}return e.getCacheValue(_)}function A(e){if(!e.getCacheValue(_)){const{curveRings:t,hasM:r,hasZ:s,rings:i}=e,n=(0,f.fromGeometryToGXGeometry)({curveRings:t,hasM:r,hasZ:s,rings:i});e.setCacheValue(_,n)}return e.getCacheValue(_)}function b(e){if(!e.getCacheValue(_)){const{curvePaths:t,hasM:r,hasZ:s,paths:i}=e,n=(0,f.fromGeometryToGXGeometry)({curvePaths:t,hasM:r,hasZ:s,paths:i});e.setCacheValue(_,n)}return e.getCacheValue(_)}function C(e){if(e.wkid)return(0,l.c)(e.wkid);const t=e.wkt2||e.wkt;return t?(0,l.a)(t):null}function M(e,t){if(e)switch(e.getGeometryType()){case n.G.enumPoint:return E(e,t);case n.G.enumEnvelope:return O(e,t);case n.G.enumMultiPoint:return G(e,t);case n.G.enumPolyline:return D(e,t);case n.G.enumPolygon:return P(e,t)}return null}function O(e,t){if(e.isEmpty())return null;const r=new c.A({xmin:e.getXMin(),ymin:e.getYMin(),xmax:e.getXMax(),ymax:e.getYMax(),spatialReference:t}),s=e.getDescription();if(s.hasM()){const t=e.queryInterval(v,0);r.mmin=t.vmin,r.mmax=t.vmax}if(s.hasZ()){const t=e.queryInterval(m,0);r.zmin=t.vmin,r.zmax=t.vmax}return r.setCacheValue(_,e),r}function G(e,t){if(e.isEmpty())return null;const r=e.getDescription(),s=r.hasM(),i=r.hasZ(),n=[],a=new o.P;for(let o=0,c=e.getPointCount();o<c;o++){e.getPointByVal(o,a);const t=[a.getX(),a.getY()];i&&t.push(a.getZ()),s&&t.push(a.getM()),n.push(t)}const l=new u.A({hasM:s,hasZ:i,points:n,spatialReference:t});return l.setCacheValue(_,e),l}function E(e,t){if(e instanceof i.P)return new h.A({x:e.x,y:e.y,spatialReference:t});if(e.isEmpty())return null;const r=new h.A({x:e.getX(),y:e.getY(),spatialReference:t}),s=e.getDescription();return s.hasM()&&(r.m=e.getM()),s.hasZ()&&(r.z=e.getZ()),r.setCacheValue(_,e),r}function P(e,t){if(e.isEmpty())return null;const r=d.A.fromJSON((0,s.A)({spatialReference:t},(0,f.toGeometry)(e,null)));return r.setCacheValue(_,e),r}function D(e,t){if(e.isEmpty())return null;const r=p.A.fromJSON((0,s.A)({spatialReference:t},(0,f.toGeometry)(e,null)));return r.setCacheValue(_,e),r}},59499:(e,t,r)=>{var s;r.d(t,{t:()=>s}),function(e){e[e.BRIGHT=0]="BRIGHT",e[e.DARK=1]="DARK"}(s||(s={}))},68707:(e,t,r)=>{r.d(t,{G:()=>s,S:()=>i});class s{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}class i extends s{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}},69230:(e,t,r)=>{r.d(t,{B:()=>i});r(81806);var s=r(68134);class i{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this.forEachMaterial(t=>null===t||void 0===t?void 0:t.setParameters({isDecoration:e}))}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,s.wB)(()=>e.view.ready,e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProperties(e){let t=!1;for(const r in e)r in this&&("attached"===r?t=!!e[r]:this[r]=e[r]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view.stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},73074:(e,t,r)=>{r.d(t,{P:()=>A});var s=r(54099),i=r(20664),n=r(9392),o=r(43047),a=r(55855),l=r(45308),c=r(42294),u=r(44815),h=r(18117),d=r(12482),p=r(731),f=r(85746),_=r(1307),v=r(49296),m=r(70667),y=r(29889),g=r(45463),x=r(442),w=r(66470),R=r(425);class A extends f.X{constructor(e){var t;super(e),this._attachmentOrigin=(0,h.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new s.A,this._geometry=null,this._width=1,this._color=(0,a.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,a.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=g.m$.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new _.o({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=null===(t=e.attached)||void 0===t||t}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:b,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:b,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){const t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,o.a)(e,this._color)||((0,o.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,o.a)(e,this._innerColor)||((0,o.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,o.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,a.o8)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){var e;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=null===(e=this.object3dResources.resources)||void 0===e?void 0:e.geometries;if(!t||0===t.length)return null;(0,i.i)(M,0,0,0);let r=0;for(const s of t)s.computeAttachmentOrigin(C)&&((0,i.f)(M,M,C),r++);return 0===r?null:((0,i.g)(M,M,1/r),this.view.renderCoordsHelper.fromRenderCoords(M,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(this._materialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===g.m$.OccludeAndTransparentStencil?g.m$.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,r){this._createRenderGeometries(t,r);for(const s of r)e.addGeometry(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new R.W(this._materialParameters),r=new Array;return this._recreateGeometry(e,t,r),{material:t,geometries:r}}_createDrapedResources(){const e=new R.W(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:r}=this,s=r.basemapTerrain.spatialReference;return null==t||null==s?[]:(0,y.A)(t,s).lines.map(t=>{let{position:i}=t;const n={overlayInfo:{spatialReference:s,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:i},removeDuplicateStartEnd:this._isClosed};return new x.$((0,m.t)(e,n))})}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const r of this.object3dResources.resources.geometries){const s=r.attributes.get(w.r.POSITION),i=(0,u.jh)(s.data.length);(0,l.projectBuffer)(s.data,t.spatialReference,0,i,this.view.spatialReference,0),(0,c.Hq)(e,i)}return!0}_createRenderGeometries(e,t){var r;const s=this.geometry;if(null==s)return;const i=(0,y.C)(s,this.view.elevationProvider,this.view.renderCoordsHelper,v.F.fromElevationInfo(null!==(r=this.elevationInfo)&&void 0!==r?r:new p.A({mode:(0,d.w7)(s,null)}))),n=new Array;for(const{position:o,mapPositions:a}of i.lines){const r={mapPositions:a,attributeData:{position:o},removeDuplicateStartEnd:this._isClosed};t.push((0,m.t)(e,r)),n.push(o)}this._laserline.pathVerticalPlane=n}}function b(e){e.geometries=[]}const C=(0,n.vt)(),M=(0,n.vt)()},77176:(e,t,r)=>{r.d(t,{b:()=>n});var s=r(15941),i=r(38496);function n(e,t,r){var n;const u=Array.isArray(e),h=u?e.length/t:e.byteLength/(4*t),d=u?e:new Uint32Array(e,0,h*t),p=null!==(n=null===r||void 0===r?void 0:r.minReduction)&&void 0!==n?n:0,f=(null===r||void 0===r?void 0:r.originalIndices)||null,_=f?f.length:0,v=(null===r||void 0===r?void 0:r.componentOffsets)||null;let m=0;if(v)for(let s=0;s<v.length-1;s++){const e=v[s+1]-v[s];e>m&&(m=e)}else m=h;const y=Math.floor(1.1*m)+1;(null==c||c.length<2*y)&&(c=new Uint32Array((0,s.cU)(2*y)));for(let s=0;s<2*y;s++)c[s]=0;let g=0;const x=!!v&&!!f,w=x?_:h;let R=(0,i.my)(h);const A=new Uint32Array(_),b=1.96;let C=0!==p?Math.ceil(4*b*b/(p*p)*p*(1-p)):w,M=1,O=v?v[1]:w;for(let s=0;s<w;s++){if(s===C){const e=1-g/s;if(e+b*Math.sqrt(e*(1-e)/s)<p)return null;C*=2}if(s===O){for(let e=0;e<2*y;e++)c[e]=0;if(f)for(let e=v[M-1];e<v[M];e++)A[e]=R[f[e]];O=v[++M]}const e=x?f[s]:s,r=e*t,i=l(d,r,t);let n=i%y,a=g;for(;0!==c[2*n+1];){if(c[2*n]===i){const e=c[2*n+1]-1;if(o(d,r,e*t,t)){a=R[e];break}}n++,n>=y&&(n-=y)}a===g&&(c[2*n]=i,c[2*n+1]=e+1,g++),R[e]=a}if(0!==p&&1-g/h<p)return null;if(x){for(let e=v[M-1];e<A.length;e++)A[e]=R[f[e]];R=(0,i.uW)(A)}const G=u?new Array(g):new Uint32Array(g*t);g=0;for(let s=0;s<w;s++)R[s]===g&&(a(d,(x?f[s]:s)*t,G,g*t,t),g++);if(f&&!x){const e=new Uint32Array(_);for(let t=0;t<e.length;t++)e[t]=R[f[t]];R=(0,i.uW)(e)}return{buffer:Array.isArray(G)?G:G.buffer,indices:R,uniqueCount:g}}function o(e,t,r,s){for(let i=0;i<s;i++)if(e[t+i]!==e[r+i])return!1;return!0}function a(e,t,r,s,i){for(let n=0;n<i;n++)r[s+n]=e[t+n]}function l(e,t,r){let s=0;for(let i=0;i<r;i++)s=e[t+i]+s|0,s=s+(s<<11)+(s>>>2)|0;return s>>>0}let c=null},80069:(e,t,r)=>{r.d(t,{F:()=>d,a:()=>f,b:()=>p});var s,i=r(57528),n=r(73398),o=r(86955),a=r(72790),l=r(70367),c=r(59499),u=r(31432),h=r(2687);class d extends u.Y{constructor(){super(...arguments),this.effect=c.t.BRIGHT}}function p(){const e=new h.N5;return e.include(n.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new l.N("colorTexture",e=>e.color),new l.N("focusArea",e=>e.focusArea),new a.c("focusAreaEffectMode",e=>e.effect)).main.add((0,o.H)(s||(s=(0,i.A)(["\n      float mask = texture( focusArea, uv, 0.0 ).r;\n      vec4 color = texture( colorTexture, uv, 0.0 );\n      vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);\n      if (focusAreaEffectMode == ",") {\n        fragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;\n      } else {\n        fragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);\n      }\n  "])),o.H.int(c.t.BRIGHT))),e}const f=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:d,build:p},Symbol.toStringTag,{value:"Module"}))},83457:(e,t,r)=>{r.d(t,{fz:()=>a,g7:()=>n,zo:()=>o});var s=r(68707);const i=new(r(20265).O);function n(e,t,r,s){return i.execute(e,t,r,s,null)}function o(e,t,r,n){const o=i.executeMany(new s.S(e),t,r,n,null);return Array.from(o)}function a(){return i.supportsCurves()}},85746:(e,t,r)=>{r.d(t,{X:()=>y});var s=r(35143),i=r(91967),n=r(5632),o=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(57662),c=r(57824),u=r(44513);class h{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.O7.Outline}destroy(){this._destroyResources()}get resources(){var e;return null===(e=this._resources)||void 0===e?void 0:e.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const r=null===(t=this._resources)||void 0===t?void 0:t.layerView;r&&(r.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this._resourceFactory.createResources(),r=new d({view:this._resourceFactory.view,renderGroup:this._renderGroup}),s=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:r,external:t,geometriesAdded:!1},s&&(this._resources.drapeSourceRenderer=s.registerGeometryDrapeSource(r)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const t=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.q.UPDATE),this._resources.geometriesAdded=!0))}}let d=class extends(n.A.IdentifiableMixin(i.A)){constructor(e){super(e),this.drapeSourceType=l.Om.Features,this.updatePolicy=u.q.SYNC,this.renderGroup=l.O7.Outline}};(0,s._)([(0,o.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,s._)([(0,o.MZ)({readOnly:!0})],d.prototype,"drapeSourceType",void 0),(0,s._)([(0,o.MZ)()],d.prototype,"renderGroup",void 0),d=(0,s._)([(0,a.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],d);var p=r(69230),f=r(68134),_=r(37046),v=r(8918);class m{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view.stage;if(null==this._resources||!e)return;const t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,r=t.stage;if(!r)return;const s=new v.x(r,{pickable:!1,updatePolicy:u.q.SYNC}),i=new _.B({castShadow:!1}),n=e.createResources(i,s);s.add(i);const o=e.cameraChanged,a=o?(0,f.wB)(()=>t.state.camera,e=>o(e),f.Vh):null;this._resources={layer:s,object:i,external:n,cameraHandle:a},this._syncVisible()}_destroyResources(){var e;null!=this._resources&&(this._resources.layer.destroy(),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class y extends p.B{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new m(this.createObject3DResourceFactory(e.view)),this.drapedResources=new h(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){var t,r;null!==(t=this.object3dResources)&&void 0!==t&&t.forEachMaterial(e),null===(r=this.drapedResources)||void 0===r||r.forEachMaterial(e)}}},94522:(e,t,r)=>{r.r(t),r.d(t,{FocusAreasView:()=>oe});var s=r(35143),i=r(91967),n=r(18690),o=r(19276),a=r(50076),l=r(76460),c=r(43927),u=r(30726),h=r(68134),d=r(31633),p=r(46053),f=(r(81806),r(85842)),_=r(38983),v=r(13191),m=r(9392),y=r(34111),g=r(19247),x=r(9956),w=r(83457),R=r(50360),A=r(58067),b=r(5809),C=r(44815),M=r(14556),O=r(38496),G=r(45136),E=r(64465),P=r(49296),D=r(16266),S=r(36423),Z=r(87925),V=r(89379),T=(r(47249),r(90364)),F=r(36451),I=r(16506),N=r(59246),j=r(80069),k=r(57162);class z extends N.w{constructor(e,t){super(e,t,new I.$(j.a,()=>r.e(75915).then(r.bind(r,75915))))}initializePipeline(){return(0,k.Ey)({colorWrite:k.kn})}}var W=r(59499),H=r(93345);let q=class extends F.A{constructor(e){super((0,V.A)((0,V.A)({},e),{},{view:e.focusAreasView.view})),this.consumes={required:[T.OG.FOCUSAREA_COLOR,T.OG.FOCUSAREA]},this.produces=T.OG.FOCUSAREA_COLOR,this._passParameters=new j.F}precompile(){this.techniques.precompile(z)}render(e){const t=this.techniques.get(z),r=e.find(e=>{let{name:t}=e;return t===this.produces});if(!t.compiled)return this.requestRender(),r;const s=this.focusAreasView.style,i=this.bindParameters,n=i.camera,o=n.fullViewport[2],a=n.fullViewport[3],l=e.find(e=>{let{name:t}=e;return t===T.OG.FOCUSAREA}),c=this.fboCache.acquire(o,a,this.produces),u=this.renderingContext;return u.bindFramebuffer(c.fbo),this._passParameters.color=r.getTexture(),this._passParameters.focusArea=l.getTexture(),this._passParameters.effect=U[s],u.bindTechnique(t,i,this._passParameters),u.screen.draw(),c.attachDepth(r.getAttachment(H.nI)),c}};(0,s._)([(0,p.MZ)()],q.prototype,"consumes",void 0),(0,s._)([(0,p.MZ)()],q.prototype,"produces",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],q.prototype,"focusAreasView",void 0),q=(0,s._)([(0,f.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],q);const U={bright:W.t.BRIGHT,dark:W.t.DARK};var B=r(74957),L=r(40366);class Y extends N.w{constructor(e,t){super(e,t,new I.$(L.a,()=>r.e(47144).then(r.bind(r,47144))))}initializePipeline(){return(0,k.Ey)({colorWrite:k.kn,depthTest:{func:H.MT.LEQUAL}})}}var $=r(32119),X=r(11850),K=r(69008),Q=r(76718),J=r(31432);let ee=class extends F.A{constructor(e){super((0,V.A)((0,V.A)({},e),{},{view:e.focusAreasView.view})),this.consumes={required:[T.hM.TRANSPARENT]},this.produces=T.OG.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new L.F}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(Y)}render(e){const t=this.techniques.get(Y),r=this.bindParameters,s=r.camera,i=s.fullViewport[2],n=s.fullViewport[3];if(!t.compiled||!this._vaos)return void this.requestRender();const o=e.find(e=>{let{name:t}=e;return t===T.hM.TRANSPARENT}),a=this.renderingContext,l=this.fboCache.acquire(i,n,T.OG.FOCUSAREA,B.NV.RG8UNORM);this.view.stage.renderer.occludedRequiresStencil?(l.acquireDepth(B.zd.DEPTH24_STENCIL8),a.blitFramebuffer(o.fbo,l.fbo,H.NV.DEPTH)):l.attachDepth(o.getAttachment(H.nI)),a.bindFramebuffer(l.fbo),a.setClearColor(0,0,0,1),a.clear(H.NV.COLOR|H.NV.STENCIL),a.setViewport(0,0,i,n);const c=a.bindTechnique(t,r);a.setFaceCullingEnabled(!1),a.setStencilTestEnabled(!0),a.setStencilOpSeparate(H.Y7.FRONT,H.eA.KEEP,H.eA.INCR_WRAP,H.eA.KEEP),a.setStencilOpSeparate(H.Y7.BACK,H.eA.KEEP,H.eA.DECR_WRAP,H.eA.KEEP),a.setDepthWriteEnabled(!1);for(let u=0;u<this._vaos.length;u++){const e=this._vaos[u],t=this._counts[u];this._maskParameters.origin=this._origins[u],c.bindDraw(r,J.m,this._maskParameters),a.bindVAO(e),a.setDepthTestEnabled(!0),a.setStencilWriteMask(255),a.setStencilFunction(H.MT.ALWAYS,0,255),a.setColorMask(!1,!1,!1,!1),a.drawArrays(H.WR.TRIANGLES,0,t),a.setDepthTestEnabled(!1),a.setStencilWriteMask(0),a.setStencilFunction(H.MT.NOTEQUAL,0,255),a.setColorMask(!0,!0,!0,!0),a.drawArrays(H.WR.TRIANGLES,0,t)}return l}updateGeometries(){this.view.stage&&(this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0,this.focusAreasView.volumes.forEach(e=>e.forEach(e=>{const t=new Array,r=e.indicesBottom;for(let n=0;n<r.length;n++)t.push(e.positions[3*(r[n]-1)]),t.push(e.positions[3*(r[n]-1)+1]),t.push(e.positions[3*(r[n]-1)+2]);const s=e.indicesExtruded;for(let n=0;n<s.length;n++)t.push(e.positions[3*s[n]]),t.push(e.positions[3*s[n]+1]),t.push(e.positions[3*s[n]+2]);const i=new K.Z(this.renderingContext,$.D,new Map([["geometry",X.SL]]),new Map([["geometry",Q.g.createVertex(this.renderingContext,H._U.STATIC_DRAW,new Float32Array(t))]]));this._vaos.push(i),this._counts.push(r.length+s.length),this._origins.push(e.origin)})),this.requestRender())}};(0,s._)([(0,p.MZ)()],ee.prototype,"consumes",void 0),(0,s._)([(0,p.MZ)()],ee.prototype,"produces",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],ee.prototype,"focusAreasView",void 0),ee=(0,s._)([(0,f.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],ee);class te{constructor(e,t,r,s,i){this.positions=e,this.indicesBottom=t,this.indicesExtruded=r,this.height=s,this.origin=i}}var re=r(69539),se=r(73074),ie=r(45463);let ne=class extends i.A{constructor(e){super(e)}initialize(){this.addHandles([(0,h.wB)(()=>this.area.enabled,()=>this._ensureElement(),h.Vh),(0,h.wB)(()=>{var e;return null===(e=this.area.outline)||void 0===e?void 0:e.color},e=>this._updateColor(e),h.Vh),(0,h.wB)(()=>this.area.geometries,e=>this._updateGeometries(e),h.Vh)])}destroy(){this.removeAllHandles(),this._outlineElement=(0,u.pR)(this._outlineElement)}_ensureElement(){var e,t,r;this.area.enabled&&null!==(e=this.area.outline)&&void 0!==e&&e.color?null!==(t=this._outlineElement)&&void 0!==t||(this._outlineElement=new se.P({view:this.view,geometry:this._mergePolygons(this.area.geometries),isDraped:!0,attached:!0,isDecoration:!1,color:re.A.toUnitRGBA(null===(r=this.area.outline)||void 0===r?void 0:r.color),renderOccluded:ie.m$.OccludeAndTransparent,width:3})):this._outlineElement=(0,u.pR)(this._outlineElement)}_updateGeometries(e){this._ensureElement(),this._outlineElement&&(this._outlineElement.geometry=this._mergePolygons(e))}_updateColor(e){this._ensureElement(),this._outlineElement&&e&&(this._outlineElement.color=re.A.toUnitRGBA(e))}_mergePolygons(e){if(!e||0===e.length)return null;const t=e.at(0).clone();return e.forEach(e=>{t.rings.push(...e.rings)}),t}};(0,s._)([(0,p.MZ)({constructOnly:!0})],ne.prototype,"view",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],ne.prototype,"area",void 0),ne=(0,s._)([(0,f.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaOutlineItem")],ne);let oe=class extends i.A{constructor(e){super(e),this._volumes=new Map,this._elevationContext=new P.F,this._outlineMap=new o.A}initialize(){this.addHandles([(0,h.wB)(()=>this.polygons,e=>this._updateVolumes(e),h.pc)]),this._outlineMap=(0,c.L)(()=>{var e;return null===(e=this.areas)||void 0===e?void 0:e.areas},e=>new ne({area:e,view:this.view}),{recycleItems:!0})}destroy(){this.removeAllHandles(),this._outlineMap.destroy()}get areas(){var e;return null===(e=this.view.map)||void 0===e?void 0:e.focusAreas}get enabledAreas(){var e,t;return null!==(e=null===(t=this.areas)||void 0===t?void 0:t.areas.toArray().filter(e=>{let{enabled:t}=e;return t}))&&void 0!==e?e:[]}get style(){var e,t;return null!==(e=null===(t=this.areas)||void 0===t?void 0:t.style)&&void 0!==e?e:"bright"}get polygons(){return this.enabledAreas.reduce((e,t)=>e.concat(t.geometries.toArray()),new Array)}containsGeometry(e){if(0===this.polygons.length)return!0;const t=new g.A(e);return this.polygons.some(e=>e.contains(t))}_updateVolumes(e){this._extrude(e),this._ensureRenderNodes()}_extrude(e){var t;if(!this.view.renderCoordsHelper||(0,n.aI)(Array.from(this._volumes.keys()),e))return;const r=this.view.renderCoordsHelper,s=(0,m.vt)(),i=r.viewingMode===E.RT.Global,o=(0,v.vt)(),c=(0,v.vt)(),u=this.view.spatialReference,h=(0,A.fromSpatialReference)(u),p=(0,y.tO)(u).radius/M.$O.radius,f=(0,d.UW)(5e5*p,"meters",u,!0);i||r.worldUpAtPosition([0,0,0],s);const g=new Map;for(const n of e){const e=this._volumes.get(n);if(e)g.set(n,e);else try{var P;const e=u.equals(n.spatialReference)?n:(0,x.project)(n,u),t=Math.max(e.extent.width,e.extent.height),a=(0,d.PQ)(t,u,"meters",!0),l=Math.max(5*a,2e4*p),v=i?p/10:p,m=this._reduceGeometryHeight(e,l,v),y=(0,S.W$)(m);if(null==y)continue;const M=(0,A.fromPolygon)(m),E=null!==(P=(0,R.g7)(M,h,!1))&&void 0!==P?P:M,V=(0,w.g7)(E,f,0,0),T=(0,A.toPolygon)(V,u);if(null==T)continue;(0,b.l)(u,[y.x,y.y,0],o,r.spatialReference),c[12]=-o[12],c[13]=-o[13],c[14]=-o[14];const F=(0,Z.C8)(T,this.view.elevationProvider,r,this._elevationContext),{polygons:I,mapPositions:N,position:j}=F,k=new Array;for(const r of I){const e=r.count,t=(0,_.e)(r.mapPositions,r.holeIndices,3);if(0===t.length)continue;const n=t.length,a=6*e,u=a+n,h=(0,C.jh)(3*a),d=(0,O.my)(u),p=(0,O.my)(n);(0,D.K)(j,N,t,r,h,null,null,null,d,p,l,s,i),(0,G.t)(h,h,c);const f=new te(h,p,d,l,[o[12],o[13],o[14]]);k.push(f)}g.set(n,k)}catch(V){l.A.getLogger(this).error(new a.A("focusareasview:projection-failed","Failed to project focus area geometry to view spatial reference",{geometry:n,error:V}))}}this._volumes=g,null===(t=this._maskRenderNode)||void 0===t||t.updateGeometries()}_ensureRenderNodes(){var e,t;this.view.stage&&(0===this.volumes.size?(this._maskRenderNode=(0,u.pR)(this._maskRenderNode),this._colorRenderNode=(0,u.pR)(this._colorRenderNode)):(null!==(e=this._maskRenderNode)&&void 0!==e||(this._maskRenderNode=new ee({focusAreasView:this})),null!==(t=this._colorRenderNode)&&void 0!==t||(this._colorRenderNode=new q({focusAreasView:this})),this.view.stage.renderView.requestRender()))}_reduceGeometryHeight(e,t,r){const s=-12e5*r,i=Math.max(-t/2,s),n=e.rings.map(e=>e.map(e=>[e[0],e[1],i])),o=e.clone();return o.rings=n,o.hasZ=!0,o}get volumes(){return this._volumes}};(0,s._)([(0,p.MZ)()],oe.prototype,"_volumes",void 0),(0,s._)([(0,p.MZ)({constructOnly:!0})],oe.prototype,"view",void 0),oe=(0,s._)([(0,f.$)("esri.views.3d.FocusAreasView")],oe)},99785:(e,t,r)=>{r.d(t,{Wq:()=>s,lO:()=>d,oR:()=>p});var s,i,n=r(38983),o=r(5568),a=r(5262),l=r(44815),c=r(38496),u=r(10294),h=r(77176);function d(e){const t=p(e.rings,e.hasZ,s.CCW_IS_HOLE,e.spatialReference),r=new Array;let i=0,o=0;for(const s of t.polygons){const e=s.count,a=s.index,u=(0,l.l5)(t.position,3*a,3*e),h=s.holeIndices.map(e=>e-a),d=(0,c.uW)((0,n.e)(u,h,3));r.push({position:u,faces:d}),i+=u.length,o+=d.length}const a=function(e,t,r){if(1===e.length)return e[0];const s=(0,l.jh)(t),i=new Array(r);let n=0,o=0,a=0;for(const l of e){for(let e=0;e<l.position.length;e++)s[n++]=l.position[e];for(const e of l.faces)i[o++]=e+a;a=n/3}return{position:s,faces:(0,c.uW)(i)}}(r,i,o),u=Array.isArray(a.position)?(0,h.b)(a.position,3,{originalIndices:a.faces}):(0,h.b)(a.position.buffer,6,{originalIndices:a.faces});return a.position=(0,l.xm)(new Float64Array(u.buffer)),a.faces=u.indices,a}function p(e,t,r,i){const n=e.length,o=new Array(n),a=new Array(n),c=new Array(n);let u=0;for(let s=0;s<n;++s)u+=e[s].length;let h=0,d=0,p=0;const v=(0,l.jh)(3*u);let m=0;for(let l=n-1;l>=0;l--){const u=e[l],y=r===s.CCW_IS_HOLE&&_(u,t,i);if(y&&1!==n)o[h++]=u;else{let e=u.length;for(let t=0;t<h;++t)e+=o[t].length;const r={index:m,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};r.pathLengths[0]=u.length,u.length>0&&(c[p++]={index:m,count:u.length}),m=y?f(u,u.length-1,-1,v,m,u.length,t):f(u,0,1,v,m,u.length,t);for(let s=0;s<h;++s){const e=o[s];r.holeIndices[s]=m,r.pathLengths[s+1]=e.length,e.length>0&&(c[p++]={index:m,count:e.length}),m=f(e,0,1,v,m,e.length,t)}h=0,r.count>0&&(a[d++]=r)}}for(let s=0;s<h;++s){const e=o[s];e.length>0&&(c[p++]={index:m,count:e.length}),m=f(e,0,1,v,m,e.length,t)}return a.length=d,c.length=p,{position:v,polygons:a,outlines:c}}function f(e,t,r,s,i,n,o){i*=3;for(let a=0;a<n;++a){const n=e[t];s[i++]=n[0],s[i++]=n[1],s[i++]=o&&n[2]?n[2]:0,t+=r}return i/3}function _(e,t,r){if(!t)return!(0,a.$3)(e);const s=e.length-1;switch((0,u.S)(e,s,r)){case o._.X:return!(0,a.$3)(e,o._.Y,o._.Z);case o._.Y:return!(0,a.$3)(e,o._.X,o._.Z);case o._.Z:return!(0,a.$3)(e,o._.X,o._.Y)}}(i=s||(s={}))[i.NONE=0]="NONE",i[i.CCW_IS_HOLE=1]="CCW_IS_HOLE"}}]);
//# sourceMappingURL=53154.b16f9ed9.chunk.js.map