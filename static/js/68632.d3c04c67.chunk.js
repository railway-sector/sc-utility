"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[68632],{3663:(e,t,i)=>{i.d(t,{O:()=>n});var s=i(18690),r=i(19276),a=i(85632);function n(e){var t,i,n;if(!e)return[];let l=(0,a.DU)(e)?[e]:r.A.isCollection(e)?e.toArray():Array.isArray(e)?e:[];return l=null===(t=l)||void 0===t?void 0:t.filter(s.Ru),0===(null!==(i=null===(n=l)||void 0===n?void 0:n.length)&&void 0!==i?i:0)?[]:l}},4722:(e,t,i)=>{i.d(t,{r:()=>v});var s=i(6326),r=i(69539),a=i(91967),n=i(18690),l=i(54901),o=i(68134),h=i(46053),d=(i(81806),i(76460),i(87990)),u=i(56611),p=i(64519),g=i(86875),c=i(7246),w=i(76940),y=i(3663);let v=class extends a.A{get updating(){var e,t;return null!==(e=null===(t=this.graphicsView)||void 0===t?void 0:t.updating)&&void 0!==e&&e}constructor(e){super(e),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new p.Y,this.graphicsView=null,this.suspended=!1;const t=new r.A([255,255,255,1/255]);this._symbols=new Map([["point",new w.A({size:"2px",style:"square",color:t})],["polyline",new c.A({width:"2px",color:t})],["polygon",new g.A({outline:null,color:t})]])}highlight(e,t){const i=(0,y.O)(e);if(0===i.length)return(0,l.hA)();let s,r=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then(e=>{let[i,a]=e;!r&&a&&(s=this._addHighlightGraphics(a,i,t))})),(0,l.hA)(()=>{var e;r=!0,null===(e=s)||void 0===e||e.remove()})}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(e,t,i){for(const a of t){var s;this._highlightCounts.set(a,(null!==(s=this._highlightCounts.get(a))&&void 0!==s?s:0)+1)}this.graphics.addMany(t);const r=e.highlight(t,i);return(0,l.hA)(()=>{this._removeHighlightGraphics(t),r.remove()})}_removeHighlightGraphics(e){this.graphics.removeMany(e.filter(e=>{var t;const i=Math.max(0,(null!==(t=this._highlightCounts.get(e))&&void 0!==t?t:0)-1);return 0===i?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,i),!1)}))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=Promise.all([i.e(73263),i.e(53046),i.e(14207)]).then(i.bind(i,14207)));const{default:e}=await this._graphicsViewLoader;if(this.destroyed)return null;const t=new e({view:this.view,layer:{type:"graphics-view-3d-dummy",id:this.layer.id,uid:this.layer.uid,elevationInfo:{mode:"on-the-ground"}},getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",t),this.addHandles([(0,l.DQ)(this.graphicsView),(0,o.wB)(()=>this.suspended,e=>{t.suspended=e},o.pc)]),t}async _createHighlightGraphics(e){const t=e.map(e=>{let{geometry:t}=e;return null===t||void 0===t?void 0:t.spatialReference}).filter(n.Ru).reduce((e,t)=>{var i;return 0!==e.length&&null!==(i=e.at(-1))&&void 0!==i&&i.equals(t)||e.push(t),e},[]),i=this.view.spatialReference,s=t.map(e=>({source:e,dest:i}));try{await(0,u.initializeProjection)(s)}catch(r){return[]}return e.map(e=>{const{geometry:t}=e;try{const s=t?(0,u.project)(t,i):null,r=e.cloneShallow();return r.geometry=s,r.symbol=this._symbols.get(null===s||void 0===s?void 0:s.type),r}catch(s){return e}})}};(0,s.Cg)([(0,h.MZ)()],v.prototype,"graphics",void 0),(0,s.Cg)([(0,h.MZ)()],v.prototype,"graphicsView",void 0),(0,s.Cg)([(0,h.MZ)()],v.prototype,"view",void 0),(0,s.Cg)([(0,h.MZ)()],v.prototype,"layer",void 0),(0,s.Cg)([(0,h.MZ)()],v.prototype,"updatingHandles",void 0),(0,s.Cg)([(0,h.MZ)()],v.prototype,"suspended",void 0),(0,s.Cg)([(0,h.MZ)()],v.prototype,"updating",null),v=(0,s.Cg)([(0,d.$)("esri.views.3d.layers.support.ImageHighlightHelper3D")],v)},17214:(e,t,i)=>{i.d(t,{A:()=>w});var s=i(6326),r=i(50076),a=i(50346),n=i(46053),l=(i(81806),i(76460),i(47249),i(87990)),o=i(19247),h=i(1900),d=i(51939),u=i(31516),p=i(59844),g=i(68295),c=i(2257);const w=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.view=null}get timeExtent(){var e;return(0,u.F)(this.layer,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,t){const{layer:i}=this;if(!e)throw new r.A("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:s}=i,n=(0,c.D8)(i,t);if(!s||null==n)return[];const l=await n.getRequiredFields(null,{index:new h.A(i.rasterFields),partitions:new Map([["$pixel",i.rasterFields.filter(e=>e.name.startsWith(d.ER)).map(e=>e.name)],["$imageCollectionItem",i.fields.map(e=>e.name)]])});(0,a.Te)(t);const u=new g.A;u.timeExtent=this.timeExtent,u.geometry=e,u.outFields=l,u.outSpatialReference=e.spatialReference;const{resolution:p,spatialReference:w}=this.view,y="2d"===this.view.type?new o.A(p,p,w):new o.A(.5*p,.5*p,w),{returnTopmostRaster:v,showNoDataRecords:m}=n.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},f={returnDomainValues:!0,returnTopmostRaster:v,pixelSize:y,showNoDataRecords:m,signal:null===t||void 0===t?void 0:t.signal};return i.queryVisibleRasters(u,f)}async getSourceScale(){return await(0,p.Hh)(),await this.layer.load(),(0,p.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){var e;return!!super.canResume()&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}};return(0,s.Cg)([(0,n.MZ)()],i.prototype,"layer",void 0),(0,s.Cg)([(0,n.MZ)()],i.prototype,"suspended",void 0),(0,s.Cg)([(0,n.MZ)({readOnly:!0})],i.prototype,"timeExtent",null),(0,s.Cg)([(0,n.MZ)()],i.prototype,"view",void 0),i=(0,s.Cg)([(0,l.$)("esri.views.layers.ImageryLayerView")],i),i}},68632:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var s=i(6326),r=i(54901),a=i(68134),n=i(46053),l=(i(81806),i(76460),i(47249),i(87990)),o=i(98774),h=i(50346),d=(i(50076),i(44882));let u=class extends d.A{constructor(e){super(e),this.redrawDebounced=(0,h.sg)(async e=>{this.redraw((e,t)=>this._redrawImage(e,t),e)},2e3)}initialize(){this.addHandles([(0,a.z7)(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this.updatingHandles.addPromise(this.redrawDebounced()))])}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}async processResult(e,t,i){t.imageOrCanvasElement?e.image=t.imageOrCanvasElement:(e.image=document.createElement("canvas"),e.pixelData=t.pixelData,await this._redrawImage(e,i))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||null==e.pixelData)throw new Error;const i=e.image,s=i.getContext("2d"),r=await this.layer.applyRenderer(e.pixelData,{signal:t}),a=this.layer.applyFilter(r).pixelBlock;if(null==a)throw new Error;i.width=a.width,i.height=a.height;const n=s.createImageData(a.width,a.height);n.data.set(a.getAsRGBA()),s.putImageData(n,0,0)}};u=(0,s.Cg)([(0,l.$)("esri.views.3d.layers.ImagerySubView3D")],u);var p=i(4722),g=i(46533),c=i(89214);let w=class extends c.A{constructor(e){super(e)}initialize(){this.updatingHandles.add(()=>this.renderedTiles,()=>this.triggerLoad()),this.updatingHandles.add(()=>this.elevationInfo.mode,e=>this._updatePopupDrapeSource(e),{initial:!0})}_updatePopupDrapeSource(e){if("on-the-ground"===e)return void this.removeHandles(y);if(this.hasHandles(y))return;const t={destroyed:!1,drapeSourceType:2,updatePolicy:0,layer:this.layer},i=this.layerView.view.overlayManager;i.registerGeometryDrapeSource(t),this.addHandles((0,r.hA)(()=>i.unregisterDrapeSource(t)),y)}async fetchDataAndGenerateStreamlines(e,t){const{needsMagnitude:i,workerHandle:s}=this,r=this.getSimulationSettings(e),{size:a,extent:n,timeExtent:l}=e;if(null==r||null==s)return;const o=await(0,g.pH)(this.layer,n,a[0],a[1],l,t);if(null==o)return null;const h={simulationSettings:r,flowExtentInfo:e.flowExtentInfo,flowData:o,needsMagnitude:i,startPositions:this.startPositions(e)},{streamlines:d}=await s.generateStreamlines(h,t);return d}};w=(0,s.Cg)([(0,l.$)("esri.views.3d.support.flow.FlowSubViewExtent3D")],w);const y=Symbol("popupDrapeSource");var v=i(17214);let m=class extends((0,v.A)(o.A)){constructor(){super(...arguments),this.type="imagery-3d"}get highlightOptions(){return null}get pixelData(){return null}initialize(){const e=()=>this._updatingHandles.addPromise(this.refreshDebounced());this._updatingHandles.add(()=>{var e;return null===(e=this.layer)||void 0===e||null===(e=e.exportImageServiceParameters)||void 0===e?void 0:e.version},e),this._updatingHandles.add(()=>{var e;return null===(e=this.layer)||void 0===e?void 0:e.renderer},e),this._updatingHandles.add(()=>this.timeExtent,e),this._highlightHelper=new p.r({view:this.view,layer:this.layer,updatingHandles:this._updatingHandles}),this.addHandles([(0,r.DQ)(this._highlightHelper),(0,a.wB)(()=>this.suspended,e=>this._highlightHelper.suspended=e,a.pc)])}_initSubView(){this.addHandles([(0,a.wB)(()=>this.layer.renderer,e=>this._recreateSubView(e),a.Vh)])}_recreateSubView(e){var t;const i="flow"===(null===e||void 0===e?void 0:e.type),s="flow"===(null===(t=this.subView)||void 0===t?void 0:t.type),r=this.subView;r&&i===s||(this.subView=i?new w({layerView:this}):new u({layerView:this}),null===r||void 0===r||r.destroy())}getFetchOptions(){return{timeExtent:this.timeExtent}}highlight(e,t){return this._highlightHelper.highlight(e,t)}isUpdating(){return super.isUpdating()||this._highlightHelper.updating}};(0,s.Cg)([(0,n.MZ)()],m.prototype,"highlightOptions",null),(0,s.Cg)([(0,n.MZ)()],m.prototype,"pixelData",null),m=(0,s.Cg)([(0,l.$)("esri.views.3d.layers.ImageryLayerView3D")],m);const f=m}}]);
//# sourceMappingURL=68632.d3c04c67.chunk.js.map