"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[16004],{657:(e,t,i)=>{i.d(t,{Y:()=>n});var s=i(30726),r=i(50346);class n{constructor(e,t){this._textures=e,this.loadPromise=null,this._disposed=!1;const i=this._textures.acquire(t);(0,r.$X)(i)?(i.then(e=>{this._disposed?(0,s.Gz)(e):this._textureRef=e}),this.loadPromise=i):this._textureRef=i}dispose(){this._textureRef=(0,s.Gz)(this._textureRef),this._disposed=!0}get glTexture(){return null!=this._textureRef?this._textureRef.glTexture:null}}},79115:(e,t,i)=>{i.d(t,{z:()=>a});var s=i(15941),r=i(9392),n=i(482),o=i(14556);function a(e,t,i,s){if(null==t||null==s)return!1;const r=(0,n.Tp)(t,s);if(null==(null===r||void 0===r?void 0:r.projector))return!1;if(r.projector===n.pO)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;const{source:a,dest:d,projector:h}=r;if(d.spatialReferenceId===n.rz.WEB_MERCATOR){const t=n.w5[a.spatialReferenceId][n.rz.WGS84];return null!=t&&(t(e,0,c,0),(0,n.s7)(c,0,i,0),i[3]=l(c[1],e[2],e[3],o.$O.radius),!0)}if(a.spatialReferenceId!==n.rz.WGS84&&a.spatialReferenceId!==n.rz.CGCS2000||d.spatialReferenceId!==n.rz.PLATE_CARREE){var u,m;h(e,0,i,0);const t=null!==(u=a.metersPerUnit)&&void 0!==u?u:1,s=null!==(m=d.metersPerUnit)&&void 0!==m?m:1;i[3]=e[3]*t/s}else{const t=n.w5[a.spatialReferenceId][n.rz.SPHERICAL_ECEF],s=n.w5[n.rz.SPHERICAL_ECEF][n.rz.PLATE_CARREE];let r=e[3];null!=t&&null!=s&&(r=l(e[1],e[2],e[3],o.$O.radius)),h(e,0,i,0),i[3]=r}return!0}function l(e,t,i,s){const r=s+t;if(r<s/2||i>r)return Number.MAX_VALUE;const n=Math.abs(d*e)+Math.asin(i/r);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}const c=(0,r.vt)(),d=(0,s.kU)(1)},99766:(e,t,i)=>{i.r(t),i.d(t,{default:()=>we});var s=i(35143),r=i(50076),n=i(81806),o=i(76460),a=i(30726),l=i(68134),c=i(52394),d=i(46053),h=(i(47249),i(85842)),u=i(63919),m=i(44680),p=i(34761),g=i(13191),f=i(4336),_=i(20664),b=i(9392),y=i(55855),v=i(34111),w=i(5809),C=i(21479),x=i(14487),E=i(2413),M=i(88105),T=i(28586),P=i(14303),U=i(12482),A=i(64465),O=i(97048),R=i(65768);class L extends R.P{constructor(e,t,i,s,r,n,o){super(e,0,0,0,t),this.nodesCached=i,this.vboMB=s,this.textureMB=r,this.vboMBCached=n,this.textureMBCached=o}}var I=i(57662),F=i(83491),S=i(75228),H=i(35493),V=i(83490),k=i(93345);const N={[T.El.Points]:null,[T.El.Lines]:null,[T.El.LineStrip]:null,[T.El.Triangles]:k.WR.TRIANGLES,[T.El.TriangleStrip]:k.WR.TRIANGLE_STRIP,[T.El.NotSet]:null},B={[T._N.Opaque]:V.sf.Opaque,[T._N.Mask]:V.sf.Mask,[T._N.Blend]:V.sf.Blend},j={[T.TJ.Back]:V.s2.Back,[T.TJ.Front]:V.s2.Front,[T.TJ.None]:V.s2.None,[T.TJ.NotSet]:V.s2.Back},D={[T.Nt.WrapYBit]:{s:k.pF.CLAMP_TO_EDGE,t:k.pF.REPEAT},[T.Nt.WrapXBit]:{s:k.pF.REPEAT,t:k.pF.CLAMP_TO_EDGE},[T.Nt.WrapXy]:{s:k.pF.REPEAT,t:k.pF.REPEAT},[T.Nt.None]:{s:k.pF.CLAMP_TO_EDGE,t:k.pF.CLAMP_TO_EDGE},[T.Nt.NotSet]:{s:k.pF.CLAMP_TO_EDGE,t:k.pF.CLAMP_TO_EDGE}},G={[T.LU.U8]:1,[T.LU.I8]:1,[T.LU.U16]:2,[T.LU.I16]:2,[T.LU.U32]:4,[T.LU.I32]:4,[T.LU.F32]:4,[T.LU.F64]:8,[T.LU.Utf8String]:1,[T.LU.NotSet]:1};var z=i(39356),W=i(45270),J=i(3112),X=i(82805),q=i(50248),Z=i(48168);class ${constructor(e){this.type=q.d.TILES3D,this.slicePlaneEnabled=!1,this.isGround=!0,this.layerView=e,this.layerViewUid=e.uid}intersect(e,t,i,s,r,n){if(e.options.filteredLayerViewUids.includes(this.layerView.uid))return;const o=e.results,a=e.options.store===J.o.ALL,l=this.layerView.view.stage.renderView.componentObjectCollection,c=new Z.JG(n,e.options.normalRequired);this.layerView.objects.forEach(r=>{r.visible&&r.intersectionGeometry&&l.intersect(r,i,s,e.tolerance,null,c,(r,n,l,c)=>{if(n>=0){if(null!=t&&!t(i,s,n))return;const r=e=>{const t=new W.kV(this.layerView.layer.uid,()=>this._createTiles3DGraphic(this.layerView.layer,{}));e.set(this.type,t,n,l)};if(this.isGround&&(null==o.ground.distance||n<o.ground.distance)&&r(o.ground),e.options.isFiltered)return;if((null==o.min.distance||n<o.min.distance)&&r(o.min),(null==o.max.distance||n>o.max.distance)&&r(o.max),a){const t=new X.i(e.ray);r(t),e.results.all.push(t)}}})})}_createTiles3DGraphic(e,t){return new z.A({layer:e,sourceLayer:e,attributes:t})}}var K,Y,Q=i(95225),ee=i(42136),te=i(59231),ie=i(10231),se=i(16449),re=i(55002),ne=i(91555),oe=i(657),ae=i(97808),le=i(81148),ce=i(50468),de=i(25672),he=i(96897),ue=i(66470),me=i(52757),pe=i(91196),ge=i(90992),fe=i(79196),_e=i(75569);(Y=K||(K={}))[Y.API=1]="API",Y[Y.VerboseAPI=2]="VerboseAPI",Y[Y.Error=3]="Error";class be{constructor(){this.handle=0,this.isVisible=!1,this.components=[],this.textureMemoryUsage=0,this.vboMemoryUsage=0,this.cpuMemoryUsage=0,this.textures=[]}get usedMemory(){return this.textureMemoryUsage+this.vboMemoryUsage+this.cpuMemoryUsage}get cachedMemory(){return this.usedMemory}}function ye(e){return Math.round(e/1048.576)/1e3}let ve=class extends((0,F.w)(pe.A)){constructor(){super(...arguments),this.type="integrated-mesh-3dtiles",this._compressionTracker=new fe.c,this._modifications=new Array,this._visibleGeometryChangedSchedulerHandle=null,this._wasmLayerId=-1,this.ignoresMemoryFactor=!1,this.drapeTargetType=I.sv.WithoutRasterImage,this._applySSAO=!(0,n.A)("disable-feature:im-ssao"),this._shadeNormals=!!(0,n.A)("enable-feature:im-shading"),this._lyrHandleToObjects=new Map,this._initialCullFace=new Map,this._suspendedHandle=null,this._dbgFlags=new Set}get hasModifications(){return this._modifications&&this._modifications.length>0}initialize(){if(this._dbgFlags.add(K.Error),this._dbg(K.VerboseAPI,"Tiles3DLayerView3D initialize() called"),this._updatingHandles.add(()=>this.layer.modifications,()=>this._loadModifications(),l.Vh),!this._canProjectWithoutEngine())throw new r.A("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});const e=(0,S.Bk)(this).then(e=>{this._wasmLayerId=e,this._intersectionHandler=new $(this),this.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler),this._updatingHandles.add(()=>this.slicePlaneEnabled,e=>this._slicePlaneEnabledChange(e)),this._updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),l.Vh),this._updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),l.Vh),this._elevationProvider=new H.e({view:this.view,layerElevationSource:this,intersectionHandler:this._intersectionHandler}),this.view.elevationProvider.register("im",this._elevationProvider),this.view.basemapTerrain.overlayManager.registerDrapeTarget(this);const t=this.view.resourceController.memoryController.newCache("t3d-".concat(this.uid),e=>this._onRemoveFromCache(e));this._memCache=t,this.addHandles([(0,l.wB)(()=>this.layer.elevationInfo,e=>this._elevationInfoChanged(e))]),this._suspendedHandle=(0,l.wB)(()=>this.suspended,e=>{var t;return null===(t=this._wasm)||void 0===t?void 0:t.setEnabled(this,!e)},l.Vh)});this.addResolvingPromise(e)}destroy(){this._dbg(K.VerboseAPI,"Tiles3DLayerView3D destroy() called"),(0,S.r8)(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._intersectionHandler&&(this.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null),this._elevationProvider&&(this._elevationProvider.objectsChanged(this._obbs),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null),this.view.basemapTerrain.overlayManager.unregisterDrapeTarget(this),this._lyrHandleToObjects.forEach(e=>this.freeObject(e)),this._lyrHandleToObjects.clear(),this._initialCullFace.clear(),this._memCache=(0,a.pR)(this._memCache),this._updatingHandles=(0,a.pR)(this._updatingHandles),this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)}_modificationsChanged(){var e;const t=this.layer.spatialReference,i=(0,O.Ir)(this._layerClippingArea,this._modifications,t);null===(e=this._wasm)||void 0===e||e.setMeshModifications(this,i,t.wkid)}_clippingAreaChanged(){const e=this.layer.spatialReference,t=(0,E.vt)();this._layerClippingArea=(0,ee.k)(this.view.clippingArea,t,e)?t:null,this._modificationsChanged()}_visibleGeometryChanged(){var e;null!==(e=this._visibleGeometryChangedSchedulerHandle)&&void 0!==e||(this._visibleGeometryChangedSchedulerHandle=(0,c._)(()=>{this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle=null}))}_slicePlaneEnabledChange(e){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=e),this.objects.forEach(t=>{const i=this._collection.getMaterial(t);i.commonMaterialParameters.hasSlicePlane=e,i.commonMaterialParameters.cullFace=e?V.s2.None:this._initialCullFace.get(t)})}_elevationInfoChanged(e){var t;null===(t=this._wasm)||void 0===t||t.setLayerOffset(this,(0,U.M7)(e))}get _obbs(){return this.objects.map(e=>this._collection.getComponentObb(e))}get _wasm(){return(0,S.pw)(this.view)}get wasmLayerId(){return this._wasmLayerId}get usedMemory(){let e=0;return this._lyrHandleToObjects.forEach(t=>{t.isVisible&&(e+=t.usedMemory)}),e}get unloadedMemory(){return 0}get cachedMemory(){let e=0;return this._lyrHandleToObjects.forEach(t=>{t.isVisible||(e+=t.usedMemory)}),e}get visibleAtCurrentScale(){return(0,ge.E5)(this.layer.effectiveScaleRange,this.view.scale)}get performanceInfo(){let e=0,t=0,i=0,s=0,r=0,n=0;return this._lyrHandleToObjects.forEach(o=>{o.isVisible?(e+=o.textureMemoryUsage,t+=o.vboMemoryUsage,r++):(i+=o.textureMemoryUsage,s+=o.vboMemoryUsage,n++)}),new L(this.usedMemory,r,n,ye(t),ye(e),ye(s),ye(i))}_canProjectWithoutEngine(){if(this.view.state.viewingMode===A.RT.Local){var e,t,i;const s=null!==(e=this.view.renderSpatialReference)&&void 0!==e&&e.isWebMercator?3857:null!==(t=null===(i=this.view.renderSpatialReference)||void 0===i?void 0:i.wkid)&&void 0!==t?t:-1;if(3857!==s&&32662!==s)return!1}return!0}get _stage(){return this.view.stage}get _collection(){return this._stage.renderView.componentObjectCollection}get elevationOffset(){return(0,U.M7)(this.layer.elevationInfo)}get elevationRange(){const e=this.fullExtent;return null!==e&&void 0!==e&&e.zmin&&null!==e&&void 0!==e&&e.zmax?new Q.H(e.zmin,e.zmax):null}getElevationRange(e){return null}get fullExtent(){return this.layer.fullExtent}get objects(){return Array.from(this._lyrHandleToObjects.values()).reduce((e,t)=>e.concat(t.components),new Array)}isUpdating(){const e=this._wasm;return!(this._wasmLayerId<0||null==e)&&(e.isUpdating(this._wasmLayerId)||this._compressionTracker.compressing)}updatingFlagChanged(){this.notifyChange("updating")}async createRenderable(e){const t=e.meshData;if(null==t.data)throw new Error("meshData.data undefined");if(t.desc=JSON.parse(t.desc),null==t.desc)throw new Error("meshData.desc undefined");const i=(0,b.ci)(t.desc.origin),s=new Array,r=new Map,n=new be;n.handle=e.handle,this._lyrHandleToObjects.set(e.handle,n);const o=this.view.basemapTerrain.spatialReference;let a,l;if("global"===this.view.viewingMode){const e=(0,g.vt)();(0,w.l)(v.fv,i,e,o),a=(0,u.z0)((0,m.vt)(),e),l=(0,u.B8)((0,m.vt)(),a)}else a=m.zK,l=m.zK;const c=(0,g.vt)();(0,p.Tl)(c,c,i);const d=(0,p.sC)((0,b.vt)(),c);let h=null;const E=(0,b.vt)();if(t.desc.obb){const e=t.desc.obb.quaternion;h=new te.ab(t.desc.obb.center,t.desc.obb.halfSize,(0,f.fA)(e[0],e[1],e[2],e[3]))}for(let u=0;u<t.desc.prims.length;u++){var P;const e=t.desc.prims[u];if(this._dbg(K.VerboseAPI,JSON.stringify(e)),null==N[e.ptype]||null==t.data){this._dbg(K.VerboseAPI,"[Unsupported Feature] Unsupported primitive mode ("+e.ptype+"). Skipping primitive.");continue}const c=null!==(P=t.desc)&&void 0!==P&&P.materials&&null!=e.materialId?t.desc.materials[e.materialId]:null,p=null!=c?c.lightingModel:T.EF.Unlit,{positionView:g,positionAttr:f,normalsView:v,normalsAttr:w,colorAttr:U,texCoord0Attr:A,indicesView:O}=this.getBufferViews(e,t.data.buffer,a);if(null==f||null==g||null==O)continue;const R=new se.$(null!=U,A?ae.I.Default:ae.I.None,null!=v,this._shadeNormals,this._applySSAO),L=f.data.length/f.size,I=(e,t)=>!e||e.data.length/e.size===L||(this._dbg(K.Error,"".concat(t," !== numPos. Skipping primitive.")),!1);if(!I(A,"numTexcoord")||!I(U,"numColors")||!I(w,"normals"))continue;const F=(0,se.h)(R);if(null!=h?h=h.clone():(h=(0,te.OX)(f),(0,_.f)(E,h.center,i),h.center=E),a!==m.zK)for(let t=0;t<g.count;t++)g.getVec(t,E),(0,_.o)(E,E,a),g.setVec(t,E);const S=F.createBuffer(f.data.length);if((0,me.zC)(ue.r.POSITION,f,null,null,S,0),null!=A){const e=S.getField(ue.r.UV0,M.gH);(0,me.Ue)(A,e,0)}null!=U&&(0,me.zC)(ue.r.COLOR,f,null,null,S,0),null!=w&&(0,me.zC)(ue.r.NORMALCOMPRESSED,w,null,null,S,0);const H=new Uint32Array([0,O.typedBuffer.length]),k={vertices:{data:S.buffer,count:S.byteLength/F.stride,layoutParameters:R},positionData:{positions:g.typedBuffer,indices:O.typedBuffer},indices:O.typedBuffer,componentOffsets:H};n.cpuMemoryUsage+=g.count,n.cpuMemoryUsage+=O.count;const D=this.view.renderSpatialReference,G=(0,b.vt)(),z=[1,1,1];(0,C.f)(d,D,z,o)||this._dbg(K.Error,"Unsupported coordinate system for IM overlay"),(0,x.F)(d,D,G,o);const W=this._collection.createObject(new ie.i((0,y.fA)(G[0],G[1],z[0],z[1]),new re.d(d,l),h,k));c&&this._collection.updateMaterial(W,e=>{var i,o;e.baseColor=c.baseColorFactor,e.usePBR=p===T.EF.Pbr,e.hasParametersFromSource=!1,e.baseColorTexture=this._getTexture(c.baseColorTex,t,r,n),e.usePBR&&(e.mrrFactors=[c.metallicFactor,c.roughnessFactor,0],e.emissiveBaseColor=null!==(i=c.emissiveFactor)&&void 0!==i?i:[0,0,0],e.metallicRoughnessTexture=this._getTexture(c.metalTex,t,r,n),e.emissionTexture=this._getTexture(c.emissiveTex,t,r,n),e.occlusionTexture=this._getTexture(c.occlusionTex,t,r,n),e.normalTexture=this._getTexture(c.normalTex,t,r,n)),e.objectOpacity=0,e.alphaDiscardMode=V.sf.Mask;const a=[];e.baseColorTexture&&a.push(e.baseColorTexture.loadPromise),e.usePBR&&e.metallicRoughnessTexture&&a.push(e.metallicRoughnessTexture.loadPromise),e.usePBR&&e.emissionTexture&&a.push(e.emissionTexture.loadPromise),e.usePBR&&e.occlusionTexture&&a.push(e.occlusionTexture.loadPromise),e.usePBR&&e.normalTexture&&a.push(e.normalTexture.loadPromise);const l=Promise.all(a);s.push(l),l.then(()=>{var t,i,s,r,o;e.alphaDiscardMode=B[c.alphaMode],e.objectOpacity=1,n.textureMemoryUsage+=(null===(t=e.baseColorTexture)||void 0===t||null===(t=t.glTexture)||void 0===t?void 0:t.usedMemory)||0,e.usePBR&&(n.textureMemoryUsage+=(null===(i=e.metallicRoughnessTexture)||void 0===i||null===(i=i.glTexture)||void 0===i?void 0:i.usedMemory)||0,n.textureMemoryUsage+=(null===(s=e.emissionTexture)||void 0===s||null===(s=s.glTexture)||void 0===s?void 0:s.usedMemory)||0,n.textureMemoryUsage+=(null===(r=e.occlusionTexture)||void 0===r||null===(r=r.glTexture)||void 0===r?void 0:r.usedMemory)||0,n.textureMemoryUsage+=(null===(o=e.normalTexture)||void 0===o||null===(o=o.glTexture)||void 0===o?void 0:o.usedMemory)||0)}),e.commonMaterialParameters.doubleSided=c.isDoubleSided,e.commonMaterialParameters.cullFace=c.faceCulling?j[c.faceCulling]:V.s2.Back,this._initialCullFace.set(W,e.commonMaterialParameters.cullFace),e.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled,e.componentParameters.castShadows=ne.d0.All,e.textureAlphaCutoff=null!==(o=c.alphaCutoff)&&void 0!==o?o:_e.Q,e.alphaDiscardMode=B[c.alphaMode],e.isIntegratedMesh=!0,e.polygonOffsetEnabled=!1,e.hasOccludees=!1,e.ellipsoidMode=(0,le.V)(this.view.spatialReference)}),n.components.push(W),n.vboMemoryUsage+=this._collection.getObjectGPUMemoryUsage(W)}if(await Promise.all(s),r.forEach(e=>{n.textures.push(e)}),!this._memCache)throw new Error("no memCache");return this._memCache.put("".concat(n.handle),n),{memUsageBytes:n.usedMemory}}freeRenderable(e){const t=this._lyrHandleToObjects.get(e);t&&(this.freeObject(t),this._lyrHandleToObjects.delete(e))}freeObject(e){this._memCache&&this._memCache.pop("".concat(e.handle)),e.components.forEach(t=>{e.textures.forEach(e=>{this._stage.removeTexture(e)}),this._collection.destroyObject(t),this._initialCullFace.delete(t)})}setRenderableVisibility(e,t,i){if(this._memCache){for(let s=0;s<i;++s){const i=e[s],r=t[s];if(!r)continue;const n=this._lyrHandleToObjects.get(i);n&&(this._visibleGeometryChanged(),n.isVisible=r,n.components.forEach(e=>{this._collection.setObjectVisibility(e,r),this._elevationProvider.objectChanged(this._collection.getComponentObb(e))}),this._memCache.pop("".concat(i)))}for(let s=0;s<i;++s){const i=e[s],r=t[s];if(r)continue;const n=this._lyrHandleToObjects.get(i);n&&(this._visibleGeometryChanged(),n.isVisible=r,n.components.forEach(e=>{this._collection.setObjectVisibility(e,r),this._elevationProvider.objectChanged(this._collection.getComponentObb(e))}),this._memCache.put("".concat(i),n))}}}_getTexture(e,t,i,s){var r,o;let a=null;if(e&&null!==(r=t.desc)&&void 0!==r&&r.images&&null!==(o=t.data)&&void 0!==o&&o.buffer){const r=t.desc.images[null===e||void 0===e?void 0:e.imageId];if(a=i.get(r),!a&&r){var l;const o=this._stage.renderView.renderingContext.parameters.maxMaxAnisotropy,c=!!r.mipCount||o>1,d=D[null!==(l=e.wrapMode)&&void 0!==l?l:T.Nt.None];let h=r.alpha?4:3;const u=new Uint8Array(t.data.buffer,r.data.byteOffset,r.data.byteCount);let m=null,p=null,g=null;switch(r.format){case T.h7.Raw:r.pixelFormat===T.CP.R8?(m=u,h=1,p=""):r.pixelFormat===T.CP.Rgb8?(m=u,h=3,p=""):r.pixelFormat===T.CP.Rgba8&&(m=u,h=4,p="");break;case T.h7.Dxt1:m=u,h=3,p=V.JS.DDS_ENCODING;break;case T.h7.Dxt5:m=u,h=4,p=V.JS.DDS_ENCODING;break;case T.h7.Basis:m=u,h=3,p=V.JS.KTX2_ENCODING;break;case T.h7.Png:p="image/png",g=document.createElement("img");break;case T.h7.Jpeg:p="image/jpeg",g=document.createElement("img");break;case T.h7.Etc2:p="image/ktx",g=document.createElement("img");break;case T.h7.Astc:this._dbg(K.Error,"Astc texture not supported");break;case T.h7.Pvrtc:this._dbg(K.Error,"Pvrtc texture not supported")}if(g&&p){const e=new Blob([u],{type:p});g.src=URL.createObjectURL(e),m=g}if(m&&null!=p){const e=(0,n.A)("enable-feature:esri-compress-IM-textures")?{compressionTracker:this._compressionTracker,compressionCallback:e=>{e&&e>0&&(s.textureMemoryUsage-=e)}}:void 0;a=new he.g(m,{mipmap:c,maxAnisotropy:o,encoding:p,wrap:d,components:h,compressionOptions:e,noUnpackFlip:!0,width:r.mip0Width,height:r.mip0Height}),this._stage.addTexture(a),i.set(r,a)}}}return a?new oe.Y(this.view.stage.renderView.textures,a.id):null}getBufferViews(e,t,i){let s,r,n,o,a,l,c,d=null;for(let u=0;u<e.atrbs.length;u++){const c=e.atrbs[u],m=c.view,p=void 0,g=m.byteOffset+m.byteCount,f=m.byteCount/G[m.type],_=[...Array(f).keys()].map(e=>e);try{switch(c.sem){case T.eN.Position:3!==m.ncomp||m.type!==T.LU.F32?this._dbg(K.Error,"[Unsupported Feature] Unsupported view for Position ("+m+")"):(s=new M.xs(t,m.byteOffset,p,g),r=new ce.n(s.typedBuffer,_,3));break;case T.eN.Normal:if(3!==m.ncomp||m.type!==T.LU.F32)this._dbg(K.Error,"[Unsupported Feature] Unsupported view for Normal ("+m+")");else{const e=new M.xs(t,m.byteOffset,p,g),s=(0,de._l)(e.typedBuffer,i);a=new M.Qt(s),l=new ce.n(a.typedBuffer,_,2)}break;case T.eN.TexCoord:2!==m.ncomp||m.type!==T.LU.F32?this._dbg(K.Error,"[Unsupported Feature] Unsupported view for Texcoord ("+m+")"):void 0===o&&(o=new ce.n(new M.gH(t,m.byteOffset,p,g).typedBuffer,_,2));break;case T.eN.Color:4===m.ncomp?(m.type===T.LU.F32&&(d=new M.Eq(t,m.byteOffset,p,g)),m.type===T.LU.U8&&(d=new M.XP(t,m.byteOffset,p,g)),m.type===T.LU.U16&&(d=new M.Uz(t,m.byteOffset,p,g))):3===m.ncomp&&(m.type===T.LU.F32&&(d=new M.xs(t,m.byteOffset,p,g)),m.type===T.LU.U8&&(d=new M.eI(t,m.byteOffset,p,g)),m.type===T.LU.U16&&(d=new M.nS(t,m.byteOffset,p,g))),null==d?this._dbg(K.VerboseAPI,"[Unsupported Feature] Unsupported view for Color ("+m+")"):n=new ce.n(d.typedBuffer,_,m.ncomp);break;case T.eN.FeatureIndex:break;default:this._dbg(K.VerboseAPI,"[Unsupported Feature] Unsupported semantic ("+c.sem+"). Skipping vertex attribute.")}}catch(h){this._dbg(K.VerboseAPI,"Error Creating buffer ("+h+"). Skipping vertex attribute.")}}if(e.index){const i=e.index.view,s=void 0,r=i.byteOffset+i.byteCount;switch(e.index.view.type){case T.LU.U16:c=new M.h(t,i.byteOffset,s,r);break;case T.LU.U32:c=new M.P(t,i.byteOffset,s,r);break;case T.LU.U8:default:this._dbg(K.Error,"[Unsupported Feature] index type not supported ("+i.type+").")}}if(null==c&&null!=s){const e=s.count;if(e<65535){const t=new Uint16Array(e);c=new M.h(t)}else{const t=new Uint32Array(e);c=new M.P(t)}for(let t=0;t<e;t++)c.set(t,t)}return{positionView:s,positionAttr:r,colorAttr:n,texCoord0Attr:o,indicesView:c,normalsView:a,normalsAttr:l}}_loadModifications(){if(this.removeHandles("modifications"),null==this.layer.modifications)return void(this._modifications=[]);const e=this.layer.modifications;this.addHandles(this._updatingHandles.addOnCollectionChange(()=>e,()=>this._modifications=e.toArray(),l.Vh),"modifications")}_onRemoveFromCache(e){var t;null!==(t=this._wasm)&&void 0!==t&&t.onRenderableEvicted(this,e.handle,e.usedMemory),this.freeRenderable(e.handle)}_dbg(e,t){this._dbgFlags.has(e)&&(e===K.Error?o.A.getLogger(this).error(t):o.A.getLogger(this).warn(t))}};(0,s._)([(0,d.MZ)({type:[P.A]})],ve.prototype,"_modifications",void 0),(0,s._)([(0,d.MZ)()],ve.prototype,"_visibleGeometryChangedSchedulerHandle",void 0),(0,s._)([(0,d.MZ)()],ve.prototype,"layer",void 0),(0,s._)([(0,d.MZ)({readOnly:!0})],ve.prototype,"visibleAtCurrentScale",null),(0,s._)([(0,d.MZ)()],ve.prototype,"elevationOffset",null),ve=(0,s._)([(0,h.$)("esri.views.3d.layers.IntegratedMesh3DTilesLayerView3D")],ve);const we=ve}}]);
//# sourceMappingURL=16004.5e661418.chunk.js.map