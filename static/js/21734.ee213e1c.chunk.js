"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[21734],{11941:(e,t,n)=>{var s,r;n.d(t,{D:()=>r,f:()=>s}),function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"}(s||(s={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(r||(r={}))},12119:(e,t,n)=>{n.d(t,{EG:()=>m,Js:()=>r,TJ:()=>s,UY:()=>a,ay:()=>d,bP:()=>p,cJ:()=>i,iF:()=>o});var s,r,o,i,a,c,l=n(55855),f=n(78315),u=n(74279),h=n(95225);class d extends h.H{constructor(e,t){super(NaN,NaN),this.id=e,this.serviceMbsInIndexSR=t,this.serviceMbsInRenderSR=(0,f.f)(0,0,0,-1)}invalidateServiceBVsInRenderSR(){var e;(0,u.Q7)(this.serviceMbsInRenderSR),null===(e=this.serviceObbInRenderSR)||void 0===e||e.invalidate()}shareServiceBVsInRenderSRWith(e){this.serviceObbInRenderSR=e.serviceObbInRenderSR,this.serviceMbsInRenderSR=e.serviceMbsInRenderSR}}(c=s||(s={}))[c.Unmodified=0]="Unmodified",c[c.Culled=1]="Culled",c[c.NotChecked=2]="NotChecked",function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(r||(r={}));class p extends d{constructor(e,t,n,s,i,a,c,f,u,h){super(e,n),this.index=t,this.childCount=s,this.level=i,this.resources=a,this.version=c,this.lodMetric=f,this.maxError=u,this.numFeatures=h,this.failed=!1,this.cacheState=o.Unknown,this.vertexCount=0,this.memory=0,this.childrenLoaded=0,this.hasModifications=!1,this.imModificationImpact=r.NotChecked,this.elevationAgnosticBoundingVolume=(0,l.fA)(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR(),this.elevationAgnosticBoundingVolume[3]=-1}}!function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"}(o||(o={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(i||(i={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(a||(a={}));class m{constructor(e,t,n,s){this.nodeHasLOD=e,this.isChosen=t,this.lodLevel=n,this.version=s}}},21734:(e,t,n)=>{n.r(t),n.d(t,{destroyContext:()=>R,dracoDecompressPointCloudData:()=>m,filterObbsForModifications:()=>y,filterObbsForModificationsSync:()=>x,initialize:()=>F,interpretObbModificationResults:()=>A,process:()=>p,project:()=>v,setLegacySchema:()=>g,setModifications:()=>b,setModificationsSync:()=>M,test:()=>O,transformNormals:()=>w});var s=n(15941),r=n(13312),o=n(14894),i=n(5845),a=n(45136),c=n(11941),l=n(28899);function f(e){return(0,l.s)("esri/libs/i3s/".concat(e))}let u;var h=n(97048),d=n(12119);async function p(e){I=await C();const t=[e.geometryBuffer];return{result:E(I,e,t),transferList:t}}async function m(e){var t;I=await C();const n=[e.geometryBuffer],{geometryBuffer:s}=e,r=s.byteLength,o=I._malloc(r),i=new Uint8Array(I.HEAPU8.buffer,o,r);i.set(new Uint8Array(s));const a=I.dracoDecompressPointCloudData(o,i.byteLength);if(I._free(o),a.error.length>0)throw new Error("i3s.wasm: ".concat(a.error));const c=(null===(t=a.featureIds)||void 0===t?void 0:t.length)>0?a.featureIds.slice():null,l=a.positions.slice();return c&&n.push(c.buffer),n.push(l.buffer),{result:{positions:l,featureIds:c},transferList:n}}async function y(e){await C(),x(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function b(e){await C(),M(e)}async function g(e){I=await C(),I.setLegacySchema(e.context,e.jsonSchema)}async function v(e){const{localMatrix:t,origin:s,positions:a,vertexSpace:c}=e,l=r.A.fromJSON(e.inSpatialReference),f=r.A.fromJSON(e.outSpatialReference);let u;const[{projectBuffer:h},{initializeProjection:d}]=await Promise.all([Promise.resolve().then(n.bind(n,45308)),Promise.resolve().then(n.bind(n,9956))]);await d(l,f);const p=[0,0,0];if(!h(s,l,0,p,f,0))throw new Error("Failed to project");if("georeferenced"===c.type&&null==c.origin){if(u=new Float64Array(a.length),!h(a,l,0,u,f,0,u.length/3))throw new Error("Failed to project")}else{const e="georeferenced"===c.type?o.A.fromJSON(c):i.A.fromJSON(c),{projectMeshVertexPositions:s}=await n.e(22956).then(n.bind(n,22956)),r=s({vertexAttributes:{position:a},transform:t?{localMatrix:t}:void 0,vertexSpace:e,spatialReference:l},f);if(!r)throw new Error("Failed to project");u=r}const m=u.length,[y,b,g]=p;for(let n=0;n<m;n+=3)u[n]-=y,u[n+1]-=b,u[n+2]-=g;return{result:{projected:u,original:a,projectedOrigin:p},transferList:[u.buffer,a.buffer]}}async function w(e){let{normalMatrix:t,normals:n}=e;const r=new Float32Array(n.length);return(0,a.b)(r,n,t),(0,s.or)(t)&&(0,a.n)(r,r),{result:{transformed:r,original:n},transferList:[r.buffer,n.buffer]}}function R(e){N(e)}let S,I;function M(e){if(!I)return;const t=e.modifications,n=I._malloc(8*t.length),s=new Float64Array(I.HEAPU8.buffer,n,t.length);for(let r=0;r<t.length;++r)s[r]=t[r];I.setModifications(e.context,n,t.length,e.isGeodetic),I._free(n)}function E(e,t,n){const{context:s,globalTrafo:r,mbs:o,obbData:i,elevationOffset:a,geometryBuffer:l,geometryDescriptor:f,indexToVertexProjector:u,vertexToRenderProjector:d}=t,p=e._malloc(l.byteLength),m=e._malloc(33*Float64Array.BYTES_PER_ELEMENT),y=new Uint8Array(e.HEAPU8.buffer,p,l.byteLength);y.set(new Uint8Array(l));const b=new Float64Array(e.HEAPU8.buffer,m,33);L(b,[NaN,NaN,NaN]);let g=b.byteOffset+3*b.BYTES_PER_ELEMENT,v=new Float64Array(b.buffer,g);L(v,r),g+=16*b.BYTES_PER_ELEMENT,v=new Float64Array(b.buffer,g),L(v,o),g+=4*b.BYTES_PER_ELEMENT,i&&(v=new Float64Array(b.buffer,g),L(v,i));const w=f,R={isDraco:!1,isLegacy:!1,color:t.layouts.some(e=>e.some(e=>"color"===e.name)),normal:t.needNormals&&t.layouts.some(e=>e.some(e=>"normalCompressed"===e.name)),uv0:t.layouts.some(e=>e.some(e=>"uv0"===e.name)),uvRegion:t.layouts.some(e=>e.some(e=>"uvRegion"===e.name)),featureIndex:w.featureIndex},S=e.process(s,!!t.obbData,p,y.byteLength,w,R,m,a,u,d,t.normalReferenceFrame);if(e._free(m),e._free(p),S.error.length>0)throw new Error("i3s.wasm: ".concat(S.error));if(S.discarded)return null;const I=S.componentOffsets.length>0?S.componentOffsets.slice():null,M=S.featureIds.length>0?S.featureIds.slice():null,E=S.anchorIds.length>0?Array.from(S.anchorIds):null,A=S.anchors.length>0?Array.from(S.anchors):null,x=S.interleavedVertedData.slice().buffer,N=S.indicesType===c.f.Int16?new Uint16Array(S.indices.buffer,S.indices.byteOffset,S.indices.byteLength/2).slice():new Uint32Array(S.indices.buffer,S.indices.byteOffset,S.indices.byteLength/4).slice(),F=S.positions.slice(),{buffer:C,byteOffset:O,byteLength:U}=S.positionIndices,D=S.positionIndicesType===c.f.Int16?new Uint16Array(C,O,U/2).slice():new Uint32Array(C,O,U/4).slice(),P=new h._b(t.layouts[0],x,N,S.hasColors,S.hasModifications,{data:F,indices:D});return M&&n.push(M.buffer),I&&n.push(I.buffer),n.push(x),n.push(N.buffer),n.push(F.buffer),n.push(D.buffer),new h.sQ(I,M,E,A,P,r,S.obb)}function A(e){return 0===e?d.Js.Unmodified:1===e?d.Js.PotentiallyModified:2===e?d.Js.Culled:d.Js.Unknown}function x(e){if(!I)return;const{context:t,buffer:n}=e,s=I._malloc(n.byteLength),r=n.byteLength/Float64Array.BYTES_PER_ELEMENT,o=new Float64Array(I.HEAPU8.buffer,s,r),i=new Float64Array(n);o.set(i),I.filterOBBs(t,s,r),i.set(o),I._free(s)}function N(e){I&&0===I.destroy(e)&&(I=null)}function L(e,t){for(let n=0;n<t.length;++n)e[n]=t[n]}async function F(){I||await C()}async function C(){return I||(I=await(null!==S&&void 0!==S?S:(u||(u=new Promise(e=>n.e(77258).then(n.bind(n,77258)).then(e=>e.i).then(t=>{let{default:n}=t;const s=n({locateFile:f,onRuntimeInitialized:()=>e(s)});delete s.then})).catch(e=>{throw e})),S=u))),I}const O={transform:(e,t)=>I&&E(I,e,t),destroy:N}},97048:(e,t,n)=>{n.d(t,{Ir:()=>m,_b:()=>f,sQ:()=>u,xb:()=>h});var s=n(76460),r=n(68930),o=n(9392),i=n(12016),a=n(9956),c=n(14487),l=n(11941);class f{constructor(e,t,n,s,r,o){this.layout=e,this.interleavedVertexData=t,this.indices=n,this.hasColors=s,this.hasModifications=r,this.positionData=o}}class u{constructor(e,t,n,s,r,o,i){this.componentOffsets=e,this.featureIds=t,this.anchorIds=n,this.anchors=s,this.transformedGeometry=r,this.globalTrafo=o,this.obb=i}}class h extends i.B{constructor(e){super("SceneLayerWorker","process",{process:e=>[e.geometryBuffer],project:e=>[e.positions.buffer],transformNormals:e=>[e.normals.buffer]},e,{hasInitialize:!0})}setModifications(e,t,n,s){const r={context:e,modifications:m(t,n,s),isGeodetic:s.isGeographic};this.broadcast(r,"setModifications")}setLegacySchema(e,t){const n=JSON.stringify(t);return this.broadcast({context:e,jsonSchema:n},"setLegacySchema")}destroyContext(e){return this.broadcast(e,"destroyContext")}project(e,t){return this.invokeMethod("project",e,t)}transformNormals(e,t){return this.invokeMethod("transformNormals",e,t)}}const d=new r.A({deallocator:null}),p=(0,o.vt)();function m(e,t,n){d.clear();let r=1/0,o=1/0,i=-1/0,f=-1/0,u=!1;for(const m of t){const e="clip"===m.type?l.D.Inside:"mask"===m.type?l.D.Outside:l.D.Replace,t=m.geometry;let h=e=>e;if(t.spatialReference){if(!(0,a.canProjectWithoutEngine)(t.spatialReference,n)){s.A.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}h=e=>((0,c.F)(e,t.spatialReference,p,n),p)}else t.hasZ||(p[2]=0,h=e=>(p[0]=e[0],p[1]=e[1],p));u=u||e===l.D.Outside,d.push(e),d.push(t.rings.length);for(const n of t.rings){d.push(n.length);for(const e of n){const t=h(e);d.push(t[0]),d.push(t[1]),d.push(t[2]),r=Math.min(r,t[0]),o=Math.min(o,t[1]),i=Math.max(i,t[0]),f=Math.max(f,t[1])}}}if(null!=e)if(u){const t=1e-4;d.push(l.D.Inside),d.push(2),d.push(4),d.push(r-t),d.push(o-t),d.push(0),d.push(i+t),d.push(o-t),d.push(0),d.push(i+t),d.push(f+t),d.push(0),d.push(r-t),d.push(f+t),d.push(0),d.push(4),d.push(e[0]),d.push(e[1]),d.push(0),d.push(e[2]),d.push(e[1]),d.push(0),d.push(e[2]),d.push(e[3]),d.push(0),d.push(e[0]),d.push(e[3]),d.push(0)}else d.push(l.D.Outside),d.push(1),d.push(4),d.push(e[0]),d.push(e[1]),d.push(0),d.push(e[2]),d.push(e[1]),d.push(0),d.push(e[2]),d.push(e[3]),d.push(0),d.push(e[0]),d.push(e[3]),d.push(0);d.push(l.D.Finished);const h=new Float64Array(d.length);for(let s=0;s<d.length;++s)h[s]=d.at(s);return h}}}]);
//# sourceMappingURL=21734.ee213e1c.chunk.js.map