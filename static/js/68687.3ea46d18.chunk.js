"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[68687],{3109:(e,t,n)=>{n.d(t,{$x:()=>o,Wn:()=>c,XO:()=>l,iE:()=>u,y6:()=>a});var i=n(73582),r=n(2413),s=n(80963);class a{constructor(e,t,n,i,r){this.extent=e,this.timeExtent=t,this.size=n,this.pixelRatio=i,this.time=r}get flowExtentInfo(){var e;return{modelSize:this.size,valid:null===(e=(0,s.Vp)(this.extent.spatialReference))||void 0===e?void 0:e.valid,extent:(0,r.VY)(this.extent)}}insideMapExtent(e,t){return o(this.flowExtentInfo,e,t)}modelToMapSpace(e,t,n){return l(this.flowExtentInfo,e,t,n)}}function o(e,t,n){const{extent:i,valid:r}=e,[s,a,o,l]=i;return!(n<a||n>l)&&(null!=r&&s>o?t>=o||t<=s:t>=s&&t<=o)}function l(e,t,n,s){const{extent:a,modelSize:o,valid:l}=e,[u,d,h]=a,f=c(u,h,l);let m=t/o[0]*f+u;return null!=l&&s&&(m=new i.hr(l[0],l[1]).normalize(m)),[m,(o[1]-n)/o[1]*(0,r.uJ)(a)+d]}function u(e,t,n){return null!=n&&Math.abs(e-n.valid[0])<n.dx&&Math.abs(t-n.valid[1])<n.dx}function c(e,t,n){if(null!=n&&e>t){const[i,r]=n;return r-e+(t-i)}return t-e}},10600:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(27106);function r(e){return function(){return new s(e.apply(this,arguments))}}function s(e){var t,n;function r(t,n){try{var a=e[t](n),o=a.value,l=o instanceof i.A;Promise.resolve(l?o.v:o).then(function(n){if(l){var i="return"===t?"return":"next";if(!o.k||n.done)return r(i,n);n=e[i](n).value}s(a.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){s("throw",e)}}function s(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise(function(s,a){var o={key:e,arg:i,resolve:s,reject:a,next:null};n?n=n.next=o:(t=n=o,r(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}s.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},s.prototype.next=function(e){return this._invoke("next",e)},s.prototype.throw=function(e){return this._invoke("throw",e)},s.prototype.return=function(e){return this._invoke("return",e)}},27106:(e,t,n)=>{function i(e,t){this.v=e,this.k=t}n.d(t,{A:()=>i})},31516:(e,t,n)=>{n.d(t,{F:()=>s});n(18690),n(53084);var i=n(18288),r=n(59187);n(42052),n(72027);function s(e,t,n){if(null==(null===e||void 0===e?void 0:e.timeInfo))return null;const{datesInUnknownTimezone:s=!1,timeOffset:a,useViewTime:o}=e;let l=e.timeExtent;s&&(l=function(e){if(!e)return e;const{start:t,end:n}=e;return new r.A({start:null!=t?(0,i.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,i.S1)(n,n.getTimezoneOffset(),"minutes"):n})}(l));let u=o?t&&l?t.intersection(l):t||l:l;return!u||u.isEmpty||u.isAllTime?u:(a&&(u=u.offset(-a.value,a.unit)),s&&(u=function(e){if(!e)return e;const{start:t,end:n}=e;return new r.A({start:null!=t?(0,i.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=n?(0,i.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}(u)),u.equals(n)?n:u)}},31723:(e,t,n)=>{n.d(t,{DW:()=>d,Sw:()=>l,T5:()=>m,Xx:()=>u,Zt:()=>c,uu:()=>o});var i=n(2413),r=n(46533),s=n(76191),a=n(3109);function o(e){return e?4:3}function l(e){return e[0].vertices instanceof Float32Array}class u{constructor(e,t,n,i,r,s){this.data=e,this.mask=t,this.width=n,this.height=i,this.lij=r,this.extent=s}}function c(e){return(0,s.et)(e.lij[0],e.lij[1],e.lij[2])}function d(e,t){let[n,r,s,o]=[null,null,null,null];for(const i of e){const e=i.extent;n=f(e[0],n),r=f(e[1],r),s=h(e[2],s),o=h(e[3],o)}if(null==n||null==r||null==s||null==o)return null;if((0,a.iE)(n,s,t)){const t=[...e].toSorted((e,t)=>e.extent[0]-t.extent[0]);let i=t[0].extent[2],r=0,a=0,o=0;for(let e=1;e<t.length;e++){const[n,s,l]=t[e].extent;if(i<n&&(o++,r=i,a=n,o>1))break;i=Math.max(i,l)}1===o&&(n=a,s=r)}return(0,i.vt)([n,r,s,o])}function h(e,t){return null==t?e:Math.max(e,t)}function f(e,t){return null==t?e:Math.min(e,t)}function m(e,t,n){const[s,o]=n.modelSize;let l=null;const u=new Map;t.forEach(t=>{u.set(t.lij,(0,r.DE)(e,t))});const c=(e,t,n)=>(0,i.Rj)(e.extent,t,n);return(r,d)=>{var h;const f=Math.round(r),m=Math.round(d);if(!e.wrapAround&&(f<0||f>=s||m<0||m>=o))return[0,0];const[g,p]=(0,a.XO)(n,r,d,!0);if(!(0,a.$x)(n,g,p))return[0,0];if(null==l||!c(l,g,p)){l=null;for(const[e,n]of t)if(c(n,g,p)){l=n;break}}if(null==(null===(h=l)||void 0===h?void 0:h.data))return[0,0];const v=u.get(l.lij);if(null==v)return[0,0];const{width:y,height:_,extent:w}=l;return v((g-w[0])/(0,i.VL)(w)*y,_-(p-w[1])/(0,i.uJ)(w)*_)}}},46533:(e,t,n)=>{n.d(t,{CW:()=>f,DE:()=>m,GA:()=>y,S1:()=>v,pH:()=>_});var i=n(89379),r=n(81806),s=n(76460),a=n(15941),o=n(50346),l=n(47249),u=n(76797),c=n(80963);const d=()=>s.A.getLogger("esri.views.2d.engine.flow.dataUtils"),h=10;async function f(e,t,n,i){const s=performance.now(),a=m(t,n),u=performance.now(),c=v(t,a,n.width,n.height),f=performance.now(),g=function(e,t){const n=new l.A,i=e.reduce((e,t)=>e+t.vertices.length,0),r=new Float32Array(4*i),s=new Array(e.length);let a=0,o=0;for(const{vertices:l}of e){const e=a;for(const t of l)r[4*a]=t.x,r[4*a+1]=t.y,r[4*a+2]=t.t,r[4*a+3]=t.speed,a++;s[o++]={startVertex:e,numberOfVertices:l.length,totalTime:l[l.length-1].t,timeSeed:t?n.getFloat():0}}return{lineVertices:r,lineDescriptors:s}}(c,!0),p=performance.now(),y="Streamlines"===e?function(e,t){const n=9,{lineVertices:i,lineDescriptors:r}=e;let s=0,a=0;for(const f of r)s+=2*f.numberOfVertices,a+=6*(f.numberOfVertices-1);const o=new Float32Array(s*n),l=new Uint32Array(a);let u=0,c=0;function d(){l[c++]=u-2,l[c++]=u,l[c++]=u-1,l[c++]=u,l[c++]=u+1,l[c++]=u-1}function h(e,t,i,r,s,a,l,c){const d=u*n;let h=0;o[d+h++]=e,o[d+h++]=t,o[d+h++]=1,o[d+h++]=i,o[d+h++]=a,o[d+h++]=l,o[d+h++]=r/2,o[d+h++]=s/2,o[d+h++]=c,u++,o[d+h++]=e,o[d+h++]=t,o[d+h++]=-1,o[d+h++]=i,o[d+h++]=a,o[d+h++]=l,o[d+h++]=-r/2,o[d+h++]=-s/2,o[d+h++]=c,u++}for(const f of r){const{totalTime:e,timeSeed:n}=f;let r=null,s=null,a=null,o=null,l=null,u=null;for(let c=0;c<f.numberOfVertices;c++){const m=i[4*(f.startVertex+c)],g=i[4*(f.startVertex+c)+1],p=i[4*(f.startVertex+c)+2],v=i[4*(f.startVertex+c)+3];let y=null,_=null,w=null,x=null;if(c>0){y=m-r,_=g-s;const i=Math.sqrt(y*y+_*_);if(y/=i,_/=i,c>1){let e=y+l,n=_+u;const i=Math.sqrt(e*e+n*n);e/=i,n/=i;const r=Math.min(1/(e*y+n*_),t);e*=r,n*=r,w=-n,x=e}else w=-_,x=y;null!==w&&null!==x&&(h(r,s,a,w,x,e,n,v),d())}r=m,s=g,a=p,l=y,u=_,o=v}h(r,s,a,-u,l,e,n,o)}return{vertexData:o,indexData:l}}(g,h):function(e){const t=16,n=1,i=2,{lineVertices:r,lineDescriptors:s}=e;let a=0,o=0;for(const C of s){const e=C.numberOfVertices-1;a+=4*e*2,o+=6*e*2}const l=new Float32Array(a*t),u=new Uint32Array(o);let c,d,h,f,m,g,p,v,y,_,w,x,T,M,S=0,b=0;function A(){u[b++]=S-8,u[b++]=S-7,u[b++]=S-6,u[b++]=S-7,u[b++]=S-5,u[b++]=S-6,u[b++]=S-4,u[b++]=S-3,u[b++]=S-2,u[b++]=S-3,u[b++]=S-1,u[b++]=S-2}function R(e,r,s,a,o,u,c,d,h,f,m,g,p,v){const y=S*t;let _=0;for(const t of[n,i])for(const n of[1,2,3,4])l[y+_++]=e,l[y+_++]=r,l[y+_++]=s,l[y+_++]=a,l[y+_++]=c,l[y+_++]=d,l[y+_++]=h,l[y+_++]=f,l[y+_++]=t,l[y+_++]=n,l[y+_++]=p,l[y+_++]=v,l[y+_++]=o/2,l[y+_++]=u/2,l[y+_++]=m/2,l[y+_++]=g/2,S++}function k(e,t){let n=y+w,i=_+x;const r=Math.sqrt(n*n+i*i);n/=r,i/=r;const s=y*n+_*i;n/=s,i/=s;let a=w+T,o=x+M;const l=Math.sqrt(a*a+o*o);a/=l,o/=l;const u=w*a+x*o;a/=u,o/=u,R(c,d,h,f,-i,n,m,g,p,v,-o,a,e,t),A()}function V(e,t,n,i,r,s){if(y=w,_=x,w=T,x=M,null==y&&null==_&&(y=w,_=x),null!=m&&null!=g){T=e-m,M=t-g;const n=Math.sqrt(T*T+M*M);T/=n,M/=n}null!=y&&null!=_&&k(r,s),c=m,d=g,h=p,f=v,m=e,g=t,p=n,v=i}function L(e,t){y=w,_=x,w=T,x=M,null==y&&null==_&&(y=w,_=x),null!=y&&null!=_&&k(e,t)}for(const C of s){c=null,d=null,h=null,f=null,m=null,g=null,p=null,v=null,y=null,_=null,w=null,x=null,T=null,M=null;const{totalTime:e,timeSeed:t}=C;for(let n=0;n<C.numberOfVertices;n++)V(r[4*(C.startVertex+n)],r[4*(C.startVertex+n)+1],r[4*(C.startVertex+n)+2],r[4*(C.startVertex+n)+3],e,t);L(e,t)}return{vertexData:l,indexData:u}}(g),_=performance.now();return(0,r.A)("esri-2d-profiler")&&(d().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-s)),d().info("I.2","_getStreamlines (ms)",Math.round(f-u)),d().info("I.3","createAnimatedLinesData (ms)",Math.round(p-f)),d().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(_-p)),d().info("I.5","createFlowMesh (ms)",Math.round(_-s)),d().info("I.6","Mesh size (bytes)",y.vertexData.buffer.byteLength+y.indexData.buffer.byteLength)),await Promise.resolve(),(0,o.Te)(i),y}function m(e,t){const n=function(e,t,n,i){if(0===i)return e;const r=Math.round(3*i),s=new Array(2*r+1);let a=0;for(let u=-r;u<=r;u++){const e=Math.exp(-u*u/(i*i));s[u+r]=e,a+=e}for(let u=-r;u<=r;u++)s[u+r]/=a;const o=new Float32Array(e.length);for(let u=0;u<n;u++)for(let n=0;n<t;n++){let i=0,a=0;for(let o=-r;o<=r;o++){if(n+o<0||n+o>=t)continue;const l=s[o+r];i+=l*e[2*(u*t+(n+o))],a+=l*e[2*(u*t+(n+o))+1]}o[2*(u*t+n)]=i,o[2*(u*t+n)+1]=a}const l=new Float32Array(e.length);for(let u=0;u<t;u++)for(let e=0;e<n;e++){let i=0,a=0;for(let l=-r;l<=r;l++){if(e+l<0||e+l>=n)continue;const c=s[l+r];i+=c*o[2*((e+l)*t+u)],a+=c*o[2*((e+l)*t+u)+1]}l[2*(e*t+u)]=i,l[2*(e*t+u)+1]=a}return l}(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,i)=>{const r=Math.floor(e),s=Math.floor(i);if(r<0||r>=t.width)return[0,0];if(s<0||s>=t.height)return[0,0];const a=e-r,o=i-s,l=r,u=s,c=r<t.width-1?r+1:r,d=s<t.height-1?s+1:s,h=n[2*(u*t.width+l)],f=n[2*(u*t.width+c)],m=n[2*(d*t.width+l)],g=n[2*(d*t.width+c)],p=n[2*(u*t.width+l)+1],v=n[2*(u*t.width+c)+1];return[(h*(1-o)+m*o)*(1-a)+(f*(1-o)+g*o)*a,(p*(1-o)+n[2*(d*t.width+l)+1]*o)*(1-a)+(v*(1-o)+n[2*(d*t.width+c)+1]*o)*a]}:(e,i)=>{const r=Math.round(e),s=Math.round(i);return r<0||r>=t.width||s<0||s>=t.height?[0,0]:[n[2*(s*t.width+r)],n[2*(s*t.width+r)+1]]}}function g(e,t,n,i,r,s,o,l){const u=[],{raster:c,width:d,height:h,resolutionFactor:f}=l;let m=i,g=r,p=0,[v,y]=n(m,g);v*=t.velocityScale,y*=t.velocityScale;const _=Math.sqrt(v*v+y*y);let w,x;u.push({x:m,y:g,t:p,speed:_});for(let T=0;T<t.verticesPerLine;T++){let[i,r]=n(m,g);i*=t.velocityScale,r*=t.velocityScale;const l=Math.sqrt(i*i+r*r);if(l<t.minSpeedThreshold)return u;const v=e*i/l,y=e*r/l;if(m+=v*t.segmentLength,g+=y*t.segmentLength,t.wrapAround&&(m=(0,a.OS)(m,s[0])),p+=e*t.segmentLength/l,Math.acos(v*w+y*x)>t.maxTurnAngle)return u;if(t.collisions){let e=Math.round(m*f);const n=Math.round(g*f);if(t.wrapAround&&(e=(0,a.OS)(e,d)),e<0||e>d-1||n<0||n>h-1)return u;const i=c[n*d+e];if(-1!==i&&i!==o)return u;c[n*d+e]=o}u.push({x:m,y:g,t:p,speed:l}),w=v,x=y}return u}function p(e,t,n,r,s,a,o,l){const u=Math.round((.2+.6*o.getFloat())*e.verticesPerLine),c=e.verticesPerLine-u,d=g(-1,(0,i.A)((0,i.A)({},e),{},{verticesPerLine:c}),t,n,r,s,a,l),h=g(1,(0,i.A)((0,i.A)({},e),{},{verticesPerLine:u}),t,n,r,s,a,l),f=d.reverse();return f.splice(-1,1),f.concat(h)}function v(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{positions:[]};if(e.density<=0)return[];const{positions:s}=r,a=[],o=new l.A,u=1/Math.max(e.lineCollisionWidth,1),c=Math.round(n*u),d=Math.round(i*u),h=new Int32Array(c*d);for(let l=0;l<h.length;l++)h[l]=-1;const f={raster:h,width:c,height:d,resolutionFactor:u},m={},v=e.lineSpacing/Math.sqrt(e.density),y=Math.floor(i/v),_=Math.floor(n/v);for(let l=0;l<y;l++){const e=l*v;for(let t=0;t<_;t++){const n=t*v;m["".concat(t,"-").concat(l)]={x:n,y:e,positions:[]}}}for(const{x:l,y:g}of s){const e=m["".concat(Math.floor(l/v),"-").concat(Math.floor(g/v))];e&&e.positions.push([l,g])}const w=[];for(const l in m){const e=m[l];if(0===e.positions.length)w.push({x:e.x+v/2,y:e.y+v/2,sort:.66+.33*o.getFloat(),stage:0});else{const[t]=e.positions.splice(0,1);w.push({x:t[0],y:t[1],sort:.33*o.getFloat(),stage:1});for(const[n,i]of e.positions)w.push({x:n,y:i,sort:.33+.33*o.getFloat(),stage:2})}}w.sort((e,t)=>e.sort-t.sort);for(const{x:l,y:x,stage:T}of w){const r=e.onlyForwardTracing?g(1,e,t,l,x,[n,i],a.length,f):p(e,t,l,x,[n,i],a.length,o,f);r.length<2||a.push({stage:T,vertices:r})}return a}function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.height,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const o=t.pixels,l=n*i,u=new Float32Array(2*l),c=t.width,d=(e,t)=>e+r+(t+s)*c,h=(e,t)=>e+t*n;let f;if(null!=t.mask)if(n!==t.width||i!==t.height||0!==r||0!==s){f=new Uint8Array(2*l);const e=t.mask;for(let t=0;t<i;++t)for(let i=0;i<n;++i){const n=d(i,t),r=h(i,t);f[2*r]=e[2*n],f[2*r+1]=e[2*n+1]}}else f=t.mask;else f=new Uint8Array(2*l),f.fill(255);if("vector-uv"===e)for(let a=0;a<i;++a)for(let e=0;e<n;++e){const t=d(e,a),n=h(e,a);u[2*n]=o[0][t],u[2*n+1]=-o[1][t]}else if("vector-magdir"===e){const{cos:e,sin:t}=Math;for(let r=0;r<i;++r)for(let i=0;i<n;++i){const n=d(i,r),s=h(i,r),l=o[0][n],c=(0,a.kU)(o[1][n]),f=e(c-Math.PI/2),m=t(c-Math.PI/2);u[2*s]=f*l,u[2*s+1]=m*l}}return{data:u,mask:f,width:n,height:i}}async function _(e,t,n,i,s,a){const o=performance.now(),l=(0,c.Vp)(t.spatialReference);if(!l){const l=await w(e,t,n,i,s,a);return(0,r.A)("esri-2d-profiler")&&d().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-o)),(0,r.A)("esri-2d-profiler")&&d().info("I.9","Number of parts",1),l}const[h,f]=l.valid,m=f-h,g=Math.ceil(t.width/m),p=t.width/g,v=Math.round(n/g);let y=t.xmin;const _=[],x=performance.now();for(let r=0;r<g;r++){const n=new u.A({xmin:y,xmax:y+p,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference});_.push(w(e,n,v,i,s,a)),y+=p}const T=await Promise.all(_);if((0,r.A)("esri-2d-profiler")&&d().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-x)),(0,r.A)("esri-2d-profiler")&&d().info("I.9","Number of parts",T.length),1===T.length)return(0,r.A)("esri-2d-profiler")&&d().info("I.10","loadImagery, general exit without stitching back (ms)",Math.round(performance.now()-o)),T[0];const M={data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i};let S=0;for(const r of T){for(let e=0;e<r.height;e++)for(let t=0;t<r.width;t++)S+t>=n||(M.data[2*(e*n+S+t)]=r.data[2*(e*r.width+t)],M.data[2*(e*n+S+t)+1]=r.data[2*(e*r.width+t)+1],M.mask[e*n+S+t]=r.mask[e*r.width+t]);S+=r.width}return(0,r.A)("esri-2d-profiler")&&d().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-o)),M}async function w(e,t,n,i,r,s){const a={requestProjectedLocalDirections:!0,signal:s};if(null!=r&&(a.timeExtent=r),"imagery"===e.type){var o;await e.load({signal:s});const r=await e.internalFetchImage(t,n,i,a);return null==(null===r||void 0===r||null===(o=r.pixelData)||void 0===o?void 0:o.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:y(e.rasterInfo.dataType,r.pixelData.pixelBlock)}await e.load({signal:s});const l=await e.fetchPixels(t,n,i,a);return null==(null===l||void 0===l?void 0:l.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:y(e.serviceRasterInfo.dataType,l.pixelBlock)}},51939:(e,t,n)=>{n.d(t,{AL:()=>y,DV:()=>g,ER:()=>r,F_:()=>o,Nd:()=>f,Oo:()=>s,dy:()=>h,eS:()=>T,h4:()=>M,jC:()=>v,nq:()=>m,rZ:()=>d,y6:()=>p});var i=n(44135);const r="Raster.",s="Raster.Dim.",a=".Max",o={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},l=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function u(e,t){return new i.A({name:e,alias:t,domain:null,editable:!1,length:50,type:"string"})}function c(e,t){return new i.A({name:e,alias:t,domain:null,editable:!1,type:"double"})}function d(e){return u(o.servicePixelValue,null!==e&&void 0!==e?e:"Service Pixel Value")}function h(e){return u(o.rawServicePixelValue,null!==e&&void 0!==e?e:"Raw Service Pixel Value")}function f(){return u(o.itemPixelValue,"Item Pixel Value")}function m(e){return u("".concat(o.servicePixelValue,".").concat(e),e)}function g(e){return c("".concat(o.magnitude),"Magnitude"+(e?" (".concat(e,")"):""))}function p(){return c("".concat(o.direction),"Direction (\xb0)")}function v(e){return e.fields.filter(e=>"oid"!==e.type&&"value"!==e.name.toLowerCase()).map(e=>{const t=e.clone();return t.name="".concat(r).concat(e.name),t})}function y(e){const t=new Set,n=new Set,r=new Map;return e.variables.forEach(e=>{let{dimensions:i}=e;i.forEach(e=>{if(e.recurring)r.set(e.name,e.unit);else{var i,s;const r="ISO8601"===(null===(i=e.unit)||void 0===i?void 0:i.trim())||"stdtime"===(null===(s=e.name)||void 0===s||null===(s=s.trim())||void 0===s?void 0:s.toLowerCase())?t:n;r.add(e.name),e.hasRanges&&r.add("".concat(e.name).concat(a))}})}),[u(o.variable,"Variable"),...[...t].map(e=>function(e,t){return new i.A({name:e,alias:t,domain:null,editable:!1,type:"date"})}("".concat(s).concat(e),w(e))),...[...n].map(e=>c("".concat(s).concat(e),w(e))),...[...r].map(e=>{let[t,n]=e;return c("".concat(s).concat(t),_(t,n))})]}function _(e,t){var n;return(t=null===(n=t)||void 0===n?void 0:n.toLowerCase())&&l.has(t)?l.get(t):w(e)}function w(e){const t=e.endsWith(a),n=t?e.slice(0,-4):e,i="StdTime"===n?"Standard Time":"StdZ"===n?"Standard Z":n;return t?"".concat(i," Max"):i}function x(e,t){return t?new Date(e):e}function T(e,t,n){(null===n||void 0===n?void 0:n.length)&&(t[o.variable]=n[0].variableName,n.forEach(n=>{let{dimensionName:i,values:r}=n;if(i&&null!==r&&void 0!==r&&r.length){const n="".concat(s).concat(i),o=e.find(e=>{let{name:t}=e;return t===n});if(!o)return;const l="date"===o.type,u=r[0];if(Array.isArray(u)){if(t["".concat(s).concat(i)]=x(u[0],l),null!=u[1]){const n="".concat(s).concat(i).concat(a);if(e.some(e=>{let{name:t}=e;return t===n})){const e=x(u[1],l);t[n]=e}}}else t["".concat(s).concat(i)]=x(u,l)}}))}function M(e,t){if(t.pixelType.startsWith("f")&&e.forEach(e=>{let{format:t,fieldName:n}=e;t&&n&&/^raster\.(item|service)pixelvalue/i.test(n)&&(t.places=2)}),t.multidimensionalInfo){const n=t.multidimensionalInfo.variables.flatMap(e=>{let{dimensions:t}=e;return t});e.forEach(e=>{let{format:t,fieldName:i}=e;if(t&&null!==i&&void 0!==i&&i.startsWith(s)){var r;const e=i.slice(s.length),o="".concat(e).concat(a),l=n.find(t=>{let{name:n}=t;return n===e||n===o});(null===l||void 0===l||null===(r=l.values)||void 0===r?void 0:r.every(e=>Number.isInteger(e)))&&(t.places=0)}})}}},64147:(e,t,n)=>{n.d(t,{$7:()=>u,Ci:()=>m,Cq:()=>g,FO:()=>c,NK:()=>h,S$:()=>i,iM:()=>f,jt:()=>s,nD:()=>l,q6:()=>a,q7:()=>o,ti:()=>d,um:()=>r});const i=.1,r=1,s=1,a=1e3,o=!1,l=3,u=1,c=1.5,d=501,h=256,f=3,m=2,g=2},66917:(e,t,n)=>{n.d(t,{Dt:()=>y,EO:()=>f,Lu:()=>a,Sl:()=>p,UL:()=>d,YC:()=>u,hq:()=>s,l0:()=>l,oU:()=>c,r$:()=>m,vG:()=>g});var i=n(76931),r=n(31723);function s(e){const t=a(u(e)),n=t,r=Math.max(t/2,5),s=Math.round((0,i.Lz)(e.maxPathLength)/r)+1,{density:o}=e;return{smoothing:(0,i.Lz)(e.smoothing),interpolate:!0,velocityScale:"flow-from"===e.flowRepresentation?1:-1,verticesPerLine:s,minSpeedThreshold:.001,segmentLength:r,maxTurnAngle:1,collisions:!0,lineCollisionWidth:n,lineSpacing:10,density:o,onlyForwardTracing:!0,wrapAround:!1}}function a(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function o(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function l(e){return{kind:"constant",value:[.1,.1,.1,1]}}function u(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,i.Lz)(e.trailWidth)]};const t=e.getVisualVariablesForType("size")[0],n=[],r=[];let s;if(t.stops){for(const e of t.stops)n.push(e.value),r.push((0,i.Lz)(e.size));s=t.stops.length}else n.push(t.minDataValue,t.maxDataValue),r.push((0,i.Lz)(t.minSize),(0,i.Lz)(t.maxSize)),s=2;return{kind:"ramp",stops:n,values:r,count:s}}function c(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:o(e.color)};const t=e.getVisualVariablesForType("color")[0],n=[],i=[];for(const r of t.stops)n.push(r.value),Array.prototype.push.apply(i,o(r.color));return{kind:"ramp",stops:n,values:i,count:t.stops.length}}function d(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],n=[],i=[];for(const r of t.stops)n.push(r.value),i.push(r.opacity);return{kind:"ramp",stops:n,values:i,count:t.stops.length}}function h(e,t,n,i){switch(t){case"int":e.setUniform1iv(n,i);break;case"float":e.setUniform1fv(n,i);break;case"vec2":e.setUniform2fv(n,i);break;case"vec3":e.setUniform3fv(n,i);break;case"vec4":e.setUniform4fv(n,i)}}function f(e,t,n,i){"constant"===i.kind?h(e,n,"u_".concat(t),i.value):(h(e,"float","u_".concat(t,"_stops"),i.stops),h(e,n,"u_".concat(t,"_values"),i.values),e.setUniform1i("u_".concat(t,"_count"),i.count))}function m(e,t){let n=!0;return n=n&&e.collisions===t.collisions,n=n&&e.density===t.density,n=n&&e.interpolate===t.interpolate,n=n&&e.lineCollisionWidth===t.lineCollisionWidth,n=n&&e.lineSpacing===t.lineSpacing,n=n&&e.maxTurnAngle===t.maxTurnAngle,n=n&&e.minSpeedThreshold===t.minSpeedThreshold,n=n&&e.segmentLength===t.segmentLength,n=n&&e.smoothing===t.smoothing,n=n&&e.velocityScale===t.velocityScale,n=n&&e.verticesPerLine===t.verticesPerLine,n}function g(e,t){return e===t||null!=e&&null!=t&&e.equals(t)}function p(e,t){if(!m(e.simulationSettings,t.simulationSettings))return!1;if(!g(e.timeExtent,t.timeExtent))return!1;let n=!0;return n=n&&e.loadImagery===t.loadImagery,n=n&&e.createFlowMesh===t.createFlowMesh,n=n&&e.color.kind===t.color.kind,n=n&&e.opacity.kind===t.opacity.kind,n=n&&e.size.kind===t.size.kind,n}function v(e,t,n,i){return e/=n.size[0],t=1-(t/=n.size[1]),e*=n.extent.xmax-n.extent.xmin,t*=n.extent.ymax-n.extent.ymin,e+=n.extent.xmin,t+=n.extent.ymin,e-=i.extent.xmin,t-=i.extent.ymin,e/=i.extent.xmax-i.extent.xmin,t=1-(t/=i.extent.ymax-i.extent.ymin),{x:e*=i.size[0],y:t*=i.size[1]}}function y(e,t,n,i){const s=[],a=n.time-t.time;if(0===e.length)return[];const o=(0,r.Sw)(e),l=o?(0,r.uu)(e[0].hasMagnitude):1,u=o?(e,t)=>{let{vertices:n}=e;const i=n,r=t*l;return{x:i[r],y:i[r+1],t:i[r+2],speed:0}}:(e,t)=>{let{vertices:n}=e;return n[t]};for(const r of e){const{stage:e,vertices:o}=r;if(2===e)continue;const c=o.length/l,d=u(r,0),h=d.t,f=(a*i-h)%(u(r,c-1).t-h)+h;let m,g=d.x,p=d.y,y=d.t;for(m=1;m<c&&y<f;m++){const e=u(r,m),t=Math.min(e.t,f)-y,n=e.t-y;g+=(e.x-g)*(t/n),p+=(e.y-p)*(t/n),y+=t}s.push(v(g,p,t,n))}return s}},76191:(e,t,n)=>{n.d(t,{Tb:()=>s,et:()=>u,mS:()=>o,nx:()=>a});var i=n(34111),r=n(2413);const s="virtual-snapshot-tile",a="virtual-display-filter-highlight-tile";class o{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u(e,t,n);this._tilingScheme=i,this.id=s,this.lij=[0,0,0],this.extent=null,this.measures=new l,this.loadPriority=0,this.used=!1,this.lij[0]=this.measures.lodLevel=e,this.lij[1]=t,this.lij[2]=n,i&&(this.extent=(0,r.vt)(),null===i||void 0===i||i.getExtent(e,t,n,this.extent))}get planetRadius(){return(0,i.tO)(this.spatialReference).radius}get spatialReference(){var e;return null===(e=this._tilingScheme)||void 0===e?void 0:e.spatialReference}get resolution(){var e,t;return null!==(e=null===(t=this._tilingScheme)||void 0===t?void 0:t.resolutionAtLevel(this.measures.lodLevel))&&void 0!==e?e:0}get level(){return this.lij[0]}get lodLevelDelta(){return this.measures.lodLevel-this.level}createChildren(){const e=this.lij[0]+1,t=2*this.lij[1],n=2*this.lij[2];return[new o(e,t,n,this._tilingScheme),new o(e,t+1,n,this._tilingScheme),new o(e,t,n+1,this._tilingScheme),new o(e,t+1,n+1,this._tilingScheme)]}}class l{constructor(){this.visible=!0,this.distance=0,this.lodLevel=0,this.splitPriority=0,this.mergeable=!0}}function u(e,t,n){return"".concat(e,"/").concat(t,"/").concat(n)}},89214:(e,t,n)=>{n.d(t,{A:()=>Q});var i=n(89379),r=n(6326),s=n(18690),a=(n(81806),n(30726)),o=n(50346),l=n(68134),u=n(52394),c=n(91417),d=n(31633),h=n(46053),f=(n(76460),n(87990)),m=n(34111),g=n(56611),p=n(2413),v=n(80963),y=n(731),_=n(66917),w=n(69576),x=n(1873),T=n(64147),M=n(3109),S=n(12016);class b extends S.B{constructor(e){super("FlowWorker","generateStreamlines",{generateStreamlines:e=>[e.flowData.data.buffer,e.flowData.mask.buffer],generateTiledStreamlines:e=>{const t=[];return e.flowDataTiles.forEach(e=>{"loaded"===e.type&&t.push(e.data.data.buffer,e.data.mask.buffer)}),t}},e,{strategy:"dedicated"})}generateStreamlines(e,t){return this.invokeMethod("generateStreamlines",e,t)}generateTiledStreamlines(e,t){return this.invokeMethod("generateTiledStreamlines",e,t)}}var A=n(69539),R=n(9392),k=n(75002),V=n(94587),L=n(12482),C=n(63048),P=n(70667),I=n(31723),D=n(1599);function E(e,t,n,i,r,s){let{vertices:a,stage:o,hasMagnitude:l}=n;const{spatialReference:u}=t.extent,c=[],d=(0,I.uu)(l),h=t.flowExtentInfo.modelSize[0];let f=0;for(let M=0;M<a.length;M+=d){if(s&&M>0){const e=a[M]-a[M-d];e>h/2?f-=h:-e>h/2&&(f+=h)}const[n,r]=t.modelToMapSpace(a[M]+f,a[M+1],!1),o=s?[n,r,D.bi]:F(n,r,u,e,i);c.push(o)}const m=Math.floor(a.length/d),g=(0,V.fY)(m);for(let M=0;M<m;M++)g[M]=a[M*d+2];const{hasVVColor:p,hasVVOpacity:v,hasVVSize:y}=r.parameters;let _,w,x;if(l&&(p||v||y)){const e=(0,k.oe)(m);for(let t=0;t<m;t++)e[t]=a[t*d+3];p&&(_=[e]),v&&(w=[e]),y&&(x=[e])}const T=(0,P.yU)([c],void 0,[{timeStamps:g,streamlineType:o}],_,w,x);return(0,P.te)(r,T[0])}function F(e,t,n,i,r){const{absoluteZ:s}=(0,L.Q5)(e,t,0,n,i,r),a=(0,R.fA)(e,t,s);return i.renderCoordsHelper.toRenderCoords(a,n,a),a}var q=n(10600),O=n(48989),Z=n(97255);class z{constructor(e,t,n,i,r){this._query=e,this.streamlines=t,this._material=n,this.geometries=i,this._bytesPerFeature=r,this._startTime=0,this._endTime=1/0,this.usedMemory=null,this.startTime=this._query.time,this.computeMemory()}computeMemory(){const e=(0,Z.Qh)(this.streamlines),t=(0,Z.Qh)(this.geometries.map(e=>e.attributes)),n=this.streamlines.length*this._bytesPerFeature;this.usedMemory=e+t+n}get startTime(){return this._startTime}set startTime(e){this._query.time!==e&&(this._query=new M.y6(this._query.extent,this._query.timeExtent,this._query.size,this._query.pixelRatio,(0,c.Kp)(e))),this._startTime=e,this.setMaterialParameters({startTime:e})}get endTime(){return this._endTime}set endTime(e){this._endTime=e,this.setMaterialParameters({endTime:e})}get query(){return this._query}hasFadedOut(e){return this.endTime+this._material.parameters.fadeOutTime<e}setMaterialParameters(e){this._material.setParameters(e)}get test(){return null}}var U=n(442),W=n(59752);class j extends z{constructor(e,t,n,i,r){super(e,t,n,i,O.Fq.LINE_ROUND.draped.bytesPerFeature),this._layerView=r,this._drapeRenderer=null,this.drapeSourceType=2,this.updatePolicy=0,this.renderGroup=0,this._frameTask=null,this._renderGeometries=[]}get _view(){return this._layerView.view}get layer(){return this._layerView.layer}get fullOpacity(){return this._layerView.fullOpacity}get attached(){return null!=this._drapeRenderer}get destroyed(){return this.attached}async attach(){const{geometries:e}=this;null!=e&&(this.detach(),this._frameTask=this._view.resourceController.scheduler.registerTask(W.W6.FLOW_GENERATOR),await this._frameTask.scheduleGenerator(t=>this._addGeometryToOverlay(e,t)))}_addGeometryToOverlay(e,t){var n=this;return(0,q.A)(function*(){n._drapeRenderer=n._view.overlayManager.registerGeometryDrapeSource(n);for(let i=0;i<e.length;i+=T.ti){const r=e.slice(i,i+T.ti).map(e=>new U.$(e));n._drapeRenderer.addGeometries(r,0),n._renderGeometries.push(...r),n._drapeRenderer.commitChanges(),t.madeProgress(),t.done&&(t=yield)}})()}detach(){this._frameTask=(0,a.xt)(this._frameTask),this._drapeRenderer&&(this._drapeRenderer.removeGeometries(this._renderGeometries,2),this._drapeRenderer.commitChanges(),this._renderGeometries.length=0),this.attached&&this._view.overlayManager.unregisterDrapeSource(this),this._drapeRenderer=(0,a.pR)(this._drapeRenderer)}}var G=n(37046),B=n(8918);class N extends z{constructor(e,t,n,i,r){super(e,t,n,i,O.Fq.LINE_ROUND.bytesPerFeature),this._view=r,this._objects3D=[],this._engineLayer=null,this._frameTask=null}get attached(){return null!=this._engineLayer}async attach(){const{geometries:e}=this;null!=e&&(this.detach(),this._frameTask=this._view.resourceController.scheduler.registerTask(W.W6.FLOW_GENERATOR),await this._frameTask.scheduleGenerator(t=>this._addGeometryToLayer(e,t)))}detach(){var e,t;this.attached&&(null!==(e=this._engineLayer)&&void 0!==e&&e.removeMany(this._objects3D),this._objects3D.forEach(e=>e.dispose()),null!==(t=this._engineLayer)&&void 0!==t&&t.commit(),this._objects3D=[],this._engineLayer=null,this._frameTask=(0,a.xt)(this._frameTask))}_addGeometryToLayer(e,t){var n=this;return(0,q.A)(function*(){const{stage:i}=n._view,r=new B.x(i,{pickable:!1,updatePolicy:1});for(let s=0;s<e.length;s+=T.ti){const i=new G.B({geometries:e.slice(s,s+T.ti),castShadow:!1});r.add(i),n._objects3D.push(i),r.commit(),t.madeProgress(),t.done&&(t=yield)}n._engineLayer=r})()}}var H=n(9902),$=n(12028),K=n(52479),Y=n(90992);let Q=class extends w.A{constructor(e){super(e),this.type="flow",this.renderedTiles=null,this.requireLoad=!1,this.workerHandle=null,this.frameTask=null,this._averageLoadingTime=(0,c.Kp)(0),this._abortController=null,this._loadingState="ready-to-load",this._tilesUpdateIsWaiting=!1,this._debugAllowAutoLoading=!0,this.emissiveStrength=0,this._overrideMaterialParameters=null,this._overrideSimulationSettings=null,this._overrideTransitionEnabled=null,this._updateTask=null,this._debouncedTileUpdate=(0,o.sg)(async()=>{const{allTiles:e}=this.surface,t=this._getTileFilterFunction(),n=new Set;await this.frameTask.scheduleGenerator(function*(i){for(let r=0;r<e.length;++r){const s=e.at(r);t(s)&&n.add(s),i.madeProgress(),i.done&&(i=yield)}}),this.renderedTiles=n})}initialize(){const{surface:e,view:t}=this,{resourceController:n}=t;this.workerHandle=new b((0,x.m)(n)),this.frameTask=n.scheduler.registerTask(W.W6.FLOW_GENERATOR),this._updateTask=(0,u.mg)({update:e=>this._update(e)}),this.addHandles([(0,l.wB)(()=>this._simulationSettings,()=>this.triggerLoad(),{sync:!0,equals:(e,t)=>null==e&&null==t||null!=e&&null!=t&&(0,_.r$)(e,t)}),(0,l.wB)(()=>{const{elevationInfo:e}=this;return[this._clippingArea,this._visible,this._draped,this.view.state.contentPixelRatio,this.view.viewingMode,null===e||void 0===e?void 0:e.mode,null===e||void 0===e?void 0:e.offset,null===e||void 0===e?void 0:e.unit,this._effectiveDensity]},()=>this.triggerLoad(),l.OH),(0,l.wB)(()=>this._materialParameters,e=>{var t,n;null!==(t=this._resources)&&void 0!==t&&t.setMaterialParameters(e),null===(n=this._lastResources)||void 0===n||n.setMaterialParameters(e)}),e.on("tiles-changed",()=>{this.loadByTileTreesAllowed&&this._triggerTilesUpdate()}),t.enableFeatureTiles(),(0,l.wB)(()=>[this._dataBounds,this._featureTilesBounds,this.loadAllTiles],()=>this._triggerTilesUpdate()),(0,l.wB)(()=>this._flowRenderer,(e,t)=>{var n,i;const r=null!==(n=null===t||void 0===t?void 0:t.visualVariables)&&void 0!==n?n:[],s=null!==(i=null===e||void 0===e?void 0:e.visualVariables)&&void 0!==i?i:[];s.length===r.length&&s.every((e,t)=>e.type===r[t].type)||this.clear()}),(0,l.z7)(()=>{var e;return!(null!==(e=t.featureTiles)&&void 0!==e&&e.updating)},()=>{this.loadByTileTreesAllowed&&this._triggerTilesUpdate()})]),this._triggerTilesUpdate()}destroy(){this._updateTask=(0,a.xt)(this._updateTask),this.abort(),this.clear()}abort(){this._abortController=(0,a.DC)(this._abortController),this.requireLoad=!1}get _clippingArea(){const e=(0,g.projectOrLoad)(this.view.clippingArea,this.surface.spatialReference).geometry;return null==e?null:(0,p.VY)(e)}get _dataBounds(){const e=(0,g.projectOrLoad)(this.layer.fullExtent,this.surface.spatialReference).geometry;return null==e?null:(0,p.VY)(e)}get _draped(){return"on-the-ground"===this.elevationInfo.mode}get _ellipsoidRadius(){return(0,m.tO)(this.view.spatialReference).radius}get extent(){const{spatialReference:e}=this.surface;let t=this.renderedTiles;if(null==e||null==t)return null;const n=this.view.terrainLevel;if(null!=n){const e=new Set;t.forEach(t=>{Math.abs(n-t.level)<T.iM&&e.add(t)}),t=e}const i=(0,I.DW)(t,this.spatialReferenceInfo);return null==i?null:((0,p.E$)(i,this._clippingArea,i),(0,p.w1)(i,e))}get loadAllTiles(){const{position:e}=this.view.camera,t=e.z;return null!=t&&t*(0,d.G9)(e.spatialReference)/this._ellipsoidRadius>=T.FO}get isDataGlobal(){const{extent:e,spatialReferenceInfo:t}=this;return null!=e&&(0,M.iE)(e.xmin,e.xmax,t)}get loadByTileTreesAllowed(){return!this.loadAllTiles||!this.loadRequirementsMet}get _featureTilesBounds(){var e;const t=null===(e=this.view.featureTiles)||void 0===e?void 0:e.filterExtent,n=(0,g.projectOrLoad)(t,this.surface.spatialReference).geometry;return null==n?null:(0,p.VY)(n)}get _flowRenderer(){const e=this.layer.renderer;return"flow"!==(null===e||void 0===e?void 0:e.type)?null:e}get _materialParameters(){return(0,i.A)((0,i.A)((0,i.A)({},function(e,t,n){var i,r,s,a;if(null==e)return{};let o=null;if(e.visualVariables){const t=[],n=e.visualVariables,i=new C.wI({supports:{size:!0,color:!0,rotation:!1,opacity:!0}});o=(0,C.T3)(n,i,t)}const l=null!==(i=o)&&void 0!==i&&i.color?[1,1,1,1]:A.A.toUnitRGBA(e.color);return l[3]*=t,{color:l,width:e.trailWidth,cap:0,animationSpeed:e.flowSpeed,trailLength:e.trailLength,animation:3,emissiveStrength:n,vvColor:null===(r=o)||void 0===r?void 0:r.color,vvOpacity:null===(s=o)||void 0===s?void 0:s.opacity,vvSize:null===(a=o)||void 0===a?void 0:a.size}}(this._flowRenderer,this.layerView.fullOpacity,this.emissiveStrength)),{},{fadeInTime:T.jt,fadeOutTime:T.um},this._overrideMaterialParameters),{},{hasSlicePlane:this.layerView.slicePlaneEnabled,screenSizePerspective:!this._draped&&(0,$.tl)(this.layer.screenSizePerspectiveEnabled)?this.view.screenSizePerspective.parameters:null})}get _opacity(){return this.layerView.fullOpacity}get _seamlessTransitionWaitingTime(){const{_averageLoadingTime:e}=this;return(0,c.Kp)(0===e?T.$7:this._averageLoadingTime*T.nD)}get _seamlessTransitionEnabled(){return null!=this._overrideTransitionEnabled?this._overrideTransitionEnabled:T.q7}get _tracingResolution(){var e;const{extent:t}=this;if(!t)return[0,0];const n=(0,M.Wn)(t.xmin,t.xmax,null===(e=this.spatialReferenceInfo)||void 0===e?void 0:e.valid)/(t.ymax-t.ymin),[i,r]=this.view.size;let s,a;i<r?(s=i,a=i/n):(s=r*n,a=r);const o=T.NK,l=this.view.qualitySettings.flow3D.maxTracingResolution,u=Math.max(1,o/Math.min(s,a)),c=u*Math.min(1,l/Math.max(s*u,a*u));return[Math.round(s*c),Math.round(a*c)]}get _visible(){var e;const t=null===(e=this._flowRenderer)||void 0===e?void 0:e.color;return this.visibleAtCurrentScale&&this.layer.effectiveVisible&&this._opacity>0&&(null==t||t.a>0)}get _estimatedStreamlines(){const{extent:e,_simulationSettings:t,renderedTiles:n}=this;if(null==t||null==n)return 0;const i=this._tracingResolution[0]*this._tracingResolution[1]/t.lineSpacing**2*t.density,r=null==e?null:(0,p.VY)(e);if(null==r)return 0;let s=0;for(const l of n)(0,p.gR)(r,l.extent)&&(s+=(0,p.Wc)(l.extent));const a=(0,p.Wc)(r),o=0===a?0:s/a;return 2*Math.round(i*o)}get _effectiveDensity(){const{_estimatedStreamlines:e,_simulationSettings:t}=this,{qualitySettings:n,quality:i}=this.view;if(null==t)return 0;const r=n.flow3D.maxTotalNumberOfStreamlines,s=e>=r?r/e:1,a=t.density*s*i;return t.lineSpacing/Math.sqrt(a)<t.lineCollisionWidth?(t.lineSpacing/t.lineCollisionWidth)**2:a}get elevationInfo(){var e;return null!==(e=this.layer.elevationInfo)&&void 0!==e?e:X}startPositions(e){if(!this._seamlessTransitionEnabled)return[];const{_flowRenderer:t,_resources:n}=this;return null==t||null==n?[]:(0,_.Dt)(n.streamlines,n.query,e,t.flowSpeed)}get needsMagnitude(){var e,t;return null!==(e=null===(t=this._flowRenderer)||void 0===t?void 0:t.hasVisualVariables())&&void 0!==e&&e}get spatialReferenceInfo(){return(0,v.Vp)(this.surface.spatialReference)}get layer(){return this.layerView.layer}get loadingState(){return this._loadingState}get loadRequirementsMet(){return null!=this.renderedTiles&&this.renderedTiles.size>0}getUpdating(){return this.updatingHandles.updating||this.requireLoad||"before-transition"===this._loadingState}get updating(){return this.getUpdating()}get visibleAtCurrentScale(){return!(0,Y.j)()||(0,Y.E5)(this.layer.effectiveScaleRange,this.view.scale)}get _simulationSettings(){const{_flowRenderer:e,_overrideSimulationSettings:t}=this;if(null==e)return null;let n=(0,_.hq)(e);return n.segmentLength=n.lineCollisionWidth/2,n.onlyForwardTracing=!1,n.density*=T.Ci,this.loadAllTiles&&this.isDataGlobal&&(n.density*=T.Cq),null!=t&&(n=(0,i.A)((0,i.A)({},n),t)),n}getSimulationSettings(e){const{_simulationSettings:t,spatialReferenceInfo:n}=this;if(null==t)return null;const r="global"===this.view.viewingMode&&null!=n&&(0,M.iE)(e.extent.xmin,e.extent.xmax,n);return(0,i.A)((0,i.A)({},t),{},{wrapAround:r,density:this._effectiveDensity})}get surface(){return this.view.basemapTerrain}doRefresh(){this.triggerLoad()}clear(){var e,t;null!==(e=this._resources)&&void 0!==e&&e.detach(),this._resources=null,null!==(t=this._lastResources)&&void 0!==t&&t.detach(),this._lastResources=null,this._loadingState="ready-to-load"}_update(e){var t;const n=(0,c.y)(e.time);(null===(t=this._lastResources)||void 0===t?void 0:t.hasFadedOut(n))&&this._lastResources.detach();const i=this._nextStateForTransition(n);if(!this.requireLoad||this.updatingHandles.updating||"ready-to-load"!==i||!this.loadRequirementsMet)return void(this._loadingState=i);this._loadingState="loading";this.updatingHandles.addPromise((0,o.QZ)((async()=>{const e=performance.now(),t=this._seamlessTransitionEnabled&&null!=this._resources?(0,c.Kp)(n+this._seamlessTransitionWaitingTime):n;await this._load(t);const i=(0,c.Kp)((performance.now()-e)/1e3);this._updateAverageLoadingTime(i)})())),this.requireLoad=!1}_updateAverageLoadingTime(e){const t=T.S$;this._averageLoadingTime=(0,c.Kp)(t*e+(1-t)*this._averageLoadingTime)}triggerLoad(){this._debugAllowAutoLoading&&(this.requireLoad=!0)}async _load(e){const{extent:t,view:n}=this;if(!this._visible)return this.clear(),void(this._loadingState="ready-to-load");if(null==t)return void(this._loadingState="ready-to-load");const i=new M.y6(t,this.layerView.timeExtent,this._tracingResolution,n.state.contentPixelRatio,e);null==this._abortController&&(this._abortController=new AbortController);const r=this._abortController,s=await this._loadStreamlines(i,r.signal);if((0,o.Te)(r.signal),this._visible&&null!=s){var a;null!==(a=this._lastResources)&&void 0!==a&&a.detach(),this._lastResources=this._resources,this._resources=s;const t=performance.now()/1e3,n=t>e?t:e;null!=this._lastResources&&(this._lastResources.endTime=n),this._resources.startTime=n,await s.attach(),this._loadingState=this._seamlessTransitionEnabled?"before-transition":"transitioning"}else this._loadingState="ready-to-load"}async _loadStreamlines(e,t){const n=await this.fetchDataAndGenerateStreamlines(e,t);if(null==n)return null;const{geometries:i,material:r}=await this._createGeometry(e,n);return this._draped?new j(e,n,r,i,this.layerView):new N(e,n,r,i,this.view)}async fetchDataAndGenerateStreamlines(e,t){return null}async _createGeometry(e,t){const n=new K.W(this._materialParameters,this.view.state.isGlobal),i=new Array,{elevationInfo:r,_draped:s,view:a}=this;return await this.frameTask.scheduleGenerator(function*(o){for(let l=0;l<t.length;++l)i.push(E(a,e,t[l],r,n,s)),o.madeProgress(),o.done&&(o=yield)}),{geometries:i,material:n}}_triggerTilesUpdate(){if(this._tilesUpdateIsWaiting)return;this._tilesUpdateIsWaiting=!0;this.updatingHandles.addPromise((0,o.QZ)((async()=>{await(0,l.C_)(()=>this.view.stationary),this._tilesUpdateIsWaiting=!1,await this._debouncedTileUpdate()})()))}_getTileFilterFunction(){const{_dataBounds:e,view:t,_featureTilesBounds:n}=this;if(this.loadAllTiles)return t=>t.leaf&&J(e,t.extent);const i=t=>t.rendered&&t.visible&&J(e,t.extent),{featureTiles:r}=t;if(!r)return i;const a=r.tiles.filter(e=>e.measures.visible);return e=>i(e)&&J(n,e.extent)&&a.some(t=>{let{lij:n}=t;return(0,s.aI)(n,e.lij)||(0,H.ZH)(n,e.lij)})}_nextStateForTransition(e){const{_resources:t}=this;if(null==this._flowRenderer||null==t||"ready-to-load"===this._loadingState||"loading"===this._loadingState)return this._loadingState;const n=t.startTime;return e<n?"before-transition":e<n+T.um?"transitioning":"ready-to-load"}get usedMemory(){var e,t,n,i;return(null!==(e=null===(t=this._lastResources)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0)+(null!==(n=null===(i=this._resources)||void 0===i?void 0:i.usedMemory)&&void 0!==n?n:0)}get test(){}};(0,r.Cg)([(0,h.MZ)()],Q.prototype,"type",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"renderedTiles",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_resources",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_lastResources",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"requireLoad",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_averageLoadingTime",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_loadingState",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"emissiveStrength",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_clippingArea",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_dataBounds",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_draped",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_ellipsoidRadius",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"extent",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"loadAllTiles",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"isDataGlobal",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_featureTilesBounds",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_flowRenderer",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_materialParameters",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_opacity",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_seamlessTransitionWaitingTime",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_seamlessTransitionEnabled",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_tracingResolution",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_visible",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_estimatedStreamlines",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_effectiveDensity",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"elevationInfo",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"needsMagnitude",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"spatialReferenceInfo",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"layer",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"loadingState",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"updating",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"visibleAtCurrentScale",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_overrideMaterialParameters",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_overrideSimulationSettings",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_overrideTransitionEnabled",void 0),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"_simulationSettings",null),(0,r.Cg)([(0,h.MZ)()],Q.prototype,"surface",null),Q=(0,r.Cg)([(0,f.$)("esri.views.3d.layers.FlowSubView3D")],Q);const X=new y.A({mode:"on-the-ground"});function J(e,t){return null==e||null==t||(0,p.HY)(e,t)}}}]);
//# sourceMappingURL=68687.3ea46d18.chunk.js.map