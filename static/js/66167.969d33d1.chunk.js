"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[66167],{114:(e,t,i)=>{i.d(t,{P:()=>f});var a=i(59422),n=i(62887),r=i(76418),s=i(5095),o=i(40480),l=i(3986),c=i(93345);const u=1/65536;class f extends l.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,a.vt)()}dispose(){}drawMany(e,t){const i=e.styleLayer;this._drawIcons(e,i,t),this._drawText(e,i,t)}_drawIcons(e,t,i){const{context:a,displayLevel:l,painter:c,spriteMosaic:u,state:f,styleLayerUID:d,requestRender:p,allowDelayedRender:g}=e,y=t.iconMaterial,m=c.vectorTilesMaterialManager;let _,M=!1;for(const n of i)if(n.layerData.has(d)&&(_=n.layerData.get(d),_.iconPerPageElementsMap.size>0)){M=!0;break}if(!M)return;const h=t.getPaintValue("icon-translate",l),v=t.getPaintValue("icon-translate-anchor",l);let U=t.getLayoutValue("icon-rotation-alignment",l);U===r.I5.AUTO&&(U=t.getLayoutValue("symbol-placement",l)===r.kt.POINT?r.I5.VIEWPORT:r.I5.MAP);const E=U===r.I5.MAP,P=t.getLayoutValue("icon-keep-upright",l)&&E,I=_.isIconSDF,x=this._iconProgramOptions;x.sdf=I;const R=m.getMaterialProgram(a,y,x);if(g&&null!=p&&!R.compiled)return void p();a.useProgram(R),R.setUniformMatrix3fv("u_displayViewMat3",U===r.I5.MAP?f.displayViewMat3:f.displayMat3),R.setUniformMatrix3fv("u_displayMat3",v===r.Cq.VIEWPORT?f.displayMat3:f.displayViewMat3),R.setUniform2fv("u_iconTranslation",h),R.setUniform1f("u_depth",t.z),R.setUniform1f("u_mapRotation",(0,o.wV)(f.rotation)),R.setUniform1f("u_keepUpright",P?1:0),R.setUniform1f("u_level",10*l),R.setUniform1i("u_texture",s.$U),R.setUniform1f("u_fadeDuration",n.zk/1e3);let T=-1;for(const n of i){if(!n.layerData.has(d))continue;if(n.key.level!==T&&(T=n.key.level,y.setDataUniforms(R,l,t,T,u)),_=n.layerData.get(d),0===_.iconPerPageElementsMap.size)continue;_.prepareForRendering(a),_.updateOpacityInfo();const i=_.iconVAO;if(null!=i){a.bindVAO(i),R.setUniformMatrix3fv("u_dvsMat3",n.transforms.displayViewScreenMat3),R.setUniform1f("u_time",(performance.now()-_.lastOpacityUpdate)/1e3);for(const[t,i]of _.iconPerPageElementsMap)this._renderIconRange(e,R,i,t,n)}}}_renderIconRange(e,t,i,a,n){const{context:r,spriteMosaic:o}=e;this._spritesTextureSize[0]=o.getWidth(a)/4,this._spritesTextureSize[1]=o.getHeight(a)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(r,c.Cj.LINEAR,a,s.$U),this._setStencilState(e,n),r.drawElements(c.WR.TRIANGLES,i[1],c.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),n.triangleCount+=i[1]/3}_drawText(e,t,i){const{context:l,displayLevel:c,glyphMosaic:f,painter:d,pixelRatio:p,spriteMosaic:g,state:y,styleLayerUID:m,requestRender:_,allowDelayedRender:M}=e,h=t.textMaterial,v=d.vectorTilesMaterialManager;let U,E=!1;for(const a of i)if(a.layerData.has(m)&&(U=a.layerData.get(m),U.glyphPerPageElementsMap.size>0)){E=!0;break}if(!E)return;const P=t.getPaintProperty("text-opacity");if(P&&!P.isDataDriven&&0===P.getValue(c))return;const I=t.getPaintProperty("text-color"),x=!I||I.isDataDriven||I.getValue(c)[3]>0,R=t.getPaintProperty("text-halo-width"),T=t.getPaintProperty("text-halo-color"),S=(!R||R.isDataDriven||R.getValue(c)>0)&&(!T||T.isDataDriven||T.getValue(c)[3]>0);if(!x&&!S)return;let D=t.getLayoutValue("text-rotation-alignment",c);D===r.I5.AUTO&&(D=t.getLayoutValue("symbol-placement",c)===r.kt.POINT?r.I5.VIEWPORT:r.I5.MAP);const w=D===r.I5.MAP,V=t.getLayoutValue("text-keep-upright",c)&&w,A=.8*3/p;this._glyphTextureSize||(this._glyphTextureSize=(0,a.fA)(f.width/4,f.height/4));const L=t.getPaintValue("text-translate",c),N=t.getPaintValue("text-translate-anchor",c),O=this._sdfProgramOptions,C=v.getMaterialProgram(l,h,O);if(M&&null!=_&&!C.compiled)return void _();l.useProgram(C),C.setUniformMatrix3fv("u_displayViewMat3",D===r.I5.MAP?y.displayViewMat3:y.displayMat3),C.setUniformMatrix3fv("u_displayMat3",N===r.Cq.VIEWPORT?y.displayMat3:y.displayViewMat3),C.setUniform2fv("u_textTranslation",L),C.setUniform1f("u_depth",t.z+u),C.setUniform2fv("u_mosaicSize",this._glyphTextureSize),C.setUniform1f("u_mapRotation",(0,o.wV)(y.rotation)),C.setUniform1f("u_keepUpright",V?1:0),C.setUniform1f("u_level",10*c),C.setUniform1i("u_texture",s.mg),C.setUniform1f("u_antialiasingWidth",A),C.setUniform1f("u_fadeDuration",n.zk/1e3);let k=-1;for(const a of i){if(!a.layerData.has(m))continue;if(a.key.level!==k&&(k=a.key.level,h.setDataUniforms(C,c,t,k,g)),U=a.layerData.get(m),0===U.glyphPerPageElementsMap.size)continue;U.prepareForRendering(l),U.updateOpacityInfo();const i=U.textVAO;if(null==i)continue;l.bindVAO(i),C.setUniformMatrix3fv("u_dvsMat3",a.transforms.displayViewScreenMat3),this._setStencilState(e,a);const n=(performance.now()-U.lastOpacityUpdate)/1e3;C.setUniform1f("u_time",n),U.glyphPerPageElementsMap.forEach((e,t)=>{this._renderGlyphRange(l,e,t,f,C,S,x,a)})}}_renderGlyphRange(e,t,i,a,n,r,o,l){a.bind(e,c.Cj.LINEAR,i,s.mg),r&&(n.setUniform1f("u_halo",1),e.drawElements(c.WR.TRIANGLES,t[1],c.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),l.triangleCount+=t[1]/3),o&&(n.setUniform1f("u_halo",0),e.drawElements(c.WR.TRIANGLES,t[1],c.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),l.triangleCount+=t[1]/3)}_setStencilState(e,t){const{context:i,is3D:a,stencilSymbols:n}=e;if(i.setStencilTestEnabled(!0),n)return i.setStencilWriteMask(255),void i.setStencilFunction(c.MT.ALWAYS,t.stencilRef,255);i.setStencilWriteMask(0),a?i.setStencilFunction(c.MT.EQUAL,t.stencilRef,255):i.setStencilFunction(c.MT.GREATER,255,255)}}},3986:(e,t,i)=>{i.d(t,{A:()=>a});class a{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,i){}drawMany(e,t,i){for(const a of t)a.visible&&this.draw(e,a,i)}}},38134:(e,t,i)=>{i.d(t,{F:()=>f});var a=i(15941),n=i(85827),r=i(28608),s=i(5095),o=i(3986),l=i(76718),c=i(93345),u=i(36911);class f extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(1,0,0,1),this._patternMatrix=(0,n.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(e,t){const{context:i,painter:n,requestRender:r,allowDelayedRender:o}=e;this._loadWGLResources(e);const l=e.displayLevel,u=e.styleLayer,f=u.backgroundMaterial,d=n.vectorTilesMaterialManager,p=u.getPaintValue("background-color",l),g=u.getPaintValue("background-opacity",l),y=u.getPaintValue("background-pattern",l),m=void 0!==y,_=1|window.devicePixelRatio,M=e.spriteMosaic;let h,v;const U=_>s.C_?2:1,E=this._programOptions;E.pattern=m;const P=d.getMaterialProgram(i,f,E);if(!o||null==r||P.compiled){if(i.bindVAO(this._vao),i.useProgram(P),m){const e=M.getMosaicItemPosition(y,!0);if(null!=e){const{tl:t,br:a,page:n}=e;h=a[0]-t[0],v=a[1]-t[1];const r=M.getPageSize(n);null!=r&&(M.bind(i,c.Cj.LINEAR,n,s.$U),P.setUniform4f("u_tlbr",t[0],t[1],a[0],a[1]),P.setUniform2fv("u_mosaicSize",r),P.setUniform1i("u_texture",s.$U))}P.setUniform1f("u_opacity",g)}else{const e=p[3]*g;this._color[0]=e*p[0],this._color[1]=e*p[1],this._color[2]=e*p[2],this._color[3]=e,P.setUniform4fv("u_color",this._color)}P.setUniform1f("u_depth",u.z||0);for(const e of t){if(P.setUniform1f("u_coord_range",e.rangeX),P.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),m){const t=Math.max(2**(Math.round(l)-e.key.level),1),i=U*e.width*t,n=i/(0,a.yR)(h),r=i/(0,a.yR)(v);this._patternMatrix[0]=n,this._patternMatrix[4]=r,P.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(c.MT.EQUAL,0,255),i.drawArrays(c.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:i}=e,a=i.backgroundMaterial,n=new Int8Array([0,0,1,0,0,1,1,1]),r=l.g.createVertex(t,c._U.STATIC_DRAW,n),s=new u.Z(t,a.getAttributeLocations(),a.getLayoutInfo(),new Map([["geometry",r]]));this._vao=s}}},40480:(e,t,i)=>{i.d(t,{p6:()=>o,wV:()=>s});Math.PI;const a=256/360,n=1/Math.LN2;function r(e,t){return(e%=t)>=0?e:e+t}function s(e){return r(e*a,256)}function o(e){return Math.log(e)*n}},43106:(e,t,i)=>{i.d(t,{p:()=>s});var a=i(76418),n=i(3986),r=i(93345);class s extends n.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:n,requiredLevel:s,state:o,painter:l,spriteMosaic:c,styleLayerUID:u,requestRender:f,allowDelayedRender:d}=e;if(!t.some(e=>{var t,i;return null!==(t=null===(i=e.layerData.get(u))||void 0===i?void 0:i.circleIndexCount)&&void 0!==t&&t}))return;const p=e.styleLayer,g=p.circleMaterial,y=l.vectorTilesMaterialManager,m=p.getPaintValue("circle-translate",n),_=p.getPaintValue("circle-translate-anchor",n),M=this._programOptions,h=y.getMaterialProgram(i,g,M);if(d&&null!=f&&!h.compiled)return void f();i.useProgram(h),h.setUniformMatrix3fv("u_displayMat3",_===a.Cq.VIEWPORT?o.displayMat3:o.displayViewMat3),h.setUniform2fv("u_circleTranslation",m),h.setUniform1f("u_depth",p.z),h.setUniform1f("u_antialiasingWidth",1.2);let v=-1;for(const a of t){if(!a.layerData.has(u))continue;a.key.level!==v&&(v=a.key.level,g.setDataUniforms(h,n,p,v,c));const e=a.layerData.get(u);if(!e.circleIndexCount)continue;e.prepareForRendering(i);const t=e.vao;null!=t&&(i.bindVAO(t),h.setUniformMatrix3fv("u_dvsMat3",a.transforms.displayViewScreenMat3),s!==a.key.level?i.setStencilFunction(r.MT.EQUAL,a.stencilRef,255):i.setStencilFunction(r.MT.GREATER,255,255),i.drawElements(r.WR.TRIANGLES,e.circleIndexCount,r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),a.triangleCount+=e.circleIndexCount/3)}}}},51519:(e,t,i)=>{i.d(t,{I:()=>l});var a=i(76418),n=i(5095),r=i(3986),s=i(93345);const o=1/65536;class l extends r.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:i,renderPass:a,spriteMosaic:n,styleLayerUID:r}=e;let s=!1;for(const M of t)if(M.layerData.has(r)){const e=M.layerData.get(r);if(e.fillIndexCount>0||e.outlineIndexCount>0){s=!0;break}}if(!s)return;const o=e.styleLayer,l=o.getPaintProperty("fill-pattern"),c=void 0!==l,u=c&&l.isDataDriven;let f;if(c&&!u){const e=l.getValue(i);f=n.getMosaicItemPosition(e,!0)}const d=!c&&o.getPaintValue("fill-antialias",i);let p=!0,g=1;if(!c){const e=o.getPaintProperty("fill-color"),t=o.getPaintProperty("fill-opacity");if((null===e||void 0===e||!e.isDataDriven)&&(null===t||void 0===t||!t.isDataDriven)){const e=o.getPaintValue("fill-color",i);g=o.getPaintValue("fill-opacity",i)*e[3],g>=1&&(p=!1)}}if(p&&"opaque"===a)return;const y=o.getPaintValue("fill-translate",i),m=o.getPaintValue("fill-translate-anchor",i);(p||"translucent"!==a)&&this._drawFill(e,r,o,t,y,m,c,f,u);const _=!o.hasDataDrivenOutlineColor&&o.outlineUsesFillColor&&g<1;d&&"opaque"!==a&&!_&&this._drawOutline(e,r,o,t,y,m)}_drawFill(e,t,i,r,l,c,u,f,d){if(u&&!d&&null==f)return;const{context:p,displayLevel:g,state:y,painter:m,pixelRatio:_,spriteMosaic:M,requestRender:h,allowDelayedRender:v}=e,U=i.fillMaterial,E=m.vectorTilesMaterialManager,P=_>n.C_?2:1,I=this._fillProgramOptions;I.pattern=u;const x=E.getMaterialProgram(p,U,I);if(v&&null!=h&&!x.compiled)return void h();if(p.useProgram(x),null!=f){const{page:e}=f,t=M.getPageSize(e);null!=t&&(M.bind(p,s.Cj.LINEAR,e,n.$U),x.setUniform2fv("u_mosaicSize",t),x.setUniform1i("u_texture",n.$U))}x.setUniformMatrix3fv("u_displayMat3",c===a.Cq.VIEWPORT?y.displayMat3:y.displayViewMat3),x.setUniform2fv("u_fillTranslation",l),x.setUniform1f("u_depth",i.z+o);let R=-1;for(const a of r){if(!a.layerData.has(t))continue;a.key.level!==R&&(R=a.key.level,U.setDataUniforms(x,g,i,R,M));const e=a.layerData.get(t);if(!e.fillIndexCount)continue;e.prepareForRendering(p);const r=e.fillVAO;if(null!=r){if(p.bindVAO(r),x.setUniformMatrix3fv("u_dvsMat3",a.transforms.displayViewScreenMat3),p.setStencilFunction(s.MT.EQUAL,a.stencilRef,255),u){const e=Math.max(2**(Math.round(g)-a.key.level),1),t=a.rangeX/(P*a.width*e);x.setUniform1f("u_patternFactor",t)}if(d){const t=e.patternMap;if(!t)continue;for(const[e,i]of t){const t=M.getPageSize(e);null!=t&&(M.bind(p,s.Cj.LINEAR,e,n.$U),x.setUniform2fv("u_mosaicSize",t),x.setUniform1i("u_texture",n.$U),p.drawElements(s.WR.TRIANGLES,i[1],s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else p.drawElements(s.WR.TRIANGLES,e.fillIndexCount,s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.fillIndexStart);a.triangleCount+=e.fillIndexCount/3}}}_drawOutline(e,t,i,n,r,l){const{context:c,displayLevel:u,state:f,painter:d,pixelRatio:p,spriteMosaic:g,requestRender:y,allowDelayedRender:m}=e,_=i.outlineMaterial,M=d.vectorTilesMaterialManager,h=.75/p,v=this._outlineProgramOptions,U=M.getMaterialProgram(c,_,v);if(m&&null!=y&&!U.compiled)return void y();c.useProgram(U),U.setUniformMatrix3fv("u_displayMat3",l===a.Cq.VIEWPORT?f.displayMat3:f.displayViewMat3),U.setUniform2fv("u_fillTranslation",r),U.setUniform1f("u_depth",i.z+o),U.setUniform1f("u_outline_width",h);let E=-1;for(const a of n){if(!a.layerData.has(t))continue;a.key.level!==E&&(E=a.key.level,_.setDataUniforms(U,u,i,E,g));const e=a.layerData.get(t);if(e.prepareForRendering(c),!e.outlineIndexCount)continue;const n=e.outlineVAO;null!=n&&(c.bindVAO(n),U.setUniformMatrix3fv("u_dvsMat3",a.transforms.displayViewScreenMat3),c.setStencilFunction(s.MT.EQUAL,a.stencilRef,255),c.drawElements(s.WR.TRIANGLES,e.outlineIndexCount,s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.outlineIndexStart),a.triangleCount+=e.outlineIndexCount/3)}}}},56012:(e,t,i)=>{i.d(t,{$:()=>o});var a=i(76418),n=i(5095),r=i(3986),s=i(93345);class o extends r.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:r,state:o,painter:l,pixelRatio:c,spriteMosaic:u,styleLayerUID:f,requestRender:d,allowDelayedRender:p}=e;if(!t.some(e=>{var t,i;return null!==(t=null===(i=e.layerData.get(f))||void 0===i?void 0:i.lineIndexCount)&&void 0!==t&&t}))return;const g=e.styleLayer,y=g.lineMaterial,m=l.vectorTilesMaterialManager,_=g.getPaintValue("line-translate",r),M=g.getPaintValue("line-translate-anchor",r),h=g.getPaintProperty("line-pattern"),v=void 0!==h,U=v&&h.isDataDriven;let E,P;if(v&&!U){const e=h.getValue(r);E=u.getMosaicItemPosition(e)}let I=!1;if(!v){const e=g.getPaintProperty("line-dasharray");if(P=void 0!==e,I=P&&e.isDataDriven,P&&!I){const t=e.getValue(r),i=g.getDashKey(t,g.getLayoutValue("line-cap",r));E=u.getMosaicItemPosition(i)}}const x=1/c,R=this._programOptions;R.pattern=v,R.sdf=P;const T=m.getMaterialProgram(i,y,R);if(p&&null!=d&&!T.compiled)return void d();if(i.useProgram(T),T.setUniformMatrix3fv("u_displayViewMat3",o.displayViewMat3),T.setUniformMatrix3fv("u_displayMat3",M===a.Cq.VIEWPORT?o.displayMat3:o.displayViewMat3),T.setUniform2fv("u_lineTranslation",_),T.setUniform1f("u_depth",g.z),T.setUniform1f("u_antialiasing",x),E&&null!=E){const{page:e}=E,t=u.getPageSize(e);null!=t&&(u.bind(i,s.Cj.LINEAR,e,n.$U),T.setUniform2fv("u_mosaicSize",t),T.setUniform1i("u_texture",n.$U))}let S=-1;for(const a of t){if(!a.layerData.has(f))continue;a.key.level!==S&&(S=a.key.level,y.setDataUniforms(T,r,g,S,u));const e=2**(r-S)/c;T.setUniform1f("u_zoomFactor",e);const t=a.layerData.get(f);if(!t.lineIndexCount)continue;t.prepareForRendering(i);const o=t.vao;if(null!=o){if(i.bindVAO(o),T.setUniformMatrix3fv("u_dvsMat3",a.transforms.displayViewScreenMat3),i.setStencilFunction(s.MT.EQUAL,a.stencilRef,255),U||I){const e=t.patternMap;if(!e)continue;for(const[t,a]of e){const e=u.getPageSize(t);null!=e&&(u.bind(i,s.Cj.LINEAR,t,n.$U),T.setUniform2fv("u_mosaicSize",e),T.setUniform1i("u_texture",n.$U),i.drawElements(s.WR.TRIANGLES,a[1],s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]))}}else i.drawElements(s.WR.TRIANGLES,t.lineIndexCount,s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.lineIndexStart);a.triangleCount+=t.lineIndexCount/3}}}}},78403:(e,t,i)=>{i.d(t,{Z:()=>a});class a{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(t.has(e))return t.get(e);const i=this._read(e);if(!i)throw new Error("cannot find shader file ".concat(e));const a=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let n=a.exec(i);const r=[];for(;null!=n;)r.push({path:n[1],start:n.index,length:n[0].length}),n=a.exec(i);let s=0,o="";return r.forEach(e=>{o+=i.slice(s,e.start),o+=t.has(e.path)?"":this._resolve(e.path,t),s=e.start+e.length}),o+=i.slice(s),t.set(e,o),o}_read(e){return this._readFile(e)}}}}]);
//# sourceMappingURL=66167.969d33d1.chunk.js.map