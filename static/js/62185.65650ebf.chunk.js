"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[62185],{771:(e,t,i)=>{i.d(t,{I:()=>o});var r=i(6326),l=i(76460),s=i(50346),a=i(68134),n=(i(81806),i(47249),i(50076),i(87990));const o=e=>{const t=e;let i=class extends t{initialize(){this.addHandles((0,a.on)(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(e=>{(0,s.zf)(e)||l.A.getLogger(this).error(e)})}),"RefreshableLayerView")}};return i=(0,r.Cg)([(0,n.$)("esri.views.layers.RefreshableLayerView")],i),i}},17775:(e,t,i)=>{function r(e){return"Function"===(null===e||void 0===e?void 0:e.datasetFormat)}function l(e){return r(e)?e.primaryRasters.rasters:[e]}function s(e,t,i,r){const{x:l,y:s}=t,{x:a,y:n}=i,{xmin:o,xmax:u,ymin:d,ymax:h}=e,{width:p,height:c}=e,g=p/a,m=c/n,y=Math.min(g,m),v=y<=1?0:Math.min(.1,y/100),f=Math.floor((o-l)/a+v),_=Math.floor((s-h)/n+v),w=Math.floor((u-l)/a-v),T=Math.floor((s-d)/n-v);return{ul:{x:f,y:_},width:r>0&&g<.1?0:w-f+1,height:r>0&&m<.1?0:T-_+1}}i.d(t,{$g:()=>s,pb:()=>l,qg:()=>r})},28866:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(6326),l=i(39356),s=i(50076),a=i(46053),n=(i(81806),i(76460),i(47249),i(87990)),o=i(51939),u=i(31516),d=i(17775),h=i(59844),p=i(2257);const c=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch(e){return null}}get timeExtent(){var e;return(0,u.F)(this.layer,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){const{renderer:e}=this.layer;return!("raster-stretch"!==(null===e||void 0===e?void 0:e.type)||!e.dynamicRangeAdjustment||"min-max"===e.stretchType||"standard-deviation"===e.stretchType)}get datumTransformation(){try{return this.layer.loaded?(0,h.vI)(this.layer.fullExtent,this.view.spatialReference,!0):null}catch(e){return null}}supportsSpatialReference(e){try{return!this.layer.loaded||!!(0,h.eh)(this.layer.serviceRasterInfo,e)}catch(t){return!1}}async fetchPopupFeaturesAtLocation(e,t){const{layer:i}=this;if(!e)throw new s.A("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:r}=i,a=(0,p.D8)(i,t);if(!r||null==a)return[];const n=[],{value:u,magdirValue:h,processedValue:c}=await i.identify(e,{timeExtent:this.timeExtent,signal:null===t||void 0===t?void 0:t.signal});let g="";if(null!==u&&void 0!==u&&u.length){var m,y,v;g="imagery-tile"===i.type&&i.hasStandardTime()&&null!=u[0]?u.map(e=>i.getStandardTimeValue(e)).join(", "):u.join(", ");const e={ObjectId:0};e[o.F_.servicePixelValue]="imagery-tile"===i.type&&(0,d.qg)(i.raster)?null===c||void 0===c?void 0:c.join(", "):g,e[o.F_.rawServicePixelValue]=g;const t=null!==(m=null===(y=i.raster)||void 0===y?void 0:y.rasterInfo)&&void 0!==m?m:i.serviceRasterInfo,r=null===t||void 0===t?void 0:t.attributeTable;if(null!=r){const{fields:t,features:i}=r,l=t.find(e=>{let{name:t}=e;return"value"===t.toLowerCase()}),s=e[o.F_.servicePixelValue],a=l?i.find(e=>String(e.attributes[l.name])===s):null;if(a)for(const r in a.attributes)a.attributes.hasOwnProperty(r)&&(e[o.ER+r]=a.attributes[r])}const s=null===t||void 0===t?void 0:t.dataType;"vector-magdir"!==s&&"vector-uv"!==s||(e[o.F_.magnitude]=null===h||void 0===h?void 0:h[0],e[o.F_.direction]=null===h||void 0===h?void 0:h[1]);const{multidimensionalDefinition:a}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});(0,o.eS)(i.rasterFields,e,a);const{graphicOrigin:p}=i,f=new l.A({geometry:null===(v=this.fullExtent)||void 0===v?void 0:v.clone(),attributes:e,layer:i,origin:p,sourceLayer:i});n.push(f)}return n}async getSourceScale(){return await this.layer.load(),(0,h.OO)(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return(0,h.eh)(this.layer.serviceRasterInfo,this.view.spatialReference)}};return(0,r.Cg)([(0,a.MZ)()],i.prototype,"fullExtent",null),(0,r.Cg)([(0,a.MZ)()],i.prototype,"layer",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],i.prototype,"timeExtent",null),(0,r.Cg)([(0,a.MZ)()],i.prototype,"tileInfo",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],i.prototype,"hasTilingEffects",null),(0,r.Cg)([(0,a.MZ)()],i.prototype,"datumTransformation",null),i=(0,r.Cg)([(0,n.$)("esri.views.layers.ImageryTileLayerView")],i),i}},69576:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(6326),l=i(91967),s=i(46053),a=(i(81806),i(76460),i(47249),i(87990)),n=i(19451);let o=class extends l.A{constructor(e){super(e),this.updatingHandles=new n.U}destroy(){this.updatingHandles.destroy()}get updating(){return this.updatingHandles.updating}get layer(){return this.layerView.layer}get view(){return this.layerView.view}get suspended(){return this.layerView.suspended}get fullOpacity(){return this.layerView.fullOpacity}get usedMemory(){return 0}};(0,r.Cg)([(0,s.MZ)({constructOnly:!0})],o.prototype,"layerView",void 0),(0,r.Cg)([(0,s.MZ)({readOnly:!0})],o.prototype,"updatingHandles",void 0),(0,r.Cg)([(0,s.MZ)()],o.prototype,"updating",null),(0,r.Cg)([(0,s.MZ)()],o.prototype,"layer",null),(0,r.Cg)([(0,s.MZ)()],o.prototype,"view",null),(0,r.Cg)([(0,s.MZ)()],o.prototype,"suspended",null),(0,r.Cg)([(0,s.MZ)()],o.prototype,"fullOpacity",null),o=(0,r.Cg)([(0,a.$)("esri.views.3d.layers.SubView3D")],o)},71853:(e,t,i)=>{i.d(t,{OI:()=>g,Pp:()=>p,VC:()=>c,WL:()=>d,b4:()=>n,hE:()=>u,kc:()=>o,xV:()=>h});var r=i(72745),l=i(93345),s=i(29492),a=i(96673);function n(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest";const r=!(arguments.length>3&&void 0!==arguments[3]&&arguments[3]&&"u8"===t.pixelType),n=r?l.ld.FLOAT:l.ld.UNSIGNED_BYTE,o=null==t.pixels||0===t.pixels.length?null:r?t.getAsRGBAFloat():t.getAsRGBA(),u=e.capabilities.textureFloatLinear,d=new a.R(t.width,t.height);return d.internalFormat=r?l.H0.RGBA32F:6408,d.samplingMode=!u||"bilinear"!==i&&"cubic"!==i?9728:9729,d.dataType=n,d.wrapMode=33071,new s.g(e,d,o)}function o(e,t){const{spacing:i,offsets:r,coefficients:n,size:[o,u]}=t,d=i[0]>1,h=new a.R(d?4*o:o,u);h.internalFormat=l.H0.RGBA32F,h.dataType=l.ld.FLOAT,h.samplingMode=9728,h.wrapMode=33071;const p=new Float32Array(d?o*u*16:2*r.length);if(d&&null!=n)for(let l=0,s=0;l<n.length;l++)p[s++]=n[l],l%3==2&&(p[s++]=1);else for(let l=0;l<u;l++)for(let e=0;e<o;e++){const t=4*(l*o+e),i=2*(e*u+l);p[t]=r[i],p[t+1]=r[i+1],p[t+3]=-1===r[i]?0:1}return new s.g(e,h,p)}function u(e,t){const i=new a.R(t.length/4,1);return i.internalFormat=6408,i.samplingMode=9728,i.wrapMode=33071,new s.g(e,i,t)}function d(e,t,i){const r=new a.R(i[0],i[1]);return r.internalFormat=6406,r.pixelFormat=6406,r.dataType=l.ld.UNSIGNED_BYTE,r.samplingMode=9728,r.wrapMode=33071,new s.g(e,r,t)}function h(e,t,i){return{u_flipY:!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u_applyTransform:!!e,u_opacity:arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u_transformSpacing:e?e.spacing:r.uY,u_transformGridSize:e?e.size:r.uY,u_targetImageSize:t,u_srcImageSize:i}}function p(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function c(e){return{u_bandCount:e.bandCount,u_minOutput:e.minOutput,u_maxOutput:e.maxOutput,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function g(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}},72608:(e,t,i)=>{i.r(t),i.d(t,{default:()=>z});var r=i(6326),l=i(50076),s=(i(81806),i(68134)),a=i(46053),n=(i(76460),i(47249),i(87990)),o=i(59844),u=i(83491),d=i(96453),h=i(89379),p=i(10600),c=i(79468),g=i(2413),m=i(46533),y=i(89214),v=i(64147),f=i(31723),_=i(74110);const w={type:"delete"},T={type:"waiting"},b={type:"on-worker",upsampled:!1},x={type:"on-worker",upsampled:!0};let S=class extends y.A{constructor(e){super(e),this._resetTileData=!0,this._throttledTriggerLoad=null,this._throttling=!1}initialize(){this.addHandles([this.surface.on("tile-data-changed",e=>{let{tile:t,layerIndex:i,layerClass:r}=e;null!=this.renderedTiles&&(this.loadByTileTreesAllowed||this._tileIsUpsampled(t))&&i===this._layerIndex&&1===r&&this._updateFlowDataTile(t)}),(0,s.wB)(()=>this.renderedTiles,e=>{const t=this.frameTask.scheduleGenerator(t=>this._updateFlowDataTiles(e,t));this.updatingHandles.addPromise(t)},s.OH),(0,s.wB)(()=>this._pixelSize,()=>{this.invalidateTileData(),this._resetTileData=!0},s.OH)]),this._throttledTriggerLoad=(0,c.n)(()=>{super.triggerLoad(),this._throttling=!1},()=>this._throttling=!0,v.q6,this),this.addHandles(this._throttledTriggerLoad)}_updateFlowDataTiles(e,t){var i=this;return(0,p.A)(function*(){const r=C();for(const s of null!==e&&void 0!==e?e:[]){var l;const e=null===(l=i._flowDataTiles)||void 0===l?void 0:l.get((0,f.Zt)(s)),a=null==e||"delete"===e.type||"waiting"===e.type?i._getLoadedState(s):e;null!=a&&r.set((0,f.Zt)(s),a),t.madeProgress(),t.done&&(t=yield)}i._flowDataTiles=r,i._resetTileData=!0,i.triggerLoad()})()}abort(){super.abort(),this._throttling=!1}get _layerIndex(){return this.surface.getLayerIndexByUID(1,this.layerView.uid)}get loadByTileTreesAllowed(){return super.loadByTileTreesAllowed||!this._allTilesLoaded}get _pixelSize(){return this.surface.tilingScheme.pixelSize}doRefresh(){this.invalidateTileData(),super.doRefresh()}triggerLoad(){const{_throttledTriggerLoad:e}=this;this._allTilesLoaded?(e.hasPendingUpdates()||e(),e.forceUpdate()):e()}async fetchDataAndGenerateStreamlines(e,t){const{_flowDataTiles:i,needsMagnitude:r,workerHandle:l}=this,s=this.getSimulationSettings(e);if(null==s||null==l||null==i)return;const a=this._resetTileData;this._resetTileData=!1;const n=C();i.forEach((e,t)=>{"delete"===e.type?(n.set(t,w),i.delete(t)):(a||"on-worker"!==e.type&&"waiting"!==e.type)&&(n.set(t,e),i.set(t,"waiting"!==e.type&&e.upsampled?x:b))});const o={simulationSettings:s,flowExtentInfo:e.flowExtentInfo,flowDataTiles:n,reset:a,needsMagnitude:r,startPositions:this.startPositions(e)},{streamlines:u}=await l.generateTiledStreamlines(o,t);return u}getUpdating(){return super.getUpdating()||this._throttling}_getLoadedState(e){const{_layerIndex:t}=this,i=null==e.surface;if(null==t||i)return w;const r=e.getLayerInfo(t,1);if(null==r)return w;if(!e.visible&&null==r.requestAbort)return r.requestAbort=new AbortController,this.surface.requestTileData(e,t,1,r.requestAbort),w;const l=this._getRasterTile(r,e,t);return null==l?this._upsampleFlowData(t,r.upsampleInfo,e.lij,e.extent):{type:"loaded",data:this._createFlowDataTile(l,e.lij,e.extent,this._pixelSize),upsampled:!1}}_upsampleFlowData(e,t,i,r){if(null==t)return w;const l=t.tile;if(null==l)return w;const s=l.getLayerInfo(e,1);if(null==s)return w;const a=this._getRasterTile(s,l,e);if(null==a)return w;const{scale:n,offset:o}=t,u=Math.max(Math.floor(this._pixelSize*n),1),d=a.source,h=Math.floor(o[0]*d.width),p=Math.floor((1-o[1]-n)*d.height);return{type:"loaded",data:this._createFlowDataTile(a,i,r,u,h,p),upsampled:!0}}_getRasterTile(e,t,i){const{data:r}=e;return!e.dataMissing&&t.hasLayerData(i,1)&&(0,_.k$)(r)?r:null}_createFlowDataTile(e,t,i,r,l,s){const a=(0,m.GA)(this.layer.serviceRasterInfo.dataType,e.source,r,r,l,s),n=a.mask.slice();return new f.Xx(a.data,n,a.width,a.height,t,(0,g.o8)(i))}_updateFlowDataTile(e){const{renderedTiles:t,_layerIndex:i}=this;if(null==t||null==i)return;if(t.has(e)){const t=this._getLoadedState(e);return void(this._setTileData(e,t)&&this.triggerLoad())}let r=this._setTileData(e,w);for(const s of t.values()){var l;const t=s.getLayerInfo(i,1);if(null==t)continue;if(null!=this._getRasterTile(t,s,i))continue;if((null===(l=t.upsampleInfo)||void 0===l?void 0:l.tile)!==e)continue;const a=this._getLoadedState(s),n=this._setTileData(s,a);r||(r=n)}r&&this.triggerLoad()}_setTileData(e,t){const{_flowDataTiles:i}=this;if(null==i)return!1;const r=(0,f.Zt)(e);return(null!=i.get(r)||"delete"!==t.type)&&(i.set(r,t),!0)}get _allTilesLoaded(){var e;let t=0;for(const l of null!==(i=null===(r=this._flowDataTiles)||void 0===r?void 0:r.values())&&void 0!==i?i:[]){var i,r;"delete"!==l.type&&"waiting"!==l.type&&t++}return t===(null===(e=this.renderedTiles)||void 0===e?void 0:e.size)}invalidateTileData(){const{_flowDataTiles:e}=this;null===e||void 0===e||e.forEach((t,i)=>{e.set(i,T)})}_tileIsUpsampled(e){var t;const i=null===(t=this._flowDataTiles)||void 0===t?void 0:t.get((0,f.Zt)(e));return null!=i&&("loaded"===i.type||"on-worker"===i.type)&&i.upsampled}get usedMemory(){var e,t;const i=9*this._pixelSize**2,r=(null!==(e=null===(t=this._flowDataTiles)||void 0===t?void 0:t.size)&&void 0!==e?e:0)*i;return super.usedMemory+r}get test(){var e;return(0,h.A)((0,h.A)({},super.test),{},{loadedTiles:null!==(e=this._flowDataTiles)&&void 0!==e?e:C()})}};function C(){return new Map}(0,r.Cg)([(0,a.MZ)()],S.prototype,"_throttling",void 0),S=(0,r.Cg)([(0,n.$)("esri.views.3d.support.flow.FlowSubViewTiles3D")],S);var I=i(30726),M=i(745),R=i(71853);const A={bandCount:3,minOutput:0,maxOutput:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class O{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.lij=e,this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.opacity=1,this.source=t,this.width=i||t.width,this.height=r||t.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=(0,I.WD)(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?(0,h.A)((0,h.A)({},A),{},{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||A}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){null!=e&&e.length>0?this._bandIds&&e.every((e,t)=>{var i;return!(null===(i=this._bandIds)||void 0===i||!i[t])&&e===this._bandIds[t]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,null!=this._rasterTexture){const t=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode("bilinear"===t?9729:9728)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=(0,I.WD)(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((null==this._rasterTexture||this._dirty)&&this._updateRasterTexture(e,this.bandIds),null!=this._rasterTexture&&(this._updateColormapTexture(e),this.transformGrid&&null==this._transformGridTexture&&(this._transformGridTexture=(0,R.kc)(e,this.transformGrid))),!0)}getUniforms(e){var t,i,r;const{symbolizerParameters:l,transformGrid:s,width:a,height:n,opacity:o}=this,u=(0,R.xV)(s,[a,n],[this.source.width,this.source.height],o),d=(0,R.Pp)(l.colormap,l.colormapOffset),h="stretch"===this.symbolizerParameters.type?(0,R.VC)(this.symbolizerParameters):null,p="hillshade"===this.symbolizerParameters.type?(0,R.OI)(this.symbolizerParameters):null,c=e.emptyTexture;return new M.C(u,d,h||p,null!==(t=this._rasterTexture)&&void 0!==t?t:c,null!==(i=this._transformGridTexture)&&void 0!==i?i:c,null!==(r=this._colormapTexture)&&void 0!==r?r:c)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return"bilinear"===this.interpolation&&null!=e.colormap&&"stretch"===e.type}get memoryUsage(){if(null==this._memoryUsed){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(e=>null!=e?e.descriptor.width*e.descriptor.height*4:0).reduce((e,t)=>e+t,0)}return this._memoryUsed}release(){return this._rasterTexture=(0,I.WD)(this._rasterTexture),this._transformGridTexture=(0,I.WD)(this._transformGridTexture),this._colormapTexture=(0,I.WD)(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,t){const i=this.source?this.source.extractBands(t):null;if(!(null!==i&&void 0!==i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=(0,I.WD)(this._rasterTexture));const r=null==t&&null==this.bandIds||null!=t&&null!=this.bandIds&&t.join("")===this.bandIds.join("");if(null!=this._rasterTexture&&r)return;this._rasterTexture=(0,I.WD)(this._rasterTexture);const l=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=(0,R.b4)(e,i,l,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(e){return"lut"===this.symbolizerParameters.type||"nearest"===e||"majority"===e||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const t=this._colormap,i=this.symbolizerParameters.colormap;return i?t?i.length!==t.length||i.some((e,i)=>e!==t[i])?(this._colormapTexture=(0,I.WD)(this._colormapTexture),this._colormapTexture=(0,R.hE)(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=(0,R.hE)(e,i),void(this._colormap=i)):(this._colormapTexture=(0,I.WD)(this._colormapTexture),void(this._colormap=null))}}var L=i(28866),D=i(91196),F=i(771),E=i(55754),Z=i(9685);let P=class extends((0,L.A)((0,F.I)((0,d.E)((0,u.w)(D.A))))){constructor(){super(...arguments),this.type="imagery-tile-3d",this._isAlignedMapTile=!0,this._flowSubView=null,this.ignoresMemoryFactor=!1,this.unloadedMemory=0}initialize(){this.layer.increaseRasterJobHandlerUsage(),null==this.fullExtent&&this.addResolvingPromise(Promise.reject(new l.A("layerview:spatial-reference-incompatible","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})));const e=(0,s.C_)(()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.basemapTerrain)||void 0===e?void 0:e.tilingSchemeLocked}).then(()=>{const e=this.view.basemapTerrain.tilingScheme,t=this.layer.tileInfo;this._isAlignedMapTile=["png","png24","png32","jpg","mixed"].includes(t.format)&&e.compatibleWith(t),this.tileInfo=this._isAlignedMapTile?t:e.toTileInfo(),this.addHandles([(0,s.wB)(()=>this.layer.renderer,e=>{this._setSubView(e),this._updatingHandles.addPromise(this.doRefresh())},s.OH),(0,s.wB)(()=>[this.layer.interpolation,this.layer.bandIds,this.layer.multidimensionalDefinition,this.layer.multidimensionalSubset,this.layer.rasterFunction,this.timeExtent],()=>this._updatingHandles.addPromise(this.doRefresh()),s.OH)])});this._setSubView(this.layer.renderer),this.addResolvingPromise(e)}destroy(){var e;this.layer.decreaseRasterJobHandlerUsage(),null===(e=this._flowSubView)||void 0===e||e.destroy()}_setSubView(e){if("wcs"===this.layer.type)return;const t="flow"===(null===e||void 0===e?void 0:e.type),i=this._flowSubView;t&&null!=i||(null!==i&&void 0!==i&&i.destroy(),this._flowSubView=t?new S({layerView:this}):null)}get _blankTile(){const e=document.createElement("canvas"),t=e.getContext("2d"),[i,r]=this.tileInfo.size;return e.width=i,e.height=r,t.clearRect(0,0,i,r),t.getImageData(0,0,i,r)}get _hasFlow(){return null!=this._flowSubView}get imageFormatIsOpaque(){return"jpg"===this.layer.tileInfo.format}get hasMixedImageFormats(){return"mixed"===this.layer.tileInfo.format}get dataLevelRange(){var e,t;const i=this.layer.tileInfo,r=null===(e=this.tileInfo.lodAt(0))||void 0===e?void 0:e.scale,l=null===(t=i.lodAt(i.lods.length-1))||void 0===t?void 0:t.scale;return this.levelRangeFromScaleRange(r,l)}get visibleAtCurrentScale(){var e,t;return null!==(e=null===(t=this._flowSubView)||void 0===t?void 0:t.visibleAtCurrentScale)&&void 0!==e?e:this.tilesVisibleAtCurrentScale()}_getFullExtent(){var e,t;return(0,o.eh)(this.layer.serviceRasterInfo,null!==(e=null===(t=this.view.basemapTerrain)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:this.view.spatialReference)}async fetchTile(e,t){const i=this.tileInfo,r=this._canSymbolizeInWebGL(),l={tileInfo:i,requestRawData:r&&!this._hasFlow,signal:t.signal,timeExtent:this.timeExtent,requestAsImageElement:this._isAlignedMapTile,requestProjectedLocalDirections:this._hasFlow,noClip:!1},{layer:s}=this,[a,n,o]=e,u=await s.fetchTile(a,n,o,l);if(u instanceof HTMLImageElement)return u;let d=null===u||void 0===u?void 0:u.pixelBlock;if(null==d)return this._blankTile;if(!r&&!this._hasFlow&&(d=await s.applyRenderer(u),null==d))return this._blankTile;const h=new O([a,n,o],d,i.size[0],i.size[1]);return r?(h.symbolizerRenderer=s.symbolizer.rendererJSON,h.symbolizerParameters=s.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(a)),h.transformGrid=u.transformGrid,h.bandIds=s.bandIds):(h.isRendereredSource=!0,h.bandIds=null),h.interpolation=s.interpolation,h}_getSymbolizerOptions(e){var t;const i=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:null!=(null===(t=this.view.basemapTerrain)||void 0===t?void 0:t.spatialReference)?this.view.basemapTerrain.spatialReference.isGeographic:this.view.spatialReference.isGeographic,resolution:{x:i,y:i},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,t){return(0,E.Vp)(e,t,this.view)}async doRefresh(){var e;this.suspended||(null!==(e=this._flowSubView)&&void 0!==e&&e.doRefresh(),this.emit("data-changed"))}isUpdating(){var e,t;return null!==(e=null===(t=this._flowSubView)||void 0===t?void 0:t.updating)&&void 0!==e&&e}_canSymbolizeInWebGL(){var e,t;const i=(0,Z.C)(),{symbolizer:r}=this.layer,l=null===(e=r.lookup.colormapLut)||void 0===e?void 0:e.indexedColormap,s=!(null===(t=this.layer.rasterFunction)||void 0===t||!t.hasClipFunction),a=l&&l.length>4*(i.maxTextureSize||4096);return r.canRenderInWebGL&&!a&&!s}get usedMemory(){var e,t;return null!==(e=null===(t=this._flowSubView)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0}get test(){}};(0,r.Cg)([(0,a.MZ)({readOnly:!0})],P.prototype,"_blankTile",null),(0,r.Cg)([(0,a.MZ)()],P.prototype,"_hasFlow",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],P.prototype,"imageFormatIsOpaque",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],P.prototype,"hasMixedImageFormats",null),(0,r.Cg)([(0,a.MZ)()],P.prototype,"_flowSubView",void 0),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],P.prototype,"dataLevelRange",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],P.prototype,"visibleAtCurrentScale",null),P=(0,r.Cg)([(0,n.$)("esri.views.3d.layers.ImageryTileLayerView3D")],P);const z=P},79468:(e,t,i)=>{i.d(t,{n:()=>l});var r=i(75540);function l(e,t,i,l){let s=null,a=1e3;"number"==typeof t?(a=t,l=i):(s=null!==t&&void 0!==t?t:null,a=i);const n=(0,r.v)(0);let o;const u=()=>{n.value=0,e.apply(l,o)},d=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s&&s.apply(l,t),o=t,a?n.value||(n.value=setTimeout(u,a)):u()};return d.remove=()=>{n.value&&(clearTimeout(n.value),n.value=0)},d.forceUpdate=()=>{n.value&&(clearTimeout(n.value),u())},d.hasPendingUpdates=()=>!!n.value,d}},83491:(e,t,i)=>{i.d(t,{w:()=>d});var r=i(6326),l=i(54901),s=i(50346),a=i(68134),n=i(46053),o=(i(81806),i(76460),i(47249),i(87990)),u=i(47700);const d=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,u.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,l.hA)(()=>e.abort())),await(0,a.C_)(()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady},t),(0,s.Te)(t);const i=(0,u.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,r.Cg)([(0,n.MZ)()],i.prototype,"view",void 0),(0,r.Cg)([(0,n.MZ)()],i.prototype,"slicePlaneEnabled",void 0),i=(0,r.Cg)([(0,o.$)("esri.views.3d.layers.LayerView3D")],i),i}},91196:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(6326),l=i(54099),s=i(5632),a=i(76460),n=i(30726),o=i(91291),u=i(46053),d=(i(81806),i(47249),i(87990)),h=i(19451),p=i(90992);let c=class extends((0,s.sA)((0,o.g)(l.nJ))){get spatialReferenceSupported(){return!0}constructor(e){super(e),this._updatingHandles=new h.U,this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){var t;const i=this.layer&&this.layer.id||"no id",r=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";a.A.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),e)}})}destroy(){this._updatingHandles=(0,n.pR)(this._updatingHandles),this._set("parent",null)}get fullOpacity(){var e,t,i,r;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(i=null===(r=this.parent)||void 0===r?void 0:r.fullOpacity)&&void 0!==i?i:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var e;const t=this.view.timeExtent,i=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!i||!t.intersection(i).isEmpty}canResume(){var e,t;const i=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&this.parent&&!this.parent.suspended&&(null===(t=this.view)||void 0===t?void 0:t.ready)&&(0,p.g7)(i)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var e,t;const i=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0);const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.g7)(r)&&this.visibleAtCurrentScale||(i.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(i.outsideVisibilityTimeExtent=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,r.Cg)([(0,u.MZ)({readOnly:!0})],c.prototype,"spatialReferenceSupported",null),(0,r.Cg)([(0,u.MZ)()],c.prototype,"view",void 0),(0,r.Cg)([(0,u.MZ)()],c.prototype,"fullOpacity",null),(0,r.Cg)([(0,u.MZ)()],c.prototype,"layer",void 0),(0,r.Cg)([(0,u.MZ)()],c.prototype,"parent",void 0),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],c.prototype,"suspended",null),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],c.prototype,"suspendInfo",null),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],c.prototype,"legendEnabled",null),(0,r.Cg)([(0,u.MZ)({type:Boolean,readOnly:!0})],c.prototype,"updating",null),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],c.prototype,"updatingProgress",null),(0,r.Cg)([(0,u.MZ)()],c.prototype,"updateSuspended",null),(0,r.Cg)([(0,u.MZ)()],c.prototype,"visible",null),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],c.prototype,"visibleAtCurrentScale",null),(0,r.Cg)([(0,u.MZ)({readOnly:!0})],c.prototype,"visibleAtCurrentTimeExtent",null),c=(0,r.Cg)([(0,d.$)("esri.views.layers.LayerView")],c)},96453:(e,t,i)=>{i.d(t,{E:()=>p});var r=i(6326),l=i(50076),s=i(68134),a=i(46053),n=(i(81806),i(76460),i(47249),i(87990)),o=i(65768),u=i(93938),d=i(4225),h=i(90992);const p=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.hasMixedImageFormats=!0}get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}tilesVisibleAtCurrentScale(){const{minScale:e,maxScale:t}=this.layer;if(!(0,h.WK)(e,t))return!0;const{basemapTerrain:i}=this.view,r=i.getLayerIndexByUID(1,this.uid);if(null==r)return!1;const{tilingScheme:l}=i,s=e&&l.levelAtScale(e),a=t&&l.levelAtScale(t);return i.renderer.visibleTiles.some(e=>!!e.layerInfo[1][r]&&(!s||e.level>=s)&&(!a||e.level<=a))}get visibleAtCurrentScale(){return this.tilesVisibleAtCurrentScale()}get dataScaleRange(){const e=this.tileInfo.lods;let t=e[0].scale,i=e[e.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const{effectiveMinLOD:e,effectiveMaxLOD:r}=this.layer.tilemapCache;t=this.tileInfo.lodAt(e).scale,i=this.tileInfo.lodAt(r).scale}return{minScale:t,maxScale:i}}canResume(){var e,t,i;const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(i=this.view)||void 0===i?void 0:i.ready)&&(0,h.g7)(r)&&this.visibleAtCurrentTimeExtent||!1}get dataLevelRange(){const{minScale:e,maxScale:t}=this.dataScaleRange;return this.levelRangeFromScaleRange(e,t)}get displayLevelRange(){const e=this.layer.minScale||this.dataScaleRange.minScale,t=this.layer.maxScale||this.dataScaleRange.maxScale,i=this.levelRangeFromScaleRange(e,t);return this.layer.maxScale&&i.maxLevel++,i}get performanceInfo(){return new o.P(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(e){return this.layer.getTileUrl(e[0],e[1],e[2])}_addTilingSchemeMatchPromise(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new l.A("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(e)return this.addResolvingPromise(Promise.reject(e));this.addResolvingPromise((0,s.C_)(()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.basemapTerrain)||void 0===e?void 0:e.tilingSchemeLocked}).then(()=>{var e;const t=this.view.basemapTerrain.tilingScheme,i="tilemapCache"in this.layer?null===(e=this.layer.tilemapCache)||void 0===e?void 0:e.effectiveMaxLOD:void 0,r=this._getTileInfoCompatibilityError(this.tileInfo,t,i);if(r)throw r}))}_getTileInfoSupportError(e,t){var i;const r=(0,d._y)(e,t,this.view.spatialReference,this.view.state.viewingMode,"tilemapCache"in this.layer?null===(i=this.layer.tilemapCache)||void 0===i?void 0:i.effectiveMaxLOD:void 0);if(!r)return;const s={layer:this.layer,error:r};switch(r.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":return new l.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",s);default:return new l.A("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",s)}}_getTileInfoCompatibilityError(e,t,i){return null!=e&&t.compatibleWith(e,i)?null:new l.A("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const i={minLevel:0,maxLevel:1/0},r=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!r)return i;const l=r.levels[0],s=e=>{const t=Math.log(l.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(i.minLevel=Math.max(0,s(e))),null!=t&&t>0&&(i.maxLevel=Math.max(0,s(t))),i}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return(0,r.Cg)([(0,a.MZ)({readOnly:!0})],i.prototype,"imageFormatIsOpaque",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],i.prototype,"updating",void 0),(0,r.Cg)([(0,a.MZ)(u.S)],i.prototype,"updatingProgress",void 0),(0,r.Cg)([(0,a.MZ)(u.b)],i.prototype,"updatingProgressValue",void 0),(0,r.Cg)([(0,a.MZ)()],i.prototype,"hasMixedImageFormats",void 0),(0,r.Cg)([(0,a.MZ)()],i.prototype,"fullExtent",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],i.prototype,"isOpaque",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],i.prototype,"visibleAtCurrentScale",null),(0,r.Cg)([(0,a.MZ)()],i.prototype,"dataScaleRange",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],i.prototype,"dataLevelRange",null),(0,r.Cg)([(0,a.MZ)({readOnly:!0})],i.prototype,"displayLevelRange",null),(0,r.Cg)([(0,a.MZ)()],i.prototype,"layer",void 0),i=(0,r.Cg)([(0,n.$)("esri.views.3d.layers.TiledLayerView3D")],i),i}}}]);
//# sourceMappingURL=62185.65650ebf.chunk.js.map