{"version":3,"file":"static/js/21734.38f2b779.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/libs/i3s/I3SModule.js","../node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js","../node_modules/@arcgis/core/views/3d/layers/I3SMeshWorkerHandle.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{getAssetUrl as t}from\"../../assets.js\";function s(){return n??=(async()=>{const s=await import(\"../../chunks/i3s.js\");return await s.default({locateFile:s=>t(`esri/libs/i3s/${s}`)})})(),n}function i(){n=null}let n;export{i as cleanup,s as get};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{hasScaling as e}from\"../../../core/mathUtils.js\";import r from\"../../../geometry/SpatialReference.js\";import{ensurePackedMat4f64 as t,ensurePackedArray as o}from\"../../../geometry/support/DoubleArray.js\";import n from\"../../../geometry/support/MeshGeoreferencedVertexSpace.js\";import s from\"../../../geometry/support/MeshLocalVertexSpace.js\";import{b as i,n as a}from\"../../../chunks/vec3.js\";import{get as f,cleanup as c}from\"../../../libs/i3s/I3SModule.js\";import{TransformedGeometry as l,TransformedData as u}from\"./I3SMeshWorkerHandle.js\";async function m(e){A=await N();const r=[e.geometryBuffer];return{result:L(A,e,r),transferList:r}}async function y(e){A=await N();const r=[e.geometryBuffer],{geometryBuffer:t}=e,o=t.byteLength,n=A._malloc(o),s=new Uint8Array(A.HEAPU8.buffer,n,o);s.set(new Uint8Array(t));const i=A.dracoDecompressPointCloudData(n,s.byteLength);if(A._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,f=i.positions.slice();return a&&r.push(a.buffer),r.push(f.buffer),{result:{positions:f,featureIds:a},transferList:r}}async function p(e){await N(),S(e);const r={buffer:e.buffer};return{result:r,transferList:[r.buffer]}}async function h(e){await N(),j(e)}async function b(e){A=await N(),A.setLegacySchema(e.context,e.jsonSchema)}async function d(e){const{localMatrix:i,origin:a,positions:f,vertexSpace:c}=e,l=r.fromJSON(e.inSpatialReference),u=r.fromJSON(e.outSpatialReference),m=i?t(i):void 0,y=o(a);let p;const[{projectBuffer:h},{initializeProjection:b}]=await Promise.all([import(\"../../../geometry/projection/projectBuffer.js\"),import(\"../../../geometry/projectionUtils.js\")]);await b(l,u);const d=[0,0,0];if(!h(y,l,0,d,u,0))throw new Error(\"Failed to project\");if(\"georeferenced\"===c.type&&null==c.origin){if(p=new Float64Array(f.length),!h(f,l,0,p,u,0,p.length/3))throw new Error(\"Failed to project\")}else{const e=\"georeferenced\"===c.type?n.fromJSON(c):s.fromJSON(c),{projectMeshVertexPositions:r}=await import(\"../../../geometry/support/meshUtils/projectMeshVertexPositions.js\"),t=r({vertexAttributes:{position:f},transform:m?{localMatrix:m}:void 0,vertexSpace:e,spatialReference:l},u);if(!t)throw new Error(\"Failed to project\");p=t}const g=p.length,[w,E,A]=d;for(let r=0;r<g;r+=3)p[r]-=w,p[r+1]-=E,p[r+2]-=A;return{result:{projected:p,original:f,projectedOrigin:d},transferList:[p.buffer,f.buffer]}}async function g({normalMatrix:r,normals:t}){const o=new Float32Array(t.length);return i(o,t,r),e(r)&&a(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}}function w(e){_(e)}let E,A;function j(e){if(!A)return;const r=e.modifications,t=A._malloc(8*r.length),o=new Float64Array(A.HEAPU8.buffer,t,r.length);for(let n=0;n<r.length;++n)o[n]=r[n];A.setModifications(e.context,t,r.length,e.isGeodetic),A._free(t)}function L(e,r,t){const{context:o,globalTrafo:n,mbs:s,obbData:i,elevationOffset:a,geometryBuffer:f,geometryDescriptor:c,indexToVertexProjector:m,vertexToRenderProjector:y}=r,p=e._malloc(f.byteLength),h=33,b=e._malloc(h*Float64Array.BYTES_PER_ELEMENT),d=new Uint8Array(e.HEAPU8.buffer,p,f.byteLength);d.set(new Uint8Array(f));const g=new Float64Array(e.HEAPU8.buffer,b,h);P(g,[NaN,NaN,NaN]);let w=g.byteOffset+3*g.BYTES_PER_ELEMENT,E=new Float64Array(g.buffer,w);P(E,n),w+=16*g.BYTES_PER_ELEMENT,E=new Float64Array(g.buffer,w),P(E,s),w+=4*g.BYTES_PER_ELEMENT,i&&(E=new Float64Array(g.buffer,w),P(E,i));const A=c,j={isDraco:!1,isLegacy:!1,color:r.layouts.some(e=>e.some(e=>\"color\"===e.name)),normal:r.needNormals&&r.layouts.some(e=>e.some(e=>\"normalCompressed\"===e.name)),uv0:r.layouts.some(e=>e.some(e=>\"uv0\"===e.name)),uvRegion:r.layouts.some(e=>e.some(e=>\"uvRegion\"===e.name)),featureIndex:A.featureIndex},L=e.process(o,!!r.obbData,p,d.byteLength,A,j,b,a,m,y,r.normalReferenceFrame);if(e._free(b),e._free(p),L.error.length>0)throw new Error(`i3s.wasm: ${L.error}`);if(L.discarded)return null;const x=L.componentOffsets.length>0?L.componentOffsets.slice():null,S=L.featureIds.length>0?L.featureIds.slice():null,_=L.anchorIds.length>0?Array.from(L.anchorIds):null,M=L.anchors.length>0?Array.from(L.anchors):null,N=L.interleavedVertedData.slice().buffer,U=1===L.indicesType?new Uint16Array(L.indices.buffer,L.indices.byteOffset,L.indices.byteLength/2).slice():new Uint32Array(L.indices.buffer,L.indices.byteOffset,L.indices.byteLength/4).slice(),F=L.positions.slice(),{buffer:T,byteOffset:v,byteLength:B}=L.positionIndices,I=1===L.positionIndicesType?new Uint16Array(T,v,B/2).slice():new Uint32Array(T,v,B/4).slice(),O=new l(r.layouts[0],N,U,L.hasColors,L.hasModifications,{data:F,indices:I});return S&&t.push(S.buffer),x&&t.push(x.buffer),t.push(N),t.push(U.buffer),t.push(F.buffer),t.push(I.buffer),new u(x,S,_,M,O,n,L.obb)}function x(e){return 0===e?0:1===e?1:2===e?2:3}function S(e){if(!A)return;const{context:r,buffer:t}=e,o=A._malloc(t.byteLength),n=t.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(A.HEAPU8.buffer,o,n),i=new Float64Array(t);s.set(i),A.filterOBBs(r,o,n),i.set(s),A._free(o)}function _(e){A&&0===A.destroy(e)&&(A=null,E=null,c())}function P(e,r){for(let t=0;t<r.length;++t)e[t]=r[t]}async function M(){A||await N()}async function N(){return A||(A=await(E??=f())),A}const U={transform:(e,r)=>A&&L(A,e,r),destroy:_};export{w as destroyContext,y as dracoDecompressPointCloudData,p as filterObbsForModifications,S as filterObbsForModificationsSync,M as initialize,x as interpretObbModificationResults,m as process,d as project,b as setLegacySchema,h as setModifications,j as setModificationsSync,U as test,g as transformNormals};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport s from\"../../../core/Logger.js\";import o from\"../../../core/PooledArray.js\";import{create as t}from\"../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{WorkerHandle as e}from\"../../../core/workers/WorkerHandle.js\";import{canProjectWithoutEngine as r}from\"../../../geometry/projectionUtils.js\";import{projectVectorToVector as i}from\"../../../geometry/projection/projectVectorToVector.js\";class n{constructor(s,o,t,e,r,i){this.layout=s,this.interleavedVertexData=o,this.indices=t,this.hasColors=e,this.hasModifications=r,this.positionData=i}}class h{constructor(s,o,t,e,r,i,n){this.componentOffsets=s,this.featureIds=o,this.anchorIds=t,this.anchors=e,this.transformedGeometry=r,this.globalTrafo=i,this.obb=n}}class a extends e{constructor(s){super(\"SceneLayerWorker\",\"process\",{process:s=>[s.geometryBuffer],project:s=>[s.positions.buffer],transformNormals:s=>[s.normals.buffer]},s,{hasInitialize:!0})}setModifications(s,o,t){const e={context:s,modifications:o,isGeodetic:t};return this.broadcast(e,\"setModifications\")}setLegacySchema(s,o){const t=JSON.stringify(o);return this.broadcast({context:s,jsonSchema:t},\"setLegacySchema\")}destroyContext(s){return this.broadcast(s,\"destroyContext\")}async destroyContextAndSelf(s){await this.destroyContext(s),this.destroy()}project(s,o){return this.invokeMethod(\"project\",s,o)}transformNormals(s,o){return this.invokeMethod(\"transformNormals\",s,o)}}const p=new o({deallocator:null}),c=t();function u(o,t,e){p.clear();let n=1/0,h=1/0,a=-1/0,u=-1/0,l=!1;for(const m of t){const o=\"clip\"===m.type?2:\"mask\"===m.type?1:0,t=m.geometry;let f=s=>s;if(t.spatialReference){if(!r(t.spatialReference,e)){s.getLogger(\"esri.views.3d.layers.I3SMeshWorkerHandle\").warn(\"im-modification-projection-failed\",\"Can't project modification polygon into layer spatial reference, ignoring modification\",{polygon:t});continue}f=s=>(i(s,t.spatialReference,c,e),c)}else t.hasZ||(c[2]=0,f=s=>(c[0]=s[0],c[1]=s[1],c));l=l||1===o;const d=t.rings.length,g=t.rings.some(s=>s.length<3);if(0===d||g)s.getLogger(\"esri.views.3d.layers.I3SMeshWorkerHandle\").warn(\"im-modification-invalid-polygon\",\"Ignoring invalid modification polygon (no rings or rings with less than 3 vertices).\",{polygon:t});else{p.push(o),p.push(d);for(const s of t.rings){p.push(s.length);for(const o of s){const s=f(o);p.push(s[0]),p.push(s[1]),p.push(s[2]),n=Math.min(n,s[0]),h=Math.min(h,s[1]),a=Math.max(a,s[0]),u=Math.max(u,s[1])}}}}if(null!=o)if(l){const s=1e-4;p.push(2),p.push(2),p.push(4),p.push(n-s),p.push(h-s),p.push(0),p.push(a+s),p.push(h-s),p.push(0),p.push(a+s),p.push(u+s),p.push(0),p.push(n-s),p.push(u+s),p.push(0),p.push(4),p.push(o[0]),p.push(o[1]),p.push(0),p.push(o[2]),p.push(o[1]),p.push(0),p.push(o[2]),p.push(o[3]),p.push(0),p.push(o[0]),p.push(o[3]),p.push(0)}else p.push(1),p.push(1),p.push(4),p.push(o[0]),p.push(o[1]),p.push(0),p.push(o[2]),p.push(o[1]),p.push(0),p.push(o[2]),p.push(o[3]),p.push(0),p.push(o[0]),p.push(o[3]),p.push(0);p.push(3);const f=new Float64Array(p.length);for(let s=0;s<p.length;++s)f[s]=p.at(s);return f}export{a as I3SMeshWorkerHandle,h as TransformedData,n as TransformedGeometry,u as toWasmModification};\n"],"names":["n","async","m","e","A","N","r","geometryBuffer","result","L","transferList","y","_i$featureIds","t","o","byteLength","_malloc","s","Uint8Array","HEAPU8","buffer","set","i","dracoDecompressPointCloudData","_free","error","length","Error","concat","a","featureIds","slice","f","positions","push","p","S","h","j","b","setLegacySchema","context","jsonSchema","d","localMatrix","origin","vertexSpace","c","l","fromJSON","inSpatialReference","u","outSpatialReference","projectBuffer","initializeProjection","Promise","all","type","Float64Array","projectMeshVertexPositions","vertexAttributes","position","transform","spatialReference","g","w","E","projected","original","projectedOrigin","_ref","normalMatrix","normals","Float32Array","transformed","_","modifications","setModifications","isGeodetic","globalTrafo","mbs","obbData","elevationOffset","geometryDescriptor","indexToVertexProjector","vertexToRenderProjector","BYTES_PER_ELEMENT","P","NaN","byteOffset","isDraco","isLegacy","color","layouts","some","name","normal","needNormals","uv0","uvRegion","featureIndex","process","normalReferenceFrame","discarded","x","componentOffsets","anchorIds","Array","from","M","anchors","interleavedVertedData","U","indicesType","Uint16Array","indices","Uint32Array","F","T","v","B","positionIndices","I","positionIndicesType","O","hasColors","hasModifications","data","obb","filterOBBs","destroy","default","locateFile","constructor","this","layout","interleavedVertexData","positionData","transformedGeometry","super","project","transformNormals","hasInitialize","broadcast","JSON","stringify","destroyContext","destroyContextAndSelf","invokeMethod","deallocator","clear","geometry","getLogger","warn","polygon","hasZ","rings","Math","min","max","at"],"sourceRoot":""}