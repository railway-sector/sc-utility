"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[66167],{114:(e,t,i)=>{i.d(t,{P:()=>u});var a=i(59422),n=i(62887),r=i(5095),s=i(40480),o=i(3986),l=i(93345);const c=1/65536;class u extends o.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,a.vt)()}dispose(){}drawMany(e,t){const i=e.styleLayer;this._drawIcons(e,i,t),this._drawText(e,i,t)}_drawIcons(e,t,i){const{context:a,displayLevel:o,painter:l,spriteMosaic:c,state:u,styleLayerUID:f,requestRender:d,allowDelayedRender:p}=e,g=t.iconMaterial,m=l.vectorTilesMaterialManager;let y,_=!1;for(const n of i)if(n.layerData.has(f)&&(y=n.layerData.get(f),y.iconPerPageElementsMap.size>0)){_=!0;break}if(!_)return;const M=t.getPaintValue("icon-translate",o),h=t.getPaintValue("icon-translate-anchor",o);let v=t.getLayoutValue("icon-rotation-alignment",o);2===v&&(v=0===t.getLayoutValue("symbol-placement",o)?1:0);const U=0===v,x=t.getLayoutValue("icon-keep-upright",o)&&U,P=y.isIconSDF,E=this._iconProgramOptions;E.sdf=P;const S=m.getMaterialProgram(a,g,E);if(p&&null!=d&&!S.compiled)return void d();a.useProgram(S),S.setUniformMatrix3fv("u_displayViewMat3",0===v?u.displayViewMat3:u.displayMat3),S.setUniformMatrix3fv("u_displayMat3",1===h?u.displayMat3:u.displayViewMat3),S.setUniform2fv("u_iconTranslation",M),S.setUniform1f("u_depth",t.z),S.setUniform1f("u_mapRotation",(0,s.wV)(u.rotation)),S.setUniform1f("u_keepUpright",x?1:0),S.setUniform1f("u_level",10*o),S.setUniform1i("u_texture",r.$U),S.setUniform1f("u_fadeDuration",n.zk/1e3),S.setUniform1i("u_isStencilPass",e.stencilSymbols?1:0);let D=-1;for(const n of i){if(!n.layerData.has(f))continue;if(n.key.level!==D&&(D=n.key.level,g.setDataUniforms(S,o,t,D,c)),y=n.layerData.get(f),0===y.iconPerPageElementsMap.size)continue;y.prepareForRendering(a),y.updateOpacityInfo();const i=y.iconVAO;if(null!=i){a.bindVAO(i),S.setUniformMatrix3fv("u_dvsMat3",n.transforms.displayViewScreenMat3),S.setUniform1f("u_time",(performance.now()-y.lastOpacityUpdate)/1e3);for(const[t,i]of y.iconPerPageElementsMap)this._renderIconRange(e,S,i,t,n)}}}_renderIconRange(e,t,i,a,n){const{context:s,spriteMosaic:o}=e;this._spritesTextureSize[0]=o.getWidth(a)/4,this._spritesTextureSize[1]=o.getHeight(a)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(s,9729,a,r.$U),this._setStencilState(e,n),s.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),n.triangleCount+=i[1]/3}_drawText(e,t,i){const{context:o,displayLevel:l,glyphMosaic:u,painter:f,pixelRatio:d,spriteMosaic:p,state:g,styleLayerUID:m,requestRender:y,allowDelayedRender:_}=e,M=t.textMaterial,h=f.vectorTilesMaterialManager;let v,U=!1;for(const a of i)if(a.layerData.has(m)&&(v=a.layerData.get(m),v.glyphPerPageElementsMap.size>0)){U=!0;break}if(!U)return;const x=t.getPaintProperty("text-opacity");if(x&&!x.isDataDriven&&0===x.getValue(l))return;const P=t.getPaintProperty("text-color"),E=!P||P.isDataDriven||P.getValue(l)[3]>0,S=t.getPaintProperty("text-halo-width"),D=t.getPaintProperty("text-halo-color"),w=(!S||S.isDataDriven||S.getValue(l)>0)&&(!D||D.isDataDriven||D.getValue(l)[3]>0);if(!E&&!w)return;let R=t.getLayoutValue("text-rotation-alignment",l);2===R&&(R=0===t.getLayoutValue("symbol-placement",l)?1:0);const I=0===R,V=t.getLayoutValue("text-keep-upright",l)&&I,T=.8*3/d;this._glyphTextureSize||(this._glyphTextureSize=(0,a.fA)(u.width/4,u.height/4));const L=t.getPaintValue("text-translate",l),N=t.getPaintValue("text-translate-anchor",l),A=this._sdfProgramOptions,k=h.getMaterialProgram(o,M,A);if(_&&null!=y&&!k.compiled)return void y();o.useProgram(k),k.setUniformMatrix3fv("u_displayViewMat3",0===R?g.displayViewMat3:g.displayMat3),k.setUniformMatrix3fv("u_displayMat3",1===N?g.displayMat3:g.displayViewMat3),k.setUniform2fv("u_textTranslation",L),k.setUniform1f("u_depth",t.z+c),k.setUniform2fv("u_mosaicSize",this._glyphTextureSize),k.setUniform1f("u_mapRotation",(0,s.wV)(g.rotation)),k.setUniform1f("u_keepUpright",V?1:0),k.setUniform1f("u_level",10*l),k.setUniform1i("u_texture",r.mg),k.setUniform1f("u_antialiasingWidth",T),k.setUniform1f("u_fadeDuration",n.zk/1e3);let b=-1;for(const a of i){if(!a.layerData.has(m))continue;if(a.key.level!==b&&(b=a.key.level,M.setDataUniforms(k,l,t,b,p)),v=a.layerData.get(m),0===v.glyphPerPageElementsMap.size)continue;v.prepareForRendering(o),v.updateOpacityInfo();const i=v.textVAO;if(null==i)continue;o.bindVAO(i),k.setUniformMatrix3fv("u_dvsMat3",a.transforms.displayViewScreenMat3),this._setStencilState(e,a);const n=(performance.now()-v.lastOpacityUpdate)/1e3;k.setUniform1f("u_time",n),v.glyphPerPageElementsMap.forEach((e,t)=>{this._renderGlyphRange(o,e,t,u,k,w,E,a)})}}_renderGlyphRange(e,t,i,a,n,s,o,c){a.bind(e,9729,i,r.mg),s&&(n.setUniform1f("u_halo",1),e.drawElements(l.WR.TRIANGLES,t[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),c.triangleCount+=t[1]/3),o&&(n.setUniform1f("u_halo",0),e.drawElements(l.WR.TRIANGLES,t[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),c.triangleCount+=t[1]/3)}_setStencilState(e,t){const{context:i,is3D:a,stencilSymbols:n}=e;if(i.setStencilTestEnabled(!0),n)return i.setStencilWriteMask(255),void i.setStencilFunction(519,t.stencilRef,255);i.setStencilWriteMask(0),a?i.setStencilFunction(514,t.stencilRef,255):i.setStencilFunction(516,255,255)}}},3986:(e,t,i)=>{i.d(t,{A:()=>a});class a{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,i){}drawMany(e,t,i){for(const a of t)a.visible&&this.draw(e,a,i)}}},38134:(e,t,i)=>{i.d(t,{F:()=>d});var a=i(15941),n=i(30726),r=i(85827),s=i(28608),o=i(5095),l=i(3986),c=i(93345),u=i(36911),f=i(9243);class d extends l.A{constructor(){super(...arguments),this._color=(0,s.fA)(1,0,0,1),this._patternMatrix=(0,r.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao=(0,n.WD)(this._vao)}drawMany(e,t){const{context:i,painter:n,requestRender:r,allowDelayedRender:s}=e;this._loadWGLResources(e);const l=e.displayLevel,u=e.styleLayer,f=u.backgroundMaterial,d=n.vectorTilesMaterialManager,p=u.getPaintValue("background-color",l),g=u.getPaintValue("background-opacity",l),m=u.getPaintValue("background-pattern",l),y=void 0!==m,_=1|window.devicePixelRatio,M=e.spriteMosaic;let h,v;const U=_>o.C_?2:1,x=this._programOptions;x.pattern=y;const P=d.getMaterialProgram(i,f,x);if(!s||null==r||P.compiled){if(i.bindVAO(this._vao),i.useProgram(P),y){const e=M.getMosaicItemPosition(m,!0);if(null!=e){const{tl:t,br:a,page:n}=e;h=a[0]-t[0],v=a[1]-t[1];const r=M.getPageSize(n);null!=r&&(M.bind(i,9729,n,o.$U),P.setUniform4f("u_tlbr",t[0],t[1],a[0],a[1]),P.setUniform2fv("u_mosaicSize",r),P.setUniform1i("u_texture",o.$U))}P.setUniform1f("u_opacity",g)}else{const e=p[3]*g;this._color[0]=e*p[0],this._color[1]=e*p[1],this._color[2]=e*p[2],this._color[3]=e,P.setUniform4fv("u_color",this._color)}P.setUniform1f("u_depth",u.z||0);for(const e of t){if(P.setUniform1f("u_coord_range",e.rangeX),P.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),y){const t=Math.max(2**(Math.round(l)-e.key.level),1),i=U*e.width*t,n=i/(0,a.yR)(h),r=i/(0,a.yR)(v);this._patternMatrix[0]=n,this._patternMatrix[4]=r,P.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(514,0,255),i.drawArrays(c.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:i}=e,a=i.backgroundMaterial,n=new Int8Array([0,0,1,0,0,1,1,1]),r=new f.R(t,a.geometryLayout,n);this._vao=new u.Z(t,r)}}},40480:(e,t,i)=>{i.d(t,{p6:()=>o,wV:()=>s});Math.PI;const a=256/360,n=1/Math.LN2;function r(e,t){return(e%=t)>=0?e:e+t}function s(e){return r(e*a,256)}function o(e){return Math.log(e)*n}},43106:(e,t,i)=>{i.d(t,{p:()=>r});var a=i(3986),n=i(93345);class r extends a.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:a,requiredLevel:r,state:s,painter:o,spriteMosaic:l,styleLayerUID:c,requestRender:u,allowDelayedRender:f}=e;if(!t.some(e=>{var t,i;return null!==(t=null===(i=e.layerData.get(c))||void 0===i?void 0:i.circleIndexCount)&&void 0!==t&&t}))return;const d=e.styleLayer,p=d.circleMaterial,g=o.vectorTilesMaterialManager,m=d.getPaintValue("circle-translate",a),y=d.getPaintValue("circle-translate-anchor",a),_=this._programOptions,M=g.getMaterialProgram(i,p,_);if(f&&null!=u&&!M.compiled)return void u();i.useProgram(M),M.setUniformMatrix3fv("u_displayMat3",1===y?s.displayMat3:s.displayViewMat3),M.setUniform2fv("u_circleTranslation",m),M.setUniform1f("u_depth",d.z),M.setUniform1f("u_antialiasingWidth",1.2);let h=-1;for(const v of t){if(!v.layerData.has(c))continue;v.key.level!==h&&(h=v.key.level,p.setDataUniforms(M,a,d,h,l));const e=v.layerData.get(c);if(!e.circleIndexCount)continue;e.prepareForRendering(i);const t=e.vao;null!=t&&(i.bindVAO(t),M.setUniformMatrix3fv("u_dvsMat3",v.transforms.displayViewScreenMat3),r!==v.key.level?i.setStencilFunction(514,v.stencilRef,255):i.setStencilFunction(516,255,255),i.drawElements(n.WR.TRIANGLES,e.circleIndexCount,n.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),v.triangleCount+=e.circleIndexCount/3)}}}},51519:(e,t,i)=>{i.d(t,{I:()=>o});var a=i(5095),n=i(3986),r=i(93345);const s=1/65536;class o extends n.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:i,renderPass:a,spriteMosaic:n,styleLayerUID:r}=e;let s=!1;for(const M of t)if(M.layerData.has(r)){const e=M.layerData.get(r);if(e.fillIndexCount>0||e.outlineIndexCount>0){s=!0;break}}if(!s)return;const o=e.styleLayer,l=o.getPaintProperty("fill-pattern"),c=void 0!==l,u=c&&l.isDataDriven;let f;if(c&&!u){const e=l.getValue(i);f=n.getMosaicItemPosition(e,!0)}const d=!c&&o.getPaintValue("fill-antialias",i);let p=!0,g=1;if(!c){const e=o.getPaintProperty("fill-color"),t=o.getPaintProperty("fill-opacity");if((null===e||void 0===e||!e.isDataDriven)&&(null===t||void 0===t||!t.isDataDriven)){const e=o.getPaintValue("fill-color",i);g=o.getPaintValue("fill-opacity",i)*e[3],g>=1&&(p=!1)}}if(p&&"opaque"===a)return;const m=o.getPaintValue("fill-translate",i),y=o.getPaintValue("fill-translate-anchor",i);(p||"translucent"!==a)&&this._drawFill(e,r,o,t,m,y,c,f,u);const _=!o.hasDataDrivenOutlineColor&&o.outlineUsesFillColor&&g<1;d&&"opaque"!==a&&!_&&this._drawOutline(e,r,o,t,m,y)}_drawFill(e,t,i,n,o,l,c,u,f){if(c&&!f&&null==u)return;const{context:d,displayLevel:p,state:g,painter:m,pixelRatio:y,spriteMosaic:_,requestRender:M,allowDelayedRender:h}=e,v=i.fillMaterial,U=m.vectorTilesMaterialManager,x=y>a.C_?2:1,P=this._fillProgramOptions;P.pattern=c;const E=U.getMaterialProgram(d,v,P);if(h&&null!=M&&!E.compiled)return void M();if(d.useProgram(E),null!=u){const{page:e}=u,t=_.getPageSize(e);null!=t&&(_.bind(d,9729,e,a.$U),E.setUniform2fv("u_mosaicSize",t),E.setUniform1i("u_texture",a.$U))}E.setUniformMatrix3fv("u_displayMat3",1===l?g.displayMat3:g.displayViewMat3),E.setUniform2fv("u_fillTranslation",o),E.setUniform1f("u_depth",i.z+s);let S=-1;for(const s of n){if(!s.layerData.has(t))continue;s.key.level!==S&&(S=s.key.level,v.setDataUniforms(E,p,i,S,_));const e=s.layerData.get(t);if(!e.fillIndexCount)continue;e.prepareForRendering(d);const n=e.fillVAO;if(null!=n){if(d.bindVAO(n),E.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3),d.setStencilFunction(514,s.stencilRef,255),c){const e=Math.max(2**(Math.round(p)-s.key.level),1),t=s.rangeX/(x*s.width*e);E.setUniform1f("u_patternFactor",t)}if(f){const t=e.patternMap;if(!t)continue;for(const[e,i]of t){const t=_.getPageSize(e);null!=t&&(_.bind(d,9729,e,a.$U),E.setUniform2fv("u_mosaicSize",t),E.setUniform1i("u_texture",a.$U),d.drawElements(r.WR.TRIANGLES,i[1],r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else d.drawElements(r.WR.TRIANGLES,e.fillIndexCount,r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.fillIndexStart);s.triangleCount+=e.fillIndexCount/3}}}_drawOutline(e,t,i,a,n,o){const{context:l,displayLevel:c,state:u,painter:f,pixelRatio:d,spriteMosaic:p,requestRender:g,allowDelayedRender:m}=e,y=i.outlineMaterial,_=f.vectorTilesMaterialManager,M=.75/d,h=this._outlineProgramOptions,v=_.getMaterialProgram(l,y,h);if(m&&null!=g&&!v.compiled)return void g();l.useProgram(v),v.setUniformMatrix3fv("u_displayMat3",1===o?u.displayMat3:u.displayViewMat3),v.setUniform2fv("u_fillTranslation",n),v.setUniform1f("u_depth",i.z+s),v.setUniform1f("u_outline_width",M);let U=-1;for(const s of a){if(!s.layerData.has(t))continue;s.key.level!==U&&(U=s.key.level,y.setDataUniforms(v,c,i,U,p));const e=s.layerData.get(t);if(e.prepareForRendering(l),!e.outlineIndexCount)continue;const a=e.outlineVAO;null!=a&&(l.bindVAO(a),v.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3),l.setStencilFunction(514,s.stencilRef,255),l.drawElements(r.WR.TRIANGLES,e.outlineIndexCount,r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.outlineIndexStart),s.triangleCount+=e.outlineIndexCount/3)}}}},56012:(e,t,i)=>{i.d(t,{$:()=>s});var a=i(5095),n=i(3986),r=i(93345);class s extends n.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:n,state:s,painter:o,pixelRatio:l,spriteMosaic:c,styleLayerUID:u,requestRender:f,allowDelayedRender:d}=e;if(!t.some(e=>{var t,i;return null!==(t=null===(i=e.layerData.get(u))||void 0===i?void 0:i.lineIndexCount)&&void 0!==t&&t}))return;const p=e.styleLayer,g=p.lineMaterial,m=o.vectorTilesMaterialManager,y=p.getPaintValue("line-translate",n),_=p.getPaintValue("line-translate-anchor",n),M=p.getPaintProperty("line-pattern"),h=void 0!==M,v=h&&M.isDataDriven;let U,x;if(h&&!v){const e=M.getValue(n);U=c.getMosaicItemPosition(e)}let P=!1;if(!h){const e=p.getPaintProperty("line-dasharray");if(x=void 0!==e,P=x&&e.isDataDriven,x&&!P){const t=e.getValue(n),i=p.getDashKey(t,p.getLayoutValue("line-cap",n));U=c.getMosaicItemPosition(i)}}const E=1/l,S=this._programOptions;S.pattern=h,S.sdf=x;const D=m.getMaterialProgram(i,g,S);if(d&&null!=f&&!D.compiled)return void f();if(i.useProgram(D),D.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),D.setUniformMatrix3fv("u_displayMat3",1===_?s.displayMat3:s.displayViewMat3),D.setUniform2fv("u_lineTranslation",y),D.setUniform1f("u_depth",p.z),D.setUniform1f("u_antialiasing",E),U&&null!=U){const{page:e}=U,t=c.getPageSize(e);null!=t&&(c.bind(i,9729,e,a.$U),D.setUniform2fv("u_mosaicSize",t),D.setUniform1i("u_texture",a.$U))}let w=-1;for(const R of t){if(!R.layerData.has(u))continue;R.key.level!==w&&(w=R.key.level,g.setDataUniforms(D,n,p,w,c));const e=2**(n-w)/l;D.setUniform1f("u_zoomFactor",e);const t=R.layerData.get(u);if(!t.lineIndexCount)continue;t.prepareForRendering(i);const s=t.vao;if(null!=s){if(i.bindVAO(s),D.setUniformMatrix3fv("u_dvsMat3",R.transforms.displayViewScreenMat3),i.setStencilFunction(514,R.stencilRef,255),v||P){const e=t.patternMap;if(!e)continue;for(const[t,n]of e){const e=c.getPageSize(t);null!=e&&(c.bind(i,9729,t,a.$U),D.setUniform2fv("u_mosaicSize",e),D.setUniform1i("u_texture",a.$U),i.drawElements(r.WR.TRIANGLES,n[1],r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else i.drawElements(r.WR.TRIANGLES,t.lineIndexCount,r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.lineIndexStart);R.triangleCount+=t.lineIndexCount/3}}}}},78403:(e,t,i)=>{i.d(t,{Z:()=>a});class a{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(t.has(e))return t.get(e);const i=this._read(e);if(!i)throw new Error("cannot find shader file ".concat(e));const a=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let n=a.exec(i);const r=[];for(;null!=n;)r.push({path:n[1],start:n.index,length:n[0].length}),n=a.exec(i);let s=0,o="";return r.forEach(e=>{o+=i.slice(s,e.start),o+=t.has(e.path)?"":this._resolve(e.path,t),s=e.start+e.length}),o+=i.slice(s),t.set(e,o),o}_read(e){return this._readFile(e)}}}}]);
//# sourceMappingURL=66167.5f0c6bac.chunk.js.map