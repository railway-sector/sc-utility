{"version":3,"file":"static/js/22665.13c71540.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js","../node_modules/@arcgis/core/layers/graphics/sources/support/sourceUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{clamp as a}from\"../../../core/mathUtils.js\";import{throwIfAborted as s,isAbortError as o}from\"../../../core/promiseUtils.js\";import n from\"../../../core/Warning.js\";import{equals as i}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as u,convertToGeometry as l}from\"../featureConversionUtils.js\";import{executeQueryForSnapping as c}from\"../data/executeQueryForSnapping.js\";import h from\"../data/FeatureStore.js\";import{checkProjectionSupport as m,project as p}from\"../data/projectionSupport.js\";import{QueryEngine as d}from\"../data/QueryEngine.js\";import{validateGeoJSON as f,createOptimizedFeatures as g}from\"./geojson/geojson.js\";import{mixAttributes as y}from\"./support/sourceUtils.js\";import{getGetFeatureSpatialReference as _,getFeatureCount as x,getFeature as C}from\"../../ogc/wfsUtils.js\";import w from\"../../support/FieldsIndex.js\";import{isNumber as R}from\"../../../support/guards.js\";import{utc as F}from\"../../../time/constants.js\";const S=\"esri.layers.WFSLayer\";class j{constructor(){this._customParameters=null,this._queryEngine=null,this._supportsPagination=!0}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,r={}){const{getFeatureUrl:a,getFeatureOutputFormat:o,fields:n,geometryType:i,featureType:u,maxRecordCount:l,maxTotalRecordCount:c,maxPageCount:p,objectIdField:f,customParameters:g}=e,{spatialReference:y,getFeatureSpatialReference:x}=_(a,u,e.spatialReference);try{await m(x,y)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{inSpatialReference:x,outSpatialReference:y})}s(r),this._customParameters=g,this._featureType=u,this._fieldsIndex=w.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some((e=>\"esriFieldTypeDate\"===e.type))?{timeZoneIANA:F}:null}),this._geometryType=i,this._getFeatureUrl=a,this._getFeatureOutputFormat=o,this._getFeatureSpatialReference=x,this._maxRecordCount=l,this._maxTotalRecordCount=c,this._maxPageCount=p,this._objectIdField=f,this._spatialReference=y;let C=await this._snapshotFeatures(r);if(C.errors.length>0&&(this._supportsPagination=!1,C=await this._snapshotFeatures(r),C.errors.length>0))throw C.errors[0];const R={type:\"object-id\",fieldName:f};return this._queryEngine=new d({fieldsIndex:this._fieldsIndex,geometryType:i,hasM:!1,hasZ:!1,featureIdInfo:R,spatialReference:y,timeInfo:null,featureStore:new h({geometryType:i,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(C.features),{warnings:q(C),extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){await this._waitSnapshotComplete();return(await this._queryEngine.executeQueryForIds(e,t.signal)).filter(R)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),c(this._queryEngine,e,t.signal)}async queryAttributeBins(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeAttributeBinsQuery(e,t.signal)}async refresh(t){return this._customParameters=t.customParameters,this._maxRecordCount=t.maxRecordCount,this._maxTotalRecordCount=t.maxTotalRecordCount,this._maxPageCount=t.maxPageCount,this._snapshotTask?.abort(),this._snapshotTask=e((e=>this._snapshotFeatures({signal:e}))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),this._queryEngine.featureStore.addMany(e.features);for(const t of q(e))r.getLogger(S).warn(new n(\"wfs-layer:refresh-warning\",t.message,t.details));e.errors?.length&&r.getLogger(S).warn(new n(\"wfs-layer:refresh-error\",\"Refresh completed with errors\",{errors:e.errors}))}),(()=>{this._queryEngine.featureStore.clear()})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e){const t=e?.signal,r=this._maxTotalRecordCount,n=this._maxPageCount,i=this._supportsPagination&&n>1?await x(this._getFeatureUrl,this._featureType.typeName,{customParameters:this._customParameters,signal:t}):void 0;let u=[];const l=[];if(null==i)try{u=await this._singleQuery(t)}catch(c){o(c)||l.push(c)}else{const e=Math.min(i,r),s=T(this,a(Math.ceil(e/this._maxRecordCount),1,n),t);await Promise.allSettled(Array.from({length:10}).map((()=>E(s,u,l))))}return s(t),{features:u,totalRecordCount:i,maxTotalRecordCount:r,maxPageCount:n,errors:l}}async _singleQuery(e){const t=Number.isFinite(this._maxRecordCount)&&this._maxRecordCount>0?this._maxRecordCount:void 0,r=await C(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,count:t,signal:e});return this._processGeoJSON(r,{signal:e})}async _pageQuery(e,t){const r=e*this._maxRecordCount,a=await C(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,startIndex:r,count:this._maxRecordCount,signal:t});return this._processGeoJSON(a,{startIndex:r,signal:t})}_processGeoJSON(e,t){f(e,this._getFeatureSpatialReference.wkid);const{startIndex:r,signal:a}=t;s(a);const o=g(e,{geometryType:this._geometryType,hasZ:!1,objectIdField:this._objectIdField});if(!i(this._spatialReference,this._getFeatureSpatialReference))for(const s of o)null!=s.geometry&&(s.geometry=u(p(l(s.geometry,this._geometryType,!1,!1),this._getFeatureSpatialReference,this._spatialReference)));let n=r??1;for(const s of o){const e={};y(this._fieldsIndex,e,s.attributes,!0),s.attributes=e,null==e[this._objectIdField]&&(s.objectId=e[this._objectIdField]=n++)}return o}}function*T(e,t,r){for(let a=0;a<t;a++)yield e._pageQuery(a,r)}async function E(e,t,r){let a=e.next();for(;!a.done;){try{const e=await a.value;t.push(...e)}catch(s){o(s)||r.push(s)}a=e.next()}}function q(e){const t=[];return null!=e.totalRecordCount&&(e.features.length<e.totalRecordCount&&t.push({name:\"wfs-layer:maxRecordCount-too-low\",message:`Could only fetch ${e.features.length} of ${e.totalRecordCount} in ${e.maxPageCount} queries. Try increasing the value of WFSLayer.maxRecordCount.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount}}),e.totalRecordCount>e.maxTotalRecordCount&&t.push({name:\"wfs-layer:large-dataset\",message:`The number of ${e.totalRecordCount} features exceeds the maximum allowed of ${e.maxTotalRecordCount}.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount,maxTotalRecordCount:e.maxTotalRecordCount}})),t}export{j as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{parseDate as t}from\"../../../../core/date.js\";import{isValid as e}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{validateFieldValue as n,validationErrorToString as r,isNumericField as o,isStringField as s,isDateField as i,sanitizeNullFieldValue as u}from\"../../../support/fieldUtils.js\";class l{constructor(t){this.description=t,this.code=null}}class a{constructor(t){this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error=new l(t)}}function p(t){return new a(t)}class c{constructor(t){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=t}}function f(t){return new c(t)}const g=new Set;function d(t,e,o,s=!1){g.clear();for(const i in o){const u=t.get(i);if(!u)continue;const l=m(u,o[i]);if(g.add(u.name),u&&(s||u.editable)){const t=n(u,l);if(t)return p(r(t,u,l));e[u.name]=l}}for(const n of t.requiredFields??[])if(!g.has(n.name))return p(`missing required field \"${n.name}\"`);return null}function m(e,n){let r=n;return o(e)&&\"string\"==typeof n?r=parseFloat(n):s(e)&&null!=n&&\"string\"!=typeof n?r=String(n):i(e)&&\"string\"==typeof n&&(r=t(n)),u(r)}let y;function h(t,n){if(!t||!e(n))return t;if(\"rings\"in t||\"paths\"in t){if(null==y)throw new TypeError(\"geometry engine not loaded\");return y.simplify(n,t)}return t}async function I(){return null==y&&(y=await import(\"../../../../geometry/geometryEngineJSON.js\")),y}async function E(t,n){!e(t)||\"esriGeometryPolygon\"!==n&&\"esriGeometryPolyline\"!==n||await I()}const S={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:[\"COUNT\",\"SUM\",\"AVG\",\"VAR\",\"STDDEV\",\"MIN\",\"MAX\",\"PERCENTILE_CONT\",\"PERCENTILE_DISC\",\"CentroidAggregate\",\"EnvelopeAggregate\",\"ConvexHullAggregate\"],supportedNormalizationTypes:[\"field\",\"log\",\"naturalLog\",\"percentOfTotal\",\"squareRoot\"]};export{p as createFeatureEditErrorResult,f as createFeatureEditSuccessResult,E as loadGeometryEngineForSimplify,d as mixAttributes,S as queryBinsCapabilities,h as simplify};\n"],"names":["S","j","constructor","this","_customParameters","_queryEngine","_supportsPagination","destroy","_this$_queryEngine","load","e","r","arguments","length","undefined","getFeatureUrl","a","getFeatureOutputFormat","o","fields","n","geometryType","i","featureType","u","maxRecordCount","l","maxTotalRecordCount","c","maxPageCount","p","objectIdField","f","customParameters","g","spatialReference","y","getFeatureSpatialReference","x","_","m","_unused","t","inSpatialReference","outSpatialReference","s","_featureType","_fieldsIndex","w","fromLayerJSON","dateFieldsTimeReference","some","type","timeZoneIANA","F","_geometryType","_getFeatureUrl","_getFeatureOutputFormat","_getFeatureSpatialReference","_maxRecordCount","_maxTotalRecordCount","_maxPageCount","_objectIdField","_spatialReference","C","_snapshotFeatures","errors","R","fieldName","d","fieldsIndex","hasM","hasZ","featureIdInfo","timeInfo","featureStore","h","addMany","features","warnings","q","extent","fetchRecomputedExtents","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","signal","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","filter","queryExtent","executeQueryForExtent","querySnapping","queryAttributeBins","executeAttributeBinsQuery","refresh","_this$_snapshotTask","_snapshotTask","abort","promise","then","_e$errors","clear","getLogger","warn","message","details","finished","_unused2","typeName","_singleQuery","push","Math","min","_pageQuery","T","ceil","Promise","allSettled","Array","from","map","async","next","done","value","E","totalRecordCount","Number","isFinite","count","_processGeoJSON","startIndex","wkid","geometry","attributes","objectId","name","concat","recordCount","description","code","globalId","success","uniqueId","error","Set","get","add","editable","_t$requiredFields","requiredFields","has","parseFloat","String","TypeError","simplify","I","supportsAutoIntervalBin","supportsFixedIntervalBin","supportsFixedBoundariesBin","supportsDateBin","supportsStackBy","supportsSplitBy","supportsNormalization","supportedStatisticTypes","supportedNormalizationTypes"],"sourceRoot":""}