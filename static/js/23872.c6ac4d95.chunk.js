"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[23872],{771:(e,i,t)=>{t.d(i,{A:()=>a});var r=t(35143),l=t(76460),n=t(50346),s=t(68134),o=(t(81806),t(47249),t(50076),t(85842));const a=e=>{let i=class extends e{initialize(){this.addHandles((0,s.on)(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(e=>{(0,n.zf)(e)||l.A.getLogger(this).error(e)})}),"RefreshableLayerView")}};return i=(0,r._)([(0,o.$)("esri.views.layers.RefreshableLayerView")],i),i}},14387:(e,i,t)=>{t.d(i,{c:()=>l,d:()=>n});var r=t(81806);function l(e){const{objectIdField:i,uniqueIdFields:t}=e;return null!==t&&void 0!==t&&t.length?t.length>=2?{type:"unique-id-composite",fieldNames:t}:{type:"unique-id-simple",fieldName:t[0]}:{type:"object-id",fieldName:i}}function n(e,i,t,l,n,o){const a=function(e){switch(e){case"esriGeometryMultipoint":return{min:(0,r.A)("featurelayer-snapshot-multipoint-min-threshold"),max:(0,r.A)("featurelayer-snapshot-multipoint-max-threshold")};case"esriGeometryPoint":return{min:(0,r.A)("featurelayer-snapshot-point-min-threshold"),max:(0,r.A)("featurelayer-snapshot-point-max-threshold")};case"esriGeometryMultiPatch":case"esriGeometryPolygon":return{min:(0,r.A)("featurelayer-snapshot-polygon-min-threshold"),max:(0,r.A)("featurelayer-snapshot-polygon-max-threshold")};case"esriGeometryPolyline":return{min:(0,r.A)("featurelayer-snapshot-polyline-min-threshold"),max:(0,r.A)("featurelayer-snapshot-polyline-max-threshold")}}}(l);if(!(0,r.A)("featurelayer-snapshot-enabled")||null===t||void 0===t||!t.query.supportsPagination||null!==t&&void 0!==t&&t.operations.supportsEditing||i)return null;const u=function(e,i){const t=null===i||void 0===i?void 0:i.clone().intersection(e),l=null!=t?t.width*t.height:0,n=i?i.width*i.height:0,s=0===n?0:l/n,o=(0,r.A)("featurelayer-snapshot-coverage");return!isNaN(s)&&s>=o}(n,o),{min:d,max:f}=a,h=u?f:d,p=function(e){switch(e){case"esriGeometryPoint":return null;case"esriGeometryPolyline":case"esriGeometryPolygon":case"esriGeometryMultiPatch":case"esriGeometryMultipoint":return(0,r.A)("featurelayer-snapshot-max-vertex-count")}}(l);let y=(0,r.A)("featurelayer-snapshot-initial-tolerance");return"esriGeometryPoint"!==l&&"esriGeometryMultipoint"!==l||(y=null),{supportsExceedsLimit:s(e,t),initialTolerance:y,maxFeatureCount:h,maxVertexCount:p}}function s(e,i){return!(!e&&!(0,r.A)("featurelayer-snapshot-non-hosted-exceedslimit-enabled"))&&(null===i||void 0===i?void 0:i.operations.supportsExceedsLimitStatistics)}},21009:(e,i,t)=>{t.d(i,{BL:()=>a,Cz:()=>l,KQ:()=>n,M1:()=>o,T1:()=>s,dr:()=>r});const r="ESRI__ID",l="ESRI__OriginID",n="ESRI__DestID",s="ESRI__LayoutGeometry",o="ESRI__AggregationCount",a="LC.ESRI__IsSpatial"},31516:(e,i,t)=>{t.d(i,{F:()=>n});t(18690),t(53084);var r=t(18288),l=t(48718);t(42052),t(72027);function n(e,i,t){if(null==(null===e||void 0===e?void 0:e.timeInfo))return null;const{datesInUnknownTimezone:n=!1,timeOffset:s,useViewTime:o}=e;let a=e.timeExtent;n&&(a=function(e){if(!e)return e;const{start:i,end:t}=e;return new l.T({start:null!=i?(0,r.S1)(i,i.getTimezoneOffset(),"minutes"):i,end:null!=t?(0,r.S1)(t,t.getTimezoneOffset(),"minutes"):t})}(a));let u=o?i&&a?i.intersection(a):i||a:a;return!u||u.isEmpty||u.isAllTime?u:(s&&(u=u.offset(-s.value,s.unit)),n&&(u=function(e){if(!e)return e;const{start:i,end:t}=e;return new l.T({start:null!=i?(0,r.S1)(i,-i.getTimezoneOffset(),"minutes"):i,end:null!=t?(0,r.S1)(t,-t.getTimezoneOffset(),"minutes"):t})}(u)),u.equals(t)?t:u)}},66049:(e,i,t)=>{t.d(i,{A:()=>x});var r=t(89379),l=t(35143),n=(t(81806),t(76460)),s=t(50346),o=t(68134),a=t(34154),u=t(46053),d=(t(47249),t(85842)),f=t(82857),h=t(21009),p=t(64810),y=t(10252),c=t(8203),m=t(91447),v=t(96854),F=t(53430),g=t(46530),I=t(28009),b=t(68295),w=t(14387),_=t(2257);class E{constructor(e){this._fieldsIndex=e,this._clauses=[]}async finish(){return{requiresCurrentUser:(await Promise.all(this._clauses)).some(e=>e.currentUserRequired)}}visitClientWhereClause(e){e&&this._clauses.push((0,a.GP)(e,this._fieldsIndex))}visitFeatureReduction(e){if(e)switch(e.type){case"binning":case"cluster":this.visitLabelingInfo(e.labelsVisible,e.labelingInfo)}}visitLabelingInfo(e,i){if(e&&null!=i)for(const t of i)this.visitClientWhereClause(t.where)}visitDisplayFilter(e,i){if(e)for(const r of null!==(t=null===i||void 0===i?void 0:i.filters)&&void 0!==t?t:[]){var t;this.visitClientWhereClause(r.where)}}visitFilter(e){this.visitClientWhereClause(null===e||void 0===e?void 0:e.where)}visitTrackInfo(e){null!=e&&(this.visitLabelingInfo(null===e||void 0===e?void 0:e.latestObservations.labelsVisible,null===e||void 0===e?void 0:e.latestObservations.labelingInfo),this.visitLabelingInfo(null===e||void 0===e?void 0:e.previousObservations.labelsVisible,null===e||void 0===e?void 0:e.previousObservations.labelingInfo),this.visitLabelingInfo(null===e||void 0===e?void 0:e.trackLines.labelsVisible,null===e||void 0===e?void 0:e.trackLines.labelingInfo))}}const x=e=>{let i=class extends e{constructor(){super(...arguments),this._updatingRequiredPromise=null,this.filter=null,this.layer=null,this.requiresCurrentUser=!1,this.requiredFields=[],this.view=null}initialize(){this.addHandles([(0,o.wB)(()=>{var e,i,t,r;const l=this.layer,n=this.view;return[l&&"elevationInfo"in l?null===(e=l.elevationInfo)||void 0===e?void 0:e.featureExpressionInfo:null,l&&"displayField"in l?l.displayField:null,l&&"timeInfo"in l&&l.timeInfo,l&&"renderer"in l&&l.renderer,l&&"labelingInfo"in l&&l.labelingInfo,l&&"floorInfo"in l&&l.floorInfo,(null===n||void 0===n||null===(i=n.requiredFieldsOptions)||void 0===i?void 0:i.featureTitleFields)&&l&&"featureTitleFields"in l&&l.featureTitleFields,(null===n||void 0===n||null===(t=n.requiredFieldsOptions)||void 0===t?void 0:t.utilityNetworkFields)&&(0,I._)(n,l),l.displayFilterInfo,this.displayFilterEnabled,this.filter,this.featureEffect,this.timeExtent,"knowledge-graph-sublayer"===(null===l||void 0===l?void 0:l.type)&&"link-chart"===l.parentCompositeLayer.type&&(null===(r=l.parentCompositeLayer.linkChart)||void 0===r||null===(r=r.linkChartProperties.nonspatialDataDisplay)||void 0===r?void 0:r.mode),"parquet"===(null===l||void 0===l?void 0:l.type)&&l.popupTemplate]},()=>this._handleChange(),o.pc),(0,o.on)(()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.floors},"change",()=>this._handleChange()),(0,o.on)(()=>{var e;return null===(e=this.layer.displayFilterInfo)||void 0===e?void 0:e.filters},"change",()=>this._handleChange()),(0,o.on)(()=>this.layer&&"sublayers"in this.layer?this.layer.sublayers:null,"change",()=>this._handleChange())])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:i},requiredFields:t}=this;return"outFields"in e&&e.outFields?(0,F.DB)(i,[...(0,F.hL)(i,e.outFields),...t]):(0,F.DB)(i,t)}get displayFilterEnabled(){var e,i,t,r;return(null===(e=null===(i=this.view)||void 0===i?void 0:i.displayFilterEnabled)||void 0===e||e)&&(!("displayFilterEnabled"in this.layer)||null===(t=null===(r=this.layer)||void 0===r?void 0:r.displayFilterEnabled)||void 0===t||t)}get effectiveDisplayFilter(){const e=this.layer;return this.displayFilterEnabled&&e.displayFilterInfo?(0,p.u2)(e.displayFilterInfo,this.view):null}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){n.A.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}get signedInUser(){var e;return null!==(e=this.layer)&&void 0!==e&&e.url?(0,m.fE)(this.layer.url):Promise.resolve(null)}highlight(e,i){throw new Error("missing implementation")}createQuery(){var e;const i={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=null!=this.filter?this.filter.createQuery(i):new b.A(i);return"floorInfo"in this.layer&&this.layer.floorInfo&&(t.where=(0,a.mA)(t.where,(0,g.E)(this))),this.displayFilterEnabled&&(t.where=(0,a.mA)(t.where,null===(e=this.effectiveDisplayFilter)||void 0===e?void 0:e.where)),null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new b.A(e)}queryFeatures(e,i){throw new Error("missing implementation")}queryObjectIds(e,i){throw new Error("missing implementation")}queryFeatureCount(e,i){throw new Error("missing implementation")}queryExtent(e,i){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,i){const t=await this._createPopupQuery(e.map(e=>{var i,t;return null!==(i=null===(t=e.origin)||void 0===t?void 0:t.layer)&&void 0!==i?i:e.layer}),i);return await(0,v.A)(this.layer,e,t,(0,r.A)({getPopupTemplate:e=>e&&"popupEnabled"in e&&e.popupEnabled?(0,_.D8)(e,i):null,hasRequiredFields:(e,i)=>this._popupFeatureHasRequiredFields(e,i)},i))}_handleChange(){const e=Promise.all([this._updateRequiredFields(),this._updateClientWhereClauseRequirements()]).then(()=>{});return this._set("_updatingRequiredPromise",e),e.then(()=>{this._updatingRequiredPromise===e&&this._set("_updatingRequiredPromise",null)}),e}async _updateClientWhereClauseRequirements(){var e;if(!this.layer||!this.view)return;const{layer:i}=this,t=new E(i.fieldsIndex);if(t.visitFilter(this.filter),"featureReduction"in i&&t.visitFeatureReduction(i.featureReduction),"labelingInfo"in i&&t.visitLabelingInfo(i.labelsVisible,i.labelingInfo),"trackInfo"in i&&t.visitTrackInfo(i.trackInfo),"2d"===this.view.type&&(t.visitFilter(null===(e=this.featureEffect)||void 0===e?void 0:e.filter),t.visitDisplayFilter(this.displayFilterEnabled,i.displayFilterInfo),"featureReduction"in i&&t.visitFeatureReduction(i.featureReduction)),"subtype-group"===i.type)for(const l of i.sublayers)t.visitLabelingInfo(l.labelsVisible,l.labelingInfo);try{const e=await t.finish();this._set("requiresCurrentUser",e.requiresCurrentUser)}catch(r){n.A.getLogger(this).error(r)}}async _updateRequiredFields(){var e,i;if(!this.layer||!this.view)return;const t="3d"===this.view.type,{layer:r,layer:{fieldsIndex:l}}=this,s="renderer"in r&&r.renderer,o="orderBy"in r&&r.orderBy,a="featureReduction"in r?r.featureReduction:null,u=new Set,d=[s?s.collectRequiredFields(u,l):null,(0,F.Im)(u,r),t&&"elevationInfo"in r?(0,F.NO)(u,r):null,null!=this.filter?(0,F.o)(u,r,this.filter):null,t||null==this.featureEffect?null:(0,F.o)(u,r,this.featureEffect.filter),!t&&a?(0,F.RP)(u,r,a):null,!t&&o?(0,F.f)(u,r,o):null];if("timeInfo"in r&&r.timeInfo&&this.timeExtent&&(0,F._w)(u,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"timeInfo"in r&&r.timeInfo&&"trackInfo"in r&&r.trackInfo){const{trackInfo:e}=r;(0,F._w)(u,r.fieldsIndex,[r.timeInfo.trackIdField]),"feature"!==r.type&&"startTimeField"!==e.timeField||(0,F._w)(u,r.fieldsIndex,[r.timeInfo.startField]),"endTimeField"===e.timeField&&(0,F._w)(u,r.fieldsIndex,[r.timeInfo.endField]),await(0,F.d)(u,r)}if("floorInfo"in r&&r.floorInfo&&(0,F._w)(u,r.fieldsIndex,[r.floorInfo.floorField]),"featureTitleFields"in r&&null!==(e=this.view)&&void 0!==e&&null!==(e=e.requiredFieldsOptions)&&void 0!==e&&e.featureTitleFields&&r.featureTitleFields&&(0,F._w)(u,r.fieldsIndex,r.featureTitleFields),"feature"===r.type&&r.globalIdField&&null!==(i=this.view)&&void 0!==i&&null!==(i=i.requiredFieldsOptions)&&void 0!==i&&i.globalIdField&&(0,F._w)(u,r.fieldsIndex,[r.globalIdField]),this.displayFilterEnabled&&d.push((0,F.A6)(u,r,r.displayFilterInfo)),"feature"===r.type&&t&&null!=r.infoFor3D&&(null==r.globalIdField&&n.A.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),(0,F._w)(u,r.fieldsIndex,[r.globalIdField])),"subtype-group"===r.type){(0,F.rq)(u,l,r.subtypeField);const e=r.sublayers.map(e=>{var i;return Promise.all([null===(i=e.renderer)||void 0===i?void 0:i.collectRequiredFields(u,l),(0,F.Im)(u,e)])});d.push(Promise.all(e))}if("catalog-footprint"===r.type&&r.parent){const e=r.parent;(0,F._w)(u,l,[e.itemNameField,e.itemSourceField,e.itemTypeField,e.maxScaleField,e.minScaleField])}"knowledge-graph-sublayer"===r.type&&"link-chart"===r.parentCompositeLayer.type&&(0,F.rq)(u,l,h.BL),"parquet"===r.type&&d.push((0,_.TO)(r,r.popupTemplate).then(e=>{for(const i of e)u.add(i)}));const p=await Promise.allSettled(d);if(t)(0,F.rq)(u,l,r.objectIdField);else for(const n of(0,f.Y)((0,w.c)(r)))(0,F.rq)(u,l,n);t&&"displayField"in r&&r.displayField&&(0,F.rq)(u,l,r.displayField);for(const f of p)"rejected"===f.status&&n.A.getLogger(this).error(f.reason);const y=Array.from(u).sort();this._set("requiredFields",y)}_popupFeatureHasRequiredFields(e,i){return(0,F.Kl)(e,i)}async _createPopupQuery(e,i){const t=this.layer.createQuery(),r=new Set;let l=!1;const n=null!==e&&void 0!==e?e:[this.layer];for(const o of n){if(!("popupEnabled"in o))continue;const e=(0,_.D8)(o,i);if(null==e)continue;const t=await(0,v.Y)(e);(0,s.Te)(i);const n=t&&t.arcadeUtils.hasGeometryOperations(e);l=!("point"!==this.layer.geometryType&&!n);const a=await(0,_.TO)(this.layer,e);(0,s.Te)(i);for(const i of a)r.add(i)}return t.returnGeometry=l,t.returnZ=l,t.returnM=l,t.outFields=Array.from(r),t.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo&&(t.where=(0,a.mA)(t.where,(0,g.E)(this))),t}canResume(){return!!super.canResume()&&(null==this.timeExtent||!this.timeExtent.isEmpty)}getTest(){}get test(){}};return(0,l._)([(0,u.MZ)()],i.prototype,"_updatingRequiredPromise",void 0),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"availableFields",null),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"displayFilterEnabled",null),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"effectiveDisplayFilter",null),(0,l._)([(0,u.MZ)({type:y.A})],i.prototype,"featureEffect",null),(0,l._)([(0,u.MZ)({type:c.A})],i.prototype,"filter",void 0),(0,l._)([(0,u.MZ)()],i.prototype,"layer",void 0),(0,l._)([(0,u.MZ)({type:Number})],i.prototype,"maximumNumberOfFeatures",null),(0,l._)([(0,u.MZ)({readOnly:!0,type:Boolean})],i.prototype,"maximumNumberOfFeaturesExceeded",null),(0,l._)([(0,u.MZ)()],i.prototype,"requiresCurrentUser",void 0),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"requiredFields",void 0),(0,l._)([(0,u.MZ)({readOnly:!0})],i.prototype,"signedInUser",null),(0,l._)([(0,u.MZ)()],i.prototype,"suspended",void 0),(0,l._)([(0,u.MZ)()],i.prototype,"view",void 0),i=(0,l._)([(0,d.$)("esri.views.layers.FeatureLayerView")],i),i}},82857:(e,i,t)=>{function*r(e){switch(e.type){case"object-id":case"unique-id-simple":return void(yield e.fieldName);case"unique-id-composite":return void(yield*e.fieldNames)}}t.d(i,{Y:()=>r})}}]);
//# sourceMappingURL=23872.c6ac4d95.chunk.js.map