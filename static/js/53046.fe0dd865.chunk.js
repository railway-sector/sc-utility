"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[53046],{31329:(t,e,i)=>{i.d(e,{p:()=>M});var s=i(6326),r=i(91967),n=i(68134),a=i(46053),o=(i(81806),i(76460),i(47249),i(87990)),l=i(34111),h=i(4212),c=i(15941),d=i(34761),p=i(13191),u=i(20664),_=i(9392),g=i(5809),v=i(50840),y=i(14487),b=i(42294),f=i(2413),S=i(44230),x=i(13927),m=i(95925),C=i(70335);const w=.5*Math.PI,E=w/Math.PI*180;class I{constructor(t){this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,_.vt)(),direction:(0,_.vt)()},this._renderCoordsHelper=t.renderCoordsHelper;for(let e=0;e<4;e++)this._extent[e]={origin:(0,_.vt)(),direction:(0,_.vt)(),cap:{next:null,direction:(0,_.vt)()}},this._planes[e]=(0,x.vt)();this._planes[4]=(0,x.vt)(),this._planes[5]=(0,x.vt)(),this._planesWithoutFar=this._planes.slice(0,5)}update(t,e,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=this._extent;this._toRenderBoundingExtent(t,e,i),(0,u.g)(this._center.origin,r[0].origin,r[2].origin),(0,u.h)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||(0,u.h)(this._center.direction,this._center.direction,-1);for(let n=0;n<4;n++){const t=r[n];this._renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const e=r[3===n?0:n+1];t.cap.next=e.origin,(0,u.E)(t.cap.direction,t.origin,e.origin),(0,x.mR)(t.direction,t.cap.direction,t.origin,this._planes[n]),s||(0,u.h)(t.direction,t.direction,-1)}(0,x.mR)(r[0].cap.direction,r[1].cap.direction,r[0].origin,this._planes[4]),s?(0,x.ze)(this._planes[4],this._planes[5]):((0,x.C)(this._planes[5],this._planes[4]),(0,x.ze)(this._planes[4],this._planes[4])),this._maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this._maxSpanSpatialReference=e,this._minGlobalAltitude=.9*(0,l.tO)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t)return!1;if(1===this._renderCoordsHelper.viewingMode){const i=this._maxSpanSpatialReference.isGeographic?E:w*e;if(this._maxSpan>i)return!0;if(null!=t.altitude&&t.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(0===this._maxSpan){const e=this._extent[0];return!(i||!t.intersectsRay((0,m.LV)(e.origin,e.direction)))}for(let r=0;r<this._extent.length;r++){const e=this._extent[r];if(!i&&t.intersectsRay((0,m.LV)(e.origin,e.direction)))return!0;if(t.intersectsLineSegment((0,S.Cr)(e.origin,e.cap.next,k),e.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let r=0;r<t.lines.length;r++){const e=t.lines[r];if((0,C.Sc)(s,e.origin,e.endpoint,e.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,e,i){(0,f.gX)(t,j),j[2]=i,(0,g.l)(e,j,O,this._renderCoordsHelper.spatialReference),(0,d.B8)(D,O),(0,b.Ie)(V);for(const{x0:s,x1:r,y0:n,y1:a}of G)for(let o=0;o<5;o++){const l=o/4;j[0]=(0,c.Cc)(t[s],t[r],l),j[1]=(0,c.Cc)(t[n],t[a],l),j[2]=i,(0,y.F)(j,e,j,this._renderCoordsHelper.spatialReference),(0,u.t)(j,j,D),(0,b.iT)(V,j)}(0,u.j)(this._extent[0].origin,V[0],V[1],V[2]),(0,u.j)(this._extent[1].origin,V[3],V[1],V[2]),(0,u.j)(this._extent[2].origin,V[3],V[4],V[2]),(0,u.j)(this._extent[3].origin,V[0],V[4],V[2]);for(let s=0;s<4;++s)(0,u.t)(this._extent[s].origin,this._extent[s].origin,O)}_toRenderBoundingExtentLocal(t,e,i){(0,v.S)(t,e,R,this._renderCoordsHelper.spatialReference),(0,u.j)(this._extent[0].origin,R[0],R[1],i),(0,u.j)(this._extent[1].origin,R[2],R[1],i),(0,u.j)(this._extent[2].origin,R[2],R[3],i),(0,u.j)(this._extent[3].origin,R[0],R[3],i)}_toRenderBoundingExtent(t,e,i){switch(this._renderCoordsHelper.viewingMode){case 1:this._toRenderBoundingExtentGlobal(t,e,i);break;case 2:this._toRenderBoundingExtentLocal(t,e,i);break;default:(0,h.Xb)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(t){if((0,x.mN)(t.planes[4],this._center.origin)<0&&(0,u.f)(this._center.direction,t.direction)<0)return!0;for(let e=0;e<4;e++){const i=this._extent[e];if((0,x.mN)(t.planes[4],i.origin)<0&&(0,u.f)(i.direction,t.direction)<0)return!0}return!1}}const G=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],j=(0,_.vt)(),O=(0,p.vt)(),D=(0,p.vt)(),V=(0,b.vt)(),R=(0,f.vt)(),k=(0,S.vt)();var B=i(59752),A=i(22856);let M=class extends r.A{constructor(t){super(t),this.suspended=!1,this._extent=null,this._extentIntersectionDirty=!0,this._isVisibleBelowSurfaceInternal=!1,this.graphicsCoreOwner=null,this.updating=!0}initialize(){const{graphicsCoreOwner:t}=this;this._extentIntersection=new I({renderCoordsHelper:t.view.renderCoordsHelper});const e=t.view,i=e.basemapTerrain,s=e.resourceController.scheduler;this.addHandles([e.on("resize",()=>this._viewChange()),(0,n.wB)(()=>e.state.camera,()=>this._viewChange(),n.OH),s.registerTask(B.W6.FRUSTUM_VISIBILITY,this),(0,n.wB)(()=>i.visibleElevationBounds,()=>this._elevationBoundsChange())]),"local"===e.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([(0,n.wB)(()=>{var t;return[i.baseOpacity,i.wireframe,null===(t=e.map)||void 0===t||null===(t=t.ground)||void 0===t||null===(t=t.navigationConstraint)||void 0===t?void 0:t.type]},()=>this._updateIsVisibleBelowSurface(),n.Vh)])}destroy(){this._set("graphicsCoreOwner",null),this._extent=null,this._extentIntersection=null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(t){this._extent=t,this._extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(t){this._isVisibleBelowSurfaceInternal=t,this._setDirty(),this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){var t;const e=this.graphicsCoreOwner.view,i=e.basemapTerrain,s="local"===e.viewingMode,r="none"===(null===(t=e.map.ground)||void 0===t||null===(t=t.navigationConstraint)||void 0===t?void 0:t.type);this._isVisibleBelowSurface=s||!i.opaque||r}_updateExtentIntersection(){if(!this._extentIntersectionDirty)return;this._extentIntersectionDirty=!1;const t=this.graphicsCoreOwner.view;let e;if(this._isVisibleBelowSurfaceInternal)e=-.3*(0,l.tO)(t.spatialReference).radius;else{const{min:i,max:s}=t.basemapTerrain.visibleElevationBounds;e=i-Math.max(1,(s-i)*(1.2-1))}this._extentIntersection.update(this._extent,t.spatialReference,e)}get readyToRun(){return this.updating}runTask(t){if(this._set("updating",!1),!this._extent)return this._set("suspended",!1),A.G;this._updateExtentIntersection();const e=this.graphicsCoreOwner.view.frustum,i=(0,l.tO)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(e,i)),t.madeProgress()}};(0,s.Cg)([(0,a.MZ)({readOnly:!0})],M.prototype,"suspended",void 0),(0,s.Cg)([(0,a.MZ)({constructOnly:!0})],M.prototype,"graphicsCoreOwner",void 0),(0,s.Cg)([(0,a.MZ)({readOnly:!0})],M.prototype,"updating",void 0),M=(0,s.Cg)([(0,o.$)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],M)},35148:(t,e,i)=>{i.d(e,{V:()=>d});var s=i(6326),r=i(91967),n=i(54099),a=i(68134),o=i(46053),l=(i(81806),i(76460),i(47249),i(87990)),h=i(68920),c=i(59752);let d=class extends r.A{constructor(t){super(t),this._dirtyExtents=new h.D,this._globalDirty=!1,this._averageExtentUpdateSize=0,this._dirtyGraphicsSet=new Set,this._updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new n.bk}initialize(){var t;const e=this.elevationProvider,i=this.graphicsCoreOwner.view.resourceController.scheduler;this._task=i.registerTask(p(null===(t=this.graphicsCore.layer.elevationInfo)||void 0===t?void 0:t.mode),this),this.addHandles([e.on("elevation-change",t=>this._elevationChanged(t)),(0,a.wB)(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),this._task,(0,a.wB)(()=>{var t;return p(null===(t=this.graphicsCore.layer.elevationInfo)||void 0===t?void 0:t.mode)},t=>this._task.priority=t)])}destroy(){this._dirtyGraphicsSet.clear(),this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null,this.elevationProvider=null,this._dirtyExtents.destroy()}clear(){this._dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0,this.notifyChange("updating")}get updating(){return this.readyToRun}get readyToRun(){return this._dirtyGraphicsSet.size>0||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(t){for(this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,t.madeProgress()),t.run(()=>this._dirtyExtents.merge(t));this.readyToRun&&!t.done;)this._updateDirtyGraphics(t),this._updateDirtyExtents(t);this.notifyChange("updating")}_updateDirtyGraphics(t){const e=this.graphicsCoreOwner.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy;for(const r of this._dirtyGraphicsSet.keys()){var s;const n=this.graphicsCore.getGraphics3DGraphicById(r);if(this._dirtyGraphicsSet.delete(r),null!=n&&(n.alignWithElevation(this.elevationProvider,e,i),null!==(s=this.graphicsCore.deconflictor)&&void 0!==s&&s.setDirty(),t.madeProgress()),t.done)return}}_updateDirtyExtents(t){for(;!this._dirtyExtents.empty&&!t.done;){const e=this._dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:e,spatialReference:i});const s=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(e,i,t=>{const e=this.graphicsCore.getGraphics3DGraphicById(t);null!=e&&e.needsElevationUpdates()&&this._dirtyGraphicsSet.add(t)}),this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-s)+.9*this._averageExtentUpdateSize,t.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear(),this._dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((t,e)=>this._dirtyGraphicsSet.add(e))}_elevationChanged(t){if("scene"===t.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const e=t.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const t=this.graphicsCore.computedExtent;t&&e[2]>t.xmin&&e[0]<t.xmax&&e[3]>t.ymin&&e[1]<t.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",t)}else e[0]===-1/0?this._globalDirty=!0:this._dirtyExtents.add(e),this.notifyChange("updating")}};function p(t){return null==t?c.W6.ELEVATION_ALIGNMENT:"relative-to-scene"===t?c.W6.ELEVATION_ALIGNMENT_SCENE:c.W6.ELEVATION_ALIGNMENT}(0,s.Cg)([(0,o.MZ)()],d.prototype,"graphicsCoreOwner",void 0),(0,s.Cg)([(0,o.MZ)()],d.prototype,"graphicsCore",void 0),(0,s.Cg)([(0,o.MZ)()],d.prototype,"queryGraphicUIDsInExtent",void 0),(0,s.Cg)([(0,o.MZ)()],d.prototype,"elevationProvider",void 0),(0,s.Cg)([(0,o.MZ)({readOnly:!0})],d.prototype,"updating",null),(0,s.Cg)([(0,o.MZ)({readOnly:!0})],d.prototype,"updatingRemaining",null),d=(0,s.Cg)([(0,l.$)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],d)},86486:(t,e,i)=>{i.d(e,{LO:()=>o,kg:()=>l,or:()=>h,vl:()=>a});var s=i(69539),r=i(11687),n=i(15492);function a(t,e){var i;const s=function(t,e){if(null!=t.symbol)return t.symbol;const i=null===e||void 0===e?void 0:e.renderer;return null!=i&&"dot-density"!==i.type?i.getSymbol(t,e):null}(t,e);if(null==s)return null;const a=null===e||void 0===e?void 0:e.renderer,o=new r.$(a,s);if(null==a||!("visualVariables"in a)||!a.visualVariables)return o;const l=null!==(i=(0,n.getVisualVariableValues)(a,t,e))&&void 0!==i?i:[],h=["proportional","proportional","proportional"];for(const{variable:r,value:n}of l)if(null!=n||"size"===r.type&&r.useSymbolValue)switch(r.type){case"color":o.color=null===n||void 0===n?void 0:n.toRgba();break;case"size":if("outline"===r.target)o.outlineSize=n;else{const t=r.axis,e=r.useSymbolValue?"symbol-value":null!==n&&void 0!==n?n:"proportional";switch(t){case"width":h[0]=e;break;case"depth":h[1]=e;break;case"height":h[2]=e;break;case"width-and-depth":h[0]=h[1]=e;break;default:h[0]=h[1]=h[2]=e}}break;case"opacity":o.opacity=n;break;case"rotation":switch(r.axis){case"tilt":o.tilt=n;break;case"roll":o.roll=n;break;default:o.heading=n}}return"proportional"===h[0]&&"proportional"===h[1]&&"proportional"===h[2]||(o.size=h),o}async function o(t,e){var i;const a=await async function(t,e){var i,s;return null!=t.symbol?t.symbol:null!==(i=null===e||void 0===e||null===(s=e.renderer)||void 0===s?void 0:s.getSymbolAsync(t,e))&&void 0!==i?i:null}(t,e);if(!a)return null;const o=null===e||void 0===e?void 0:e.renderer,l=new r.$(o,a);if(!o||!("visualVariables"in o)||!o.visualVariables)return l;const h=null!==(i=(0,n.getVisualVariableValues)(o,t,e))&&void 0!==i?i:[],c=["proportional","proportional","proportional"];for(const{variable:r,value:n}of h)if("color"===r.type)l.color=s.A.toUnitRGBA(n);else if("size"===r.type)if("outline"===r.target)l.outlineSize=n;else{const t=r.axis,e=r.useSymbolValue?"symbol-value":n;"width"===t?c[0]=e:"depth"===t?c[1]=e:"height"===t?c[2]=e:c[0]=c[1]="width-and-depth"===t?e:c[2]=e}else"opacity"===r.type?l.opacity=n:"rotation"===r.type&&"tilt"===r.axis?l.tilt=n:"rotation"===r.type&&"roll"===r.axis?l.roll=n:"rotation"===r.type&&(l.heading=n);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(l.size=c),l}function l(t){const e=t[arguments.length>1&&void 0!==arguments[1]?arguments[1]:0];return"number"==typeof e&&isFinite(e)?e:null}function h(t){for(let e=0;e<3;e++){const i=t[e];if("number"==typeof i)return isFinite(i)?i:0}return 0}},90592:(t,e,i)=>{i.d(e,{w:()=>_});var s=i(54901);i(81806);class r{}class n extends r{constructor(t,e){super(),this.objectStateId=t,this.object=e}remove(){this.object.removeStateID(this.objectStateId)}}class a extends r{constructor(t,e,i){super(),this.objectStateId=t,this.object=e,this.owner=i}remove(){this.owner.removeRenderGeometryObjectState(this.object,this.objectStateId)}}class o extends r{constructor(t,e){super(),this.objectStateId=t,this._removeCallback=e,this.object=null}remove(){this._removeCallback(this.objectStateId)}}class l{constructor(){this._items=[]}addObject(t,e){this._items.push(new n(e,t))}addRenderGeometry(t,e,i){this._items.push(new a(e,t,i))}addExternal(t,e){this._items.push(new o(e,t))}remove(t){this._remove(e=>e.objectStateId===t)}removeByObject(t){this._remove(e=>e.object===t)}removeAll(){this._items.forEach(t=>t.remove()),this._items=[]}_remove(t){const{_items:e}=this;for(let i=e.length-1;i>=0;--i){const s=e[i];t(s)&&(s.remove(),e.splice(i,1))}}}class h extends l{constructor(){super(...arguments),this.stateType=1}}class c extends l{constructor(t){super(),this.highlightName=t,this.stateType=0}}class d{constructor(t){this.objectIdField=t,this.ids=new Set,this.paused=!1}hasGraphic(t){const e=this.objectIdField?t.graphic.attributes[this.objectIdField]:t.graphic.uid;return this.ids.has(e)}}class p extends d{constructor(t){super(t),this.stateType=1,this.objectStateSet=new h}}class u extends d{constructor(t,e){super(e),this.highlightName=t,this.stateType=0,this.objectStateSet=new c(t)}}class _{constructor(t){this._graphicsCore=t,this._stateSets=new Array}destroy(){this.reset(),this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach(t=>t.objectStateSet.removeAll()),this._stateSets.length=0)}acquireOccludeeSet(t){const e=new p(t);this._stateSets.push(e);const i=(0,s.hA)(()=>this.releaseSet(e));return{set:e,handle:i}}acquireHighlightSet(t,e){const i=new u(t,e);this._stateSets.push(i);const r=(0,s.hA)(()=>this.releaseSet(i));return{set:i,handle:r}}releaseSet(t){t.objectStateSet.removeAll();const e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)}setUid(t,e){t.ids.add(e);const i=this._graphicsCore.graphics3DGraphics.get(e);i&&i.addObjectStateSet(t.objectStateSet)}setUids(t,e){e.forEach(e=>this.setUid(t,e))}setObjectIds(t,e){e.forEach(e=>t.ids.add(e)),this._initializeSet(t)}addGraphic(t){this._stateSets.forEach(e=>{!e.paused&&e.hasGraphic(t)&&t.addObjectStateSet(e.objectStateSet)})}removeGraphic(t){this._stateSets.forEach(e=>{e.hasGraphic(t)&&t.removeObjectState(e.objectStateSet)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(t=>t.objectStateSet.removeAll())}_initializeSet(t){const e=this._graphicsCore.graphics3DGraphics;t.objectIdField?e.forEach(e=>{e&&t.hasGraphic(e)&&e.addObjectStateSet(t.objectStateSet)}):t.ids.forEach(i=>{const s=e.get(i);s&&s.addObjectStateSet(t.objectStateSet)})}get test(){}}}}]);
//# sourceMappingURL=53046.fe0dd865.chunk.js.map