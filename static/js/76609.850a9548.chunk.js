"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[76609],{14318:(e,t,i)=>{i.d(t,{O:()=>u});var n=i(89379),s=i(35143),a=i(91967),o=i(30726),r=i(50346),l=i(46053),c=(i(81806),i(76460),i(47249),i(85842)),d=i(59752);let u=class extends a.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,r.sg)(async(e,t,i,s)=>{const a=this._frameTask;if(null==a)return;const o=await a.schedule(()=>t.snap((0,n.A)((0,n.A)({},e),{},{context:i,signal:s})),s);o.valid&&await a.schedule(()=>{this.stagedPoint=o.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update((0,n.A)((0,n.A)({},this._snapPoints),{},{context:i})))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(d.W6.SNAPPING):d.nu}destroy(){this._abortController=(0,o.DC)(this._abortController),this._frameTask=(0,o.xt)(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:s}=e,a=t.update({point:n,scenePoint:s,context:i});return this.stagedPoint=a,a}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,o.DC)(this._abortController),this._snapPoints=null}};(0,s._)([(0,l.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"stagedPoint",null),(0,s._)([(0,l.MZ)()],u.prototype,"constrainResult",void 0),(0,s._)([(0,l.MZ)()],u.prototype,"_stagedPoint",void 0),u=(0,s._)([(0,c.$)("esri.views.interactive.snapping.SnappingOperation")],u)},23458:(e,t,i)=>{var n;i.d(t,{L:()=>n,h:()=>s}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(n||(n={}));const s=[n.Horizontal,n.Vertical,n.Direct]},29201:(e,t,i)=>{i.d(t,{I:()=>w,a:()=>M,b:()=>S});var n,s,a=i(57528),o=i(34981),r=i(26917),l=i(59395),c=i(90080),d=i(94192),u=i(80883),p=i(3799),h=i(21390),m=i(86955),g=i(70367),v=i(66470),_=i(91911),f=i(31432),y=i(2687);class M extends f.Y{}function S(e){const t=new y.N5,{vertex:i,fragment:f,varyings:M}=t,{output:S,perspectiveInterpolation:w}=e;return(0,p.NB)(i,e),t.include(l.d,e),t.include(d.Z,e),t.fragment.include(r.HQ,e),t.include(c.g,e),t.include(_.z,e),t.attributes.add(v.r.POSITION,"vec3"),t.attributes.add(v.r.UV0,"vec2"),w&&t.attributes.add(v.r.PERSPECTIVEDIVIDE,"float"),i.main.add((0,m.H)(n||(n=(0,a.A)(["\n    vpos = position;\n    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);\n    vTexCoord = uv0;\n    gl_Position = transformPosition(proj, view, vpos);\n    ",""])),(0,m.If)(w,"gl_Position *= perspectiveDivide;"))),M.add("vpos","vec3",{invariant:!0}),M.add("vTexCoord","vec2"),f.include(u.a),f.uniforms.add(new h.m("opacity",e=>e.opacity),new g.N("tex",e=>e.glTexture)).main.add((0,m.H)(s||(s=(0,a.A)(["\n    discardBySlice(vpos);\n    discardByTerrainDepth();\n    ","\n    vec4 finalColor = texture(tex, vTexCoord) * opacity;\n    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);"])),(0,m.If)(S===o.V.ObjectAndLayerIdColor,"fragColor = vec4(0, 0, 0, 1); return;"))),t}const w=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:M,build:S},Symbol.toStringTag,{value:"Module"}))},30416:(e,t,i)=>{i.d(t,{r:()=>I});var n=i(89379),s=i(88105),a=i(34981),o=i(83490),r=i(59696),l=i(34812),c=i(45463),d=i(60322),u=i(77730),p=i(86994),h=i(66470),m=i(82809),g=i(86401),v=i(63928),_=i(52757),f=i(16506),y=i(59246),M=i(72001),S=i(96643),w=i(29201),P=i(57162);class C extends y.w{constructor(e,t){super(e,t,new f.$(w.I,()=>i.e(48391).then(i.bind(i,48391))),A)}_getPipelineState(e,t){const{oitPass:i,output:n,hasOccludees:s,cullFace:o}=e,r=i===M.Y.NONE;return(0,P.Ey)({blending:(0,a.RN)(n)?r?P.RC:(0,d.ez)(i):null,culling:(0,P.Xt)(o),depthTest:{func:(0,d.K_)(i)},depthWrite:(0,d.z5)(e),drawBuffers:(0,d.m6)(i,n),colorWrite:P.kn,stencilWrite:s?S.v0:null,stencilTest:s?t?S.a9:S.qh:null,polygonOffset:(0,d.mE)(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}const A=new Map([[h.r.POSITION,0],[h.r.UV0,2],[h.r.PERSPECTIVEDIVIDE,3]]);var b=i(35143),D=i(97808),O=i(42717),T=i(6485),x=i(92656);class z extends x.E{constructor(e){super(),this.draped=e,this.cullFace=o.s2.None,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=D.I.None,this.emissionSource=O.ZX.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1,this.snowCover=!1}}(0,b._)([(0,T.W)({count:o.s2.COUNT})],z.prototype,"cullFace",void 0),(0,b._)([(0,T.W)()],z.prototype,"enableOffset",void 0),(0,b._)([(0,T.W)()],z.prototype,"writeDepth",void 0),(0,b._)([(0,T.W)()],z.prototype,"hasOccludees",void 0),(0,b._)([(0,T.W)()],z.prototype,"terrainDepthTest",void 0),(0,b._)([(0,T.W)()],z.prototype,"cullAboveTerrain",void 0),(0,b._)([(0,T.W)()],z.prototype,"perspectiveInterpolation",void 0);class I extends v.W{constructor(e){super(e,H),this.vertexAttributeLocations=A,this.supportsEdges=!0,this.produces=new Map([[u.N.OPAQUE_MATERIAL,e=>(0,a.CL)(e)],[u.N.TRANSPARENT_MATERIAL,e=>(0,a._o)(e)&&this.parameters.writeDepth],[u.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,a._o)(e)&&!this.parameters.writeDepth],[u.N.DRAPED_MATERIAL,e=>(0,a._o)(e)||(0,a.CL)(e)]]),this._configuration=new z(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<d.xt,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new R(e)}createBufferWriter(){let e=g.l5;return this.parameters.perspectiveInterpolation&&(e=e.clone().f32(h.r.PERSPECTIVEDIVIDE)),new L(e)}}class R extends r.A{constructor(e){super((0,n.A)((0,n.A)({},e),e.material.parameters)),this.parameters=e;const t=this._material.parameters.texture;(0,l.y)(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(C,e)}}class L extends m.Z{write(e,t,i,n,a,o){for(const r of this.vertexBufferLayout.fields.keys()){const n=i.get(r);if(n)if(r===h.r.PERSPECTIVEDIVIDE){(0,p.vA)(1===n.size);const e=a.getField(r,s.Y$);e&&(0,_.uO)(n,e,o)}else(0,_.zC)(r,n,e,t,a,o)}return null}}class H extends c.qA{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=o.s2.None,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}},46576:(e,t,i)=>{i.d(t,{T:()=>a});var n=i(29808),s=i(3112);function a(e){const t=new n.n(e);return t.options.store=s.o.MIN,t.options.excludeLabels=!0,t}},56567:(e,t,i)=>{i.d(t,{A:()=>m});var n=i(35143),s=i(23458),a=i(69098),o=i(73582),r=i(42553),l=i(30726),c=i(46053),d=i(21403),u=(i(81806),i(47249),i(85842)),p=i(40565),h=i(19247);let m=class extends(r.A.JSONSupportMixin(a.A)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=s.L.Direct,this.offset=0,this.orientation=0}get valid(){return null!=this.startPoint&&null!=this.endPoint}equals(e){return this===e||(0,l.CM)(this.startPoint,e.startPoint)&&(0,l.CM)(this.endPoint,e.endPoint)&&this.measureType===e.measureType&&this.offset===e.offset&&this.orientation===e.orientation}};(0,n._)([(0,c.MZ)({type:["length"],json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),(0,n._)([(0,c.MZ)({type:h.A,json:{write:{isRequired:!0}}})],m.prototype,"startPoint",void 0),(0,n._)([(0,c.MZ)({type:h.A,json:{write:{isRequired:!0}}})],m.prototype,"endPoint",void 0),(0,n._)([(0,c.MZ)({type:s.h,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"measureType",void 0),(0,n._)([(0,c.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"offset",void 0),(0,n._)([(0,c.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,d.w)(e=>o.ie.normalize((0,p.GB)(e),0,!0))],m.prototype,"orientation",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],m.prototype,"valid",null),m=(0,n._)([(0,u.$)("esri.analysis.LengthDimension")],m)},59962:(e,t,i)=>{i.d(t,{t:()=>d,k:()=>u});const n="theme-style";function s(e,t){return function(e,t){const i=new Image(t,t);return i.src=e,i}(function(e){const t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,".concat(btoa(t))}(a(function(e){const t=e.split(",")[1],i=atob(t);return(new DOMParser).parseFromString(i,"image/svg+xml")}(e),t)),t.size)}function a(e,t){let{accentColor:i,contrastColor:s}=t;const a=i.toHex(),o=i.a,r=s.toHex(),l=s.a,c=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(n);return c&&(c.innerHTML="\n      .contrast-fill { fill: ".concat(r,"; fill-opacity: ").concat(l,"; }\n      .contrast-stroke { stroke: ").concat(r,"; stroke-opacity: ").concat(l,";  }\n      .accent-fill { fill: ").concat(a,"; fill-opacity: ").concat(o,"; }\n      .accent-stroke { stroke: ").concat(a,"; stroke-opacity:  ").concat(o,"; }")),e}const o="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",r="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxjaXJjbGUgY3g9IjM5LjQ3OCIgY3k9IjMuMDc4IiByPSIyOCIgY2xhc3M9ImFjY2VudC1maWxsIiB0cmFuc2Zvcm09InJvdGF0ZSg0MC41NDIpIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI1IiBkPSJtNy4wNzQgMzAuMDUzIDI5LjM5NyAxMS45ODUtMy42NzMtMzMuNDkzIiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSIyLjk5NiIgZD0iTTI0LjUwNCAyMy4yMDdhMTEuOTggMTEuOTggMCAwIDAtOS44IDcuNTA3IiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIGNvbnRyYXN0LWZpbGwiLz48cGF0aCBkPSJtMjkuODE4IDIyLjgwOC02LjE4NCA0LjYtLjU0MS04LjM2NHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+";var l=i(96897);const c=64;function d(e,t){const{accentColor:i,contrastColor:n,preMultiplyAlpha:a}=t;return e.fromData("heading-rotate:[accent:".concat(i,",contrast:").concat(n,",size:").concat(c,"]"),()=>new l.g(s(o,{accentColor:i,contrastColor:n,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:a}))}function u(e,t){const{accentColor:i,contrastColor:n,preMultiplyAlpha:a}=t;return e.fromData("tilt-rotate:[accent:".concat(i,",contrast:").concat(n,",size:").concat(c,"]"),()=>new l.g(s(r,{accentColor:i,contrastColor:n,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:a}))}},68655:(e,t,i)=>{i.d(t,{f:()=>o});var n=i(9392),s=i(29772),a=i(23739);async function o(){return e=await(0,a.V)(),{autoLength2D:t=>{var i;return null!==(i=e.geodesicLength(t))&&void 0!==i?i:(0,s.Xg)(t)},autoDistanceBetweenPoints2D:(t,i)=>{var n;return null!==(n=e.geodesicDistanceBetweenPoints(t,i))&&void 0!==n?n:(0,s.ll)(t,i)},autoDistance2D:(t,i,n)=>{var a;return r[0]=t[0],r[1]=t[1],r[2]=3===t.length?t[2]:0,l[0]=i[0],l[1]=i[1],l[2]=3===i.length?i[2]:0,null!==(a=e.geodesicDistance(r,l,n))&&void 0!==a?a:(0,s.sT)(r,l,n)}};var e}const r=(0,n.vt)(),l=(0,n.vt)()},76609:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Xt});var n=i(35143),s=i(91967),a=i(54901),o=(i(81806),i(76460)),r=i(43927),l=i(30726),c=i(46053),d=(i(47249),i(85842)),u=i(2522),p=i(23458),h=i(68134),m=i(31633),g=i(19747),v=i(15941),_=i(24648),f=i(40565),y=i(34761),M=i(13191),S=i(20664),w=i(9392),P=i(19247),C=i(5568),A=i(75762),b=i(18117),D=i(32535),O=i(25191),T=i(29772),x=i(90659);class z{constructor(e,t,i,n,s,a){this.elevationAlignedStartPoint=e,this.elevationAlignedEndPoint=t,this.directSegment=i,this.dimensionSegment=n,this.primaryOffsetAxis=s,this.spatialReference=a}}const I=(0,f.dp)(P.A);function R(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:s,orientation:a}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,offset:n,measureType:s,orientation:a}}function L(e,t){var i,n,s;let{elevationAlignedStartPoint:a,elevationAlignedEndPoint:o,offset:r,measureType:l,orientation:c}=e,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==a||null==o)return null;const u=k(null!==(i=null===d||void 0===d?void 0:d.directSegment)&&void 0!==i?i:new O.C,{elevationAlignedStartPoint:a,elevationAlignedEndPoint:o},t),h=null!==(n=null===d||void 0===d?void 0:d.primaryOffsetAxis)&&void 0!==n?n:(0,w.vt)();G(h,{measureType:l,elevationAlignedStartPoint:a,elevationAlignedEndPoint:o,directSegment:u,orientation:c,renderCoordsHelper:t});const m=null!==(s=null===d||void 0===d?void 0:d.dimensionSegment)&&void 0!==s?s:new O.C;return B({elevationAlignedStartPoint:a,elevationAlignedEndPoint:o})&&l===p.L.Vertical?((0,S.c)(m.startRenderSpace,u.startRenderSpace),(0,S.c)(m.endRenderSpace,u.endRenderSpace)):U(m,h,r,u,t),new z(a,o,u,m,h,t.spatialReference)}function H(e,t,i,n){return t===Z.Start?((0,S.c)(e.startRenderSpace,i.startRenderSpace),(0,S.c)(e.endRenderSpace,n.startRenderSpace)):((0,S.c)(e.startRenderSpace,i.endRenderSpace),(0,S.c)(e.endRenderSpace,n.endRenderSpace)),e}var Z;function E(e,t,i,n){switch(t){case p.L.Direct:return k(e,i,n);case p.L.Horizontal:case p.L.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,dimension:o,geometry:r}=i;let l;o.measureType===p.L.Direct?(l=function(e,t){const i=e.directSegment.eval(.5,A.rq.get()),n=t.worldUpAtPosition(i,A.rq.get()),s=e.dimensionSegment.eval(.5,A.rq.get()),a=(0,S.a)(A.rq.get(),s,i);return!(0,S.G)(a,w.uY)&&(0,S.e)(a,n)>0}(r,n)===s.z>a.z,t===p.L.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:i}=e.dimensionSegment,{startRenderSpace:n,endRenderSpace:s}=e.directSegment;return(0,S.x)(n,t)<(0,S.x)(s,i)}(r);const[c,d]=l?[s,a]:[a,s],u=(0,D.EL)(d,N);return t===p.L.Horizontal?u.z=c.z:(u.x=c.x,u.y=c.y),n.toRenderCoords(c,e.startRenderSpace),n.toRenderCoords(u,e.endRenderSpace),e}}}function k(e,t,i){return i.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),i.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(Z||(Z={}));const N=(0,b.T)(0,0,0,null);const V=new O.C;function G(e,t){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:a,endRenderSpace:o},directSegment:r,renderCoordsHelper:l}=t,c=r.eval(.5,A.rq.get()),d=l.worldUpAtPosition(c,A.rq.get()),u=l.worldBasisAtPosition(c,C._.Y,A.rq.get());switch(i){case p.L.Horizontal:(0,S.c)(e,d);break;case p.L.Vertical:(0,S.e)(a,d)<(0,S.e)(o,d)?(0,S.a)(e,o,a):(0,S.a)(e,a,o),(0,S.h)(e,e,d),(0,S.h)(e,e,d);break;case p.L.Direct:{var h;const i=null!==(h=t.orientation)&&void 0!==h?h:0;if(B({elevationAlignedStartPoint:n,elevationAlignedEndPoint:s}))(0,y.$0)(j,-(0,v.kU)(i),d),(0,S.t)(e,u,j);else{const t=(0,S.a)(A.rq.get(),o,a),n=(0,S.h)(A.rq.get(),t,d);(0,S.h)(n,n,t),(0,y.$0)(j,(0,v.kU)(i),t),(0,S.t)(e,n,j)}break}}return(0,S.G)(e,w.uY)?(0,S.c)(e,u):(0,S.n)(e,e)}const j=(0,M.vt)();function B(e){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i}=e;return null!=t&&null!=i&&t.x===i.x&&t.y===i.y}function U(e,t,i,n,s){const{startRenderSpace:a,endRenderSpace:o}=n,r=i/s.unitInMeters,[l,c]=function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=(0,S.e)(t,i),a=(0,S.e)(e,i),o=Math.abs(s-a)+n;return s>a?[o,n]:[n,o]}(a,o,t,r);return(0,S.b)(e.startRenderSpace,n.startRenderSpace,t,l),(0,S.b)(e.endRenderSpace,n.endRenderSpace,t,c),e}function q(e,t,i){const n=t.directSegment.eval(.5,A.rq.get());return i.worldUpAtPosition(n,e)}function Y(e,t){const{startRenderSpace:i,endRenderSpace:n}=t.directSegment;return(0,S.a)(e,n,i)}function W(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:n,endRenderSpace:s}=t.dimensionSegment;return i.invert?(0,S.a)(e,n,s):(0,S.a)(e,s,n)}function F(e,t){const i=e.directSegment.eval(.5,A.rq.get());return t.headingAtPosition(i,e.primaryOffsetAxis)}const X=(0,w.vt)();function Q(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i}=e;if(null==t||null==i)return!1;const n=(0,T.Ce)(t,i);return null!=n&&(0,_.kM)(n,"meters").value>x.U7}function $(e){return null!=e.geometry}let J=class extends s.A{constructor(e){super(e)}initialize(){const e=(0,r.L)(()=>this.analysisViewData.computations,e=>{let{computation:t}=e;return this._watchComputation(t)});this.addHandles((0,a.DQ)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,g.c)(this.view)}_watchComputation(e){return(0,h.wB)(()=>R(e),t=>{const{measureType:i}=t;if(Q(t)&&i!==p.L.Direct){const t=Math.round((0,m.oU)(x.U7,"meters","kilometers"));return o.A.getLogger(this).warnOnce("A ".concat(i," dimension in the analysis (id: '").concat(this.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(t,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}const n=L(t,this.view.renderCoordsHelper,e.geometry);e.geometry=n,e.result.length=function(e,t,i,n){if(null==e)return null;let s;if(t===p.L.Horizontal)s=n.autoDistanceBetweenPoints2D(I(e.elevationAlignedStartPoint),I(e.elevationAlignedEndPoint));else{const{startRenderSpace:t,endRenderSpace:i}=e.dimensionSegment;s=(0,T.vp)(t,i,e.spatialReference)}if(null==s)return null;const a=t===p.L.Vertical?(0,m.jE)(s.value,s.unit,i):(0,m.Vs)(s.value,s.unit,i);return(0,_.kM)(s,a)}(n,i,this._defaultUnit,this.automaticLengthMeasurementUtils)},h.pc)}};(0,n._)([(0,c.MZ)({constructOnly:!0})],J.prototype,"analysisViewData",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],J.prototype,"view",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],J.prototype,"automaticLengthMeasurementUtils",void 0),(0,n._)([(0,c.MZ)()],J.prototype,"analysis",null),(0,n._)([(0,c.MZ)()],J.prototype,"_defaultUnit",null),J=(0,n._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionController")],J);var K=i(50176),ee=i(89379),te=i(69539),ie=i(73582),ne=i(76931),se=i(55855),ae=i(13927),oe=i(59784);function re(e){return(0,oe._L)(e.accentColor,.5)}function le(e){return(0,oe.bJ)(e.accentColor)}const ce=new te.A([127,127,127,.5]);var de=i(56121),ue=i(38317),pe=i(91175),he=i(7947),me=i(99443),ge=i(50468),ve=i(17345),_e=i(62577),fe=i(45463),ye=i(66470),Me=i(425),Se=i(17046),we=i(76336);class Pe{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find(t=>this.hasOwnProperty(t)&&e===this[t])}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of p.h)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case p.L.Direct:return this.direct;case p.L.Horizontal:return this.horizontal;case p.L.Vertical:return this.vertical}}}class Ce extends de.q{constructor(e,t){const i=(0,ue.UM)(te.A.toUnitRGBA(re(e.effectiveTheme))),n=[new pe.M((0,_e.CM)(i,1,32,32),Ge)];super({view:e,renderObjects:n,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,h.wB)(()=>({color:te.A.toUnitRGBA(re(e.effectiveTheme))}),e=>i.setParameters(e))}destroy(){this._themeHandle.remove(),super.destroy()}}class Ae extends de.q{constructor(e,t){let{lineSizePt:i,material:n,metadata:s}=t;super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:s}),this._options={calloutColor:(0,se.vt)(),lineSizePt:i,material:n},this._themeHandle=(0,h.wB)(()=>te.A.toUnitRGBA(re(e.effectiveTheme)),e=>{this._options.calloutColor=e,Ve(this,be((0,ee.A)((0,ee.A)({},this._options),{},{metadata:this.metadata})))},h.Vh)}update(e){let{lineSizePt:t,material:i}=e;this._options.lineSizePt=t,this._options.material=i,Ve(this,be((0,ee.A)((0,ee.A)({},this._options),{},{metadata:this.metadata})))}destroy(){this._themeHandle.remove(),super.destroy()}}function be(e){let{calloutColor:t,lineSizePt:i,material:n,metadata:s}=e;return{calloutLength:.25*me.PV*.8*(0,ne.Lz)(i)+18,calloutColor:t,calloutWidth:2,customStateMask:Ge,discScale:.3,focusMultiplier:2,material:n,metadata:s}}function De(e,t){let{computation:i,view:n}=t;return[(0,Se.Xt)(e,(e,t,s)=>{Oe({cancel:s,computation:i,settingHeading:!1,steps:t,view:n})}),e.events.on("immediate-click",e=>{!function(e,t,i){const{dimension:n,geometry:s}=t;if(90===n.orientation||270===n.orientation)return n.orientation=0,void e.stopPropagation();if(null==s)return;const{renderCoordsHelper:a}=i,o=L((0,ee.A)((0,ee.A)({},R(t)),{},{orientation:90}),a),r=L((0,ee.A)((0,ee.A)({},R(t)),{},{orientation:270}),a);if(null==o||null==r)return;const l=F(o,a),c=F(r,a),d=ze(s,i),u=ie.ie.shortestSignedDiff(d,l),p=ie.ie.shortestSignedDiff(d,c);n.orientation=Math.abs(u)<Math.abs(p)?90:270,e.stopPropagation()}(e,i,n)})]}function Oe(e){var t,i;const{cancel:n,computation:s,settingHeading:a,steps:o,view:r}=e;if(!$(s))return;const{renderCoordsHelper:l}=r,{dimension:c,geometry:d}=s,u=(0,w.vt)(),p=He((0,w.vt)(),d,d.directSegment,l),h=Ze(A.rq.get(),{forHeading:a,geometry:d,renderCoordsHelper:l}),m=(0,ae.O_)(p,h,(0,ae.vt)()),g=a?null!==(t=c.orientation)&&void 0!==t?t:F(d,r.renderCoordsHelper):null!==(i=c.orientation)&&void 0!==i?i:0;o.next((0,he.AA)(r,m)).next(e=>{"start"===e.action&&(0,S.c)(u,e.renderStart);const t=(0,ae.Qj)(m),i=(0,ue.FY)(u,e.renderEnd,p,t);let n=g-(0,v.KJ)(i);a||(n=function(e){const t=ie.ie.normalize(e)%90;return t<5?e-t:90-t<5?e+(90-t):e}(n)),c.orientation=n}),n.next((0,Se.VG)(c,["orientation"]))}function Te(e,t){let{computation:i,manipulatorMeasureType:n,view:s}=t,a=p.L.Direct,o=0,r=0;return[e.events.on("grab-changed",t=>{if("start"!==t.action||!$(i))return;const{dimension:l,geometry:c}=i;a=l.measureType,o=l.offset,r=l.orientation;const d=(0,S.c)(A.rq.get(),e.renderLocation);l.measureType=n,l.offset=function(e,t,i,n){const{directSegment:s}=i,a=G(A.rq.get(),{measureType:t,directSegment:s,renderCoordsHelper:n}),o=U(V,a,0,s,n).eval(.5,A.rq.get()),r=(0,S.a)(A.rq.get(),e,o);return(0,S.e)(r,a)*n.unitInMeters}(d,n,c,s.renderCoordsHelper),l.orientation=0}),(0,Se.Xt)(e,(e,t,l)=>{if(!$(i))return;const{geometry:c,dimension:d}=i,{renderCoordsHelper:u}=s,p=E(qe,n,i,u),h=G(A.rq.get(),{measureType:n,directSegment:c.directSegment,renderCoordsHelper:u}),m=(0,he.z7)(e);t.next(m).next(xe(s,d,p,h)),l.next(m).next(e=>(d.measureType=a,d.offset=o,d.orientation=r,e))})]}function xe(e,t,i,n){const s=(0,S.d)(A.rq.get(),i.endRenderSpace,i.startRenderSpace);(0,S.h)(s,s,n);const a=(0,ae.O_)(i.startRenderSpace,s,(0,ae.vt)()),o=(0,ae.O_)(i.startRenderSpace,n,(0,ae.vt)()),r=t.offset;let l,c=0;const d=new Se.rh;return d.next((0,he.AA)(e,a)).next(i=>{"start"===i.action&&(c=(0,ae.mN)(o,i.renderStart));const n=((0,ae.mN)(o,i.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=r+n,l=i}),e=>(d.execute(e),l)}function ze(e,t){const{directSegment:i}=e,{renderCoordsHelper:n}=t,s=q(A.rq.get(),e,n),a=Y(A.rq.get(),e),o=(0,S.h)(A.rq.get(),a,s),{viewForward:r}=t.state.camera;(0,S.e)(o,r)>0&&(0,S.g)(o,o,-1);const l=i.eval(.5,A.rq.get());return n.headingAtPosition(l,o)}function Ie(e,t,i,n){let{forHeading:s}=n;const{dimension:a,geometry:o}=t,{primaryOffsetAxis:r}=o,l=(0,S.g)(Re,r,a.offset>=0?1:-1),c=Ze(Le,{forHeading:s,geometry:o,renderCoordsHelper:i});(0,S.h)(c,c,l);const d=(0,ue.wQ)(l,c,w.uY,Ue);e.modelTransform=d,e.renderLocation=He(je,o,o.dimensionSegment,i)}const Re=(0,w.vt)(),Le=(0,w.vt)();function He(e,t,i,n){const{startRenderSpace:s,endRenderSpace:a}=i,o=function(e,t){const i=Y(Ee,e),n=q(ke,e,t);return(0,S.e)(i,n)>0}(t,n)?s:a;return(0,S.c)(e,o)}function Ze(e,t){let{forHeading:i,geometry:n,renderCoordsHelper:s}=t;return i?q(e,n,s):W(e,n,{invert:!0})}const Ee=(0,w.vt)(),ke=(0,w.vt)();function Ne(e){return(0,ne.Lz)(e)+6}function Ve(e,t){var i,n,s,a,o;const r=t.material,l=null!==(i=t.focusMultiplier)&&void 0!==i?i:ue.eO.focusMultiplier,c=null!==(n=t.calloutLength)&&void 0!==n?n:ue.eO.calloutLength,d=ue.eO.discRadius*(null!==(s=t.discScale)&&void 0!==s?s:1),u=d*l,p=(e,t)=>{const i=[0,1,2,2,3,0];return new ve.V(t,[[ye.r.POSITION,new ge.n([c-e,-e,0,c+e,-e,0,c+e,e,0,c-e,e,0],i,3,!0)],[ye.r.UV0,new ge.n([0,0,1,0,1,1,0,1],i,2,!0)]])},h=null!==(a=t.calloutWidth)&&void 0!==a?a:ue.eO.calloutWidth,m=new Me.W({width:h,color:t.calloutColor,renderOccluded:fe.m$.OccludeAndTransparent,isDecoration:!0}),g=(0,_e.Z8)(m,[[0,0,0],[c-d,0,0]]),v=(0,_e.Z8)(m,[[0,0,0],[c-u,0,0]]),_=null!==(o=t.customStateMask)&&void 0!==o?o:we.SJ.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[c,0,0]},e.focusMultiplier=l,e.metadata=t.metadata,e.radius=d,e.renderObjects=[new pe.M(p(d,r),we.p7.Unfocused|_),new pe.M(g,we.p7.Unfocused|_),new pe.M(p(u,r),we.p7.Focused|_),new pe.M(v,we.p7.Focused|_)]}const Ge=we.SJ.Custom1,je=(0,w.vt)(),Be=(0,w.vt)(),Ue=(0,M.vt)(),qe=new O.C;var Ye,We=i(56567),Fe=i(88321),Xe=i(53084),Qe=i(56002),$e=i(50346),Je=i(19451);function Ke(e,t,i){const{constraint:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,unconstrainedGeometry:o,view:r}=i,{dimension:l,previousConstraint:c,preConstraintProperties:d}=e;if(null==s||null==a)return;const u=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==n)u(),null!=c&&null!=d&&(l.measureType=d.measureType,l.orientation=d.orientation);else switch(l.measureType=p.L.Direct,n){case Ye.Horizontal:if(n!==c&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=a.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=s.z),l.endPoint=e}break;case Ye.Vertical:if(n!==c&&(l.orientation=ze(o,r)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=a.x,e.y=a.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=s.x,e.y=s.y),l.endPoint=e}break;case Ye.Direct:n!==c&&null!=d&&(l.orientation=d.orientation),u()}e.previousConstraint=n,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(Ye||(Ye={}));var et=i(59962),tt=i(70836),it=i(7256),nt=i(85937),st=i(30416),at=i(35925),ot=i(89238),rt=i(974),lt=i(59833),ct=i(13284),dt=i(61237),ut=i(82887),pt=i(14318),ht=i(70330);let mt=class extends s.A{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new Fe.A,this._updatingHandles=new Je.U,this._getSnappingContext=(0,Qe.B)(e=>new ct.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new lt.p(new rt.ZE("point",(0,ot.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new tt.s}));const{view:t}=e;this._snappingManagerResult=(0,ut.X)(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,at.wk)(2)}),this._constraintSnappingIndicator=new it.t({view:t,attached:!0,width:1,renderOccluded:fe.m$.OccludeAndTransparent,stipplePattern:(0,at.wk)(5),isDecoration:!0});const i=te.A.toUnitRGBA(ce);this._stagedStartIndicator=new nt.I({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:i,size:10,outlineSize:0,renderOccluded:fe.m$.OccludeAndTransparent,isDecoration:!0})}initialize(){var e;const{view:t}=this;this._snappingOperation=new pt.O({view:t});const i=re(t.effectiveTheme),n=le(t.effectiveTheme),s=!(null!==(e=t.stage)&&void 0!==e&&e.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._textureHandle=(0,et.t)(t.stage.textures,{accentColor:i,contrastColor:n,preMultiplyAlpha:s}),this._orientationManipulatorMaterial=new st.r({draped:!1,texture:this._textureHandle.texture,writeDepth:!1,renderOccluded:fe.m$.Opaque,isDecoration:!0});const o=(0,r.L)(()=>this.analysisViewData.computations,e=>{let{computation:t}=e;return this._createManipulators(t)});this.addHandles([(0,h.wB)(()=>({accentColor:re(t.effectiveTheme),contrastColor:le(t.effectiveTheme)}),e=>{let{accentColor:i,contrastColor:n}=e;const a=this._textureHandle;this._textureHandle=(0,et.t)(t.stage.textures,{accentColor:i,contrastColor:n,preMultiplyAlpha:s}),this._orientationManipulatorMaterial.setParameters({texture:this._textureHandle.texture}),null===a||void 0===a||a.release();const o=te.A.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:o}),this._focusedOffsetManipulatorMaterial.setParameters({color:o}),this._thinOffsetManipulatorMaterial.setParameters({color:o}),this._constraintSnappingIndicator.color=o},h.Vh),(0,a.DQ)(o),(0,h.wB)(()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation}),e=>{let{stagedPoint:t,stagedComputation:i}=e;if(null==i||null==t)return;const n=(0,D.EL)(t,new P.A);this._applyPointUpdate(i,{endPoint:n})},h.OH),(0,h.wB)(()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}),(e,t)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:s}=e;if(i===(null===t||void 0===t?void 0:t.stagedDimension)&&s===(null===t||void 0===t?void 0:t.firstGrabbedManipulator)){for(const a of[n,null===t||void 0===t?void 0:t.selectedComputation])if(null!=a){const t=this._computationManipulators.get(a);null!=t&&this._updateManipulators(a,t,e)}}else for(const[a,o]of this._computationManipulators)this._updateManipulators(a,o,e)},h.pc),(0,h.wB)(()=>this.analysis.style.lineSize,e=>this._updateManipulatorStyle(e),h.Vh),(0,h.wB)(()=>this.view.state.camera,()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)}),(0,h.wB)(()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,i=(0,w.vt)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,i)?i:null},e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1})]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,ht.BY)(this,()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){var i;const e=null!==(i=this.view.inputManager.latestPointerType)&&void 0!==i?i:"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,$e.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,t)))}if(null!=e){const{start:t,end:i}=this._computationManipulators.get(e);if(t.grabbing||i.grabbing){!function(e,t,i){let{constraint:n,view:s}=i;const{unconstrainedGeometry:a}=e;if(null==a)return;const{renderCoordsHelper:o,spatialReference:r}=s,{startRenderSpace:l,endRenderSpace:c}=a.directSegment,d=o.fromRenderCoords(l,new P.A({spatialReference:r})),u=o.fromRenderCoords(c,new P.A({spatialReference:r}));let p;p="start"===t?{startPoint:d}:{endPoint:u},Ke(e,p,{constraint:n,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:a,view:s})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}})}destroy(){this._textureHandle=(0,l.Gz)(this._textureHandle),this._snappingOperation=(0,l.pR)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){var e;const t=this._stagedDimension,i=null===(e=this.analysisViewData.computations.at(-1))||void 0===e?void 0:e.computation;return null==t||null==i||i.dimension!==t?null:i}get _constraintHandles(){return[(0,h.z7)(()=>this.analysisViewData.selectedComputation,e=>{e.previousConstraint=this._computeConstraint(e)},(0,ee.A)((0,ee.A)({},h.pc),{},{equals:Xe.aI})),(0,h.wB)(()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:i}=e.dimension;return{measureType:t,orientation:i,computation:e}},(e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:i,computation:n}=e;switch(n.previousConstraint){case Ye.Horizontal:n.preConstraintProperties={measureType:p.L.Horizontal,orientation:0};break;case Ye.Vertical:n.preConstraintProperties={measureType:p.L.Vertical,orientation:0};break;case Ye.Direct:n.preConstraintProperties={measureType:p.L.Direct,orientation:i};break;default:n.preConstraintProperties={measureType:t,orientation:i}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)},h.OH)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,h.wB)(()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation}),t=>{let{stagedComputation:i,activeComputation:n}=t;const s=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=n)if(n===i)s.attached=!0;else{const{start:t,end:i}=this._computationManipulators.get(n),a=()=>{s.attached=t.grabbing||i.grabbing};a(),this.addHandles([t.events.on("grab-changed",a),i.events.on("grab-changed",a)],e)}else s.attached=!1}),(0,h.wB)(()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}},e=>{let{geometry:t,constraint:i}=e;const n=this._constraintSnappingIndicator;null!=t&&null!=i&&i!==Ye.Direct?(n.visible=!0,n.setGeometryFromSegment(t.directSegment)):n.visible=!1})]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove(e){let{mapPoint:t,pointerType:i}=e;if("touch"===i)return;const n=this._getSnappingContext(i);this._updatingHandles.addPromise((0,$e.QZ)(this._snappingOperation.snap({point:t},this._snappingManager,n)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(e){let{mapPoint:t,pointerType:i}=e,n=t;if("mouse"===i){const e=this._getSnappingContext(i);n=this._snappingManager.update({point:t,context:e})}const s=new We.A({startPoint:(0,D.EL)(n,new P.A),endPoint:null,measureType:p.L.Horizontal});return this._stagedDimension=s,this._resetSnappingState(),s}_onStagedClick(e){let{mapPoint:t,pointerType:i}=e;const n=this._stagedComputation;if(null==n)return;let s=t;if("mouse"===i){const e=this._getSnappingContext(i);s=this._snappingManager.update({point:t,context:e})}const a=(0,D.EL)(s,new P.A);this._applyPointUpdate(n,{endPoint:a}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),i=this._setupPointManipulator(e,{isStart:!1}),n=this._setupOffsetManipulator(e),s=this._setupHeadingManipulator(e),o=this._setupRotationManipulator(e),r=this._setupMeasureTypeManipulator(e,p.L.Direct),l=this._setupMeasureTypeManipulator(e,p.L.Horizontal),c=this._setupMeasureTypeManipulator(e,p.L.Vertical),d=new Pe({start:t,end:i,offset:n,heading:s,rotation:o,direct:r,horizontal:l,vertical:c});this._setupComputationToManipulatorsSync(e,d),this._computationManipulators.set(e,d),this.manipulators.addMany(d.values());const u=(0,a.vE)(d.values().map(e=>e.events.on("focus-changed",()=>{d.values().some(e=>e.focused)&&this._resetSnappingState()})));return{manipulators:d,remove:()=>{u.remove(),this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of d.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,h.wB)(()=>e.geometry,()=>this._updateManipulators(e,t),(0,ee.A)((0,ee.A)({},h.pc),{},{equals:Xe.aI}))],e)}_setupPointManipulator(e,t){const{view:i}=this,{dimension:n}=e,s=new Ce(i,{metadata:n}),a=function(e,t){let{isStart:i,createSnappingPipelineStep:n,dimension:s,onUpdate:a,view:o}=t;const r=i?"startPoint":"endPoint",l=(0,Se.Xt)(e,(e,t,i,l)=>{const c=(0,he.z7)(e),{snappingStep:d,cancelSnapping:u}=n(l);i=i.next(c).next((0,Se.VG)(s,[r,"measureType","orientation"])).next(u),t.next(c).next((0,he.xk)(o)).next(...d).next(e=>{const t=(0,D.EL)(e.mapEnd,new P.A);a("startPoint"===r?{startPoint:t}:{endPoint:t})})});return[l]}(s,{isStart:t.isStart,createSnappingPipelineStep:e=>(0,dt.L)({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:n,onUpdate:t=>this._applyPointUpdate(e,t),view:i});return this._computationHandles.add(a,e),s}_setupOffsetManipulator(e){const{view:t}=this,i=function(e,t){const i=[(0,w.fA)(-.5,0,0),(0,w.fA)(.5,0,0)],n=(0,_e.Z8)(t.unfocusedMaterial,i.map(e=>(0,S.g)((0,w.vt)(),e,.5))),s=n.instantiate({material:t.focusedMaterial});return new de.q((0,ee.A)({view:e,renderObjects:[new pe.M(n,we.p7.Unfocused|we.p7.Selected|Ge),new pe.M(s,we.p7.Focused|Ge)],collisionType:{type:"line",paths:[i]},radius:Ne(t.lineSizePt)/2,metadata:t.metadata,available:!1},ue.MO))}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),n=function(e,t){let{computation:i,view:n}=t;return[(0,Se.Xt)(e,(e,t,s)=>{if(!$(i)||!e.selected)return;const{geometry:a,dimension:o}=i,r=(0,he.z7)(e);t.next(r).next(xe(n,o,a.dimensionSegment,a.primaryOffsetAxis)),s.next(r).next((0,Se.VG)(o,["offset"]))})]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupHeadingManipulator(e){const{view:t}=this,i=new Ae(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=function(e,t){let{computation:i,view:n}=t;return[(0,Se.Xt)(e,(e,t,s)=>{Oe({cancel:s,computation:i,settingHeading:!0,steps:t,view:n})})]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupRotationManipulator(e){const{view:t}=this,i=new Ae(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=De(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupMeasureTypeManipulator(e,t){const{view:i}=this,n=function(e,t){const i=[(0,w.fA)(-.5,0,0),(0,w.fA)(.5,0,0)],n=(0,_e.Z8)(t.thinOffsetManipulatorMaterial,i),s=(0,_e.Z8)(t.unfocusedMaterial,i.map(e=>(0,S.g)((0,w.vt)(),e,.5))),a=s.instantiate({material:t.focusedMaterial});return new de.q((0,ee.A)({view:e,renderObjects:[new pe.M(s,we.p7.Unfocused|Ge),new pe.M(a,we.p7.Focused|Ge),new pe.M(n,Ge)],collisionType:{type:"line",paths:[i]},radius:Ne(t.lineSizePt)/2,available:!1,metadata:t.metadata},ue.MO))}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),s=Te(n,{computation:e,manipulatorMeasureType:t,view:i});return this._computationHandles.add(s,e),n}_updateManipulators(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:a}=i,{start:o,end:r,offset:l,heading:c,rotation:d}=t,u=s===e,h=$(e),{dimension:m}=e;for(const p of t.values()){const e=h&&null==n&&(null==a||p===a);p===l?(p.available=e,p.selected=u):p.available=e&&u}if(!h)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator(e=>e.available=!1):t.manipulatorForMeasureType(m.measureType).available=!1;for(const _ of[c,d])m.measureType===p.L.Direct&&0!==m.offset||(_.available=!1);B(e)?d.available=!1:c.available=!1;const{geometry:g}=e;o.renderLocation=g.directSegment.startRenderSpace,r.renderLocation=g.directSegment.endRenderSpace;const{renderCoordsHelper:v}=this.view;(function(e,t,i){const{dimensionSegment:n,primaryOffsetAxis:s}=t,a=W(je,t),o=(0,S.q)(a,w.uY)?(0,y.D_)(Ue):(0,ue.wQ)(a,s,w.uY,Ue),r=Math.max((0,S.l)(a),.1/i.unitInMeters);(0,y.hs)(o,o,(0,S.i)(je,r,r,r)),e.modelTransform=o,e.renderLocation=n.eval(.5,je)})(l,g,v),c.available&&function(e,t,i){Ie(e,t,i,{forHeading:!0})}(c,e,v),d.available&&function(e,t,i){Ie(e,t,i,{forHeading:!1})}(d,e,v),t.forEachMeasureTypeManipulator((t,i)=>{t.available&&function(e,t,i,n){const{geometry:s}=t,a=E(qe,i,t,n),o=G(je,{measureType:i,directSegment:s.directSegment,renderCoordsHelper:n}),r=(0,S.a)(Be,a.endRenderSpace,a.startRenderSpace),l=(0,ue.wQ)(r,o,w.uY,Ue),c=(0,S.l)(r);(0,y.hs)(l,l,(0,S.i)(Be,c,c,c)),e.modelTransform=l,e.renderLocation=a.eval(.5,Be)}(t,e,i,v)})}_updateManipulatorStyle(e){const t=function(e){return(0,ne.Lz)(e)+4}(e),i=Ne(e),n={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:s,heading:a,rotation:o}of this._computationManipulators.values())s.radius=i/2,a.update(n),o.update(n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_applyPointUpdate(e,t){const{view:i}=this,n=R(e);"startPoint"in t&&(n.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(n.elevationAlignedEndPoint=t.endPoint);const s=L(n,i.renderCoordsHelper);if(null==s)return;const a=this._computeConstraint((0,ee.A)((0,ee.A)({},n),{},{geometry:s}));Ke(e,t,(0,ee.A)((0,ee.A)({},n),{},{constraint:a,unconstrainedGeometry:s,view:i})),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,gt);const{state:t,renderCoordsHelper:i}=this.view,n=t.camera.computeScreenPixelSizeAt(gt);e.dimension.offset=50*n*i.unitInMeters}_computeConstraint(e){return function(e,t){if(Q(e))return Ye.Direct;if(!e.enabled)return null;const{geometry:i}=e;if(null==i||(0,S.q)(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{camera:n}=t.state,s=q(A.rq.get(),i,t.renderCoordsHelper),a=Y(A.rq.get(),i),o=(0,S.g)(A.rq.get(),s,(0,S.e)(a,s)),r=(0,S.d)(A.rq.get(),a,o),l=(0,S.k)(r),c=(0,S.k)(o),{startRenderSpace:d,endRenderSpace:u}=i.directSegment,p=Math.max(10*n.computeScreenPixelSizeAt(d),10*n.computeScreenPixelSizeAt(u))**2;return l<p?Ye.Vertical:c<p?Ye.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new Me.W({width:1,renderOccluded:fe.m$.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get test(){}};(0,n._)([(0,c.MZ)({constructOnly:!0})],mt.prototype,"analysis",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],mt.prototype,"analysisViewData",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],mt.prototype,"manipulators",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],mt.prototype,"parentTool",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],mt.prototype,"view",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],mt.prototype,"updating",null),(0,n._)([(0,c.MZ)()],mt.prototype,"firstGrabbedManipulator",null),(0,n._)([(0,c.MZ)()],mt.prototype,"hasGrabbedManipulators",null),(0,n._)([(0,c.MZ)()],mt.prototype,"snappingOptions",null),(0,n._)([(0,c.MZ)()],mt.prototype,"_stagedDimension",void 0),(0,n._)([(0,c.MZ)()],mt.prototype,"_activeComputation",null),(0,n._)([(0,c.MZ)()],mt.prototype,"_stagedComputation",null),mt=(0,n._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],mt);const gt=(0,w.vt)();var vt,_t=i(5109),ft=i(82307),yt=i(46576),Mt=i(11500);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(vt||(vt={}));let St=class extends _t.k{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._placementMode=wt,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,yt.T)(this.view.state.viewingMode),this._lengthDimensionSubTool=new mt({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,a.DQ)(this._lengthDimensionSubTool),(0,a.hA)(()=>this._clearPointerMoveTimeout()),(0,h.z7)(()=>this.state===vt.Created,()=>this.finishToolCreation(),h.pc),(0,h.z7)(()=>this.firstGrabbedManipulator,e=>{this.selectedDimension=e.metadata},h.pc),(0,h.wB)(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),h.pc)])}get state(){return this.analysis.dimensions.some(e=>"length"===e.type)?null!=this._activeSubTool?vt.Creating:vt.Created:vt.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}place(e){this.selectedDimension=null,this._placementMode=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":this._keyDownHandler(e)}}onActivate(){this._placementMode=wt,this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){var e;null!==(e=this._activeSubTool)&&void 0!==e&&e.onDeactivate(),this._activeSubTool=null}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),this.selectedDimension&&"single"===this._placementMode&&(this.view.activeTool=null),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_keyDownHandler(e){var t,i;ft.NE.cancel===e.key?(null!==(t=this._activeSubTool)&&void 0!==t&&t.removeStaged()&&"multiple"===this._placementMode&&e.stopPropagation(),this.active||(this.selectedDimension=null)):ft.NE.delete.includes(e.key)&&(null!==(i=this._activeSubTool)&&void 0!==i&&i.removeStaged(),this._removeSelected())}_intersectScreen(e){const t=(0,Mt.sC)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const i=this._intersector.results.min,n=A.rq.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,new P.A({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.xt)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach(e=>e.manipulator.state|=Ge),this._prevPointerMoveTimeout=K.p.setTimeout(()=>{this.manipulators.forEach(e=>e.manipulator.state&=~Ge)},this._pointerMoveTimerMs)}get test(){}};(0,n._)([(0,c.MZ)({constructOnly:!0})],St.prototype,"view",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],St.prototype,"analysis",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],St.prototype,"state",null),(0,n._)([(0,c.MZ)({readOnly:!0})],St.prototype,"updating",null),(0,n._)([(0,c.MZ)({readOnly:!0})],St.prototype,"cursor",null),(0,n._)([(0,c.MZ)({constructOnly:!0})],St.prototype,"analysisViewData",void 0),(0,n._)([(0,c.MZ)()],St.prototype,"selectedDimension",null),(0,n._)([(0,c.MZ)()],St.prototype,"automaticManipulatorSelection",void 0),(0,n._)([(0,c.MZ)()],St.prototype,"_activeSubTool",void 0),(0,n._)([(0,c.MZ)()],St.prototype,"_lengthDimensionSubTool",void 0),(0,n._)([(0,c.MZ)()],St.prototype,"_placementMode",void 0),St=(0,n._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionTool")],St);const wt="multiple";i(11265);var Pt=i(11113),Ct=i(66747),At=i(28608),bt=i(32314),Dt=i(70667),Ot=i(60561);class Tt extends bt.X{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=fe.m$.OccludeAndTransparent,this._width=1,this._color=(0,At.fA)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const i=e.endRenderSpace;this.transform=(0,y.kN)(xt,i),this._normal=t;const{points:n}=e.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.renderOccluded)&&void 0!==e?e:this._renderOccluded}set renderOccluded(e){var t;this._renderOccluded=e,null===(t=this._material)||void 0===t||t.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.width)&&void 0!==e?e:this._width}set width(e){var t;this._width=e,null===(t=this._material)||void 0===t||t.setParameters({width:e})}get color(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.color)&&void 0!==e?e:this._color}set color(e){var t;this._color=(0,At.o8)(e),null===(t=this._material)||void 0===t||t.setParameters({color:this._color})}get placement(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.placement)&&void 0!==e?e:this._placement}set placement(e){var t;this._placement=e,null===(t=this._material)||void 0===t||t.setParameters({placement:this._placement})}get markerPrimitive(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.markerPrimitive)&&void 0!==e?e:this._markerPrimitive}set markerPrimitive(e){var t;this._markerPrimitive=e,null===(t=this._material)||void 0===t||t.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new Ot.i({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,Dt.z)(this.geometry,this.normal)){const i=(0,Dt.t)(this._material,t);e.addGeometry(i)}}forEachMaterial(e){this._hasExternalMaterial||e(this._material)}}const xt=(0,M.vt)();class zt{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new Fe.A,this._messages=null,this._labelSegment=new O.C;const{analysis:t,computation:i,view:n,messages:s,isDecoration:a}=e;this.analysis=t,this.computation=i,this.view=n,this._messages=s;const o=e.visible,r={view:n,attached:o,isDecoration:a},{fontSize:l,textColor:c,textBackgroundColor:d}=t.style;this._visualElements=new Ht({marker:new Tt(r,e.markerMaterial),dimension:new it.t(r,e.dimensionLineMaterial),startOffset:new it.t(r,e.offsetLineMaterial),endOffset:new it.t(r,e.offsetLineMaterial),dimensionSmall:new it.t(r,e.smallDimensionLineMaterial),startOffsetSmall:new it.t(r,e.smallOffsetLineMaterial),endOffsetSmall:new it.t(r,e.smallOffsetLineMaterial),label:new Ct.N({view:n,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,ne.Lz)(l),textColor:c.clone(),backgroundColor:d.clone(),isDecoration:a})}),this._handles.add([(0,h.wB)(()=>i.geometry,e=>{this.updateCameraDependentElements(n.state.camera,e,t.style),null!=i.geometry&&this._updateLines(i.geometry)},(0,ee.A)((0,ee.A)({},h.Vh),{},{equals:Xe.aI})),(0,h.wB)(()=>i.length,e=>this._updateLabelContent(e),h.Vh)])}destroy(){this.destroyed=!0,this._handles=(0,l.pR)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){}_updateLines(e){const t=H(It,Z.Start,e.directSegment,e.dimensionSegment),i=H(Rt,Z.End,e.directSegment,e.dimensionSegment),n=this._visualElements;n.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),n.dimension.setGeometryFromSegment(e.dimensionSegment),n.startOffset.setGeometryFromSegment(t),n.endOffset.setGeometryFromSegment(i),n.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),n.startOffsetSmall.setGeometryFromSegment(t),n.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(e,t,i){const n=this._visualElements;if(null==t){for(const e of n.values())e.visible=!1;return}const s=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Lt)),a=function(e,t){return(0,S.k)(W(X,e))/t**2}(t,s),o=a<(2*(0,ne.Lz)(i.lineSize))**2,r=!o;n.marker.visible=r,n.dimension.visible=r,n.startOffset.visible=r,n.endOffset.visible=r,n.dimensionSmall.visible=o,n.startOffsetSmall.visible=o,n.endOffsetSmall.visible=o;const l=5*(0,ne.Lz)(i.fontSize),{label:c}=n;if(c.visible=a>=l**2,!c.visible)return;const{dimensionSegment:d,primaryOffsetAxis:u}=t,{offset:p}=this.computation.dimension,h=(Math.sign(p)>=0?1:-1)*function(e){return 1.5*(0,ne.Lz)(e.fontSize)+20+(0,ne.Lz)(e.lineSize/2)}(i)*s;(function(e,t,i,n){(0,S.b)(e.startRenderSpace,t.startRenderSpace,i,n),(0,S.b)(e.endRenderSpace,t.endRenderSpace,i,n)})(this._labelSegment,d,u,h),c.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,ne.Lz)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,Pt.zJ)(this._messages,e,e.unit):t.text=""}}const It=new O.C,Rt=new O.C,Lt=(0,w.vt)();class Ht{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Zt=i(50125),Et=i(38042),kt=i(63860);let Nt=class extends s.A{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new Ot.i({width:1,anchor:Zt.kJ.Tip,color:se.uY,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:fe.m$.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new Me.W({width:1,color:se.uY,renderOccluded:fe.m$.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new Me.W({width:1,color:se.uY,renderOccluded:fe.m$.OccludeAndTransparent,stipplePattern:(0,at.wk)(5),isDecoration:e}),this._smallDimensionLineMaterial=new Me.W({width:1,color:se.uY,renderOccluded:fe.m$.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new Me.W({width:1,color:se.uY,renderOccluded:fe.m$.OccludeAndTransparent,stipplePattern:(0,at.wk)(5),isDecoration:e});const t=(0,r.L)(()=>this.analysisViewData.computations,e=>{let{computation:t}=e;return this._createVisualization(t)});this._dimensionVisualizations=t,this.addHandles([(0,a.DQ)(t),(0,h.wB)(()=>te.A.toUnitRGBA(this.analysis.style.color),e=>{for(const t of this._lineMaterials())t.setParameters({color:e})},h.pc),(0,h.wB)(()=>this.analysis.style.lineSize,e=>{const t=(0,ne.Lz)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const i=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:i})},h.pc),(0,h.wB)(()=>({camera:this.view.state.camera,style:Vt(this.analysis)}),e=>{let{camera:t,style:i}=e;for(const{visualization:n}of this._dimensionVisualizations)n.updateCameraDependentElements(t,n.computation.geometry,i),n.updateLabelStyle(i)}),(0,h.wB)(()=>this.visible,e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e})]),this.addHandles([(0,Et.oQ)(()=>this._updateMessageBundle()),(0,h.z7)(()=>!this.loadingMessages,()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)},h.OH)]),this._updateMessageBundle()}get testInfo(){}_createVisualization(e){const t=new zt({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,kt.ud)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Vt(e){const{fontSize:t,lineSize:i,textColor:n,textBackgroundColor:s}=e.style;return{fontSize:t,lineSize:i,textBackgroundColor:s.clone(),textColor:n.clone()}}(0,n._)([(0,c.MZ)({constructOnly:!0})],Nt.prototype,"analysisViewData",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],Nt.prototype,"view",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],Nt.prototype,"isDecoration",void 0),(0,n._)([(0,c.MZ)()],Nt.prototype,"analysis",null),(0,n._)([(0,c.MZ)()],Nt.prototype,"visible",null),(0,n._)([(0,c.MZ)()],Nt.prototype,"loadingMessages",void 0),Nt=(0,n._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Nt);var Gt=i(53986);let jt=class extends s.A{constructor(e){super(e),this.dimension=null,this.length=null}};(0,n._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],jt.prototype,"dimension",void 0),(0,n._)([(0,c.MZ)()],jt.prototype,"length",void 0),jt=(0,n._)([(0,d.$)("esri.views.analysis.LengthDimensionResult")],jt);const Bt=["dimension"];let Ut=class extends s.A{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t}=e,i=(0,Gt.A)(e,Bt);return(0,ee.A)({result:new jt({dimension:t})},i)}initialize(){this.addHandles([(0,h.wB)(()=>this.dimension.startPoint,e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e),h.pc),(0,h.wB)(()=>this.dimension.endPoint,e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e),h.pc)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,n._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],Ut.prototype,"result",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],Ut.prototype,"projectAndAlignPoint",void 0),(0,n._)([(0,c.MZ)()],Ut.prototype,"dimension",null),(0,n._)([(0,c.MZ)()],Ut.prototype,"length",null),(0,n._)([(0,c.MZ)()],Ut.prototype,"geometry",void 0),(0,n._)([(0,c.MZ)()],Ut.prototype,"unconstrainedGeometry",void 0),(0,n._)([(0,c.MZ)()],Ut.prototype,"elevationAlignedStartPoint",void 0),(0,n._)([(0,c.MZ)()],Ut.prototype,"elevationAlignedEndPoint",void 0),(0,n._)([(0,c.MZ)()],Ut.prototype,"preConstraintProperties",void 0),(0,n._)([(0,c.MZ)()],Ut.prototype,"previousConstraint",void 0),Ut=(0,n._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionComputation")],Ut);var qt=i(17430),Yt=i(10260),Wt=i(68655);let Ft=class extends((0,u.P)(s.A)){constructor(e){super(e),this.type="dimension-view-3d",this.analysis=null,this.tool=null,this.selectedDimension=null,this.userOperation=null,this._dimensionsToComputations=new Map,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:i}=this.view,n=(0,qt.B)(e,t,i);return null==n&&(0,qt.V)(this.analysis,e.spatialReference,o.A.getLogger(this)),n};const e=(0,r.L)(()=>this.analysis.dimensions,e=>this._createComputation(e));this.computations=e,this.addHandles([(0,Yt.Hd)(this,St),(0,a.DQ)(e)]),this._analysisVisualization=new Nt({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this.addResolvingPromise((0,Wt.f)().then(e=>{this._analysisController=new J({analysisViewData:this,view:this.view,automaticLengthMeasurementUtils:e})}))}destroy(){this.userOperation=(0,l.DC)(this.userOperation),(0,Yt.aS)(this),this._analysisVisualization=(0,l.pR)(this._analysisVisualization)}get updating(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}get results(){return this.analysis.dimensions.map(e=>this._dimensionsToComputations.get(e).result)}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){}async createLengthDimensions(e){this.selectedDimension=null,await(0,Yt.ZX)(this,{placementOptions:e,onToolActivated:e=>e.place("multiple")})}place(e){return this.selectedDimension=null,(0,Yt.ZX)(this,{placementOptions:e,onToolActivated:e=>e.place("single")})}_createComputation(e){const{_dimensionsToComputations:t}=this,i=new Ut({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,i),{computation:i,remove:()=>this._removeComputation(i)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,n._)([(0,c.MZ)({readOnly:!0})],Ft.prototype,"type",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],Ft.prototype,"analysis",void 0),(0,n._)([(0,c.MZ)()],Ft.prototype,"tool",void 0),(0,n._)([(0,c.MZ)()],Ft.prototype,"updating",null),(0,n._)([(0,c.MZ)({readOnly:!0})],Ft.prototype,"results",null),(0,n._)([(0,c.MZ)()],Ft.prototype,"computations",void 0),(0,n._)([(0,c.MZ)()],Ft.prototype,"selectedDimension",void 0),(0,n._)([(0,c.MZ)()],Ft.prototype,"selectedComputation",null),(0,n._)([(0,c.MZ)()],Ft.prototype,"userOperation",void 0),(0,n._)([(0,c.MZ)()],Ft.prototype,"_analysisVisualization",void 0),(0,n._)([(0,c.MZ)()],Ft.prototype,"_analysisController",void 0),(0,n._)([(0,c.MZ)()],Ft.prototype,"_dimensionsToComputations",void 0),Ft=(0,n._)([(0,d.$)("esri.views.3d.analysis.DimensionAnalysisView3D")],Ft);const Xt=Ft},85937:(e,t,i)=>{i.d(t,{I:()=>v});var n=i(89379),s=i(20664),a=i(9392),o=i(43047),r=i(55855),l=i(32314),c=i(49296),d=i(44815),u=i(67425);var p=i(83490),h=i(62577),m=i(45463),g=i(50115);class v extends l.X{constructor(e){super(e),this.view=null,this._renderOccluded=m.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,r.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,r.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,o.a)(e,this._color)||((0,o.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,o.a)(e,this._outlineColor)||((0,o.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,i,n,s){const a=(0,d.jh)(3*e.length),o=(0,d.jh)(a.length);e.forEach((e,t)=>{a[3*t]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0});const r=(0,u.au)(a,t,0,o,0,a,0,a.length/3,i,n,s),l=null!=r;return{numVertices:e.length,position:a,mapPositions:o,projectionSuccess:l,sampledElevation:r}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,c.F.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,a=t.position;for(let o=0;o<n;++o){const e=(0,s.i)(_,a[3*o],a[3*o+1],a[3*o+2]),t=f(this._vertexMaterial,.5,e),n=f(this._vertexOutlineMaterial,.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:n})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of t)e.addGeometry(i),e.addGeometry(n)}createExternalResources(){this._vertexMaterial=new g.A((0,n.A)((0,n.A)({},this._vertexMaterialParameters),{},{writeDepth:!0,cullFace:p.s2.Back,screenSizeEnabled:!0})),this._vertexOutlineMaterial=new g.A((0,n.A)((0,n.A)({},this._vertexOutlineMaterialParameters),{},{forceTransparentMode:!0,writeDepth:!0,cullFace:p.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const _=(0,a.vt)();function f(e,t,i){return(0,h.CM)(e,t,16,16,{offset:i})}}}]);
//# sourceMappingURL=76609.850a9548.chunk.js.map