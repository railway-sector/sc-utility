"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[9912],{9912:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>ee,createFieldInfoMap:()=>W,findRelatedLayer:()=>fe,findUtilityNetwork:()=>ce,fixTokens:()=>z,formatAttributes:()=>ne,formatEditInfo:()=>K,formatValueToFieldInfo:()=>P,getAllFieldInfos:()=>X,getFieldFormat:()=>E,getFieldInfo:()=>B,getFieldInfoLabel:()=>q,getFixedFieldName:()=>R,getFixedFieldNames:()=>j,getSourceLayer:()=>C,graphicCallback:()=>L,htmlEntities:()=>$,isAssociatedFeatureSupportedLayer:()=>V,isExpressionField:()=>k,isFeatureSupportedLayer:()=>H,isGraphicForRelatableFeatureSupportedLayer:()=>J,isRelatableFeatureSupportedLayer:()=>_,isRelatableLayer:()=>Q,isRelatedField:()=>le,isSupportedContext:()=>Z,preLayerQueryCallback:()=>se,preRequestCallback:()=>de,querySourceLayer:()=>ie,queryUpdatedFeature:()=>re,shouldOpenInNewTab:()=>x,substituteAttributes:()=>D,substituteFieldsInLinksAndAttributes:()=>S});var i=n(89379),r=n(81806),l=n(76460),o=n(88685),a=n(65256),u=n(50265),s=n(94890),d=n(53430),f=n(31933),c=n(42633),p=n(76386),y=n(67478);const m=()=>l.A.getLogger("esri.widgets.Feature.support.featureUtils"),v=/href=(""|'')/gi,g=/(\{([^{\r\n]+)\})/g,I=/'/g,b=/^\s*expression\//i,h=/(\n)/gi,F=/[\u00A0-\u9999<>&]/gim,T=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,w=/^(?:mailto:|tel:)/,N="relationships/",A=(0,a.J2)("short-date-short-time");function C(e){var t;if(null!=e)return null!==(t=e.sourceLayer||e.layer)&&void 0!==t?t:void 0}async function L(e){let{type:t,value:n,event:i}=e;try{return"function"==typeof n?n(i):await n}catch(r){return void m().error("error",'An error occurred when calling the "'.concat(t,'" function'),{error:r,graphic:i.graphic,value:n})}}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!w.test(e.trim().toLowerCase())}function k(e){return!!e&&b.test(e)}function Z(e){let{fieldInfo:t,graphic:n}=e;return!(null===t||void 0===t||!t.fieldName||k(t.fieldName)||le(t.fieldName)||null!==n&&void 0!==n&&n.isAggregate||null!==n&&void 0!==n&&n.popupTemplate)}function q(e){let{expressionInfos:t,fieldInfo:n,graphic:i,isContentFieldInfos:r,layer:l}=e;if(null===n||void 0===n||!n.fieldName)return null;const o=function(e,t){if(!t||!k(t)||!e)return;const n=t.replace(b,"").toLowerCase();return e.find(e=>{let{name:t}=e;return t.toLowerCase()===n})}(t,n.fieldName);if(o)return o.title||null;if((0,f.jy)(l)&&Z({fieldInfo:n,graphic:i})){const e=l.getFieldAlias(n.fieldName);return r?n.label||e||n.fieldName:e||n.fieldName}return n.label||n.fieldName}function E(e){let{fieldInfo:t,isContentFieldInfos:n,layer:i}=e;if(null===t||void 0===t||!t.fieldName)return null;if((0,f.jy)(i)){var r;const e=i.popupTemplate||i.fieldConfigurations?null===(r=i.getFieldConfiguration(t.fieldName))||void 0===r?void 0:r.fieldFormat:(0,s.iu)(t,i.getField(t.fieldName));return n&&t.fieldFormat||e}return null}function R(e,t){const n=U(t,e);return n?n.name:e}function j(e,t){return e&&e.map(e=>R(e,t))}function U(e,t){var n;return e&&"function"==typeof e.getField&&t&&null!==(n=e.getField(t))&&void 0!==n?n:null}function M(e){return"".concat(e).trim()}function S(e){let{attributes:t,globalAttributes:n,layer:r,text:l,expressionAttributes:o,fieldInfoMap:a}=e;return l?D({formattedAttributes:n,template:G(l,(0,i.A)((0,i.A)((0,i.A)({},n),o),t),r),fieldInfoMap:a}):""}function D(e){let{formattedAttributes:t,template:n,fieldInfoMap:i}=e;return M(function(e){return e.replaceAll(v,"")}((0,o.HC)((0,o.HC)(n,e=>function(e,t){const n=t.get(e.toLowerCase());return"{".concat((null===n||void 0===n?void 0:n.fieldName)||e,"}")}(e,i)),t)))}function O(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,i.A)({},e);return Object.keys(n).forEach(e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t[e];if("string"==typeof i){const r="%27",l=(n?encodeURIComponent(i):i).replaceAll(I,r);t[e]=l}}(e,n,t)),n}function z(e,t){return e.replaceAll(g,(e,n,i)=>{const r=U(t,i);return r?"{".concat(r.name,"}"):n})}function G(e,t,n){const i=z(e,n);return i?i.replaceAll(T,(e,n,i)=>function(e,t,n){const i=(t=M(t))&&!t.startsWith("{");return(0,o.HC)(e,O(n,i||!1))}(e,n||i,t)):i}function H(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function Q(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function _(e){return H(e)&&Q(e)}function V(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function J(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&_(e.sourceLayer)}function P(e,t){const{fieldInfos:n,fieldName:r,graphic:l,isContentFieldInfos:o,layer:a,preventPlacesFormatting:s,timeZone:p}=t,y=B(n,r),m=U(a,r),v=(0,f.jy)(a)&&Z({fieldInfo:y,graphic:l}),g=v?null:null===y||void 0===y?void 0:y.format,I=v?E({fieldInfo:y,layer:a,isContentFieldInfos:o}):null,b="number"===(null===I||void 0===I?void 0:I.type);if(y&&!(0,d.JL)(r)){const t=null===m||void 0===m?void 0:m.type,n="date-time"===(null===I||void 0===I?void 0:I.type),i=null===g||void 0===g?void 0:g.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n||i)return(0,c.i0)(e,{format:n?void 0:i,fieldFormat:n?I:void 0,fieldType:t,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:p,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}})}if("string"==typeof e&&(0,d.JL)(r)&&g)return function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?Y(e,",",", ",t):e.includes(";")?Y(e,";","; ",t):e.includes(" ")?Y(e," "," ",t):(0,u.ZV)(Number(e),(0,u.yx)(t))}(e,g);if("string"==typeof(e=function(e,t){var n;const i="number"===(null===t||void 0===t||null===(n=t.fieldFormat)||void 0===n?void 0:n.type)||(null===t||void 0===t?void 0:t.format)&&null==t.format.dateFormat&&(null!=t.format.places||null!=t.format.digitSeparator);if("string"==typeof e&&i){const t=Number(e);if(!isNaN(t))return t}return e}(e,{format:b?void 0:g,fieldFormat:b?I:void 0}))||null==e||null==g&&null==I)return ee(e);const h=b?(0,u.Up)(I):g?(0,u.yx)(g):void 0;return(0,u.ZV)(e,s?(0,i.A)((0,i.A)({},h),{},{minimumFractionDigits:0,maximumFractionDigits:20}):h)}function Y(e,t,n,i){return e.trim().split(t).map(e=>(0,u.ZV)(Number(e),(0,u.yx)(i))).join(n)}function B(e,t){if(null!==e&&void 0!==e&&e.length&&t)return e.find(e=>{var n;return(null===(n=e.fieldName)||void 0===n?void 0:n.toLowerCase())===t.toLowerCase()})}function K(e,t,n,r){const{creatorField:l,creationDateField:o,editorField:u,editDateField:s}=e;if(!t)return;const d=(0,y.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,n,A,"date"),f=(0,i.A)((0,i.A)({},A),d),c=t[s];if("number"==typeof c){const e=t[u];return{type:"edit",date:(0,a.Yq)(c,f),user:e}}const p=t[o];if("number"==typeof p){const e=t[l];return{type:"create",date:(0,a.Yq)(p,f),user:e}}return null}function W(e,t){const n=new Map;if(!e)return n;for(const i of e){if(!i.fieldName)continue;const e=R(i.fieldName,t);i.fieldName=e,n.set(e.toLowerCase(),i)}return n}function X(e){const t=[];if(!e)return t;const{fieldInfos:n,content:i}=e;return n&&t.push(...n),i&&Array.isArray(i)?(i.forEach(e=>{if("fields"===e.type){const n=null===e||void 0===e?void 0:e.fieldInfos;n&&t.push(...n)}}),t):t}function $(e){return e.replaceAll(F,e=>"&#".concat(e.charCodeAt(0),";"))}function ee(e){return"string"==typeof e?e.replaceAll(h,'<br class="esri-text-new-line" />'):e}function te(e){var t;const{fieldInfoMap:n,fieldInfos:i,fieldName:l,graphic:o,isContentFieldInfos:a,layer:u,timeZone:s,value:f}=e;if(null==f)return"";const p=function(e){let{fieldName:t,value:n,graphic:i,layer:l}=e;if(le(t))return null;if(!l||"function"!=typeof l.getFieldDomain)return null;const o=i&&l.getFieldDomain(t,{feature:i,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return o&&"coded-value"===o.type?o.getName(n):null}({fieldName:l,value:f,graphic:o,layer:u});if(p)return p;const y=function(e){let{fieldName:t,graphic:n,layer:i}=e;if(le(t))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const l=i.getFeatureType(n);return l?l.name:null}({fieldName:l,graphic:o,layer:u});if(y)return y;if(n.get(l.toLowerCase()))return P(f,{fieldInfos:i||Array.from(n.values()),fieldName:l,graphic:o,isContentFieldInfos:a,layer:u,timeZone:s});const m=null===u||void 0===u||null===(t=u.fieldsIndex)||void 0===t?void 0:t.get(l);return m&&((0,c.fs)(m)||(0,d.OH)(m))?(0,c.i0)(f,{fieldType:m.type,timeZoneOptions:{layerTimeZone:u&&"preferredTimeZone"in u?u.preferredTimeZone:null,viewTimeZone:s,datesInUnknownTimezone:!(!u||!("datesInUnknownTimezone"in u))&&!!u.datesInUnknownTimezone}}):ee(f)}function ne(e){let{attributes:t,fieldInfoMap:n,fieldInfos:i,graphic:r,isContentFieldInfos:l,layer:o,relatedInfos:a,timeZone:u}=e;const s={};return null!==a&&void 0!==a&&a.forEach(e=>function(e){var t,n;let{attributes:i,relatedInfo:r,fieldInfoMap:l,fieldInfos:o,layer:a,timeZone:u}=e;i&&r&&(null!==(t=r.relatedFeatures)&&void 0!==t&&t.forEach(e=>oe({attributes:i,graphic:e,relatedInfo:r,fieldInfoMap:l,fieldInfos:o,layer:a,timeZone:u})),null===(n=r.relatedStatsFeatures)||void 0===n||n.forEach(e=>oe({attributes:i,graphic:e,relatedInfo:r,fieldInfoMap:l,fieldInfos:o,layer:a,timeZone:u})))}({attributes:s,relatedInfo:e,fieldInfoMap:n,fieldInfos:i,layer:o,timeZone:u})),t&&Object.keys(t).forEach(e=>{const a=t[e];s[e]=te({fieldInfoMap:n,fieldInfos:i,fieldName:e,graphic:r,isContentFieldInfos:l,layer:o,timeZone:u,value:a})}),s}async function ie(e,t){var n;const{layer:i,graphic:r,outFields:l,objectIds:o,returnGeometry:a,spatialReference:u}=e,s=o[0];if("number"!=typeof s&&"string"!=typeof s){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:r,objectId:s,requiredFields:l};return m().warn(e,t),null}if(null===(n=(0,f.BR)(i))||void 0===n||null===(n=n.operations)||void 0===n||!n.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:i,graphic:r,requiredFields:l,returnGeometry:a};return m().warn(e,t),null}const d=i.createQuery();return d.objectIds=o,d.outFields=null!==l&&void 0!==l&&l.length?l:[i.objectIdField],d.returnGeometry=!!a,d.returnZ=!!a,d.returnM=!!a,d.outSpatialReference=u,(await i.queryFeatures(d,t)).features[0]}async function re(e,t){var n;let{graphic:r,popupTemplate:l,layer:o,spatialReference:a}=e;if(!o||!l)return;if("function"==typeof o.load&&await o.load(t),!r.attributes)return;const u=o.objectIdField,s=r.attributes[u];if(null==s)return;const f=[s],c=new Set(await l.getRequiredFields(o.fieldsIndex));null==(null===(n=o.timeInfo)||void 0===n?void 0:n.trackIdField)||c.has(o.timeInfo.trackIdField)||await async function(e){var t;if(null===(t=e.expressionInfos)||void 0===t||!t.length)return!1;const n=await(0,p.l)(),{arcadeUtils:{requiresTrack:i}}=n;return i(e)}(l)&&c.add(o.timeInfo.trackIdField);const y=(0,d.Kl)(r,c),m=y?[]:c.has(u)?[...c]:[...c,u],v=l.returnGeometry||await async function(e){var t;if(null===(t=e.expressionInfos)||void 0===t||!t.length)return!1;const n=await(0,p.l)(),{arcadeUtils:{hasGeometryFunctions:i}}=n;return i(e)}(l);if(y&&!v)return;const g=await ie({layer:o,graphic:r,outFields:m,objectIds:f,returnGeometry:v,spatialReference:a},t);g&&(g.geometry&&(r.geometry=g.geometry),g.attributes&&(r.attributes=(0,i.A)((0,i.A)({},r.attributes),g.attributes)))}function le(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(N)}function oe(e){let{attributes:t,graphic:n,relatedInfo:i,fieldInfos:r,fieldInfoMap:l,layer:o,timeZone:a}=e;t&&n&&i&&Object.keys(n.attributes).forEach(e=>{const u=function(e){return e?"".concat(N).concat(e.layerId,"/").concat(e.fieldName):""}({layerId:i.relation.id.toString(),fieldName:e}),s=n.attributes[e];t[u]=te({fieldName:u,fieldInfos:r,fieldInfoMap:l,layer:o,value:s,graphic:n,timeZone:a})})}const ae=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ue=e=>{var t;let{layer:n,method:i,query:r,definitionExpression:l}=e;if(null===(t=n.capabilities)||void 0===t||null===(t=t.query)||void 0===t||!t.supportsCacheHint||"attachments"===i)return;const o=null!=r.where?r.where:null,a=null!=r.geometry?r.geometry:null;ae(l)||ae(o)||"extent"===(null===a||void 0===a?void 0:a.type)||"tile"===r.resultType||(r.cacheHint=!0)},se=e=>{var t;let{query:n,layer:i,method:r}=e;ue({layer:i,method:r,query:n,definitionExpression:"".concat(i.definitionExpression," ").concat(null!==(t=i.serviceDefinitionExpression)&&void 0!==t?t:"")})},de=e=>{var t;let{queryPayload:n,layer:i,method:r}=e;ue({layer:i,method:r,query:n,definitionExpression:"".concat(i.definitionExpression," ").concat(null!==(t=i.serviceDefinitionExpression)&&void 0!==t?t:"")})};function fe(e,t,n){var i,r;return e&&t&&n?"sublayer"===t.type?ye({layers:null===(i=t.layer)||void 0===i?void 0:i.allSublayers,map:e,relatedLayer:t,relationship:n})||ye({layers:null===(r=t.layer)||void 0===r?void 0:r.subtables,map:e,relatedLayer:t,relationship:n}):ye({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||ye({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function ce(e,t){var n;return e&&"utilityNetworks"in e&&t?null===(n=e.utilityNetworks)||void 0===n?void 0:n.find(e=>e.isUtilityLayer(t)):null}function pe(e,t){return null===e||void 0===e?void 0:e.allTables.find(e=>{var n;return"feature"===e.type&&e.layerId===t.id&&e.url===(null===(n=t.layer)||void 0===n?void 0:n.url)})}function ye(e){let{map:t,relationship:n,relationship:{relatedTableId:i},relatedLayer:r,layers:l}=e;if(!l)return null;for(const a of l){var o;if("map-image"===a.type){const e=ye({layers:a.sublayers,map:t,relatedLayer:r,relationship:n})||ye({layers:a.subtables,map:t,relatedLayer:r,relationship:n});if(e)return e;continue}if(!_(a))continue;if("sublayer"===r.type){if(a!==r&&a.id===i)return a.isTable?pe(t,a):a;continue}const e="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!e)return null;if("sublayer"!==a.type){if(a!==r&&a.url===e&&a.layerId===i)return a}else if(a!==r&&(null===(o=a.layer)||void 0===o?void 0:o.url)===e&&a.id===i)return a.isTable?pe(t,a):a}return null}}}]);
//# sourceMappingURL=9912.52fb1858.chunk.js.map