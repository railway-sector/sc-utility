"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[59031],{33680:(e,t,r)=>{r.d(t,{z:()=>g});var n=r(6326),i=r(91967),o=r(76460),l=r(50346),s=r(68134),a=r(46053),d=r(87990),u=r(19451);const c=e=>{const t=e;let r=class extends t{constructor(){super(...arguments),this._updatingHandles=new u.U,this._numUpdating=0}get updating(){return this._numUpdating>0||this._updatingHandles.updating}destroy(){this._updatingHandles.destroy()}autoUpdateAsync(e,t){const r=(0,l.sg)(async t=>{++this._numUpdating;try{const r=await t;this.destroyed||this._set(e,r)}catch(r){o.A.getLogger(this).warn('Async update of "'.concat(String(e),'" failed. Async update functions should not throw exceptions.'))}--this._numUpdating});return this._updatingHandles.add(t,r,s.Vh)}};return(0,n.Cg)([(0,a.MZ)()],r.prototype,"_updatingHandles",void 0),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],r.prototype,"updating",null),(0,n.Cg)([(0,a.MZ)()],r.prototype,"_numUpdating",void 0),r=(0,n.Cg)([(0,d.$)("esri.core.AsyncUpdate")],r),r};c(i.A);r(81806),r(47249);var f=r(53430);let g=class extends(c(i.A)){get layer(){return this.layerView.layer}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:t},rendererFields:r,labelingFields:n,viewFilterFields:i}=this;return(0,f.DB)(e,[...null!==t&&void 0!==t?t:[],...null!==r&&void 0!==r?r:[],...null!==n&&void 0!==n?n:[],...null!==i&&void 0!==i?i:[]])}constructor(e){super(e)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",async()=>{const{fieldsIndex:e,renderer:t}=this.layer;return t?this._getFieldsAsync(r=>t.collectRequiredFields(r,e)):null}),this.autoUpdateAsync("labelingFields",async()=>{const{layer:e}=this;return e.labelsVisible?this._getFieldsAsync(t=>(0,f.Im)(t,e)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const{layer:e,mergedFilter:t}=this.layerView;return this._getFieldsAsync(r=>(0,f.o)(r,e,t))})])}async _getFieldsAsync(e){const t=new Set;try{return await e(t),Array.from(t).sort()}catch(r){return o.A.getLogger(this).error(r),null}}};(0,n.Cg)([(0,a.MZ)()],g.prototype,"layerView",void 0),(0,n.Cg)([(0,a.MZ)()],g.prototype,"layer",null),(0,n.Cg)([(0,a.MZ)()],g.prototype,"requiredFields",null),(0,n.Cg)([(0,a.MZ)()],g.prototype,"rendererFields",void 0),(0,n.Cg)([(0,a.MZ)()],g.prototype,"labelingFields",void 0),(0,n.Cg)([(0,a.MZ)()],g.prototype,"viewFilterFields",void 0),g=(0,n.Cg)([(0,d.$)("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],g)},38229:(e,t,r)=>{r.d(t,{p:()=>i});var n=r(53430);function i(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return e.outFields?(0,n.DB)(t,[...(0,n.hL)(t,e.outFields),...r]):(0,n.DB)(t,r)}}}}},58698:(e,t,r)=>{r.d(t,{R:()=>a});var n=r(6326),i=r(50076),o=(r(76460),r(81806),r(47249),r(87990)),l=r(53430),s=r(2257);const a=e=>{const t=e;let r=class extends t{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:r}=t;if(!r)throw new i.A("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t});if(!(0,s.D8)(t,e))throw new i.A("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeaturesFromGraphics(e,t){if(this._validateFetchPopupFeatures(t),0===e.length)return[];const r="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;let n=[];"fieldsIndex"in this.layer&&(n=(0,l.hL)(this.layer.fieldsIndex,await(0,s.TO)(r,(0,s.D8)(this.layer,t)))),await this.prepareFetchPopupFeatures(n);const i=new Set,o=[],a=[];for(const s of e)(0,l.Q1)(s,n,i)?a.push(s):o.push(s);if(0===a.length)return o;const d=new Map;for(let l=0;l<e.length;l++){var u;d.set(null!==(u=e[l].getObjectId())&&void 0!==u?u:0,l)}const c=await this.whenGraphicAttributes(a,[...i]).catch(()=>a).then(e=>o.concat(e));return c.sort((e,t)=>{var r,n,i,o;const l=null!==(r=e.getObjectId())&&void 0!==r?r:0,s=null!==(n=d.get(l))&&void 0!==n?n:0,a=null!==(i=t.getObjectId())&&void 0!==i?i:0;return s-(null!==(o=d.get(a))&&void 0!==o?o:0)}),c}};return r=(0,n.Cg)([(0,o.$)("esri.views.3d.layers.support.PopupSceneLayerView")],r),r}},74294:(e,t,r)=>{r.d(t,{Eu:()=>c,bh:()=>a,r0:()=>f,ry:()=>g});var n=r(98773),i=r(53084),o=r(49723),l=r(74438);const s={setAttribute(){},rollback(){},commit(){}};function a(e,t){const r=t.attributes[e.objectIdField];if(null==r)return s;const n=e.sessions.get(r);if(n)return n;const o=(0,i.o8)(t.attributes),l=new Set,a=e.i3sOverrides.createInteractiveEditSession(r),d=new Map,u=(e,t)=>{const n=d.get(e);if(null==n){const n=t.indexOf(r);return d.set(e,n),n}return n};let c=0;const f={setAttribute(r,n){if(0!==c)return;const i=e.fieldsIndex.get(r);if(!i)return;const s=e.attributeStorageInfo.findIndex(e=>e.name===i.name);if(s<0)return;if(!(r in o))throw new Error('Attribute "'.concat(r,'" is not an attribute of the edited feature.'));a.setAttribute(s,n);const d=e.attributeStorageInfo[s];let f=!1;l.add(r),e.forEachNode((r,i)=>{const o=u(r,i);if(-1===o)return;const l=e.getAttributeData(r.index);if(l){const i=l[d.name];i&&(i[o]=n,e.setAttributeData(r.index,l,t),f=!0)}}),f&&e.clearMemCache()},rollback(){if(0===c){for(const e of l)this.setAttribute(e,o[e]);a.remove(),c=1,e.sessions.delete(r)}},commit(){0===c&&(a.remove(),c=2,e.sessions.delete(r))}};return e.sessions.set(r,f),f}function d(e,t,r){var n;const{gidToFeatureInfo:i,oidToFeatureInfo:o,fieldsIndex:l,objectIdField:s,globalIdField:a,featureOrIdentifierList:d}=r;if(!r.featuresResolved&&null!=d){for(const e of d){var u;const t={feature:null,oid:-1,gid:null};if("attributes"in e){t.feature=e;const r=e.attributes;if(null!=r)for(const e in r){var c;if(-1!==t.oid&&null!=t.gid)break;const n=l.normalizeFieldName(e);n===s&&(t.oid=null!==(c=r[e])&&void 0!==c?c:-1),n===a&&(t.gid=r[e])}}else t.oid=null!==(u=e.objectId)&&void 0!==u?u:-1,t.gid=e.globalId;null!=t.gid&&i.set(t.gid,t),-1!==t.oid&&o.set(t.oid,t)}r.featuresResolved=!0}return null!==(n=-1!==e?o.get(e):null)&&void 0!==n?n:null!=t?i.get(t):null}function u(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=[],a={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==r,fieldsIndex:e.fieldsIndex,objectIdField:e.objectIdField,globalIdField:e.globalIdField,featureOrIdentifierList:r};for(const g of t){var u,c,f;if(null!=g.error)continue;const e=null!==(u=g.objectId)&&void 0!==u?u:-1,t=g.globalId,r=null!==(c=-1===e||l?d(e,t,a):null)&&void 0!==c?c:{feature:null,oid:e,gid:t},p={oid:-1===e?r.oid:e,gid:null!==t&&void 0!==t?t:r.gid,feature:r.feature,result:g};s.push(p);const h=p.gid?(0,o.AG)(p.gid):null;if(-1===p.oid&&null!=h&&null!=i&&(p.oid=null!==(f=i.get(h))&&void 0!==f?f:-1),-1===p.oid&&null!=h){let e=n.get(h);null==e&&(e={gid:p.gid,edits:[]},n.set(h,e)),e.edits.push(p)}}return s}async function c(e,t){var r,i,s;const a=new Map,d=u(e,t.addedFeatures,null===(r=t.edits)||void 0===r?void 0:r.addFeatures,a),c=u(e,t.updatedFeatures,null===(i=t.edits)||void 0===i?void 0:i.updateFeatures,a),f=u(e,t.deletedFeatures,null===(s=t.edits)||void 0===s?void 0:s.deleteFeatures,a,t.globalIdToObjectId,!1);return a.size>0&&await async function(e,t){const r=e.i3sOverrides.layer.associatedLayer;if(null==(null===r||void 0===r?void 0:r.globalIdField))return;const i=r.createQuery(),{objectIdField:s,globalIdField:a}=r;i.where=Array.from(t.values()).map(e=>{let{gid:t}=e;return"".concat(a,"='").concat(t,"'")}).join(" OR "),i.returnGeometry=!1,i.outFields=[s,a],i.cacheHint=!1;const d=await(0,n.DZ)((0,l.SE)(r,i));if(!d.ok)return;const u=d.value.features;for(const n of u){const e=n.attributes[a],r=n.attributes[s];if(null==e||null==r||-1===r)continue;const i=t.get((0,o.AG)(e));if(null!=i)for(const t of i.edits)t.oid=r}}(e,a),{adds:d.filter(e=>-1!==e.oid),updates:c.filter(e=>-1!==e.oid),deletes:f.filter(e=>-1!==e.oid)}}function f(e,t){const r=new Map,n=e=>{for(const{oid:t,feature:n}of e){const e=null===n||void 0===n?void 0:n.geometry;"mesh"===(null===e||void 0===e?void 0:e.type)&&r.set(t,e)}};n(t.adds),n(t.updates);for(const i of t.deletes)r.set(i.oid,null);for(const[i,o]of r)e.i3sOverrides.updateGeometry(i,o)}function g(e,t){var r;const n=function(e,t){const r=t.updates;if(!r||0===r.length)return new y;const n=new y,i=new Map;for(let o=0;o<e.attributeStorageInfo.length;o++)i.set(e.attributeStorageInfo[o].name,o);return e.forEachNode((t,i)=>{for(const o of r){if(null==o.feature)continue;const r=o.feature,l=o.oid,s=i.indexOf(l);for(const i in r.attributes){const o=e.fieldsIndex.normalizeFieldName(i),a=p(n,t.index,o),d=r.attributes[i];a.push({featureIndex:s,featureId:l,value:d})}}}),n}(e,t),i=function(e,t){const r=new Map,n=t.adds;if(!n||0===n.length||null==e.globalIdField)return r;for(const o of n){var i;const e=o.oid,t=o.feature;"mesh"===(null===t||void 0===t||null===(i=t.geometry)||void 0===i?void 0:i.type)&&r.set(e,t)}return r}(e,t);if(0===n.size&&0===i.size)return;const o=new Map;for(let g=0;g<e.attributeStorageInfo.length;g++)o.set(e.attributeStorageInfo[g].name,g);let l=!1;n.forEach((t,r)=>{const n=e.getAttributeData(r);let i=!1;t.forEach((t,r)=>{const s=null!=n?n[r]:null,a=o.get(r);for(const{featureIndex:n,value:o,featureId:d}of t)s&&(s[n]=o,i=!0,l=!0),e.i3sOverrides.updateAttributeValue(d,a,o)}),i&&e.setAttributeData(r,n,null)}),l&&e.clearMemCache();const{fieldsIndex:s,i3sOverrides:a,objectIdField:d,globalIdField:u}=e,c=null===(r=a.layer.associatedLayer)||void 0===r?void 0:r.infoFor3D,f=new Set(c?[...Object.values(c.assetMapFieldRoles),...Object.values(c.transformFieldRoles)]:[]);for(const[g,p]of i){a.featureAdded(g);const{attributes:e}=p;for(const t in e){if(t!==d&&t!==u&&f.has(t))continue;const r=s.normalizeFieldName(t),n=null!=r?o.get(r):null;if(null==n)continue;const i=e[t];a.updateAttributeValue(g,n,i)}}}function p(e,t,r){const n=function(e,t){const r=e.get(t);if(r)return r;const n=new h;return e.set(t,n),n}(e,t),i=null!=r&&n.get(r);if(i)return i;const o=new Array;return n.set(r,o),o}const h=Map,y=Map},82558:(e,t,r)=>{r.d(t,{A:()=>p});var n=r(6326),i=r(18690),o=r(76460),l=r(30726),s=r(53596),a=r(50346),d=r(68134),u=r(46053),c=(r(81806),r(87990)),f=r(56611),g=r(91196);let p=class extends g.A{constructor(){super(...arguments),this.layer=null,this.filter=null,this._geometryOperators=null,this._projectionEngineLoaded=!1,this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return(0,s.w$)(this._layerFilter)}get _layerFilter(){var e;const t=null===(e=this.layer)||void 0===e?void 0:e.filter;if(null==t||t.geometries.length<1)return null;if(!this._geometryOperators||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return s.J7;const[r,n,l]=this._geometryOperators,a=t.geometries.at(0).spatialReference,d=t.geometries.toArray().map(e=>{let t;try{t=n.execute(e)}catch(r){return o.A.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(!t)return null;if(t.spatialReference.equals(a))return t;try{return(0,f.project)(t,a)}catch(r){return o.A.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),null}}).filter(i.Ru).sort((e,t)=>e.extent.xmin-t.extent.xmin),u=new Set,c=new Array,g=new Array;for(let i of d){const e=i.extent.xmin;if(c.length=0,u.forEach(t=>{if(e>=t.extent.xmax)return g.push(t),void u.delete(t);i.extent.ymin<=t.extent.ymax&&i.extent.ymax>=t.extent.ymin&&r.execute(i,t)&&c.push(t)}),c.length>0){let e;c.push(i);try{e=l.executeMany(c)}catch(p){o.A.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}c.pop(),e&&(c.forEach(e=>u.delete(e)),i=e)}u.add(i)}return u.forEach(e=>g.push(e)),g.length>0?{spatialRelationship:t.spatialRelationship,geometries:g}:null}get _filterNeedsProjectionEngine(){const e=this.layer.filter;if(null==e||e.geometries.length<=1)return!1;const t=e.geometries.at(0).spatialReference;return e.geometries.some(e=>{let{spatialReference:r}=e;return!r.equals(t)&&!(0,f.canProjectWithoutEngine)(r,t)})}get layerFilterUpdating(){return(0,s.DS)(this._layerFilter)}initialize(){const{signal:e}=this._abortController;(0,d.C_)(()=>{var e;return this.destroyed||!this._geometryOperators&&(null===(e=this.layer)||void 0===e||null===(e=e.filter)||void 0===e||null===(e=e.geometries)||void 0===e?void 0:e.length)},e).then(async()=>{(0,a.QP)(e),this._geometryOperators=await Promise.all([Promise.all([r.e(26871),r.e(16364),r.e(56175),r.e(48045),r.e(96483)]).then(r.bind(r,38165)),Promise.all([r.e(26871),r.e(16364),r.e(56175),r.e(48045),r.e(8264)]).then(r.bind(r,8264)),Promise.all([r.e(26871),r.e(16364),r.e(56175),r.e(48045),r.e(71660)]).then(r.bind(r,71660))])}).catch(a.jH),this._projectionEngineLoaded=(0,f.isLoaded)(),(0,d.C_)(()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine,e).then(async()=>{(0,a.QP)(e),await(0,f.load)(),this._projectionEngineLoaded=!0}).catch(a.jH)}destroy(){this._abortController=(0,l.DC)(this._abortController)}highlight(e,t){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}};(0,n.Cg)([(0,u.MZ)()],p.prototype,"layer",void 0),(0,n.Cg)([(0,u.MZ)()],p.prototype,"availableFields",null),(0,n.Cg)([(0,u.MZ)()],p.prototype,"maximumNumberOfFeatures",null),(0,n.Cg)([(0,u.MZ)({readOnly:!0})],p.prototype,"maximumNumberOfFeaturesExceeded",null),(0,n.Cg)([(0,u.MZ)()],p.prototype,"filter",void 0),(0,n.Cg)([(0,u.MZ)({readOnly:!0})],p.prototype,"layerFilter",null),(0,n.Cg)([(0,u.MZ)({readOnly:!0})],p.prototype,"_layerFilter",null),(0,n.Cg)([(0,u.MZ)()],p.prototype,"_geometryOperators",void 0),(0,n.Cg)([(0,u.MZ)()],p.prototype,"_projectionEngineLoaded",void 0),(0,n.Cg)([(0,u.MZ)()],p.prototype,"_filterNeedsProjectionEngine",null),(0,n.Cg)([(0,u.MZ)()],p.prototype,"layerFilterUpdating",null),p=(0,n.Cg)([(0,c.$)("esri.views.layers.SceneLayerView")],p)}}]);
//# sourceMappingURL=59031.a810c669.chunk.js.map