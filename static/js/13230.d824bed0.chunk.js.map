{"version":3,"file":"static/js/13230.d824bed0.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/3d/layers/support/SublayerPopupHighlightHelper3D.js","../node_modules/@arcgis/core/views/3d/layers/support/ImageHighlightHelper3D.js","../node_modules/@arcgis/core/views/3d/layers/MapImageLayerView3D.js","../node_modules/@arcgis/core/layers/support/timeSupport.js","../node_modules/@arcgis/core/support/timeUtils.js","../node_modules/@arcgis/core/views/layers/MapImageLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import i from\"../../../../core/Accessor.js\";import{destroyHandle as r}from\"../../../../core/handleUtils.js\";import{when as t,watch as s,initial as p,syncAndInitial as o}from\"../../../../core/reactiveUtils.js\";import{property as h}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{ImageHighlightHelper3D as l}from\"./ImageHighlightHelper3D.js\";import{MapServiceLayerViewHelper as c}from\"../../../layers/support/MapServiceLayerViewHelper.js\";import{createQueryGeometry as g}from\"../../../support/drapedUtils.js\";let d=class extends i{constructor(e){super(e)}initialize(){this._highlightHelper=new l({layer:this.layerView.layer,view:this.view,updatingHandles:this.updatingHandles}),this._mapServiceLayerViewHelper=new c({createFetchPopupFeaturesQueryGeometry:(e,i)=>g(e,i,this.view),layerView:this.layerView,updatingHandles:this.updatingHandles,highlightGraphics:this._highlightHelper.graphics,highlightGraphicUpdated:e=>this._highlightHelper.graphicsView?.graphicChanged(e)}),this.addHandles([r(this._mapServiceLayerViewHelper),t((()=>this.view?.stationary),(()=>this._mapServiceLayerViewHelper.updateHighlightedFeatures(this.view.resolution)),p),s((()=>this.layerView.suspended),(e=>this._highlightHelper.suspended=e),o)])}fetchPopupFeaturesAtLocation(e,i){return this._highlightHelper.preload(),this._mapServiceLayerViewHelper.fetchPopupFeaturesAtLocation(e,i)}highlight(e,i){return this._highlightHelper.highlight(e,i)}};e([h()],d.prototype,\"view\",void 0),e([h()],d.prototype,\"layerView\",void 0),e([h()],d.prototype,\"updatingHandles\",void 0),d=e([a(\"esri.views.3d.layers.support.SublayerPopupHighlightHelper3D\")],d);export{d as SublayerPopupHighlightHelper3D};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Color.js\";import i from\"../../../../core/Accessor.js\";import{isSome as s}from\"../../../../core/arrayUtils.js\";import{makeHandle as r,destroyHandle as o}from\"../../../../core/handleUtils.js\";import{watch as h,syncAndInitial as p}from\"../../../../core/reactiveUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{initializeProjection as c,project as n}from\"../../../../geometry/projectionUtils.js\";import{GraphicsCollection as g}from\"../../../../support/GraphicsCollection.js\";import m from\"../../../../symbols/SimpleFillSymbol.js\";import u from\"../../../../symbols/SimpleLineSymbol.js\";import d from\"../../../../symbols/SimpleMarkerSymbol.js\";import{getHighlightGraphics as y}from\"../../../layers/support/highlightUtils.js\";let w=class extends i{get updating(){return this.graphicsView?.updating??!1}constructor(t){super(t),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new g,this.graphicsView=null,this.suspended=!1;const i=new e([255,255,255,1/255]);this._symbols=new Map([[\"point\",new d({size:\"2px\",style:\"square\",color:i})],[\"polyline\",new u({width:\"2px\",color:i})],[\"polygon\",new m({outline:null,color:i})]])}highlight(t,e){const i=y(t);if(0===i.length)return r();let s,o=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then((([t,i])=>{!o&&i&&(s=this._addHighlightGraphics(i,t,e))}))),r((()=>{o=!0,s?.remove()}))}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(t,e,i){for(const r of e)this._highlightCounts.set(r,(this._highlightCounts.get(r)??0)+1);this.graphics.addMany(e);const s=t.highlight(e,i);return r((()=>{this._removeHighlightGraphics(e),s.remove()}))}_removeHighlightGraphics(t){this.graphics.removeMany(t.filter((t=>{const e=Math.max(0,(this._highlightCounts.get(t)??0)-1);return 0===e?(this._highlightCounts.delete(t),!0):(this._highlightCounts.set(t,e),!1)})))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=import(\"../GraphicsView3D.js\"));const{default:t}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new t({view:this.view,layer:this.layer,getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set(\"graphicsView\",e),this.addHandles([o(this.graphicsView),h((()=>this.suspended),(t=>{e.suspended=t}),p)]),e}async _createHighlightGraphics(t){const e=t.map((({geometry:t})=>t?.spatialReference)).filter(s).reduce(((t,e)=>(0!==t.length&&t.at(-1)?.equals(e)||t.push(e),t)),[]),i=this.view.spatialReference,r=e.map((t=>({source:t,dest:i})));try{await c(r)}catch{return[]}return t.map((t=>{const{geometry:e}=t;try{const s=e?n(e,i):null,r=t.cloneShallow();return r.geometry=s,r.symbol=this._symbols.get(s?.type),r}catch{return t}}))}};t([a()],w.prototype,\"graphics\",void 0),t([a()],w.prototype,\"graphicsView\",void 0),t([a()],w.prototype,\"view\",void 0),t([a()],w.prototype,\"layer\",void 0),t([a()],w.prototype,\"updatingHandles\",void 0),t([a()],w.prototype,\"suspended\",void 0),t([a()],w.prototype,\"updating\",null),w=t([l(\"esri.views.3d.layers.support.ImageHighlightHelper3D\")],w);export{w as ImageHighlightHelper3D};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{destroyHandle as t}from\"../../../core/handleUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import\"../../../core/Error.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import r from\"./DynamicLayerView3D.js\";import{SublayerPopupHighlightHelper3D as s}from\"./support/SublayerPopupHighlightHelper3D.js\";import o from\"../../layers/MapImageLayerView.js\";let p=class extends(o(r)){constructor(){super(...arguments),this.type=\"map-image-3d\"}initialize(){this._updatingHandles.add((()=>this.exportImageVersion),(()=>this._updatingHandles.addPromise(this.refreshDebounced()))),this._popupHighlightHelper=new s({view:this.view,layerView:this,updatingHandles:this._updatingHandles}),this.addHandles(t(this._popupHighlightHelper))}fetchPopupFeaturesAtLocation(e,t){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e,t)}highlight(e,t){return this._popupHighlightHelper.highlight(e,t)}getFetchOptions(){return{timeExtent:this.timeExtent}}};p=e([i(\"esri.views.3d.layers.MapImageLayerView3D\")],p);const a=p;export{a as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{toLocalTimeExtent as e,toUTCTimeExtent as t}from\"../../support/timeUtils.js\";function i(i,n,s){if(null==i?.timeInfo)return null;const{datesInUnknownTimezone:l=!1,timeOffset:o,useViewTime:m}=i;let u=i.timeExtent;l&&(u=e(u));let r=m?n&&u?n.intersection(u):n||u:u;return!r||r.isEmpty||r.isAllTime?r:(o&&(r=r.offset(-o.value,o.unit)),l&&(r=t(r)),r.equals(s)?s:r)}export{i as combineTimeExtent};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../core/arrayUtils.js\";import{clone as e}from\"../core/lang.js\";import{offsetDate as n}from\"../core/timeUtils.js\";import{T as i}from\"../chunks/TimeExtent.js\";import{isWebMap as r}from\"../webmap/utils.js\";import{isWebScene as l}from\"../webscene/utils.js\";function s(t){return void 0!==t.timeInfo}async function u(t,e){return t.widgets?.timeSlider?.fullTimeExtent??a(t.allLayers,e)}function o(t){const e=t.numThumbs??2,n=t.currentTimeExtent;if(n){const{start:t,end:i}=n;return null!=t&&null!=i&&t.getTime()===i.getTime()?\"instant\":2===e?\"time-window\":null==t||0===t.getTime()?\"cumulative-from-start\":\"cumulative-from-end\"}return 2===e?\"time-window\":\"cumulative-from-start\"}function m(t){const{numStops:n,stopInterval:i,stops:r}=t;return r?{dates:e(r)}:i?{interval:i.clone()}:{count:n??5}}async function a(e,n){if(0===e.length)return i.allTime;await Promise.all(e.map((t=>t.load({signal:n}))));const r=e.filter(s),l=e.filter((t=>!s(t)&&null!=t.visibilityTimeExtent));if(0===r.length&&0===l.length)return i.allTime;const u=[],o=[];for(const t of r)\"feature\"!==t?.type&&\"map-image\"!==t?.type||!t.timeInfo?.hasLiveData?o.push(t):u.push(t);const m=t=>null==t||t.isAllTime,a=[...o.map((t=>{const e=t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=t;return e?.intersection(n)??n})),...l.map((t=>t.visibilityTimeExtent))];if(a.some(m))return i.allTime;const f=u.map((async t=>{const e=(await t.fetchRecomputedExtents({signal:n}))?.timeExtent??t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=t;return e?.intersection(i)??i})),c=(await Promise.allSettled(f)).map((t=>\"fulfilled\"===t.status?t.value:null));if(c.some(m))return i.allTime;const d=[...c,...a].filter(t);if(0===d.length)return i.allTime;return d.reduce(((t,e)=>t.union(e)))}function f(t,e){const n=t.currentTimeExtent;if(!n)return null;const{start:r,end:l}=n,s=r??l??null;switch(e){case\"time-window\":return new i({start:r,end:l});case\"cumulative-from-start\":return new i({start:null,end:s});case\"cumulative-from-end\":return new i({start:s,end:null});case\"instant\":return new i({start:s,end:s})}}async function c(t,e){if(!r(t)&&!l(t))return null;await t.load({signal:e});const n=t?.widgets?.timeSlider;if(!n)return null;const i=await u(t,e),s=n.loop,a=o(n);return{fullTimeExtent:i,loop:s,mode:a,playRate:n.stopDelay??2e3,stops:m(n),timeExtent:f(n,a)}}function d(t){if(!t)return t;const{start:e,end:r}=t;return new i({start:null!=e?n(e,-e.getTimezoneOffset(),\"minutes\"):e,end:null!=r?n(r,-r.getTimezoneOffset(),\"minutes\"):r})}function p(t){if(!t)return t;const{start:e,end:r}=t;return new i({start:null!=e?n(e,e.getTimezoneOffset(),\"minutes\"):e,end:null!=r?n(r,r.getTimezoneOffset(),\"minutes\"):r})}export{a as getTimeExtentFromLayers,c as getTimeSliderSettingsFromWebDocument,p as toLocalTimeExtent,d as toUTCTimeExtent};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import{ExportImageParameters as o}from\"../../layers/support/ExportImageParameters.js\";import{combineTimeExtent as s}from\"../../layers/support/timeSupport.js\";const i=i=>{let p=class extends i{initialize(){this.exportImageParameters=new o({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),this.commitProperty(\"floors\"),(this._get(\"exportImageVersion\")||0)+1}get timeExtent(){return s(this.layer,this.view?.timeExtent,this._get(\"timeExtent\"))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e([t()],p.prototype,\"exportImageParameters\",void 0),e([t({readOnly:!0})],p.prototype,\"floors\",null),e([t({readOnly:!0})],p.prototype,\"exportImageVersion\",null),e([t()],p.prototype,\"layer\",void 0),e([t()],p.prototype,\"suspended\",void 0),e([t({readOnly:!0})],p.prototype,\"timeExtent\",null),p=e([r(\"esri.views.layers.MapImageLayerView\")],p),p};export{i as default};\n"],"names":["d","i","constructor","e","super","initialize","this","_highlightHelper","l","layer","layerView","view","updatingHandles","_mapServiceLayerViewHelper","c","createFetchPopupFeaturesQueryGeometry","g","highlightGraphics","graphics","highlightGraphicUpdated","_this$_highlightHelpe","graphicsView","graphicChanged","addHandles","r","t","_this$view","stationary","updateHighlightedFeatures","resolution","p","s","suspended","o","fetchPopupFeaturesAtLocation","preload","highlight","h","prototype","a","w","updating","_this$graphicsView$up","_this$graphicsView","_highlightCounts","Map","_graphicsViewLoader","_symbols","size","style","color","u","width","m","outline","y","length","addPromise","Promise","all","_createHighlightGraphics","_ensureGraphicsView3D","then","_ref","_addHighlightGraphics","_s","remove","_this$_highlightCount","set","get","addMany","_removeHighlightGraphics","removeMany","filter","_this$_highlightCount2","Math","max","delete","default","destroyed","getGraphics","drapeSourcePriorityOffset","_set","map","_ref2","geometry","spatialReference","reduce","_t$at","at","equals","push","source","dest","_unused","n","cloneShallow","symbol","type","_unused2","arguments","_updatingHandles","add","exportImageVersion","refreshDebounced","_popupHighlightHelper","getFetchOptions","timeExtent","timeInfo","datesInUnknownTimezone","timeOffset","useViewTime","start","end","getTimezoneOffset","intersection","isEmpty","isAllTime","offset","value","unit","exportImageParameters","destroy","floors","_this$view$floors","_this$exportImagePara","commitProperty","_get","_this$view2","canResume","_this$timeExtent","readOnly"],"sourceRoot":""}