"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[58619,68707],{68707:(e,t,i)=>{i.d(t,{G:()=>s,S:()=>r});class s{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}class r extends s{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}},74014:(e,t,i)=>{i.d(t,{G:()=>r});var s=i(33219);class r extends s.L{constructor(e){super(),this._value=e}resize(e){}read(e,t){return this._value}readWithDefault(e,t,i){return this._value}hasArcadeDependency(e){return!1}}},91969:(e,t,i)=>{i.d(t,{o:()=>ye});var s=i(32743),r=i(76931),n=i(84735),a=i(77555),o=i(28808),c=i(33443),l=i(5095),h=i(83936),d=i(35870),u=i(89379);function m(e){var t;let{pixelDimensions:i,texelDimensions:s,baseSize:n,referenceSize:a,strokeWidth:o,sizeRatio:c}=e;if(i||(i=e.sprite.sdf?[0,0]:[e.sprite.width,e.sprite.height]),s||(s=e.sprite.sdf?[0,0]:i),null!=e.patternHeight){const t=e.patternHeight/i[1];i[1]*=t,i[0]*=t}-1===n&&(n=i[1]),n=(0,r.Lz)(n),a=(0,r.Lz)(a),o=(0,r.Lz)(o);const l=(null!==(t=e.sprite.sdfDecodeCoeff)&&void 0!==t?t:1)*c;return(0,u.A)((0,u.A)({},e),{},{pixelDimensions:i,texelDimensions:s,baseSize:n,referenceSize:a,strokeWidth:o,sdfDecodeCoeff:l})}var f=i(64849),p=i(90113);class _ extends h.${get vertexSpec(){return{createComputedParams:m,optionalAttributes:{zoomRange:d.jo,value1Position2Value2:d.Z6,lineLength:d.bU},attributes:{id:d.id,bitset:d.Q5,pos:d.n1,offset:d.cY.marker,uv:d.uv.marker,animationPointerAndBaseSizeAndReferenceSize:d.GE,sizing:d.ve,angle:d.g7}}}_write(e,t){const i=this.evaluatedMeshParams.sprite,{textureBinding:s}=i;e.recordStart(this.instanceId,this.attributeLayout,s);const r=t.getDisplayId();if(this.shift&&"esriGeometryPolyline"===t.geometryType)this._writeParticles(e,t);else if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(e,t);else if("esriGeometryPolygon"===t.geometryType){const i=t.readCentroidForDisplay();if(!i)return;const[s,n]=i.coords;this._writeQuad(e,r,s,n)}else if("esriGeometryPoint"===t.geometryType){const i=t.readXForDisplay(),s=t.readYForDisplay();this._writeQuad(e,r,i,s)}else{const i=t.readGeometryForDisplay();i&&i.forEachVertex((t,i)=>{this._writeQuad(e,r,t,i)})}e.recordEnd()}_writePlacedMarkers(e,t){var i;const s=null===(i=n.z.fromFeatureSetReaderCIM(t))||void 0===i?void 0:i.clone();if(!s)return;const o=c.l.getPlacement(s,-1,this.evaluatedMeshParams.placement,(0,r.Lz)(1),e.id,(0,f.z)());if(!o)return;const l=t.getDisplayId();let h=o.next(),d=null;for(;null!=h;){const t=h.tx,i=-h.ty;if(Math.abs(t)>a.$u||Math.abs(i)>a.$u){h=o.next();continue}const s=-h.getAngle();e.recordBounds(t,i,64,64),this.shift?d&&this._writeQuad(e,l,d[0],d[1],void 0,s):this._writeQuad(e,l,t,i,void 0,s),d=[t,i],h=o.next()}}_writeParticles(e,t){const i=t.getDisplayId(),s=t.readGeometryForDisplay();if(!s)return;const r=[];s.forEachVertex((e,t)=>{r.push([e,t])});const n=function(e){const t=[];let i=0;for(let s=1;s<e.length;s++){const r=e[s-1],n=e[s],a=n[0]-r[0],o=n[1]-r[1],c=Math.sqrt(a*a+o*o),l=a/c,h=o/c;t.push({a:{position:r,distance:i,direction:[l,h]},b:{position:n,distance:i+c,direction:[l,h]}}),i+=c}return t}(r);let a=0;for(let o=1;o<r.length;o++){const e=r[o][0]-r[o-1][0],t=r[o][1]-r[o-1][1],i=Math.sqrt(e*e+t*t);a+=i}const c=t=>{for(const s of n){const{a:r,b:n}=s;this._writeQuad(e,i,r.position[0],r.position[1],[r.distance-t,n.position[0],n.position[1],n.distance-t],this.evaluatedMeshParams.angleToLine?Math.atan2(r.direction[1],r.direction[0]):0,a,!0)}},{placement:l}=this.evaluatedMeshParams;if(!l||"placementTemplate"in l||"CIMMarkerPlacementOnVertices"===l.type){let e;if(l&&"CIMMarkerPlacementOnVertices"!==l.type)e=l.placementTemplate;else{e=[0];for(const t of n){const{a:i,b:s}=t,r=i.position[0]-s.position[0],n=i.position[1]-s.position[1],a=Math.sqrt(r*r+n*n);e.push(a)}}let t=-1*a;for(;t<2*a;)for(const i of e)t+=i,c(t)}else"CIMMarkerPlacementAtExtremities"===l.type?l.extremityPlacement===o.$2.JustBegin?c(1):l.extremityPlacement===o.$2.JustEnd?(c(a-1),c(-1)):l.extremityPlacement===o.$2.Both&&(c(1),c(a-1)):"CIMMarkerPlacementOnLine"===l.type&&c(a/2)}_writeQuad(e,t,i,s,r){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const c=this.evaluatedMeshParams.sprite,{rect:h}=c,d=h.x+l.hM,u=h.y+l.hM,m=h.x+h.width-l.hM,f=h.y+h.height-l.hM,_=e.vertexCount();o||e.recordBounds(i,s,64,64);const v={texXmin:d,texYmin:u,texXmax:m,texYmax:f,value1Position2Value2:r,angle:n/p.rp,lineLength:a};for(let l=0;l<4;l++)this._writeVertex(e,t,i,s,v);e.indexEnsureSize(6),e.indexWrite(_),e.indexWrite(_+1),e.indexWrite(_+2),e.indexWrite(_+1),e.indexWrite(_+3),e.indexWrite(_+2)}}class v extends _{constructor(){super(...arguments),this.shift=!1}}class y extends _{constructor(){super(...arguments),this.shift=!0}}var g=i(27307),x=i(35797),P=i(28736),M=i(64346);class w extends h.${_write(e,t,i){const s=null!==i&&void 0!==i?i:n.z.fromFeatureSetReaderCIM(t);if(!s)return;const r=this.evaluatedMeshParams.sprite,{textureBinding:a}=r;e.recordStart(this.instanceId,this.attributeLayout,a);const o=t.getDisplayId();this._writePoly(e,o,s.asOptimized()),e.recordEnd()}}class b extends w{constructor(){super(...arguments),this.vertexSpec={createComputedParams:m,attributes:{id:d.id,bitset:d.Q5,pos:d.n1,offset:d.cY.fill,tlbr:d.Tx,animationPointerAndBaseSizeAndReferenceSize:d.GE,sizing:d.ve},optionalAttributes:{zoomRange:d.jo,value1Position2Value2:d.k3,lineLength:d.Sy}}}_writePoly(e,t,i){const s=[];if(!(0,x.lO)(s,i))return;const r=e.vertexCount();i.forEachVertex((i,s)=>{this._writeVertex(e,t,i,s)}),e.indexEnsureSize(s.length);for(const n of s)e.indexWrite(r+n)}}class I{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0}}class z extends w{constructor(){super(...arguments),this.vertexSpec={createComputedParams:m,attributes:{id:d.id,bitset:d.Q5,pos:d.n1,offset:d.cY.line,tlbr:d.Tx,animationPointerAndBaseSizeAndReferenceSize:d.GE,sizing:d.ve,accumulatedDistance:d.YE,normal:d.qb,segmentDirection:d.zK},optionalAttributes:{zoomRange:d.jo,value1Position2Value2:d.k3,lineLength:d.bU}},this._tessParams=new M.sp,this._currentWrite=new I,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._lineLength=0,this._lineTessellator=new g.i((e,t,i,s,r,n,a,o,c,l,h)=>this._writeTesselatedVertex(e,t,i,s,r,n,a,o,c,l,h,this._lineLength),this._writeTriangle.bind(this),!1)}_writePoly(e,t,i){const s=(0,x.uS)(n.z.fromOptimized(i,"esriGeometryPolyline"),64);if(null==s)return;const{_currentWrite:a,_tessellationOptions:c}=this,{baseSize:l,capType:h,joinType:d,miterLimit:u}=this.evaluatedMeshParams,m=(0,r.Lz)(.5*l);c.halfWidth=m,c.capType=(0,P.ue)(h||o.uT.Round),c.joinType=(0,P.qE)(d||o.wd.Round),c.miterLimit=u||2,a.out=e,a.id=t,a.vertexCount=0,a.indexCount=0,a.vertexFrom=e.vertexCount(),a.vertexBounds=1;for(const{line:r,start:n,pathLength:o}of s){c.initialDistance=n%65535,a.pathLength=o,this._lineLength=0;for(let e=1;e<r.length;e++){const t=r[e].x-r[e-1].x,i=r[e].y-r[e-1].y;this._lineLength+=Math.sqrt(t*t+i*i)}this._lineTessellator.tessellate(r,c,false)}}_writeTesselatedVertex(e,t,i,s,r,n,a,o,c,l,h,d){const{out:u,id:m,vertexBounds:f,pathLength:p}=this._currentWrite;return this.hasEffects&&u.recordBounds(e,t,f,f),this._tessParams.extrusionOffsetX=a,this._tessParams.extrusionOffsetY=o,this._tessParams.normalX=c,this._tessParams.normalY=l,this._tessParams.directionX=r,this._tessParams.directionY=n,this._tessParams.distance=h,this._tessParams.pathLength=p,this._tessParams.lineLength=d,this._writeVertex(u,m,e,t,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(e,t,i){const{out:s}=this._currentWrite;s.indexEnsureSize(3),s.indexWrite(e),s.indexWrite(t),s.indexWrite(i),this._currentWrite.indexCount+=3}}var A=i(81320),L=i(13308),S=i(33346),D=i(13720),E=i(88075),k=i(38550),R=i(9410),G=i(57156),T=i(98112),C=i(87663),B=i(88685),W=i(94967),F=i(98006),O=i(19555),Z=i(59422),N=i(72745),V=i(98618),j=i(1484),Q=i(19358),Y=i(19385),q=i(5685),X=i(81615);const $=(0,C.Bj)(e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t});class J extends X.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,i,s){if(this._zoomLevel=s||0,null!=i)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{const i=t.readXForDisplay(),s=t.readYForDisplay();this._writePoint(e,i,s,0,t);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":{const i=t.readCentroidForDisplay();if(!i)return;const[s,r]=i.coords;this._writePoint(e,s,r,0,t);break}case"esriGeometryMultipoint":{let i=0;const s=n.z.fromFeatureSetReader(t);if(null!==s&&void 0!==s&&s.nextPath())for(;s.nextPoint();)this._writePoint(e,s.x,s.y,i++,t);break}case"esriGeometryPolyline":this._writeLines(e,t)}}_getMetricDir(){const{horizontalAlignment:e,verticalAlignment:t}=this.evaluatedMeshParams;return["center"===e?0:"right"===e?-1:1,"middle"===t?0:"bottom"===t?-1:1]}_createLineLabelMetric(e,t,i,s,r){var n,a,o,c;const[l,h]=this._getMetricDir(),d=null!==(n=null===(a=this.evaluatedMeshParams.scaleInfo)||void 0===a?void 0:a.maxScale)&&void 0!==n?n:0,u=null!==(o=null===(c=this.evaluatedMeshParams.scaleInfo)||void 0===c?void 0:c.minScale)&&void 0!==o?o:0,m=this.evaluatedMeshParams.labelClassId;return new Y.f(e,m,t,i,s,l,h,d,u,r)}_writePoint(e,t,i,s,r){var n,a,o,c;if(t<0||t>l.CQ||i<0||i>l.CQ)return;const h=this._getShaping();if(!h)return;const d=r.getDisplayId(),u=this.evaluatedMeshParams.labelClassId,m=function(e,t,i){return(0,B.Wm)("".concat(e).concat(t).concat(i))}(r.getObjectId(),u,s),[f,p]=this._getMetricDir(),_=null!==(n=null===(a=this.evaluatedMeshParams.scaleInfo)||void 0===a?void 0:a.maxScale)&&void 0!==n?n:0,v=null!==(o=null===(c=this.evaluatedMeshParams.scaleInfo)||void 0===c?void 0:c.minScale)&&void 0!==o?o:0,y=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};e.metricStart(new Y.f(d,u,m,t,i,f,p,_,v,y)),this._writeGlyphs(e,d,t,i,h,0,y,void 0,!1),e.metricBoxWrite(h.boundsT),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const e of this._references){const t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){const{scaleInfo:i,verticalAlignment:s}=this.evaluatedMeshParams,r=this.evaluatedMeshParams.repeatLabelDistance||128,n=this._getShaping("middle");if(!n)return;const a=(e,t,i,s)=>this._placeSubdivGlyphs(e,t,i,s),o=(n.bounds.width+r)/2;this._current={out:e,id:t.getDisplayId(),objId:t.getObjectId(),shaping:n,zoomRange:(0,P.My)(i,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null,pathIndex:0},this._verticalPlacement="bottom"===s?"above":"top"===s?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,a,o):this._writeCenterAlong(t,a,o)}_writeAboveAndBelowAlong(e,t,i){const{repeatLabel:s}=this.evaluatedMeshParams,{shaping:r}=this._current,n=r.bounds.halfHeight,a=e.readGeometryForDisplay();if(!a)return;const o=new j.A;(0,V.kz)(o,a,!1,!1,"esriGeometryPolyline",1);const c=H(new j.A,o,n),l=H(new j.A,o,-n),h=(0,V.zv)(l,"esriGeometryPolyline",!1,!1),d=(0,V.zv)(c,"esriGeometryPolyline",!1,!1),u=(0,q.Zy)(d.paths,r.bounds.width),m=(0,q.Zy)(h.paths,r.bounds.width);this._current.offsetDirection="above";for(let f=0;f<u.length;f++)this._current.pathIndex=f,(0,q.Nd)(u[f],i,t,!!s);this._current.offsetDirection="below";for(let f=0;f<m.length;f++)this._current.pathIndex=f,(0,q.Nd)(m[f],i,t,!!s)}_writeCenterAlong(e,t,i){const{repeatLabel:s}=this.evaluatedMeshParams,{shaping:r}=this._current,n=(0,q.Zy)(e.readLegacyGeometryForDisplay().paths,r.bounds.width);for(let a=0;a<n.length;a++)this._current.pathIndex=a,(0,q.Nd)(n[a],i,t,!!s)}_placeSubdivGlyphs(e,t,i,s){const{allowOverrun:r,labelPosition:n,repeatLabelDistance:a}=this.evaluatedMeshParams,o=this._current.zoomRange[0],c=$(t),l=this._current.shaping.bounds.width/2,h=Math.sqrt(a||128)/2,d=Math.min(i,s-i),u=this._current.shaping.isMultiline?X.GJ:Math.log2(d/(h+l/2)),m=0===t?u:Math.min(c,u),f=Math.max(o,this._zoomLevel+1-m),p=this._zoomLevel-f,_=this._current.shaping.bounds.width/2*2**p,v=function(e,t,i,s,r){return(0,B.Wm)("".concat(e).concat(r).concat(t).concat(i*2**(X.GJ-s)))}(this._current.objId,this._current.pathIndex,t,this._zoomLevel,this.evaluatedMeshParams.labelClassId);this._current.shaping.isMultiline?0===t&&this._placeStraight(e,f,v):r&&p<0?this._placeStraightAlong(e,o,v):"parallel"===n?this._placeStraightAlong(e,f,v):"curved"===n&&this._placeCurved(e,f,_,v)}_placeStraight(e,t,i){const{out:s,id:r,shaping:n,referenceBounds:a}=this._current,{x:o,y:c}=e;s.metricStart(this._createLineLabelMetric(r,i,o,c)),s.metricBoxWrite(n.boundsT);const l=e.angle*(180/Math.PI)%360,h=(e.angle*(180/Math.PI)+180)%360,d={clipAngle:l,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(s,r,o,c,n,0,a,d,!1);const u={clipAngle:h,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(s,r,o,c,n,0,a,u,!1),s.metricEnd()}_placeCurved(e,t,i,s){const{out:r,id:n}=this._current;r.metricStart(this._createLineLabelMetric(n,s,e.x,e.y));const a=e.clone(),o=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(a,t,1,o),this._placeBack(e,a,t,i,1,o),this._placeForward(e,a,t,i,1,o)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(a,t,0,c),this._placeBack(e,a,t,i,0,c),this._placeForward(e,a,t,i,0,c)),r.metricEnd()}_placeStraightAlong(e,t,i){const{out:s,id:n,shaping:a,zoomRange:o,referenceBounds:c}=this._current,{boxBorderLineColor:l,boxBackgroundColor:h}=this.evaluatedMeshParams,d=e.clone(),u=e.angle*(180/Math.PI)%360,m=(e.angle*(180/Math.PI)+180)%360,f=a.glyphs.length>0&&!(!l&&!h);if(s.metricStart(this._createLineLabelMetric(n,i,e.x,e.y)),f){const i=Math.max(t,o[0],0),l=Math.min(X.GJ,o[1]),h=(0,W.$0)((0,F.vt)(),-e.angle),d={minZoom:i,maxZoom:l,clipAngle:u,mapAligned:!0,isLineLabel:!0},f=(0,r.Lz)(this.evaluatedMeshParams.offsetX),p=(0,r.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const t=(0,Z.fA)(f,-1*p),[i,r]=a.shapeBackground((0,W.Tl)((0,F.vt)(),h,t));s.recordStart(this.instanceId,this.attributeLayout,a.glyphs[0].textureBinding),this._writeTextBox(s,n,e.x,e.y,r,c,d),s.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const t=(0,Z.fA)(f,p),[i,r]=a.shapeBackground((0,W.Tl)((0,F.vt)(),h,t));d.clipAngle=m,s.recordStart(this.instanceId,this.attributeLayout,a.glyphs[0].textureBinding),this._writeTextBox(s,n,e.x,e.y,r,c,d),s.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(d,t,1,u,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(d,t,0,m,!0),s.metricEnd()}_placeBack(e,t,i,s,r,n){const a=e.clone();let o=e.backwardLength+0;for(;a.prev()&&!(o>=s);)this._placeOnSegment(a,t,o,i,-1,r,n),o+=a.length+0}_placeForward(e,t,i,s,r,n){const a=e.clone();let o=e.remainingLength+0;for(;a.next()&&!(o>=s);)this._placeOnSegment(a,t,o,i,1,r,n),o+=a.length+0}_placeFirst(e,t,i,s){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{out:a,id:o,shaping:c,zoomRange:l,referenceBounds:h}=this._current,d=c.glyphs,u=(0,r.Lz)(this.evaluatedMeshParams.offsetX),m=(0,r.Lz)(this.evaluatedMeshParams.offsetY),f=(0,Z.fA)(u,m),p=(0,W.$0)((0,F.vt)(),-e.angle);(0,O.l0)(f,f,p);for(const r of d){const d=r.x>c.bounds.x?i:1-i,u=d*e.remainingLength+(1-d)*e.backwardLength,m=Math.abs(r.x+r.width/2-c.bounds.x),p=Math.max(0,this._zoomLevel+Math.log2(m/(u+0))),_=Math.max(t,n?0:p);if(r.maxZoom=Math.min(l[1],X.GJ),r.angle=e.angle+(1-i)*Math.PI,r.minZoom=Math.max(l[0],_),this._writeLineGlyph(a,o,e.x,e.y,r,s,h,!0),(i||this._current.offsetDirection)&&this._isVisible(r.minZoom,r.maxZoom)){const e=new Q.A(r.bounds.x+f[0],r.bounds.y+f[1],r.bounds.width,r.bounds.height);a.metricBoxWrite(e)}}}_placeOnSegment(e,t,i,s,n,a,o){const{out:c,id:l,shaping:h,referenceBounds:d}=this._current,u=h.glyphs,m=e.dx/e.length,f=e.dy/e.length,p={x:e.x+i*-n*m,y:e.y+i*-n*f},_=(0,r.Lz)(this.evaluatedMeshParams.offsetX),v=(0,r.Lz)(this.evaluatedMeshParams.offsetY),y=(0,Z.fA)(_,v),g=(0,W.$0)((0,F.vt)(),-e.angle);(0,O.l0)(y,y,g);for(const r of u){const t=r.x>h.bounds.x?a:1-a;if(!(t&&1===n||!t&&-1===n))continue;const u=Math.abs(r.x+r.width/2-h.bounds.x),m=Math.max(0,this._zoomLevel+Math.log2(u/i)-.1),f=Math.max(s,this._zoomLevel+Math.log2(u/(i+e.length+0)));if(0!==m&&(r.angle=e.angle+(1-a)*Math.PI,r.minZoom=f,r.maxZoom=m,this._writeLineGlyph(c,l,p.x,p.y,r,o,d,!0),(a||this._current.offsetDirection)&&this._isVisible(r.minZoom,r.maxZoom))){const e=new Q.A(r.bounds.x+y[0],r.bounds.y+y[1],r.bounds.width,r.bounds.height);c.metricBoxWrite(e)}}}_writeLineGlyph(e,t,i,s,r,n,a,o){if(i<0||i>l.CQ||s<0||s>l.CQ)return;e.recordStart(this.instanceId,this.attributeLayout,r.textureBinding);const{texcoords:c,offsets:h}=r,{fontSize:d,haloSize:u,outlineSize:m}=this._textMeshTransformProps;this._writeQuad(e,t,i,s,{texcoords:c,offsets:h,fontSize:d,haloSize:u,outlineSize:m,color:(0,P.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:a,minZoom:Math.max(this._current.zoomRange[0],r.minZoom),maxZoom:Math.min(this._current.zoomRange[1],r.maxZoom),clipAngle:n,mapAligned:o,isLineLabel:!0}),e.recordEnd()}_packedZoom(e){return Math.floor(e*l.fq)/l.fq}_isVisible(e,t){let i=Math.max(this._current.zoomRange[0],e),s=Math.min(this._current.zoomRange[1],t);i=this._packedZoom(i),s=this._packedZoom(s);const r=this._packedZoom(this._zoomLevel);return i<=r&&r<=s}}function H(e,t,i){const{coords:s,lengths:r}=t,n=(0,N.vt)(),a=(0,N.vt)(),o=(0,N.vt)(),c=(0,N.vt)(),l=(0,N.vt)(),h=(0,N.vt)();let d=0;for(let u=0;u<r.length;u++){const t=r[u];for(let r=0;r<t;r++){const u=2*(r+d-1),m=2*(r+d),f=2*(r+d+1);r>0?(0,O.hZ)(n,s[u],s[u+1]):(0,O.hZ)(n,0,0),(0,O.hZ)(a,s[m],s[m+1]),r<t-1?(0,O.hZ)(o,s[f],s[f+1]):(0,O.hZ)(o,0,0),0===r?(0,O.hZ)(c,0,0):((0,O.jb)(c,a,n),(0,O.S8)(c,c),(0,O.hZ)(c,c[1],-c[0])),r===t-1?(0,O.hZ)(l,0,0):((0,O.jb)(l,o,a),(0,O.S8)(l,l),(0,O.hZ)(l,l[1],-l[0])),(0,O.WQ)(h,c,l),(0,O.S8)(h,h);const p=h[0]*l[0]+h[1]*l[1];0!==p&&(0,O.hs)(h,h,p),(0,O.hs)(h,h,i),e.coords.push(a[0]+h[0],a[1]+h[1])}e.lengths.push(t),d+=t}return e}var K=i(29300),U=i(26455),ee=i(4480),te=i(18690),ie=i(50076),se=i(53084),re=i(76460),ne=i(81456),ae=i(95776),oe=i(59872),ce=i(32252),le=i(27534),he=i(74014);const de=()=>re.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator");async function ue(e,t,i,s){const{defaultValue:r,valueExpressionInfo:n,value:a}=t;if(n){if("dictionary-template"===n.type)return(0,u.A)((0,u.A)({},t),{},{computed:e.createDictionaryTemplateField(n,i),defaultValue:r});const{expression:a}=n,o=await e.createComputedField({expression:a},s);return o?(0,u.A)((0,u.A)({},t),{},{computed:o,defaultValue:r}):null}return(0,u.A)((0,u.A)({},t),{},{computed:new he.G(a),defaultValue:r})}async function me(e,t,i){const{valueExpressionInfo:s}=t,r="dictionary-template"===s.type?e.createDictionaryTemplateField(s,i):await e.createComputedField({expression:s.expression});return r?(0,u.A)((0,u.A)({},t),{},{computed:r}):null}function fe(e){return"object"==typeof e&&null!=e&&(!(!("valueExpressionInfo"in e)||!e.valueExpressionInfo)||"type"in e&&"Process"===e.type&&"op"in e&&"Random"===e.op)}function pe(e){if(Array.isArray(e))for(const t of e)if(pe(t))return!0;if("object"==typeof e){if(fe(e))return!0;for(const t in e)if(pe(e[t]))return!0}return!1}class _e{static async create(e,t,i,s){const r={},n=new Map,a=new Map,o=new Map,c=new Map,l=new Map,h=new Map;for(const m in i){const f=i[m];if(null!=f&&"object"==typeof f)if(Array.isArray(f)){if("object"==typeof f[0])throw new Error("InternalError: Cannot handle ".concat(m,". Nested array params are not supported"));r[m]=f}else if("valueExpressionInfo"in f){if(f.value){r[m]=f.value;continue}const t=await me(e,f,s);if(!t){r[m]=f.defaultValue;continue}n.set(m,t),r[m]=null}else switch(f.type){case"cim-effect-infos":if(f.effectInfos.some(e=>e.overrides.length)){a.set(m,{effects:await Promise.all(f.effectInfos.map(async t=>{const i=t.overrides.map(t=>ue(e,t,s,!1));return{effect:t.effect,compiledOverrides:(await Promise.all(i)).filter(te.Ru)}}))});break}r[m]=f.effectInfos.map(e=>e.effect);break;case"cim-marker-placement-param":f.overrides.length&&o.set(m,{placementInfo:f,compiledOverrides:(await Promise.all(f.overrides.map(t=>ue(e,t,s,!1)))).filter(te.Ru)}),r[m]=f.placement;break;case"text-rasterization-param":{var d;if(f.overrides.length){const t=f.overrides.map(t=>{var i;return ue(e,t,s,null!==(i=f.useLegacyLabelEvaluationRules)&&void 0!==i&&i)});c.set(m,{compiledOverrides:(await Promise.all(t)).filter(te.Ru),rasterizationParam:f,objectIdToResourceId:new Map});continue}const i={type:"cim-rasterization-info",resource:f.resource};r[m]=null!==(d=await t.fetchResourceImmediate(i))&&void 0!==d?d:null;break}case"sprite-rasterization-param":{var u;if(f.overrides.length){const t=f.overrides.map(t=>ue(e,t,s,!1));c.set(m,{compiledOverrides:(await Promise.all(t)).filter(te.Ru),rasterizationParam:f,objectIdToResourceId:new Map});continue}if("animated"===f.resource.type){c.set(m,{compiledOverrides:[],rasterizationParam:f,objectIdToResourceId:new Map});continue}const i={type:"cim-rasterization-info",resource:f.resource};r[m]=null!==(u=await t.fetchResourceImmediate(i))&&void 0!==u?u:null;break}case"cim-marker-transform-param":{const{params:t}=f;if(pe(t)){const i={compiledMarkerInfos:[]};await Promise.all(t.map(async t=>{const r={props:{}};for(const i in t)if(fe(t[i])){const n=await me(e,t[i],s);r.compiledExpressionMap||(r.compiledExpressionMap=new Map);const a=r.compiledExpressionMap;n&&a.set(i,n)}else r.props[i]=t[i];i.compiledMarkerInfos.push(r)})),l.set(m,i)}else r[m]={type:"cim-marker-transform-info",infos:t};break}case"animation-params":{const{params:i}=f,s=(0,ce.oo)(i);if(pe(s)){const t=await Promise.all(s.map(t=>(0,ce.N)(t,e)));h.set(m,{params:t,propertyIdToResourceId:new Map,key:m})}else{const e=(0,ce.rS)(s),i=await t.fetchResourceImmediate({type:"animation-info",resource:e});null!=i&&"sprite"===i.type&&(r[m]={dataRow:i.rect.y,dataColumn:i.rect.x})}break}default:r[m]=f}else r[m]=f}return new _e(i,r,n,a,o,c,l,h)}constructor(e,t,i,s,r,n,a,o){this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=i,this._dynamicEffectProperties=s,this._dynamicPlacementProperties=r,this._dynamicAsyncProperties=n,this._dynamicTransformProperties=a,this._dynamicAsyncAnimations=o,this.evaluator=e=>e,this._arcadeDependencies=new Set;for(const c of this._expressions())(0,ne.QY)(this._arcadeDependencies,c)}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,i){for(const r of this._dynamicAsyncProperties.values()){const n=(0,se.o8)(r.rasterizationParam.resource);"animated"===r.rasterizationParam.resource.type&&r.rasterizationParam.resource.randomizeStartTime&&(n.primitiveName="__RESERVED__PRIMITIVE__NAME__",n.startGroup=(0,ae.A)(t.getObjectId()||0));for(const{primitiveName:e,propertyName:o,computed:c,defaultValue:l,valueExpressionInfo:h}of r.compiledOverrides)try{const s="animated"===r.rasterizationParam.resource.type?n.primitiveName:e;(0,le.Ph)(n,s,o,c,t,i,l)}catch(s){de().errorOnce(new ie.A("invalid-arcade-expression","Encountered an error when evaluating the arcade expression",{error:s,valueExpressionInfo:h}))}const a=e.enqueueRequest({type:"cim-rasterization-info",resource:n});r.objectIdToResourceId.set(t.getObjectId(),a)}for(const r of this._dynamicAsyncAnimations.values()){const s=r.params.map(e=>(0,ce.SM)(e,t,i)).map(oe.Qv).map(e=>e.simplify()),n=(0,ce.aM)(s),a=e.enqueueRequest({type:"animation-info",resource:n});r.propertyIdToResourceId.set(t.getObjectId()+"."+r.key,a)}}evaluateMeshParams(e,t,i){for(const[s,r]of this._dynamicProperties.entries())this._resolvedMeshParams[s]=r.computed.readWithDefault(t,i,r.defaultValue);for(const[s,r]of this._dynamicPlacementProperties.entries())for(const{computed:e,defaultValue:n,propertyName:a}of r.compiledOverrides){const o=e.readWithDefault(t,i,n);r.placementInfo.placement[a]=o,this._resolvedMeshParams[s]=r.placementInfo.placement}for(const[s,r]of this._dynamicEffectProperties.entries())for(const e of r.effects){for(const{computed:s,defaultValue:r,propertyName:n}of e.compiledOverrides){const a=s.readWithDefault(t,i,r);e.effect[n]=a}this._resolvedMeshParams[s]=r.effects.map(e=>e.effect)}for(const[s,r]of this._dynamicTransformProperties.entries()){const e={type:"cim-marker-transform-info",infos:[]};for(const s of r.compiledMarkerInfos){const r=(0,u.A)({},s.props);if(s.compiledExpressionMap)for(const[e,n]of s.compiledExpressionMap){const s=n.computed.readWithDefault(t,i,n.defaultValue);r[e]="number"==typeof s||"boolean"==typeof s?s:n.defaultValue}e.infos.push(r)}this._resolvedMeshParams[s]=e}for(const[s,r]of this._dynamicAsyncProperties.entries()){const i=r.objectIdToResourceId.get(t.getObjectId());if(null==i)continue;const n=e.getResource(i);this._resolvedMeshParams[s]=n}for(const[s,r]of this._dynamicAsyncAnimations.entries()){const i=r.propertyIdToResourceId.get(t.getObjectId()+"."+s);if(null==i)continue;const n=e.getResource(i);this._resolvedMeshParams[s]={dataRow:n.rect.y,dataColumn:n.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}*_expressions(){for(const e of this._dynamicProperties.values())yield e.computed;for(const e of this._dynamicEffectProperties.values())for(const t of e.effects)for(const e of t.compiledOverrides)yield e.computed;for(const e of this._dynamicPlacementProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicAsyncProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicTransformProperties.values())for(const t of e.compiledMarkerInfos)if(null!=t.compiledExpressionMap)for(const e of t.compiledExpressionMap.values())yield e.computed;for(const e of this._dynamicAsyncAnimations.values())for(const t of e.params)yield*(0,ce.ci)(t)}}var ve=i(41406);class ye{async createMeshWriter(e,t,i,s,r){const n=this._getMeshWriter(s.techniqueType),a=await _e.create(e,t,s.inputParams,r),o=new n(s.id,a,s.optionalAttributes,i);return await o.loadDependencies(),o}_getMeshWriter(e){switch(e){case s.N.Fill:return D.Y;case s.N.DotDensity:return A.k;case s.N.ComplexFill:return L.KE;case s.N.PatternFill:return R.m;case s.N.GradientFill:return E.S;case s.N.OutlineFill:return k.w0;case s.N.PatternOutlineFill:return G.Q;case s.N.ComplexOutlineFill:return S.O;case s.N.Marker:return ee.H;case s.N.PieChart:return ve.v;case s.N.Text:return X.G8;case s.N.Line:return M.Bw;case s.N.TexturedLine:return U.K;case s.N.GradientStroke:return K.F;case s.N.Heatmap:return T.h;case s.N.Label:return J;case s.N.AnimatedMarker:return v;case s.N.AnimatedMarkerShift:return y;case s.N.AnimatedFill:return b;case s.N.AnimatedLine:return z;default:throw new Error("Internal Error: Mesh writer not in the registry")}}}}}]);
//# sourceMappingURL=58619.663c7c0a.chunk.js.map