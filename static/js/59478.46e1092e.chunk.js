"use strict";(self.webpackChunksc_utility=self.webpackChunksc_utility||[]).push([[59478],{3109:(t,e,n)=>{n.d(e,{$x:()=>s,Wn:()=>u,XO:()=>a,iE:()=>c,y6:()=>l});var i=n(73582),r=n(2413),o=n(80963);class l{constructor(t,e,n,i,r){this.extent=t,this.timeExtent=e,this.size=n,this.pixelRatio=i,this.time=r}get flowExtentInfo(){var t;return{modelSize:this.size,valid:null===(t=(0,o.Vp)(this.extent.spatialReference))||void 0===t?void 0:t.valid,extent:(0,r.VY)(this.extent)}}insideMapExtent(t,e){return s(this.flowExtentInfo,t,e)}modelToMapSpace(t,e,n){return a(this.flowExtentInfo,t,e,n)}}function s(t,e,n){const{extent:i,valid:r}=t,[o,l,s,a]=i;return!(n<l||n>a)&&(null!=r&&o>s?e>=s||e<=o:e>=o&&e<=s)}function a(t,e,n,o){const{extent:l,modelSize:s,valid:a}=t,[c,h,f]=l,d=u(c,f,a);let g=e/s[0]*d+c;return null!=a&&o&&(g=new i.hr(a[0],a[1]).normalize(g)),[g,(s[1]-n)/s[1]*(0,r.uJ)(l)+h]}function c(t,e,n){return null!=n&&Math.abs(t-n.valid[0])<n.dx&&Math.abs(e-n.valid[1])<n.dx}function u(t,e,n){if(null!=n&&t>e){const[i,r]=n;return r-t+(e-i)}return e-t}},31723:(t,e,n)=>{n.d(e,{DW:()=>h,Sw:()=>a,T5:()=>g,Xx:()=>c,Zt:()=>u,uu:()=>s});var i=n(2413),r=n(46533),o=n(76191),l=n(3109);function s(t){return t?4:3}function a(t){return t[0].vertices instanceof Float32Array}class c{constructor(t,e,n,i,r,o){this.data=t,this.mask=e,this.width=n,this.height=i,this.lij=r,this.extent=o}}function u(t){return(0,o.et)(t.lij[0],t.lij[1],t.lij[2])}function h(t,e){let[n,r,o,s]=[null,null,null,null];for(const i of t){const t=i.extent;n=d(t[0],n),r=d(t[1],r),o=f(t[2],o),s=f(t[3],s)}if(null==n||null==r||null==o||null==s)return null;if((0,l.iE)(n,o,e)){const e=[...t].toSorted((t,e)=>t.extent[0]-e.extent[0]);let i=e[0].extent[2],r=0,l=0,s=0;for(let t=1;t<e.length;t++){const[n,o,a]=e[t].extent;if(i<n&&(s++,r=i,l=n,s>1))break;i=Math.max(i,a)}1===s&&(n=l,o=r)}return(0,i.vt)([n,r,o,s])}function f(t,e){return null==e?t:Math.max(t,e)}function d(t,e){return null==e?t:Math.min(t,e)}function g(t,e,n){const[o,s]=n.modelSize;let a=null;const c=new Map;e.forEach(e=>{c.set(e.lij,(0,r.DE)(t,e))});const u=(t,e,n)=>(0,i.Rj)(t.extent,e,n);return(r,h)=>{var f;const d=Math.round(r),g=Math.round(h);if(!t.wrapAround&&(d<0||d>=o||g<0||g>=s))return[0,0];const[m,w]=(0,l.XO)(n,r,h,!0);if(!(0,l.$x)(n,m,w))return[0,0];if(null==a||!u(a,m,w)){a=null;for(const[t,n]of e)if(u(n,m,w)){a=n;break}}if(null==(null===(f=a)||void 0===f?void 0:f.data))return[0,0];const p=c.get(a.lij);if(null==p)return[0,0];const{width:v,height:x,extent:y}=a;return p((m-y[0])/(0,i.VL)(y)*v,x-(w-y[1])/(0,i.uJ)(y)*x)}}},46533:(t,e,n)=>{n.d(e,{CW:()=>d,DE:()=>g,GA:()=>v,S1:()=>p,pH:()=>x});var i=n(89379),r=n(81806),o=n(76460),l=n(15941),s=n(50346),a=n(47249),c=n(76797),u=n(80963);const h=()=>o.A.getLogger("esri.views.2d.engine.flow.dataUtils"),f=10;async function d(t,e,n,i){const o=performance.now(),l=g(e,n),c=performance.now(),u=p(e,l,n.width,n.height),d=performance.now(),m=function(t,e){const n=new a.A,i=t.reduce((t,e)=>t+e.vertices.length,0),r=new Float32Array(4*i),o=new Array(t.length);let l=0,s=0;for(const{vertices:a}of t){const t=l;for(const e of a)r[4*l]=e.x,r[4*l+1]=e.y,r[4*l+2]=e.t,r[4*l+3]=e.speed,l++;o[s++]={startVertex:t,numberOfVertices:a.length,totalTime:a[a.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:r,lineDescriptors:o}}(u,!0),w=performance.now(),v="Streamlines"===t?function(t,e){const n=9,{lineVertices:i,lineDescriptors:r}=t;let o=0,l=0;for(const d of r)o+=2*d.numberOfVertices,l+=6*(d.numberOfVertices-1);const s=new Float32Array(o*n),a=new Uint32Array(l);let c=0,u=0;function h(){a[u++]=c-2,a[u++]=c,a[u++]=c-1,a[u++]=c,a[u++]=c+1,a[u++]=c-1}function f(t,e,i,r,o,l,a,u){const h=c*n;let f=0;s[h+f++]=t,s[h+f++]=e,s[h+f++]=1,s[h+f++]=i,s[h+f++]=l,s[h+f++]=a,s[h+f++]=r/2,s[h+f++]=o/2,s[h+f++]=u,c++,s[h+f++]=t,s[h+f++]=e,s[h+f++]=-1,s[h+f++]=i,s[h+f++]=l,s[h+f++]=a,s[h+f++]=-r/2,s[h+f++]=-o/2,s[h+f++]=u,c++}for(const d of r){const{totalTime:t,timeSeed:n}=d;let r=null,o=null,l=null,s=null,a=null,c=null;for(let u=0;u<d.numberOfVertices;u++){const g=i[4*(d.startVertex+u)],m=i[4*(d.startVertex+u)+1],w=i[4*(d.startVertex+u)+2],p=i[4*(d.startVertex+u)+3];let v=null,x=null,y=null,M=null;if(u>0){v=g-r,x=m-o;const i=Math.sqrt(v*v+x*x);if(v/=i,x/=i,u>1){let t=v+a,n=x+c;const i=Math.sqrt(t*t+n*n);t/=i,n/=i;const r=Math.min(1/(t*v+n*x),e);t*=r,n*=r,y=-n,M=t}else y=-x,M=v;null!==y&&null!==M&&(f(r,o,l,y,M,t,n,p),h())}r=g,o=m,l=w,a=v,c=x,s=p}f(r,o,l,-c,a,t,n,s)}return{vertexData:s,indexData:a}}(m,f):function(t){const e=16,n=1,i=2,{lineVertices:r,lineDescriptors:o}=t;let l=0,s=0;for(const _ of o){const t=_.numberOfVertices-1;l+=4*t*2,s+=6*t*2}const a=new Float32Array(l*e),c=new Uint32Array(s);let u,h,f,d,g,m,w,p,v,x,y,M,A,S,D=0,I=0;function b(){c[I++]=D-8,c[I++]=D-7,c[I++]=D-6,c[I++]=D-7,c[I++]=D-5,c[I++]=D-6,c[I++]=D-4,c[I++]=D-3,c[I++]=D-2,c[I++]=D-3,c[I++]=D-1,c[I++]=D-2}function F(t,r,o,l,s,c,u,h,f,d,g,m,w,p){const v=D*e;let x=0;for(const e of[n,i])for(const n of[1,2,3,4])a[v+x++]=t,a[v+x++]=r,a[v+x++]=o,a[v+x++]=l,a[v+x++]=u,a[v+x++]=h,a[v+x++]=f,a[v+x++]=d,a[v+x++]=e,a[v+x++]=n,a[v+x++]=w,a[v+x++]=p,a[v+x++]=s/2,a[v+x++]=c/2,a[v+x++]=g/2,a[v+x++]=m/2,D++}function k(t,e){let n=v+y,i=x+M;const r=Math.sqrt(n*n+i*i);n/=r,i/=r;const o=v*n+x*i;n/=o,i/=o;let l=y+A,s=M+S;const a=Math.sqrt(l*l+s*s);l/=a,s/=a;const c=y*l+M*s;l/=c,s/=c,F(u,h,f,d,-i,n,g,m,w,p,-s,l,t,e),b()}function L(t,e,n,i,r,o){if(v=y,x=M,y=A,M=S,null==v&&null==x&&(v=y,x=M),null!=g&&null!=m){A=t-g,S=e-m;const n=Math.sqrt(A*A+S*S);A/=n,S/=n}null!=v&&null!=x&&k(r,o),u=g,h=m,f=w,d=p,g=t,m=e,w=n,p=i}function V(t,e){v=y,x=M,y=A,M=S,null==v&&null==x&&(v=y,x=M),null!=v&&null!=x&&k(t,e)}for(const _ of o){u=null,h=null,f=null,d=null,g=null,m=null,w=null,p=null,v=null,x=null,y=null,M=null,A=null,S=null;const{totalTime:t,timeSeed:e}=_;for(let n=0;n<_.numberOfVertices;n++)L(r[4*(_.startVertex+n)],r[4*(_.startVertex+n)+1],r[4*(_.startVertex+n)+2],r[4*(_.startVertex+n)+3],t,e);V(t,e)}return{vertexData:a,indexData:c}}(m),x=performance.now();return(0,r.A)("esri-2d-profiler")&&(h().info("I.1","_createFlowFieldFromData (ms)",Math.round(c-o)),h().info("I.2","_getStreamlines (ms)",Math.round(d-c)),h().info("I.3","createAnimatedLinesData (ms)",Math.round(w-d)),h().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(x-w)),h().info("I.5","createFlowMesh (ms)",Math.round(x-o)),h().info("I.6","Mesh size (bytes)",v.vertexData.buffer.byteLength+v.indexData.buffer.byteLength)),await Promise.resolve(),(0,s.Te)(i),v}function g(t,e){const n=function(t,e,n,i){if(0===i)return t;const r=Math.round(3*i),o=new Array(2*r+1);let l=0;for(let c=-r;c<=r;c++){const t=Math.exp(-c*c/(i*i));o[c+r]=t,l+=t}for(let c=-r;c<=r;c++)o[c+r]/=l;const s=new Float32Array(t.length);for(let c=0;c<n;c++)for(let n=0;n<e;n++){let i=0,l=0;for(let s=-r;s<=r;s++){if(n+s<0||n+s>=e)continue;const a=o[s+r];i+=a*t[2*(c*e+(n+s))],l+=a*t[2*(c*e+(n+s))+1]}s[2*(c*e+n)]=i,s[2*(c*e+n)+1]=l}const a=new Float32Array(t.length);for(let c=0;c<e;c++)for(let t=0;t<n;t++){let i=0,l=0;for(let a=-r;a<=r;a++){if(t+a<0||t+a>=n)continue;const u=o[a+r];i+=u*s[2*((t+a)*e+c)],l+=u*s[2*((t+a)*e+c)+1]}a[2*(t*e+c)]=i,a[2*(t*e+c)+1]=l}return a}(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,i)=>{const r=Math.floor(t),o=Math.floor(i);if(r<0||r>=e.width)return[0,0];if(o<0||o>=e.height)return[0,0];const l=t-r,s=i-o,a=r,c=o,u=r<e.width-1?r+1:r,h=o<e.height-1?o+1:o,f=n[2*(c*e.width+a)],d=n[2*(c*e.width+u)],g=n[2*(h*e.width+a)],m=n[2*(h*e.width+u)],w=n[2*(c*e.width+a)+1],p=n[2*(c*e.width+u)+1];return[(f*(1-s)+g*s)*(1-l)+(d*(1-s)+m*s)*l,(w*(1-s)+n[2*(h*e.width+a)+1]*s)*(1-l)+(p*(1-s)+n[2*(h*e.width+u)+1]*s)*l]}:(t,i)=>{const r=Math.round(t),o=Math.round(i);return r<0||r>=e.width||o<0||o>=e.height?[0,0]:[n[2*(o*e.width+r)],n[2*(o*e.width+r)+1]]}}function m(t,e,n,i,r,o,s,a){const c=[],{raster:u,width:h,height:f,resolutionFactor:d}=a;let g=i,m=r,w=0,[p,v]=n(g,m);p*=e.velocityScale,v*=e.velocityScale;const x=Math.sqrt(p*p+v*v);let y,M;c.push({x:g,y:m,t:w,speed:x});for(let A=0;A<e.verticesPerLine;A++){let[i,r]=n(g,m);i*=e.velocityScale,r*=e.velocityScale;const a=Math.sqrt(i*i+r*r);if(a<e.minSpeedThreshold)return c;const p=t*i/a,v=t*r/a;if(g+=p*e.segmentLength,m+=v*e.segmentLength,e.wrapAround&&(g=(0,l.OS)(g,o[0])),w+=t*e.segmentLength/a,Math.acos(p*y+v*M)>e.maxTurnAngle)return c;if(e.collisions){let t=Math.round(g*d);const n=Math.round(m*d);if(e.wrapAround&&(t=(0,l.OS)(t,h)),t<0||t>h-1||n<0||n>f-1)return c;const i=u[n*h+t];if(-1!==i&&i!==s)return c;u[n*h+t]=s}c.push({x:g,y:m,t:w,speed:a}),y=p,M=v}return c}function w(t,e,n,r,o,l,s,a){const c=Math.round((.2+.6*s.getFloat())*t.verticesPerLine),u=t.verticesPerLine-c,h=m(-1,(0,i.A)((0,i.A)({},t),{},{verticesPerLine:u}),e,n,r,o,l,a),f=m(1,(0,i.A)((0,i.A)({},t),{},{verticesPerLine:c}),e,n,r,o,l,a),d=h.reverse();return d.splice(-1,1),d.concat(f)}function p(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{positions:[]};if(t.density<=0)return[];const{positions:o}=r,l=[],s=new a.A,c=1/Math.max(t.lineCollisionWidth,1),u=Math.round(n*c),h=Math.round(i*c),f=new Int32Array(u*h);for(let a=0;a<f.length;a++)f[a]=-1;const d={raster:f,width:u,height:h,resolutionFactor:c},g={},p=t.lineSpacing/Math.sqrt(t.density),v=Math.floor(i/p),x=Math.floor(n/p);for(let a=0;a<v;a++){const t=a*p;for(let e=0;e<x;e++){const n=e*p;g["".concat(e,"-").concat(a)]={x:n,y:t,positions:[]}}}for(const{x:a,y:m}of o){const t=g["".concat(Math.floor(a/p),"-").concat(Math.floor(m/p))];t&&t.positions.push([a,m])}const y=[];for(const a in g){const t=g[a];if(0===t.positions.length)y.push({x:t.x+p/2,y:t.y+p/2,sort:.66+.33*s.getFloat(),stage:0});else{const[e]=t.positions.splice(0,1);y.push({x:e[0],y:e[1],sort:.33*s.getFloat(),stage:1});for(const[n,i]of t.positions)y.push({x:n,y:i,sort:.33+.33*s.getFloat(),stage:2})}}y.sort((t,e)=>t.sort-e.sort);for(const{x:a,y:M,stage:A}of y){const r=t.onlyForwardTracing?m(1,t,e,a,M,[n,i],l.length,d):w(t,e,a,M,[n,i],l.length,s,d);r.length<2||l.push({stage:A,vertices:r})}return l}function v(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.height,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=e.pixels,a=n*i,c=new Float32Array(2*a),u=e.width,h=(t,e)=>t+r+(e+o)*u,f=(t,e)=>t+e*n;let d;if(null!=e.mask)if(n!==e.width||i!==e.height||0!==r||0!==o){d=new Uint8Array(2*a);const t=e.mask;for(let e=0;e<i;++e)for(let i=0;i<n;++i){const n=h(i,e),r=f(i,e);d[2*r]=t[2*n],d[2*r+1]=t[2*n+1]}}else d=e.mask;else d=new Uint8Array(2*a),d.fill(255);if("vector-uv"===t)for(let l=0;l<i;++l)for(let t=0;t<n;++t){const e=h(t,l),n=f(t,l);c[2*n]=s[0][e],c[2*n+1]=-s[1][e]}else if("vector-magdir"===t){const{cos:t,sin:e}=Math;for(let r=0;r<i;++r)for(let i=0;i<n;++i){const n=h(i,r),o=f(i,r),a=s[0][n],u=(0,l.kU)(s[1][n]),d=t(u-Math.PI/2),g=e(u-Math.PI/2);c[2*o]=d*a,c[2*o+1]=g*a}}return{data:c,mask:d,width:n,height:i}}async function x(t,e,n,i,o,l){const s=performance.now(),a=(0,u.Vp)(e.spatialReference);if(!a){const a=await y(t,e,n,i,o,l);return(0,r.A)("esri-2d-profiler")&&h().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-s)),(0,r.A)("esri-2d-profiler")&&h().info("I.9","Number of parts",1),a}const[f,d]=a.valid,g=d-f,m=Math.ceil(e.width/g),w=e.width/m,p=Math.round(n/m);let v=e.xmin;const x=[],M=performance.now();for(let r=0;r<m;r++){const n=new c.A({xmin:v,xmax:v+w,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});x.push(y(t,n,p,i,o,l)),v+=w}const A=await Promise.all(x);if((0,r.A)("esri-2d-profiler")&&h().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-M)),(0,r.A)("esri-2d-profiler")&&h().info("I.9","Number of parts",A.length),1===A.length)return(0,r.A)("esri-2d-profiler")&&h().info("I.10","loadImagery, general exit without stitching back (ms)",Math.round(performance.now()-s)),A[0];const S={data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i};let D=0;for(const r of A){for(let t=0;t<r.height;t++)for(let e=0;e<r.width;e++)D+e>=n||(S.data[2*(t*n+D+e)]=r.data[2*(t*r.width+e)],S.data[2*(t*n+D+e)+1]=r.data[2*(t*r.width+e)+1],S.mask[t*n+D+e]=r.mask[t*r.width+e]);D+=r.width}return(0,r.A)("esri-2d-profiler")&&h().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-s)),S}async function y(t,e,n,i,r,o){const l={requestProjectedLocalDirections:!0,signal:o};if(null!=r&&(l.timeExtent=r),"imagery"===t.type){var s;await t.load({signal:o});const r=await t.internalFetchImage(e,n,i,l);return null==(null===r||void 0===r||null===(s=r.pixelData)||void 0===s?void 0:s.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:v(t.rasterInfo.dataType,r.pixelData.pixelBlock)}await t.load({signal:o});const a=await t.fetchPixels(e,n,i,l);return null==(null===a||void 0===a?void 0:a.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:v(t.serviceRasterInfo.dataType,a.pixelBlock)}},59478:(t,e,n)=>{n.r(e),n.d(e,{default:()=>a});var i=n(6326),r=(n(76460),n(81806),n(47249),n(50076),n(87990)),o=n(46533),l=n(31723);let s=class{constructor(){this._tileData=new Map}async generateStreamlines(t){const{flowData:e,flowExtentInfo:n,needsMagnitude:i,simulationSettings:r,startPositions:l}=t,s=c((0,o.DE)(r,e),r,n.modelSize,i,l);return{result:{streamlines:s},transferList:null===s||void 0===s?void 0:s.map(t=>t.vertices.buffer)}}async generateTiledStreamlines(t){var e;const{flowDataTiles:n,flowExtentInfo:i,needsMagnitude:r,reset:o,simulationSettings:s,startPositions:a}=t;this._updateTileData(n,o);const u=c((0,l.T5)(s,this._tileData,i),s,i.modelSize,r,a);return{result:{streamlines:u},transferList:null!==(e=null===u||void 0===u?void 0:u.map(t=>t.vertices.buffer))&&void 0!==e?e:[]}}_updateTileData(t,e){e&&this._tileData.forEach((e,n)=>{null==t.get(n)&&this._tileData.delete(n)}),t.forEach((t,e)=>{"delete"===t.type?this._tileData.delete(e):"on-worker"!==t.type&&"waiting"!==t.type&&this._tileData.set(e,t.data)})}};s=(0,i.Cg)([(0,r.$)("esri.views.3d.support.flow.FlowWorker")],s);const a=s;function c(t,e,n,i,r){if(null==t)return;const s=(0,o.S1)(e,t,n[0],n[1],{positions:r}),a=[],c=(0,l.uu)(i);for(const{vertices:o,stage:l}of s){const t=new Float32Array(o.length*c);for(let e=0;e<o.length;e++)t[e*c]=o[e].x,t[e*c+1]=o[e].y,t[e*c+2]=o[e].t,i&&(t[e*c+3]=o[e].speed);a.push({vertices:t,stage:l,hasMagnitude:i})}return a}},76191:(t,e,n)=>{n.d(e,{Tb:()=>o,et:()=>c,mS:()=>s,nx:()=>l});var i=n(34111),r=n(2413);const o="virtual-snapshot-tile",l="virtual-display-filter-highlight-tile";class s{constructor(t,e,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c(t,e,n);this._tilingScheme=i,this.id=o,this.lij=[0,0,0],this.extent=null,this.measures=new a,this.loadPriority=0,this.used=!1,this.lij[0]=this.measures.lodLevel=t,this.lij[1]=e,this.lij[2]=n,i&&(this.extent=(0,r.vt)(),null===i||void 0===i||i.getExtent(t,e,n,this.extent))}get planetRadius(){return(0,i.tO)(this.spatialReference).radius}get spatialReference(){var t;return null===(t=this._tilingScheme)||void 0===t?void 0:t.spatialReference}get resolution(){var t,e;return null!==(t=null===(e=this._tilingScheme)||void 0===e?void 0:e.resolutionAtLevel(this.measures.lodLevel))&&void 0!==t?t:0}get level(){return this.lij[0]}get lodLevelDelta(){return this.measures.lodLevel-this.level}createChildren(){const t=this.lij[0]+1,e=2*this.lij[1],n=2*this.lij[2];return[new s(t,e,n,this._tilingScheme),new s(t,e+1,n,this._tilingScheme),new s(t,e,n+1,this._tilingScheme),new s(t,e+1,n+1,this._tilingScheme)]}}class a{constructor(){this.visible=!0,this.distance=0,this.lodLevel=0,this.splitPriority=0,this.mergeable=!0}}function c(t,e,n){return"".concat(t,"/").concat(e,"/").concat(n)}}}]);
//# sourceMappingURL=59478.46e1092e.chunk.js.map