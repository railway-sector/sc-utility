{"version":3,"file":"static/js/73814.c5611435.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/portal/support/layersLoader.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{parse as t}from\"../../layers/support/arcgisLayerUrl.js\";import{fetchFeatureService as r}from\"../../layers/support/fetchService.js\";import{LayerLoadContext as a}from\"../../layers/support/LayerLoadContext.js\";import{applyPreferredHostToPortalItem as o,getPreferredHost as n,isPreferredUrlApplicable as s}from\"../../layers/support/layerUtils.js\";import l from\"../Portal.js\";import{createForItemRead as i}from\"./jsonContext.js\";import{instanceTypeToLayerTypes as p,getSublayersByLayerType as u,getFirstLayerOrTable as c,preprocessFSItemData as y,populateSceneServiceItemData as d,getNumLayersAndTables as f,layerTypeToLayerModuleType as m,createSublayerData as w}from\"./loadUtils.js\";import{hasTypeKeyword as h}from\"./portalItemUtils.js\";import{loadStyleRenderer as g}from\"../../renderers/support/styleUtils.js\";import{fetchArcGISServiceJSON as I}from\"../../support/requestPresets.js\";async function b(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),v(e),e.validateItem&&e.validateItem(r),L(e,t)}function v(t){const r=t.instance.portalItem;if(!r?.type||!t.supportedTypes.includes(r.type))throw new e(\"portal:invalid-layer-item-type\",\"Invalid layer item type '${type}', expected '${expectedType}'\",{type:r?.type,expectedType:t.supportedTypes.join(\", \")})}async function L(e,t){const r=e.instance,o=r.portalItem;if(!o)return;let{url:n}=o;const{title:s}=o,l=i(o,\"portal-item\");if(\"group\"===r.type)return S(r,l,e);n&&\"media\"!==r.type&&r.read({url:n},l);const p=new a,{data:u,preferredHost:c}=await x(e,p,t);return n=o.url,\"isUrlHostModified\"in r&&(c?r.applyPreferredHost({preferredHost:c}):r.applyHostFromPortalItem()),u&&r.read(u,l),r.resourceReferences={portalItem:o,paths:l.readResourcePaths??[]},\"subtype-group\"!==r.type&&r.read({title:s},l),g(r,l)}async function S(t,r,a){const o=t.portalItem;if(!t.sourceIsPortalItem)return;const{title:n,type:s}=o;if(\"Group Layer\"===s){if(!h(o,\"Map\"))throw new e(\"portal:invalid-layer-item-typekeyword\",\"'Group Layer' item without 'Map' type keyword is not supported\");return T(t,a)}return t.read({title:n},r),j(t,a)}async function T(t,r){const a=t.portalItem,o=await a.fetchData(\"json\");if(!o)return;if(!r.populateGroupLayer)throw new e(\"portal:missing-populate-group-layer\",\"Missing populate group layer\");const n=i(a,\"web-map\");t.read(o,n),await r.populateGroupLayer(t,o,{context:n}),t.resourceReferences={portalItem:a,paths:n.readResourcePaths??[]}}async function j(t,r){let n;const{portalItem:s}=t;if(!s)return;const l=s.type,i=r.layerModuleTypeMap;if(!i)throw new e(\"portal:missing-layer-module-type-map\",\"Layer module type map is required to construct sub layers\");switch(l){case\"Feature Service\":case\"Feature Collection\":n=i.FeatureLayer;break;case\"Stream Service\":n=i.StreamLayer;break;case\"Scene Service\":n=i.SceneLayer;break;case\"Video Service\":n=i.VideoLayer;break;default:throw new e(\"portal:unsupported-item-type-as-group\",`The item type '${l}' is not supported as a 'GroupLayer'`)}const p=\"Video Service\"===l,u=new a;let[m,{data:w}]=await Promise.all([n(),p?{data:null}:x(r,u)]),h=()=>m;if(p)return F(t,h,i);if(\"Feature Service\"===l){const e=c(w)?.customParameters;w=s.url?(await y(w,s.url,u)).data:{},h=await E(w,i)||h;const{provider:r,preferredHost:a}=await U(s.url,{customParameters:e,loadContext:u});return o(s,a),await H(t,h,h,w,i,r)}return\"Scene Service\"===l&&s.url&&(w=await d(s,w,u)),f(w)>0?await H(t,h,null,w,i):await P(t,h,i)}async function P(e,t,r){const{portalItem:a}=e;if(!a?.url)return;const o=await I(a.url);o&&H(e,t,null,{layers:o.layers?.map(w),tables:o.tables?.map(w)},r)}async function F(e,t,r){const{portalItem:a}=e;if(!a?.url)return;const o=await I(a.url);o&&H(e,t,null,{layers:o.layers?.map(({id:e,name:t})=>({id:e,name:t}))},r)}async function H(e,t,r,a,o,n){let s=a.layers||[];const l=a.tables||[];if(\"Feature Collection\"===e.portalItem?.type?(s.forEach((e,t)=>{e.id=t,\"Table\"===e?.layerDefinition?.type&&l.push(e)}),s=s.filter(e=>\"Table\"!==e?.layerDefinition?.type)):(s.reverse(),l.reverse()),s.forEach(r=>{const o=n?.(r);if(o||!n){const n=M(e,t(r),a,r,o);e.add(n)}}),l.length){const t=r?null:await o.FeatureLayer();l.forEach(o=>{const s=n?.(o);if(s||!n){const n=M(e,r?r(o):t,a,o,s);e.tables.add(n)}})}}function M(e,t,r,a,o){const n=e.portalItem,s={portalItem:n.clone(),layerId:a.id};null!=a.url&&(s.url=a.url);const i=new t(s);if(\"sourceJSON\"in i&&(i.sourceJSON=o),\"subtype-group\"!==i.type&&\"catalog\"!==i.type&&(i.sublayerTitleMode=\"service-name\"),\"Feature Collection\"===n.type){const e={origin:\"portal-item\",portal:n.portal||l.getDefault()};i.read(a,e);const t=r.showLegend;null!=t&&i.read({showLegend:t},e)}return i}async function x(e,t,r){if(!1===e.supportsData)return{data:void 0};const a=e.instance,n=a.portalItem;if(!n)return{data:void 0};let s=null;try{s=await n.fetchData(\"json\",r)}catch(l){}if(C(a)){let e=null;const{count:r,preferredHost:l}=await G(n,s,t);if(o(n,l),(s?.layers||s?.tables)&&r>0){if(null==a.layerId){const e=p(a.type),t=e?.length?u(s,e)[0]:c(s);t&&(a.layerId=t.id)}e=k(s,a),\"OrientedImageryLayer\"===e?.layerType&&\"oriented-imagery\"===a.type&&a.supportedSourceTypes.add(\"Feature Layer\"),e&&null!=s.showLegend&&(e.showLegend=s.showLegend)}return r>1&&\"sublayerTitleMode\"in a&&\"service-name\"!==a.sublayerTitleMode&&(a.sublayerTitleMode=\"item-title-and-service-name\"),{data:e,preferredHost:l}}return{data:s}}async function G(e,r,a){if(r?.layers&&r?.tables)return{count:f(r)};const o=t(e.url);if(!o)return{count:1};const l=o.url.path,i=await a.fetchServiceMetadata(l,{customParameters:c(r)?.customParameters}).catch(()=>null);return{count:(r?.layers?.length??i?.layers?.length??0)+(r?.tables?.length??i?.tables?.length??0),preferredHost:s(e)?n():null}}function k(e,t){const{layerId:r}=t,a=e.layers?.find(e=>e.id===r)||e.tables?.find(e=>e.id===r);return a&&D(a,t)?a:null}function C(e){return\"stream\"!==e.type&&\"layerId\"in e}function D(e,t){const r=\"layerType\"in e&&e.layerType,{type:a}=t;return!(\"feature\"===a&&r&&\"ArcGISFeatureLayer\"!==e.layerType||\"catalog\"===a&&!r||\"oriented-imagery\"===a&&!r||\"subtype-group\"===a&&!r)}async function U(e,t){const{layersJSON:a,preferredHost:o}=await r(e,t);if(!a)return{provider:null,preferredHost:o};const n=[...a.layers,...a.tables];return{provider:e=>n.find(t=>t.id===e.id),preferredHost:o}}async function E(e,t){const{layers:r,tables:a}=e,o=[...r??[],...a??[]];if(!o.length)return;const n=new Set,s=[];for(const{layerType:p}of o){const e=p??\"ArcGISFeatureLayer\";if(n.has(e))continue;n.add(e);const r=t[m(e)];s.push(r())}const l=await Promise.all(s),i=new Map;return Array.from(n).forEach((e,t)=>{i.set(e,l[t])}),({layerType:e})=>{const t=e??\"ArcGISFeatureLayer\";return i.get(t)}}export{b as load};\n"],"names":["async","b","e","t","r","instance","portalItem","id","load","type","supportedTypes","includes","expectedType","join","v","validateItem","_l$readResourcePaths","o","url","n","title","s","l","i","a","sourceIsPortalItem","h","_n$readResourcePaths","fetchData","populateGroupLayer","read","context","resourceReferences","paths","readResourcePaths","T","layerModuleTypeMap","FeatureLayer","StreamLayer","SceneLayer","VideoLayer","concat","p","u","m","data","w","Promise","all","x","_o$layers2","I","H","layers","map","_ref","name","F","_c","c","customParameters","y","tables","length","Set","layerType","has","add","push","Map","Array","from","forEach","set","_ref4","get","E","provider","preferredHost","layersJSON","find","U","loadContext","d","f","_o$layers","_o$tables","P","j","S","applyPreferredHost","applyHostFromPortalItem","g","L","_e$portalItem","_e$layerDefinition","layerDefinition","filter","_e$layerDefinition2","reverse","M","clone","layerId","sourceJSON","sublayerTitleMode","origin","portal","getDefault","showLegend","supportsData","C","_s","_s2","count","_c2","_ref2","_r$layers$length","_r$layers","_i$layers","_ref3","_r$tables$length","_r$tables","_i$tables","path","fetchServiceMetadata","catch","G","_e","_e$layers","_e$tables","D","k","supportedSourceTypes"],"sourceRoot":""}